!function(){"use strict";frappe.templates.listing='<div class="frappe-list">  <div class="list-filters" style="display: none;">  </div>   <div style="margin-bottom:9px" class="list-toolbar-wrapper hide">   <div class="list-toolbar btn-group" style="display:inline-block; margin-right: 10px;">   </div>  </div>     <div style="clear:both"></div>  <div class="no-result text-center" style="display: none;">   {%= no_result_message %}  </div>  <div class="result">   <div class="list-headers"></div>         <div class="list-loading text-center">          {%= frappe.messages.get_waiting_message(__("Loading") + "..." ) %}         </div>   <div class="result-list"></div>  </div>  <div class="list-paging-area">   <div class="row">    <div class="col-xs-6">     <div class="btn-group btn-group-paging">      <button type="button" class="btn btn-default btn-sm btn-info" data-value="20">20</button>      <button type="button" class="btn btn-default btn-sm" data-value="100">100</button>      <button type="button" class="btn btn-default btn-sm" data-value="500">500</button>     </div>    </div>    <div class="col-xs-6 text-right">     <button class="btn btn-default btn-more btn-sm">{%= _more %}...</button>    </div>   </div>  </div> </div> ',frappe.has_indicator=function(t){return!!frappe.model.is_submittable(t)||(!(!(frappe.listview_settings[t]||{}).get_indicator&&!frappe.workflow.get_state_fieldname(t))||!(!frappe.meta.has_field(t,"enabled")&&!frappe.meta.has_field(t,"disabled")))},frappe.get_indicator=function(t,e){if(t.__unsaved)return[__("Not Saved"),"orange"];e||(e=t.doctype);var i=frappe.workflow.workflows[e],s=!i||i.override_status,a=frappe.listview_settings[e]||{},r=frappe.model.is_submittable(e),n=frappe.workflow.get_state_fieldname(e);if(n&&!s){var l=t[n];if(l){var o="";if(locals["Workflow State"][l]&&locals["Workflow State"][l].style)o={Success:"green",Warning:"orange",Danger:"red",Primary:"blue",Inverse:"black",Info:"light-blue"}[locals["Workflow State"][l].style];return o||(o="gray"),[__(l),o,n+",=,"+l]}}if(r&&0==t.docstatus&&!a.has_indicator_for_draft)return[__("Draft"),"red","docstatus,=,0"];if(r&&2==t.docstatus&&!a.has_indicator_for_cancelled)return[__("Cancelled"),"red","docstatus,=,2"];if(a.get_indicator){var d=a.get_indicator(t);if(d)return d}return r&&1==t.docstatus?[__("Submitted"),"blue","docstatus,=,1"]:t.status?[__(t.status),frappe.utils.guess_colour(t.status)]:frappe.meta.has_field(e,"enabled")?t.enabled?[__("Enabled"),"blue","enabled,=,1"]:[__("Disabled"),"grey","enabled,=,0"]:frappe.meta.has_field(e,"disabled")?t.disabled?[__("Disabled"),"grey","disabled,=,1"]:[__("Enabled"),"blue","disabled,=,0"]:void 0},frappe.ui.Filter=class{constructor(t){$.extend(this,t),null!==this.value&&void 0!==this.value||(this.value=""),this.utils=frappe.ui.filter_utils,this.set_conditions(),this.set_conditions_from_config(),this.make()}set_conditions(){var t;this.conditions=[["=",__("Equals")],["!=",__("Not Equals")],["like",__("Like")],["not like",__("Not Like")],["in",__("In")],["not in",__("Not In")],["is",__("Is")],[">",">"],["<","<"],[">=",">="],["<=","<="],["Between",__("Between")],["Timespan",__("Timespan")]],this.nested_set_conditions=[["descendants of",__("Descendants Of")],["not descendants of",__("Not Descendants Of")],["ancestors of",__("Ancestors Of")],["not ancestors of",__("Not Ancestors Of")]],(t=this.conditions).push.apply(t,this.nested_set_conditions),this.invalid_condition_map={Date:["like","not like"],Datetime:["like","not like"],Data:["Between","Timespan"],Select:["like","not like","Between","Timespan"],Link:["Between","Timespan",">","<",">=","<="],Currency:["Between","Timespan"],Color:["Between","Timespan"],Check:this.conditions.map(function(t){return t[0]}).filter(function(t){return"="!==t})}}set_conditions_from_config(){if(frappe.boot.additional_filters_config){this.filters_config=frappe.boot.additional_filters_config;for(var t=0,e=Object.keys(this.filters_config);t<e.length;t+=1){var i=e[t],s=this.filters_config[i];this.conditions.push([i,__(s.label)]);for(var a=0,r=Object.keys(this.invalid_condition_map);a<r.length;a+=1){var n=r[a];s.valid_for_fieldtypes.includes(n)||this.invalid_condition_map[n].push(i)}}}}make(){this.filter_edit_area=$(frappe.render_template("edit_filter",{conditions:this.conditions})),this.parent&&this.filter_edit_area.appendTo(this.parent.find(".filter-edit-area")),this.make_select(),this.set_events(),this.setup()}make_select(){var t=this;this.fieldselect=new frappe.ui.FieldSelect({parent:this.filter_edit_area.find(".fieldname-select-area"),doctype:this.parent_doctype,parent_doctype:this._parent_doctype,filter_fields:this.filter_fields,input_class:"input-xs",select:function(e,i){t.set_field(e,i)}}),this.fieldname&&this.fieldselect.set_value(this.doctype,this.fieldname)}set_events(){var t=this;this.filter_edit_area.find("span.remove-filter").on("click",function(){t.remove(),t.on_change()}),this.filter_edit_area.find(".condition").change(function(){if(t.field){var e=t.get_condition(),i=null;["in","like","not in","not like"].includes(e)?(i="Data",t.add_condition_help(e)):t.filter_edit_area.find(".filter-description").empty(),["Select","MultiSelect"].includes(t.field.df.fieldtype)&&["in","not in"].includes(e)&&(i="MultiSelect"),t.set_field(t.field.df.parent,t.field.df.fieldname,i,e)}})}setup(){var t=this.fieldname||"name";return this.set_values(this.doctype,t,this.condition,this.value)}setup_state(t){var e=this,i=Promise.resolve();t?this.filter_edit_area.addClass("new-filter"):i=this.update_filter_tag(),this.hidden&&i.then(function(){return e.$filter_tag.hide()})}freeze(){this.update_filter_tag()}update_filter_tag(){var t=this;return this._filter_value_set?this._filter_value_set.then(function(){t.$filter_tag?t.set_filter_button_text():t.make_tag(),t.filter_edit_area.hide()}):Promise.resolve()}remove(){this.filter_edit_area.remove(),this.field=null}set_values(t,e,i,s){if(!1!==this.set_field(t,e))return"Check"===this.field.df.original_type&&(s=1==s?"Yes":"No"),i&&this.set_condition(i,!0),this._filter_value_set=Promise.resolve(),["in","not in"].includes(i)&&Array.isArray(s)&&(s=s.join(",")),Array.isArray(s)?this._filter_value_set=this.field.set_value(s):void 0===s&&null===s||(this._filter_value_set=this.field.set_value((s+"").trim())),this._filter_value_set}set_field(t,e,i,s){var a=this,r={};if(this.field)for(var n in this.field.df)r[n]=this.field.df[n];var l=(this.fieldselect.fields_by_name[t]||{})[e];if(!l)return console.warn("Field "+e+" is not selectable."),this.remove(),!1;var o=copy_dict(l);o.read_only=0,o.hidden=0,o.is_filter=!0,delete o.hidden_due_to_dependency;var d=s||this.utils.get_default_condition(o);if(this.set_condition(d),this.utils.set_fieldtype(o,i,this.get_condition()),!this.field||r.fieldname!=e||o.fieldtype!=r.fieldtype||o.parent!=r.parent||o.options!=r.options)if(this.fieldselect.selected_doctype=t,this.fieldselect.selected_fieldname=e,this.filters_config&&this.filters_config[s]&&this.filters_config[s].valid_for_fieldtypes.includes(o.fieldtype)){var _={};if(this.filters_config[s].depends_on){var p=this.filters_config[s].depends_on,c=this.filter_list.get_filter_value(e);_[p]=c}frappe.xcall(this.filters_config[s].get_field,_).then(function(t){o.fieldtype=t.fieldtype,o.options=t.options,o.fieldname=e,a.make_field(o,r.fieldtype)})}else this.make_field(o,r.fieldtype)}make_field(t,e){var i=this.field?this.field.get_value():null;this.hide_invalid_conditions(t.fieldtype,t.original_type),this.toggle_nested_set_conditions(t);var s=this.filter_edit_area.find(".filter-field").empty().get(0);t.input_class="input-xs";var a=frappe.ui.form.make_control({df:t,parent:s,only_input:!0});a.refresh(),this.field=a,i&&a.fieldtype===e&&this.field.set_value(i),this.bind_filter_field_events()}bind_filter_field_events(){var t=this;this.field.$input.on("focusout",function(){return t.on_change()}),$(this.field.wrapper).find(":input").keydown(function(e){13==e.which&&"MultiSelect"!==t.field.df.fieldtype&&t.on_change()})}get_value(){return[this.fieldselect.selected_doctype,this.field.df.fieldname,this.get_condition(),this.get_selected_value(),this.hidden]}get_selected_value(){return this.utils.get_selected_value(this.field,this.get_condition())}get_condition(){return this.filter_edit_area.find(".condition").val()}set_condition(t,e){void 0===e&&(e=!1);var i=this.filter_edit_area.find(".condition");i.val(t),e&&i.change()}add_condition_help(t){var e=["in","not in"].includes(t)?__("values separated by commas"):__("use % as wildcard");this.filter_edit_area.find(".filter-description").html(e)}make_tag(){this.field&&(this.$filter_tag=this.get_filter_tag_element().insertAfter(this.parent.find(".active-tag-filters .clear-filters")),this.set_filter_button_text(),this.bind_tag())}bind_tag(){var t=this;this.$filter_tag.find(".remove-filter").on("click",this.remove.bind(this));var e=this.$filter_tag.find(".toggle-filter");e.on("click",function(){e.closest(".tag-filters-area").find(".filter-edit-area").show(),t.filter_edit_area.toggle()})}set_filter_button_text(){this.$filter_tag.find(".toggle-filter").html(this.get_filter_button_text())}get_filter_button_text(){var t=this.utils.get_formatted_value(this.field,this.get_selected_value());return __(this.field.df.label)+" "+__(this.get_condition())+" "+__(t)}get_filter_tag_element(){return $('<div class="filter-tag btn-group">\n\t\t\t<button class="btn btn-default btn-xs toggle-filter"\n\t\t\t\ttitle="'+__("Edit Filter")+'">\n\t\t\t</button>\n\t\t\t<button class="btn btn-default btn-xs remove-filter"\n\t\t\t\ttitle="'+__("Remove Filter")+'">\n\t\t\t\t'+frappe.utils.icon("close")+"\n\t\t\t</button>\n\t\t</div>")}hide_invalid_conditions(t,e){for(var i=this.invalid_condition_map[e]||this.invalid_condition_map[t]||[],s=0,a=this.conditions;s<a.length;s+=1){var r=a[s];this.filter_edit_area.find('.condition option[value="'+r[0]+'"]').toggle(!i.includes(r[0]))}}toggle_nested_set_conditions(t){var e=this,i="Link"===t.fieldtype&&frappe.boot.nested_set_doctypes.includes(t.options);this.nested_set_conditions.forEach(function(t){e.filter_edit_area.find('.condition option[value="'+t[0]+'"]').toggle(i)})}},frappe.ui.filter_utils={get_formatted_value:function(t,e){return"docstatus"===t.df.fieldname?e={0:"Draft",1:"Submitted",2:"Cancelled"}[e]||e:"Check"===t.df.original_type&&(e={0:"No",1:"Yes"}[cint(e)]),frappe.format(e,t.df,{only_value:1})},get_selected_value:function(t,e){if(t){var i=t.get_value();return"string"==typeof i&&(i=strip(i)),"is"!=e||i||(i=t.df.options[0].value),"Check"==t.df.original_type&&(i="Yes"==i?1:0),-1!==e.indexOf("like","not like")?!i||i.startsWith("%")||i.endsWith("%")||(i="%"+i+"%"):in_list(["in","not in"],e)&&i&&(i=i.split(",").map(function(t){return strip(t)})),"%"===i&&(i=""),i}},get_default_condition:function(t){return"Data"==t.fieldtype?"like":"Date"==t.fieldtype||"Datetime"==t.fieldtype?"Between":"="},set_fieldtype:function(t,e,i){t.original_type?t.fieldtype=t.original_type:t.original_type=t.fieldtype,t.description="",t.reqd=0,t.ignore_link_validation=!0,e?t.fieldtype=e:("docstatus"==t.fieldname?(t.fieldtype="Select",t.options=[{value:0,label:__("Draft")},{value:1,label:__("Submitted")},{value:2,label:__("Cancelled")}]):"Check"==t.fieldtype?(t.fieldtype="Select",t.options="No\nYes"):-1!=["Text","Small Text","Text Editor","Code","Markdown Editor","HTML Editor","Tag","Comments","Dynamic Link","Read Only","Assign","Color"].indexOf(t.fieldtype)?t.fieldtype="Data":"Link"==t.fieldtype&&-1==["=","!=","descendants of","ancestors of","not descendants of","not ancestors of"].indexOf(i)&&(t.fieldtype="Data"),"Data"===t.fieldtype&&"email"===(t.options||"").toLowerCase()&&(t.options=null),"Between"!=i||"Date"!=t.fieldtype&&"Datetime"!=t.fieldtype||(t.fieldtype="DateRange"),"Timespan"==i&&["Date","Datetime","DateRange","Select"].includes(t.fieldtype)&&(t.fieldtype="Select",t.options=this.get_timespan_options(["Last","Yesterday","Today","Tomorrow","This","Next"])),"is"===i&&(t.fieldtype="Select",t.options=[{label:__("Set",null,"Field value is set"),value:"set"},{label:__("Not Set",null,"Field value is not set"),value:"not set"}]))},get_timespan_options:function(t){var e={Last:["Week","Month","Quarter","6 months","Year"],This:["Week","Month","Quarter","Year"],Next:["Week","Month","Quarter","6 months","Year"]},i=[];return t.forEach(function(t){e[t]?e[t].forEach(function(e){i.push({label:t+" "+e,value:t.toLowerCase()+" "+e.toLowerCase()})}):i.push({label:__(t),value:""+t.toLowerCase()})}),i}},frappe.ui.FilterGroup=class{constructor(t){$.extend(this,t),this.filters=[],window.fltr=this,this.filter_button?this.make_popover():(this.wrapper=this.parent,this.wrapper.append(this.get_filter_area_template()),this.set_filter_events())}make_popover(){this.init_filter_popover(),this.set_popover_events()}init_filter_popover(){this.filter_button.popover({content:this.get_filter_area_template(),template:'\n\t\t\t\t<div class="filter-popover popover">\n\t\t\t\t\t<div class="arrow"></div>\n\t\t\t\t\t<div class="popover-body popover-content">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t',html:!0,trigger:"manual",container:"body",placement:"bottom",offset:"-100px 0"})}toggle_empty_filters(t){this.wrapper&&this.wrapper.find(".empty-filters").toggle(t)}set_popover_events(){var t=this;$(document.body).on("click",function(e){if(t.wrapper&&t.wrapper.is(":visible")){var i=$(e.target).is(".datepicker--cell")||0!==$(e.target).closest(".datepicker--nav-title").length||0!==$(e.target).parents(".datepicker--nav-action").length;0!==$(e.target).parents(".filter-popover").length||0!==$(e.target).parents(".filter-box").length||0!==t.filter_button.find($(e.target)).length||$(e.target).is(t.filter_button)||i||t.wrapper&&t.filter_button.popover("hide")}}),this.filter_button.on("click",function(){t.filter_button.popover("toggle")}),this.filter_button.on("shown.bs.popover",function(){var e=t.filters&&t.filters.length>0;t.wrapper||(t.wrapper=$(".filter-popover"),e&&(t.toggle_empty_filters(!1),t.add_filters_to_popover(t.filters)),t.set_filter_events()),t.toggle_empty_filters(!1),!e&&t.add_filter(t.doctype,"name")}),this.filter_button.on("hidden.bs.popover",function(){t.apply()}),frappe.router.on("change",function(){t.wrapper&&t.wrapper.is(":visible")&&t.filter_button.popover("hide")})}add_filters_to_popover(t){var e=this;t.forEach(function(t){t.parent=e.wrapper,t.field=null,t.make()})}apply(){this.update_filters(),this.on_change()}update_filter_button(){var t=this.filters.length>0,e=t?this.filters.length>1?__("{0} filters",[this.filters.length]):__("{0} filter",[this.filters.length]):__("Filter");this.filter_button.toggleClass("btn-default",!t).toggleClass("btn-primary-light",t),this.filter_button.find(".filter-icon").toggleClass("active",t),this.filter_button.find(".button-label").html(e)}set_filter_events(){var t=this;this.wrapper.find(".add-filter").on("click",function(){t.toggle_empty_filters(!1),t.add_filter(t.doctype,"name")}),this.wrapper.find(".clear-filters").on("click",function(){t.toggle_empty_filters(!0),t.clear_filters(),t.on_change()}),this.wrapper.find(".apply-filters").on("click",function(){t.filter_button.popover("hide")})}add_filters(t){for(var e=this,i=[],s=function(){var t=r[a];i.push(function(){var i;return(i=e).add_filter.apply(i,t)})},a=0,r=t;a<r.length;a+=1)s();return frappe.run_serially(i).then(function(){return e.update_filters()})}add_filter(t,e,i,s,a){if(!e)return Promise.resolve();if(!this.validate_args(t,e))return!1;var r=arguments.length<2;if(r&&this.wrapper.find(".new-filter:visible").length)return Promise.resolve();var n=[t,e,i,s,a],l=this.push_new_filter(n,r);return l&&l.then?l:Promise.resolve()}validate_args(t,e){return!(t&&e&&!frappe.meta.has_field(t,e)&&!frappe.model.std_fields_list.includes(e))||(frappe.msgprint({message:__("Invalid filter: {0}",[e.bold()]),indicator:"red"}),!1)}push_new_filter(t){var e;if(!this.filter_exists(t)){var i=(e=this)._push_new_filter.apply(e,t);return i&&i.value?i._filter_value_set:void 0}}_push_new_filter(t,e,i,s,a){var r=this;void 0===a&&(a=!1);var n={parent:this.wrapper,parent_doctype:this.doctype,doctype:t,_parent_doctype:this.parent_doctype,fieldname:e,condition:i,value:s,hidden:a,index:this.filters.length+1,on_change:function(t){t&&r.update_filters(),r.on_change()},filter_items:function(t,e){return!r.filter_exists([t,e])},filter_list:this.base_list||this},l=new frappe.ui.Filter(n);return this.filters.push(l),l}get_filter_value(t){return(this.filters.find(function(e){return e.fieldname==t})||{}).value}filter_exists(t){var e=!1;return this.filters.filter(function(t){return t.field}).map(function(i){var s=i.get_value();if(2!==t.length){var a=t[3],r=frappe.utils.arrays_equal;(r(s.slice(0,4),t.slice(0,4))||Array.isArray(a)&&r(a,s[3]))&&(e=!0)}else e=t[0]===s[0]&&t[1]===s[1]}),e}get_filters(){return this.filters.filter(function(t){return t.field}).map(function(t){return t.get_value()})}update_filters(){var t=function(t){return![void 0,null].includes(t.get_selected_value())};this.filters.map(function(e){return!t(e)&&e.remove()}),this.filters=this.filters.filter(function(e){return t(e)&&e.field}),this.update_filter_button(),0===this.filters.length&&this.toggle_empty_filters(!0)}clear_filters(){this.filters.map(function(t){return t.remove(!0)}),this.filters=[]}get_filter(t){return this.filters.filter(function(e){return e.field&&e.field.df.fieldname==t})[0]}get_filter_area_template(){return $('\n\t\t\t<div class="filter-area">\n\t\t\t\t<div class="filter-edit-area">\n\t\t\t\t\t<div class="text-muted empty-filters text-center">\n\t\t\t\t\t\t'+__("No filters selected")+'\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<hr class="divider"></hr>\n\t\t\t\t<div class="filter-action-buttons">\n\t\t\t\t\t<button class="text-muted add-filter btn btn-xs">\n\t\t\t\t\t\t+ '+__("Add a Filter")+'\n\t\t\t\t\t</button>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<button class="btn btn-secondary btn-xs clear-filters">\n\t\t\t\t\t\t\t'+__("Clear Filters")+"\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t"+(this.filter_button?'<button class="btn btn-primary btn-xs apply-filters">\n\t\t\t\t\t\t\t\t'+__("Apply Filters")+"\n\t\t\t\t\t\t\t</button>":"")+"\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>")}get_filters_as_object(){return this.get_filters().reduce(function(t,e){var i;return Object.assign(t,((i={})[e[1]]=[e[2],e[3]],i))},{})}add_filters_to_filter_group(t){var e=this;t.length&&(this.toggle_empty_filters(!1),t.forEach(function(t){e.add_filter(t[0],t[1],t[2],t[3])}))}add(t,e){var i=this;if(void 0===e&&(e=!0),!t||Array.isArray(t)&&0===t.length)return Promise.resolve();"string"==typeof t[0]&&(t=[Array.from(arguments)]);t=t.filter(function(t){return!i.exists(t)});var s=this.set_standard_filter(t),a=s.non_standard_filters;return s.promise.then(function(){return a.length>0&&i.filter_list.add_filters(a)}).then(function(){e&&i.list_view.refresh()})}},frappe.ui.FieldSelect=Class.extend({init:function(t){var e=this;if($.extend(this,t),this.fields_by_name={},this.options=[],this.$input=$('<input class="form-control">').appendTo(this.parent).on("click",function(){$(this).select()}),this.input_class&&this.$input.addClass(this.input_class),this.select_input=this.$input.get(0),this.awesomplete=new Awesomplete(this.select_input,{minChars:0,maxItems:99,autoFirst:!0,list:e.options,item:function(t){return $(repl('<li class="filter-field-select"><p>%(label)s</p></li>',t)).data("item.autocomplete",t).get(0)}}),this.$input.on("awesomplete-select",function(t){var i=t.originalEvent.text.value,s=e.awesomplete.get_item(i);e.selected_doctype=s.doctype,e.selected_fieldname=s.fieldname,e.select&&e.select(s.doctype,s.fieldname)}),this.$input.on("awesomplete-selectcomplete",function(t){var i=t.originalEvent.text.value,s=e.awesomplete.get_item(i);e.$input.val(s.label)}),this.filter_fields)for(var i in this.filter_fields)this.add_field_option(this.filter_fields[i]);else this.build_options();this.set_value(this.doctype,"name")},get_value:function(){return this.selected_doctype?this.selected_doctype+"."+this.selected_fieldname:null},val:function(t){if(void 0===t)return this.get_value();this.set_value(t)},clear:function(){this.selected_doctype=null,this.selected_fieldname=null,this.$input.val("")},set_value:function(t,e){var i=this;if(this.clear(),t){if(-1!==t.indexOf(".")){var s=t.split(".");t=s[0],e=s[1]}$.each(this.options,function(s,a){if(a.doctype===t&&a.fieldname===e)return i.selected_doctype=t,i.selected_fieldname=e,i.$input.val(a.label),!1})}},build_options:function(){var t=this;t.table_fields=[];var e=$.map(frappe.model.std_fields,function(e){var i={parent:t.doctype};return"name"==e.fieldname&&(i.options=t.doctype),$.extend(copy_dict(e),i)}),i=locals.DocType[t.doctype];i&&cint(i.istable)&&(e=e.concat([{fieldname:"parent",fieldtype:"Data",label:"Parent",parent:t.doctype}])),this.with_blank&&this.options.push({label:"",value:""});var s=e.concat(frappe.meta.docfield_list[t.doctype]);$.each(frappe.utils.sort(s,"label","string"),function(e,i){var s=frappe.get_meta(t.doctype).istable&&t.parent_doctype?t.parent_doctype:t.doctype;frappe.perm.has_perm(s,i.permlevel,"read")&&t.add_field_option(i)}),$.each(t.table_fields,function(e,i){if(i.options){var s=[].concat(frappe.meta.docfield_list[i.options]);if("Table MultiSelect"===i.fieldtype){var a=frappe.meta.get_docfields(i.options).find(function(t){return"Link"===t.fieldtype});s=a?[a]:[]}$.each(frappe.utils.sort(s,"label","string"),function(e,i){var s=frappe.get_meta(t.doctype).istable&&t.parent_doctype?t.parent_doctype:t.doctype;frappe.perm.has_perm(s,i.permlevel,"read")&&t.add_field_option(i)})}})},add_field_option:function(t){var e=this;if("docstatus"!=t.fieldname||frappe.model.is_submittable(e.doctype))if(frappe.model.table_fields.includes(t.fieldtype))e.table_fields.push(t);else{var i=null,s=null;e.doctype&&t.parent==e.doctype?(i=__(t.label),s=e.doctype):(i=__(t.label)+" ("+__(t.parent)+")",s=t.parent),-1!=frappe.model.no_value_type.indexOf(t.fieldtype)||e.fields_by_name[t.parent]&&e.fields_by_name[t.parent][t.fieldname]||(this.options.push({label:i,value:s+"."+t.fieldname,fieldname:t.fieldname,doctype:t.parent}),e.fields_by_name[t.parent]||(e.fields_by_name[t.parent]={}),e.fields_by_name[t.parent][t.fieldname]=t)}}}),frappe.templates.edit_filter='<div class="filter-box">  <div class="visible-xs flex justify-flex-end">   <span class="remove-filter">    {{ __("Remove") }}   </span>  </div>  <div class="list_filter row">   <div class="fieldname-select-area col-sm-4 ui-front form-group"></div>   <div class="col-sm-3 form-group">    <select class="condition form-control input-xs">     {% for condition in conditions %}     <option value="{{condition[0]}}">{{ condition[1] }}</option>     {% endfor %}    </select>   </div>   <div class="col-sm-4 form-group">    <div class="filter-field"></div>    <div class="text-muted small filter-description"></div>   </div>   <div class="col-sm-1 text-center hidden-xs">    <span class="remove-filter">     <svg class="icon icon-sm">      <use href="#icon-close" class="close"></use>     </svg>    </span>   </div>  </div> </div> ',frappe.ui.Tags=class{constructor(t){var e=t.parent,i=t.placeholder,s=t.tagsList,a=t.onTagAdd,r=t.onTagRemove,n=t.onTagClick,l=t.onChange;this.tagsList=s||[],this.onTagAdd=a,this.onTagRemove=r,this.onTagClick=n,this.onChange=l,this.setup(e,i)}setup(t,e){this.$ul=t,this.$input=$('<input class="tags-input form-control"></input>'),this.$inputWrapper=this.get_list_element(this.$input),this.$placeholder=this.get_list_element($('<span class="tags-placeholder text-muted">'+e+"</span>")),this.$inputWrapper.appendTo(this.$ul),this.$placeholder.appendTo(this.$ul),this.deactivate(),this.bind(),this.boot()}bind(){var t=this,e=this,i=function(){var t=frappe.utils.xss_sanitise(e.$input.val());e.addTag(t),e.$input.val("")};this.$input.keypress(function(t){13!=t.which&&13!=t.keyCode||i()}),this.$input.focusout(i),this.$input.on("blur",function(){t.deactivate()}),this.$placeholder.on("click",function(){t.activate(),t.$input.focus()})}boot(){this.addTags(this.tagsList)}activate(){this.$placeholder.hide(),this.$inputWrapper.show()}deactivate(){this.$inputWrapper.hide(),this.$placeholder.show()}addTag(t){if(t&&""!==t&&!this.tagsList.includes(t)){var e=this.get_tag(t);this.get_list_element(e,"form-tag-row").insertBefore(this.$inputWrapper),this.tagsList.push(t),this.onTagAdd&&this.onTagAdd(t)}}removeTag(t){t=frappe.utils.xss_sanitise(t),this.tagsList.includes(t)&&(this.tagsList.splice(this.tagsList.indexOf(t),1),this.onTagRemove&&this.onTagRemove(t))}addTags(t){t.map(this.addTag.bind(this))}clearTags(){this.$ul.find(".form-tag-row").remove(),this.tagsList=[]}get_list_element(t,e){void 0===e&&(e="");var i=$('<li class="'+e+'"></li>');return t.appendTo(i),i}get_tag(t){var e=this,i=frappe.get_data_pill(t,t,function(t,i){e.removeTag(t),i.closest(".form-tag-row").remove()});return this.onTagClick&&i.on("click",".pill-label",function(){e.onTagClick(t)}),i}},frappe.ui.TagEditor=Class.extend({init:function(t){$.extend(this,t),this.setup_tags(),this.user_tags||(this.user_tags=""),this.initialized=!0,this.refresh(this.user_tags)},setup_tags:function(){var t=this;this.parent&&(this.wrapper=this.parent,this.wrapper.length&&(this.tags=new frappe.ui.Tags({parent:this.wrapper,placeholder:__("Add a tag ..."),onTagAdd:function(e){if(t.initialized&&!t.refreshing)return frappe.call({method:"frappe.desk.doctype.tag.tag.add_tag",args:t.get_args(e),callback:function(i){var s=t.user_tags?t.user_tags.split(","):[];s.push(e),t.user_tags=s.join(","),t.on_change&&t.on_change(t.user_tags),frappe.tags.utils.fetch_tags()}})},onTagRemove:function(e){if(!t.refreshing)return frappe.call({method:"frappe.desk.doctype.tag.tag.remove_tag",args:t.get_args(e),callback:function(i){var s=t.user_tags.split(",");s.splice(s.indexOf(e),1),t.user_tags=s.join(","),t.on_change&&t.on_change(t.user_tags),frappe.tags.utils.fetch_tags()}})}}),this.setup_awesomplete(),this.setup_complete=!0))},setup_awesomplete:function(){var t=this,e=this.wrapper.find("input.tags-input"),i=e.get(0);this.awesomplete=new Awesomplete(i,{minChars:0,maxItems:99,list:[]}),e.on("awesomplete-open",function(t){e.attr("state","open")}),e.on("awesomplete-close",function(t){e.attr("state","closed")}),e.on("input",function(e){var i=e.target.value;frappe.call({method:"frappe.desk.doctype.tag.tag.get_tags",args:{doctype:t.frm.doctype,txt:i.toLowerCase()},callback:function(e){t.awesomplete.list=e.message}})}),e.on("focus",function(t){"open"!=e.attr("state")&&e.trigger("input")})},get_args:function(t){return{tag:t,dt:this.frm.doctype,dn:this.frm.docname}},refresh:function(t){var e=this;if(this.initialized&&this.setup_complete&&!this.refreshing){e.refreshing=!0;try{e.tags.clearTags(),t&&(e.user_tags=t,e.tags.addTags(t.split(",")))}catch(t){e.refreshing=!1,setTimeout(function(){e.refresh()},100)}e.refreshing=!1}}}),frappe.ui.is_liked=function(t){return-1!==frappe.ui.get_liked_by(t).indexOf(frappe.session.user)},frappe.ui.get_liked_by=function(t){var e=t._liked_by;return e&&(e=JSON.parse(e)),e||[]},frappe.ui.toggle_like=function(t,e,i,s){var a=t.hasClass("not-liked")?"Yes":"No";t.css("pointer-events","none"),frappe.call({method:"frappe.desk.like.toggle_like",quiet:!0,args:{doctype:e,name:i,add:a},callback:function(r){if(t.css("pointer-events","auto"),!r.exc){var n=$('.like-action[data-name="'+i.replace(/"/g,'"')+'"][data-doctype="'+e.replace(/"/g,'"')+'"]');"Yes"===a?n.removeClass("not-liked").addClass("liked"):n.addClass("not-liked").removeClass("liked");var l=locals[e]&&locals[e][i];if(l){var o=JSON.parse(l._liked_by||"[]"),d=o.indexOf(frappe.session.user);"Yes"===a?-1===d&&o.push(frappe.session.user):-1!==d&&(o=o.slice(0,d).concat(o.slice(d+1))),l._liked_by=JSON.stringify(o)}s&&s()}}})},frappe.ui.click_toggle_like=function(){var t=$(this),e=t.siblings(".likes-count"),i=t.hasClass("not-liked"),s=t.attr("data-doctype"),a=t.attr("data-name");return frappe.ui.toggle_like(t,s,a,function(){i?e.text(cint(e.text())+1):e.text(cint(e.text())-1)}),!1},frappe.ui.setup_like_popover=function(t,e,i){void 0===i&&(i=!0),frappe.dom.is_touchscreen()||t.on("mouseover",e,function(){var t=$(this);t.popover({animation:!0,placement:"bottom",trigger:"manual",template:'<div class="liked-by-popover popover">\n\t\t\t\t<div class="arrow"></div>\n\t\t\t\t<div class="popover-body popover-content"></div>\n\t\t\t</div>',content:function(){var e=t.parents(".liked-by").attr("data-liked-by");e=e?decodeURI(e):"[]",e=JSON.parse(e);var s=frappe.session.user;if(i&&(t.parents(".liked-by").find(".not-liked").length?-1!==e.indexOf(s)&&e.splice(e.indexOf(s),1):-1===e.indexOf(s)&&e.push(s)),!e.length)return"";var a=$('<ul class="list-unstyled"></ul>');return e.forEach(function(t){a.append("\n\t\t\t\t\t\t<li data-user="+t+">"+frappe.avatar(t,"avatar-xs")+"\n\t\t\t\t\t\t\t<span>"+frappe.user.full_name(t)+"</span>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t")}),a.children("li").click(function(e){var i=e.currentTarget.dataset.user;t.popover("hide"),frappe.set_route("/app/user-profile/"+i)}),a},html:!0,container:"body"}),t.popover("show"),$(".popover").on("mouseleave",function(){t.popover("hide")}),t.on("mouseout",function(){setTimeout(function(){$(".popover:hover").length||t.popover("hide")},100)})})},frappe.templates.print_template='<!DOCTYPE html> <html lang="{{ lang }}" dir="{{ layout_direction }}"> <head>  <meta charset="utf-8">  <meta http-equiv="X-UA-Compatible" content="IE=edge">  <meta name="viewport" content="width=device-width, initial-scale=1">  <meta name="description" content="">  <meta name="author" content="">  <title>{{ title }}</title>  {{ frappe.assets.include_style("printview.css", base_url, frappe.utils.is_rtl(lang)) }}  <style>   {{ print_css }}  </style> </head> <body>  <div class="print-format-gutter">   {% if print_settings.repeat_header_footer %}    <div id="footer-html" class="visible-pdf">     {% if print_settings.letter_head && print_settings.letter_head.footer %}      <div class="letter-head-footer">       {{ print_settings.letter_head.footer }}      </div>     {% endif %}     <p class="text-center small page-number visible-pdf">      {{ __("Page {0} of {1}", [`<span class="page"></span>`, `<span class="topage"></span>`]) }}     </p>    </div>   {% endif %}    <div class="print-format {% if landscape %} landscape {% endif %}"     {% if columns.length > 20 %}      style="font-size: 4.0pt"     {% endif %}    >    {% if print_settings.letter_head %}    <div {% if print_settings.repeat_header_footer %} id="header-html" class="hidden-pdf" {% endif %}>     <div class="letter-head">{{ print_settings.letter_head.header }}</div>    </div>    {% endif %}    {{ content }}   </div>  </div> </body> </html> ',frappe.provide("frappe.views"),frappe.views.BaseList=class{constructor(t){Object.assign(this,t)}show(){var t=this;frappe.run_serially([function(){return t.init()},function(){return t.before_refresh()},function(){return t.refresh()}])}init(){var t=this;if(this.init_promise)return this.init_promise;var e=[this.setup_defaults,this.set_stats,this.setup_fields,this.setup_page,this.setup_side_bar,this.setup_main_section,this.setup_view,this.setup_view_menu].map(function(e){return e.bind(t)});return this.init_promise=frappe.run_serially(e),this.init_promise}setup_defaults(){var t=this;this.page_name=frappe.get_route_str(),this.page_title=this.page_title||frappe.router.doctype_layout||__(this.doctype),this.meta=frappe.get_meta(this.doctype),this.settings=frappe.listview_settings[this.doctype]||{},this.user_settings=frappe.get_user_settings(this.doctype),this.start=0,this.page_length=20,this.data=[],this.method="frappe.desk.reportview.get",this.can_create=frappe.model.can_create(this.doctype),this.can_write=frappe.model.can_write(this.doctype),this.fields=[],this.filters=[],this.sort_by="modified",this.sort_order="desc",this.primary_action=null,this.secondary_action=null,this.menu_items=[{label:__("Refresh"),action:function(){return t.refresh()},class:"visible-xs"}]}setup_fields(){this.set_fields(),this.build_fields()}set_fields(){var t=this;[].concat(frappe.model.std_fields_list,this.meta.title_field).forEach(function(e){return t._add_field(e)})}get_fields_in_list_view(){var t=this;return this.meta.fields.filter(function(e){return frappe.model.is_value_type(e.fieldtype)&&e.in_list_view&&frappe.perm.has_perm(t.doctype,e.permlevel,"read")||"Currency"===e.fieldtype&&e.options&&!e.options.includes(":")||"status"===e.fieldname})}build_fields(){var t=this;this.fields=this.fields.map(function(e){return"string"==typeof e&&(e=[e,t.doctype]),e}),this.fields=this.fields.filter(Boolean),this.fields=this.fields.uniqBy(function(t){return t[0]+t[1]})}_add_field(t,e){if(t){if(e||(e=this.doctype),"object"==typeof t){var i=t;t=i.fieldname,e=i.parent}this.fields||(this.fields=[]),(frappe.model.std_fields_list.includes(t)||frappe.meta.has_field(e,t)||"_seen"===t)&&this.fields.push([t,e])}}set_stats(){this.stats=["_user_tags"],this.workflow_state_fieldname=frappe.workflow.get_state_fieldname(this.doctype),this.workflow_state_fieldname&&(frappe.workflow.workflows[this.doctype].override_status||this._add_field(this.workflow_state_fieldname),this.stats.push(this.workflow_state_fieldname))}setup_page(){this.page=this.parent.page,this.$page=$(this.parent),!this.hide_card_layout&&this.page.main.addClass("frappe-card"),this.page.page_form.removeClass("row").addClass("flex"),this.hide_page_form&&this.page.page_form.hide(),this.hide_sidebar&&this.$page.addClass("no-list-sidebar"),this.setup_page_head()}setup_page_head(){this.set_title(),this.set_menu_items(),this.set_breadcrumbs()}set_title(){this.page.set_title(this.page_title)}setup_view_menu(){var t={Image:"image-view",List:"list",Report:"small-file",Calendar:"calendar",Gantt:"gantt",Kanban:"kanban",Dashboard:"dashboard",Map:"map"};frappe.boot.desk_settings.view_switcher&&(this.views_menu=this.page.add_custom_button_group(__("{0} View",[this.view_name]),t[this.view_name]||"list"),this.views_list=new frappe.views.ListViewSelect({doctype:this.doctype,parent:this.views_menu,page:this.page,list_view:this,sidebar:this.list_sidebar,icon_map:t}))}set_default_secondary_action(){var t=this;if(this.secondary_action){var e=this.page.set_secondary_action(this.secondary_action.label,this.secondary_action.action,this.secondary_action.icon);this.secondary_action.icon?this.secondary_action.label||e.addClass("visible-xs"):e.addClass("hidden-xs")}else this.refresh_button=this.page.add_action_icon("refresh",function(){t.refresh()})}set_menu_items(){var t=this;this.set_default_secondary_action(),this.menu_items&&this.menu_items.map(function(e){if(!e.condition||!1!==e.condition()){var i=t.page.add_menu_item(e.label,e.action,e.standard,e.shortcut);e.class&&i&&i.addClass(e.class)}})}set_breadcrumbs(){frappe.breadcrumbs.add(this.meta.module,this.doctype)}setup_side_bar(){!this.hide_sidebar&&frappe.boot.desk_settings.list_sidebar&&(this.list_sidebar=new frappe.views.ListSidebar({doctype:this.doctype,stats:this.stats,parent:this.$page.find(".layout-side-section"),page:this.page,list_view:this}))}toggle_side_bar(t){var e=t||JSON.parse(localStorage.show_sidebar||"true");e=!e,localStorage.show_sidebar=e,this.show_or_hide_sidebar(),$(document.body).trigger("toggleListSidebar")}show_or_hide_sidebar(){var t=JSON.parse(localStorage.show_sidebar||"true");$(document.body).toggleClass("no-list-sidebar",!t)}setup_main_section(){var t=this;return frappe.run_serially([this.setup_list_wrapper,this.show_or_hide_sidebar,this.setup_filter_area,this.setup_sort_selector,this.setup_result_area,this.setup_no_result_area,this.setup_freeze_area,this.setup_paging_area].map(function(e){return e.bind(t)}))}setup_list_wrapper(){this.$frappe_list=$('<div class="frappe-list">').appendTo(this.page.main)}setup_filter_area(){if(!this.hide_filters)return this.filter_area=new FilterArea(this),this.filters&&this.filters.length>0?this.filter_area.set(this.filters):void 0}setup_sort_selector(){this.hide_sort_selector||(this.sort_selector=new frappe.ui.SortSelector({parent:this.$filter_section,doctype:this.doctype,args:{sort_by:this.sort_by,sort_order:this.sort_order},onchange:this.on_sort_change.bind(this)}))}on_sort_change(){this.refresh()}setup_result_area(){this.$result=$('<div class="result">'),this.$frappe_list.append(this.$result)}setup_no_result_area(){this.$no_result=$('\n\t\t\t<div class="no-result text-muted flex justify-center align-center">\n\t\t\t\t'+this.get_no_result_message()+"\n\t\t\t</div>\n\t\t").hide(),this.$frappe_list.append(this.$no_result)}setup_freeze_area(){this.$freeze=$('<div class="freeze"></div>').hide(),this.$frappe_list.append(this.$freeze)}get_no_result_message(){return __("Nothing to show")}setup_paging_area(){var t=this;this.$paging_area=$('<div class="list-paging-area level">\n\t\t\t\t<div class="level-left">\n\t\t\t\t\t<div class="btn-group">\n\t\t\t\t\t\t'+[20,100,500].map(function(t){return'\n\t\t\t\t\t\t\t<button type="button" class="btn btn-default btn-sm btn-paging"\n\t\t\t\t\t\t\t\tdata-value="'+t+'">\n\t\t\t\t\t\t\t\t'+t+"\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t"}).join("")+'\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="level-right">\n\t\t\t\t\t<button class="btn btn-default btn-more btn-sm">\n\t\t\t\t\t\t'+__("Load More")+"\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>").hide(),this.$frappe_list.append(this.$paging_area),this.$paging_area.find('.btn-paging[data-value="'+this.page_length+'"]').addClass("btn-info"),this.$paging_area.on("click",".btn-paging, .btn-more",function(e){var i=$(e.currentTarget);i.is(".btn-paging")?(t.$paging_area.find(".btn-paging").removeClass("btn-info"),i.addClass("btn-info"),t.start=0,t.page_length=i.data().value):i.is(".btn-more")&&(t.start=t.start+t.page_length,t.page_length=20),t.refresh()})}get_fields(){return this.fields.map(function(t){return frappe.model.get_full_column_name(t[0],t[1])})}get_group_by(){var t=this.fields&&this.fields.find(function(t){return"name"==t[0]});return t?frappe.model.get_full_column_name(t[0],t[1]):null}setup_view(){}get_filter_value(t){var e=this.get_filters_for_args().filter(function(e){return e[1]==t})[0];if(e)return{like:e[3].replace(/^%?|%$/g,""),"not set":null}[e[2]]||e[3]}get_filters_for_args(){return this.filter_area?this.filter_area.get().map(function(t){return t.slice(0,4)}):[]}get_args(){return{doctype:this.doctype,fields:this.get_fields(),filters:this.get_filters_for_args(),order_by:this.sort_selector&&this.sort_selector.get_sql_string(),start:this.start,page_length:this.page_length,view:this.view,group_by:this.get_group_by()}}get_call_args(){var t=this.get_args();return{method:this.method,args:t,freeze:this.freeze_on_refresh||!1,freeze_message:this.freeze_message||__("Loading")+"..."}}before_refresh(){}refresh(){var t=this;return this.freeze(!0),frappe.call(this.get_call_args()).then(function(e){t.prepare_data(e),t.toggle_result_area(),t.before_render(),t.render(),t.after_render(),t.freeze(!1),t.reset_defaults(),t.settings.refresh&&t.settings.refresh(t)})}prepare_data(t){var e=t.message||{};e=Array.isArray(e)?e:frappe.utils.dict(e.keys,e.values),0===this.start?this.data=e:this.data=this.data.concat(e),this.data=this.data.uniqBy(function(t){return t.name})}reset_defaults(){this.page_length=this.page_length+this.start,this.start=0}freeze(){}before_render(){}after_render(){}render(){}on_filter_change(){}toggle_result_area(){this.$result.toggle(this.data.length>0),this.$paging_area.toggle(this.data.length>0),this.$no_result.toggle(0==this.data.length);var t=this.start+this.page_length<=this.data.length;this.$paging_area.find(".btn-more").toggle(t)}call_for_selected_items(t,e){var i=this;void 0===e&&(e={}),e.names=this.get_checked_items(!0),frappe.call({method:t,args:e,freeze:!0,callback:function(t){t.exc||i.refresh()}})}};class FilterArea{constructor(t){this.list_view=t,this.list_view.page.page_form.append('<div class="standard-filter-section flex"></div>');var e=this.list_view.hide_page_form?this.list_view.page.custom_actions:this.list_view.page.page_form;this.list_view.$filter_section=$('<div class="filter-section flex">').appendTo(e),this.$filter_list_wrapper=this.list_view.$filter_section,this.trigger_refresh=!0,this.setup()}setup(){this.list_view.hide_page_form||this.make_standard_filters(),this.make_filter_list()}get(){var t=this.filter_list.get_filters(),e=this.get_standard_filters();return t.concat(e).uniqBy(JSON.stringify)}set(t){var e=this;return this.trigger_refresh=!1,this.add(t,!1).then(function(){e.trigger_refresh=!0,e.filter_list.update_filter_button()})}add(t,e){var i=this;if(void 0===e&&(e=!0),!t||Array.isArray(t)&&0===t.length)return Promise.resolve();"string"==typeof t[0]&&(t=[Array.from(arguments)]);t=t.filter(function(t){return!i.exists(t)});var s=this.set_standard_filter(t),a=s.non_standard_filters;return s.promise.then(function(){return a.length>0&&i.filter_list.add_filters(a)}).then(function(){e&&i.list_view.refresh()})}refresh_list_view(){this.trigger_refresh&&(this.list_view.start=0,this.list_view.refresh(),this.list_view.on_filter_change())}exists(t){var e=!1,i=this.list_view.page.fields_dict;"="===t[2]&&t[1]in i&&(i[t[1]].get_value()&&(e=!0));return e||(e=this.filter_list.filter_exists(t)),e}set_standard_filter(t){if(0===t.length)return{non_standard_filters:[],promise:Promise.resolve()};var e=this.list_view.page.fields_dict;return t.reduce(function(t,i){i[0];var s=i[1],a=i[2],r=i[3];return t.promise=t.promise||Promise.resolve(),t.non_standard_filters=t.non_standard_filters||[],!e[s]||"="!==a&&"like"!==a?t.non_standard_filters.push(i):t.promise=t.promise.then(function(){return e[s].set_value(r)}),t},{})}remove_filters(t){var e=this;t.map(function(t){e.remove(t[1])})}remove(t){var e=this.list_view.page.fields_dict;t in e&&e[t].set_value("");var i=this.filter_list.get_filter(t);return i&&i.remove(),this.filter_list.apply(),Promise.resolve()}clear(t){var e=this;void 0===t&&(t=!0),t||(this.trigger_refresh=!1),this.filter_list.clear_filters();var i=[],s=this.list_view.page.fields_dict,a=function(t){var s=e.list_view.page.fields_dict[t];i.push(function(){return s.set_value("")})};for(var r in s)a(r);return frappe.run_serially(i).then(function(){e.trigger_refresh=!0})}make_standard_filters(){var t=this;this.standard_filters_wrapper=this.list_view.page.page_form.find(".standard-filter-section");var e=[{fieldtype:"Data",label:"Name",condition:"like",fieldname:"name",onchange:function(){return t.refresh_list_view()}}];this.list_view.custom_filter_configs&&(this.list_view.custom_filter_configs.forEach(function(e){e.onchange=function(){return t.refresh_list_view()}}),e=e.concat(this.list_view.custom_filter_configs));var i=this.list_view.meta.fields,s=this.list_view.meta.title_field;(e=e.concat(i.filter(function(t){return t.fieldname===s||t.in_standard_filter&&frappe.model.is_value_type(t.fieldtype)}).map(function(e){var i=e.options,s="=",a=e.fieldtype;["Text","Small Text","Text Editor","HTML Editor","Data","Code","Read Only"].includes(a)&&(a="Data",s="like"),"Select"==e.fieldtype&&e.options&&(i=e.options.split("\n")).length>0&&""!=i[0]&&(i.unshift(""),i=i.join("\n"));var r="Link"===a?frappe.defaults.get_user_default(i):null;return["__default","__global"].includes(r)&&(r=null),{fieldtype:a,label:__(e.label),options:i,fieldname:e.fieldname,condition:s,default:r,onchange:function(){return t.refresh_list_view()},ignore_link_validation:"Dynamic Link"===a,is_filter:1}}))).map(function(e){t.list_view.page.add_field(e,t.standard_filters_wrapper)})}get_standard_filters(){var t=[],e=this.list_view.page.fields_dict;for(var i in e){var s=e[i],a=s.get_value();a&&("like"!==s.df.condition||a.includes("%")||(a="%"+a+"%"),t.push([this.list_view.doctype,s.df.fieldname,s.df.condition||"=",a]))}return t}make_filter_list(){var t=this;$('<div class="filter-selector">\n\t\t\t<button class="btn btn-default btn-sm filter-button">\n\t\t\t\t<span class="filter-icon">\n\t\t\t\t\t'+frappe.utils.icon("filter")+'\n\t\t\t\t</span>\n\t\t\t\t<span class="button-label hidden-xs">\n\t\t\t\t\t'+__("Filter")+"\n\t\t\t\t<span>\n\t\t\t</button>\n\t\t</div>").appendTo(this.$filter_list_wrapper),this.filter_button=this.$filter_list_wrapper.find(".filter-button"),this.filter_list=new frappe.ui.FilterGroup({base_list:this.list_view,parent:this.$filter_list_wrapper,doctype:this.list_view.doctype,filter_button:this.filter_button,default_filters:[],on_change:function(){return t.refresh_list_view()}})}is_being_edited(){return this.filter_list&&this.filter_list.wrapper&&this.filter_list.wrapper.find(".filter-box:visible").length>0}}frappe.views.view_modes=["List","Report","Dashboard","Gantt","Kanban","Calendar","Image","Inbox","Tree","Map"],frappe.views.is_valid=function(t){return frappe.views.view_modes.includes(t)};class BulkOperations{constructor(t){var e=t.doctype;e||frappe.throw(__("Doctype required")),this.doctype=e}print(t){var e=this,i=frappe.model.get_doc(":Print Settings","Print Settings"),s=cint(i.allow_print_for_draft),a=frappe.model.is_submittable(this.doctype),r=cint(i.allow_print_for_cancelled),n=t.filter(function(t){return!a||1===t.docstatus||r&&2==t.docstatus||s&&0==t.docstatus||frappe.user.has_role("Administrator")}).map(function(t){return t.name});if(t.filter(function(t){return!n.includes(t.name)}).length>0)frappe.msgprint(__("You selected Draft or Cancelled documents"));else if(0!==n.length){var l=new frappe.ui.Dialog({title:__("Print Documents"),fields:[{fieldtype:"Select",label:__("Letter Head"),fieldname:"letter_sel",default:__("No Letterhead"),options:this.get_letterhead_options()},{fieldtype:"Select",label:__("Print Format"),fieldname:"print_sel",options:frappe.meta.get_print_formats(this.doctype)},{fieldtype:"Select",label:__("Page Size"),fieldname:"page_size",options:frappe.meta.get_print_sizes(),default:i.pdf_page_size},{fieldtype:"Float",label:__("Page Height (in mm)"),fieldname:"page_height",depends_on:'eval:doc.page_size == "Custom"',default:i.pdf_page_height},{fieldtype:"Float",label:__("Page Width (in mm)"),fieldname:"page_width",depends_on:'eval:doc.page_size == "Custom"',default:i.pdf_page_width}]});l.set_primary_action(__("Print"),function(t){if(t){var i,s=frappe.get_meta(e.doctype).default_print_format,a=t.letter_sel==__("No Letterhead")?0:1,r=t.print_sel?t.print_sel:s,l=JSON.stringify(n),o=t.letter_sel;"Custom"===t.page_size?(0!==t.page_height&&0!==t.page_width||frappe.throw(__("Page height and width cannot be zero")),i=JSON.stringify({"page-height":t.page_height,"page-width":t.page_width})):i=JSON.stringify({"page-size":t.page_size}),window.open("/api/method/frappe.utils.print_format.download_multi_pdf?doctype="+encodeURIComponent(e.doctype)+"&name="+encodeURIComponent(l)+"&format="+encodeURIComponent(r)+"&no_letterhead="+(a?"0":"1")+"&letterhead="+encodeURIComponent(o)+"&options="+encodeURIComponent(i))||frappe.msgprint(__("Please enable pop-ups"))}}),l.show()}else frappe.msgprint(__("Select atleast 1 record for printing"))}get_letterhead_options(){var t=[__("No Letterhead")];return frappe.call({method:"frappe.client.get_list",args:{doctype:"Letter Head",fields:["name","is_default"],limit_page_length:0},async:!1,callback:function(e){e.message&&e.message.forEach(function(e){t.push(e.name)})}}),t}delete(t,e){void 0===e&&(e=null),frappe.call({method:"frappe.desk.reportview.delete_items",freeze:!0,args:{items:t,doctype:this.doctype}}).then(function(i){var s=i.message;s||(s=[]),s.length&&!i._server_messages&&frappe.throw(__("Cannot delete {0}",[s.map(function(t){return t.bold()}).join(", ")])),s.length<t.length&&(frappe.utils.play_sound("delete"),e&&e())})}assign(t,e){if(t.length>0){var i=new frappe.ui.form.AssignToDialog({obj:this,method:"frappe.desk.form.assign_to.add_multiple",doctype:this.doctype,docname:t,bulk_assign:!0,re_assign:!0,callback:e});i.dialog.clear(),i.dialog.show()}else frappe.msgprint(__("Select records for assignment"))}apply_assignment_rule(t,e){t.length>0&&frappe.call("frappe.automation.doctype.assignment_rule.assignment_rule.bulk_apply",{doctype:this.doctype,docnames:t}).then(function(){return e()})}submit_or_cancel(t,e,i){void 0===e&&(e="submit"),void 0===i&&(i=null),e=e.toLowerCase(),frappe.call({method:"frappe.desk.doctype.bulk_update.bulk_update.submit_cancel_or_update_docs",args:{doctype:this.doctype,action:e,docnames:t}}).then(function(s){var a=s.message;a||(a=[]),a.length&&!s._server_messages&&frappe.throw(__("Cannot {0} {1}",[e,a.map(function(t){return t.bold()}).join(", ")])),a.length<t.length&&(frappe.utils.play_sound(e),i&&i())})}edit(t,e,i){var s=this,a=Object.keys(e).sort(),r=/status/i,n=a.find(function(t){return r.test(t)}),l=new frappe.ui.Dialog({title:__("Edit"),fields:[{fieldtype:"Select",options:a,default:n,label:__("Field"),fieldname:"field",reqd:1,onchange:function(){o(l)}},{fieldtype:"Data",label:__("Value"),fieldname:"value",reqd:1}],primary_action:function(a){var r,n=a.value,o=e[l.get_value("field")].fieldname;l.disable_primary_action(),frappe.call({method:"frappe.desk.doctype.bulk_update.bulk_update.submit_cancel_or_update_docs",args:{doctype:s.doctype,freeze:!0,docnames:t,action:"update",data:(r={},r[o]=n,r)}}).then(function(t){var e=t.message||[];e.length&&!t._server_messages&&(l.enable_primary_action(),frappe.throw(__("Cannot update {0}",[e.map(function(t){return t.bold?t.bold():t}).join(", ")]))),i(),l.hide(),frappe.show_alert(__("Updated successfully"))})},primary_action_label:__("Update")});function o(t){var i=Object.assign({},e[t.get_value("field")]);if(i.label.match(r)&&"Select"===i.fieldtype&&!i.default){var s=[];"string"==typeof i.options&&(s=i.options.split("\n")),i.default=s[0]||s[1]}i.label=__("Value"),i.reqd=1,delete i.depends_on,t.replace_field("value",i)}n&&o(l),l.refresh(),l.show()}add_tags(t,e){var i=this,s=new frappe.ui.Dialog({title:__("Add Tags"),fields:[{fieldtype:"MultiSelectPills",fieldname:"tags",label:__("Tags"),reqd:!0,get_data:function(t){return frappe.db.get_link_options("Tag",t)}}],primary_action_label:__("Add"),primary_action:function(){var a=s.get_values();a&&a.tags&&(s.set_message("Adding Tags..."),frappe.call({method:"frappe.desk.doctype.tag.tag.add_tags",args:{tags:a.tags,dt:i.doctype,docs:t},callback:function(){s.hide(),e()}}))}});s.show()}}class ListSettings{constructor(t){var e=this,i=t.listview,s=t.doctype,a=t.meta,r=t.settings;s||frappe.throw("DocType required"),this.listview=i,this.doctype=s,this.meta=a,this.settings=r,this.dialog=null,this.fields=this.settings&&this.settings.fields?JSON.parse(this.settings.fields):[],this.subject_field=null,frappe.model.with_doctype("List View Settings",function(){e.make(),e.get_listview_fields(a),e.setup_fields(),e.setup_remove_fields(),e.add_new_fields(),e.show_dialog()})}make(){var t=this,e=frappe.get_meta("List View Settings");t.dialog=new frappe.ui.Dialog({title:__("{0} Settings",[__(t.doctype)]),fields:e.fields}),t.dialog.set_values(t.settings),t.dialog.set_primary_action(__("Save"),function(){var e=t.dialog.get_values();frappe.show_alert({message:__("Saving"),indicator:"green"}),frappe.call({method:"frappe.desk.doctype.list_view_settings.list_view_settings.save_listview_settings",args:{doctype:t.doctype,listview_settings:e,removed_listview_fields:t.removed_fields||[]},callback:function(e){t.listview.refresh_columns(e.message.meta,e.message.listview_settings),t.dialog.hide()}})}),t.dialog.fields_dict.total_fields.df.onchange=function(){return t.refresh()}}refresh(){this.setup_fields(),this.add_new_fields(),this.setup_remove_fields()}show_dialog(){var t=this;if(this.settings.fields||t.update_fields(),!t.dialog.get_value("total_fields")){var e=t.fields.length;e<4?e=4:e>10&&(e=4),t.dialog.set_value("total_fields",e)}t.dialog.show()}setup_fields(){var t=this,e=t.dialog.get_field("fields_html"),i=e.$wrapper[0],s="",a=t.dialog.get_values().total_fields||t.settings.total_fields;for(var r in t.fields){if(r==parseInt(a))break;var n=0==r?"":"sortable",l=0==r?"hide":"",o=0==r||"status_field"===t.fields[r].fieldname?"hide":"";s+='\n\t\t\t\t<div class="control-input flex align-center form-control fields_order '+n+'"\n\t\t\t\t\tstyle="display: block; margin-bottom: 5px;" data-fieldname="'+t.fields[r].fieldname+'"\n\t\t\t\t\tdata-label="'+t.fields[r].label+'" data-type="'+t.fields[r].type+'">\n\n\t\t\t\t\t<div class="row">\n\t\t\t\t\t\t<div class="col-md-1">\n\t\t\t\t\t\t\t'+frappe.utils.icon("drag","xs","","","sortable-handle "+l)+'\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="col-md-10" style="padding-left:0px;">\n\t\t\t\t\t\t\t'+t.fields[r].label+'\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="col-md-1 '+o+'">\n\t\t\t\t\t\t\t<a class="text-muted remove-field" data-fieldname="'+t.fields[r].fieldname+'">\n\t\t\t\t\t\t\t\t'+frappe.utils.icon("delete","xs")+"\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>"}e.html('\n\t\t\t<div class="form-group">\n\t\t\t\t<div class="clearfix">\n\t\t\t\t\t<label class="control-label" style="padding-right: 0px;">Fields</label>\n\t\t\t\t</div>\n\t\t\t\t<div class="control-input-wrapper">\n\t\t\t\t'+s+'\n\t\t\t\t</div>\n\t\t\t\t<p class="help-box small text-muted hidden-xs">\n\t\t\t\t\t<a class="add-new-fields text-muted">\n\t\t\t\t\t\t+ Add / Remove Fields\n\t\t\t\t\t</a>\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t'),new Sortable(i.getElementsByClassName("control-input-wrapper")[0],{handle:".sortable-handle",draggable:".sortable",onUpdate:function(){t.update_fields(),t.refresh()}})}add_new_fields(){var t=this;t.dialog.get_field("fields_html").$wrapper[0].getElementsByClassName("add-new-fields")[0].onclick=function(){return t.column_selector()}}setup_remove_fields(){for(var t=this,e=t.dialog.get_field("fields_html").$wrapper[0].getElementsByClassName("remove-field"),i=function(i){e.item(i).onclick=function(){return t.remove_fields(e.item(i).getAttribute("data-fieldname"))}},s=0;s<e.length;s++)i(s)}remove_fields(t){var e=this,i=e.fields.map(function(t){return t.fieldname});for(var s in e.fields){if(e.fields[s].fieldname==t){e.fields.splice(s,1);break}}e.set_removed_fields(e.get_removed_listview_fields(e.fields.map(function(t){return t.fieldname}),i)),e.refresh(),e.update_fields()}update_fields(){var t=this,e=t.dialog.get_field("fields_html").$wrapper[0].getElementsByClassName("fields_order");t.fields=[];for(var i=0;i<e.length;i++)t.fields.push({fieldname:e.item(i).getAttribute("data-fieldname"),label:e.item(i).getAttribute("data-label")});t.dialog.set_value("fields",JSON.stringify(t.fields)),t.dialog.get_value("fields")}column_selector(){var t=this,e=new frappe.ui.Dialog({title:__("{0} Fields",[__(t.doctype)]),fields:[{label:__("Reset Fields"),fieldtype:"Button",fieldname:"reset_fields",click:function(){return t.reset_listview_fields(e)}},{label:__("Select Fields"),fieldtype:"MultiCheck",fieldname:"fields",options:t.get_doctype_fields(t.meta,t.fields.map(function(t){return t.fieldname})),columns:2}]});e.set_primary_action(__("Save"),function(){var i=e.get_values().fields;for(var s in t.set_removed_fields(t.get_removed_listview_fields(i,t.fields.map(function(t){return t.fieldname}))),t.fields=[],t.set_subject_field(t.meta),t.set_status_field(),i){var a=i[s];if(t.fields.length===parseInt(t.dialog.get_values().total_fields))break;if(a!=t.subject_field.fieldname){var r=frappe.meta.get_docfield(t.doctype,a);r&&t.fields.push({label:r.label,fieldname:r.fieldname})}}t.refresh(),t.dialog.set_value("fields",JSON.stringify(t.fields)),e.hide()}),e.show()}reset_listview_fields(t){var e=this;frappe.xcall("frappe.desk.doctype.list_view_settings.list_view_settings.get_default_listview_fields",{doctype:e.doctype}).then(function(i){t.get_field("fields").df.options=e.get_doctype_fields(e.meta,i),t.refresh()})}get_listview_fields(t){this.settings.fields?this.fields=JSON.parse(this.settings.fields):this.set_list_view_fields(t),this.fields.uniqBy(function(t){return t.fieldname})}set_list_view_fields(t){var e=this;e.set_subject_field(t),e.set_status_field(),t.fields.forEach(function(t){t.in_list_view&&!in_list(frappe.model.no_value_type,t.fieldtype)&&e.subject_field.fieldname!=t.fieldname&&e.fields.push({label:t.label,fieldname:t.fieldname})})}set_subject_field(t){var e=this;if(e.subject_field={label:"Name",fieldname:"name"},t.title_field){var i=frappe.meta.get_docfield(e.doctype,t.title_field.trim());e.subject_field={label:i.label,fieldname:i.fieldname}}e.fields.push(e.subject_field)}set_status_field(){frappe.has_indicator(this.doctype)&&this.fields.push({type:"Status",label:"Status",fieldname:"status_field"})}get_doctype_fields(t,e){var i=[];return t.fields.forEach(function(t){in_list(frappe.model.no_value_type,t.fieldtype)||i.push({label:t.label,value:t.fieldname,checked:in_list(e,t.fieldname)})}),i}get_removed_listview_fields(t,e){var i=[];return frappe.has_indicator(this.doctype)&&t.push("status_field"),e.forEach(function(e){in_list(t,e)||i.push(e)}),i}set_removed_fields(t){this.removed_fields?this.removed_fields.concat(t):this.removed_fields=t}}frappe.provide("frappe.views"),frappe.views.ListView=class extends frappe.views.BaseList{static load_last_view(){var t=frappe.get_route(),e=t[1];if(2===t.length){var i=frappe.get_user_settings(e).last_view;return frappe.set_route("list",frappe.router.doctype_layout||e,frappe.views.is_valid(i)?i.toLowerCase():"list"),!0}return!1}constructor(t){super(t),this.show()}has_permissions(){return frappe.perm.has_perm(this.doctype,0,"read")}show(){if(this.parent.disable_scroll_to_top=!0,!this.has_permissions())return frappe.set_route(""),void frappe.msgprint(__("Not permitted to view {0}",[this.doctype]));super.show()}get view_name(){return"List"}get view_user_settings(){return this.user_settings[this.view_name]||{}}setup_defaults(){var t=this;if(super.setup_defaults(),this.view="List",this.sort_by=this.view_user_settings.sort_by||"modified",this.sort_order=this.view_user_settings.sort_order||"desc",this.view_user_settings.filters&&this.view_user_settings.filters.length){var e=this.view_user_settings.filters;this.filters=this.validate_filters(e)}else this.filters=(this.settings.filters||[]).map(function(e){return 3===e.length&&(e=[t.doctype,e[0],e[1],e[2]]),e});if(this.menu_items=this.menu_items.concat(this.get_menu_items()),this.view_user_settings.filters&&this.view_user_settings.filters.length){var i=this.view_user_settings.filters;this.filters=this.validate_filters(i)}else this.filters=(this.settings.filters||[]).map(function(e){return 3===e.length&&(e=[t.doctype,e[0],e[1],e[2]]),e});return"List"==this.view_name&&(this.toggle_paging=!0),this.patch_refresh_and_load_lib(),this.get_list_view_settings()}get_list_view_settings(){var t=this;return frappe.call("frappe.desk.listview.get_list_settings",{doctype:this.doctype}).then(function(e){return t.list_view_settings=e.message||{}})}on_sort_change(t,e){this.sort_by=t,this.sort_order=e,super.on_sort_change()}validate_filters(t){var e=this.meta.fields.map(function(t){return t.fieldname});return e=e.concat(frappe.model.std_fields_list),t.filter(function(t){return e.includes(t[1])}).uniqBy(function(t){return t[1]})}setup_page(){this.parent.list_view=this,super.setup_page()}setup_page_head(){super.setup_page_head(),this.set_primary_action(),this.set_actions_menu_items()}set_actions_menu_items(){var t=this;this.actions_menu_items=this.get_actions_menu_items(),this.workflow_action_menu_items=this.get_workflow_action_menu_items(),this.workflow_action_items={},this.actions_menu_items.concat(this.workflow_action_menu_items).map(function(e){var i=t.page.add_actions_menu_item(e.label,e.action,e.standard);e.class&&i.addClass(e.class),e.is_workflow_action&&i&&(t.workflow_action_items[e.name]=i)})}show_restricted_list_indicator_if_applicable(){var t=this,e=frappe.perm.get_match_rules(this.doctype);e.length&&(this.restricted_list=$('<button class="btn btn-xs restricted-button flex align-center">\n\t\t\t\t\t'+frappe.utils.icon("restriction","xs")+"\n\t\t\t\t</button>").click(function(){return t.show_restrictions(e)}).appendTo(this.page.page_form))}show_restrictions(t){void 0===t&&(t=[]),frappe.msgprint(frappe.render_template("list_view_permission_restrictions",{condition_list:t}),__("Restrictions"))}set_fields(){var t=this;[].concat(frappe.model.std_fields_list,this.get_fields_in_list_view(),[this.meta.title_field,this.meta.image_field],this.settings.add_fields||[],this.meta.track_seen?"_seen":null,this.sort_by,"enabled","disabled","color").forEach(function(e){return t._add_field(e)}),this.fields.forEach(function(e){var i=frappe.meta.get_docfield(e[1],e[0]);i&&"Currency"===i.fieldtype&&i.options&&!i.options.includes(":")&&t._add_field(i.options)})}patch_refresh_and_load_lib(){var t=this;this.refresh=this.refresh.bind(this),this.refresh=frappe.utils.throttle(this.refresh,1e3),this.load_lib=new Promise(function(e){t.required_libs?frappe.require(t.required_libs,e):e()});setInterval(function(){frappe.get_route_str()===t.page_name&&t.refresh()},3e5)}set_primary_action(){var t=this;this.can_create?this.page.set_primary_action(__("Add")+" "+(frappe.router.doctype_layout||__(this.doctype)),function(){t.settings.primary_action?t.settings.primary_action():t.make_new_doc()},"add"):this.page.clear_primary_action()}make_new_doc(){var t=this.doctype,e={};this.filter_area.get().forEach(function(t){"="===t[2]&&frappe.model.is_non_std_field(t[1])&&(e[t[1]]=t[3])}),frappe.new_doc(t,e)}setup_view(){this.setup_columns(),this.render_header(),this.render_skeleton(),this.setup_events(),this.settings.onload&&this.settings.onload(this),this.show_restricted_list_indicator_if_applicable()}refresh_columns(t,e){this.meta=t,this.list_view_settings=e,this.setup_columns(),this.refresh(!0)}refresh(t){var e=this;void 0===t&&(t=!1),super.refresh().then(function(){e.render_header(t),e.update_checkbox()})}update_checkbox(t){if(this.$checkbox_actions){var e=this.$checkbox_actions.find(".list-check-all");e.prop("checked")&&t&&!t.prop("checked")&&e.prop("checked",!1),e.prop("checked",this.$checks.length===this.data.length)}}setup_freeze_area(){this.$freeze=$('<div class="freeze flex justify-center align-center text-muted">'+__("Loading")+"...</div>").hide(),this.$result.append(this.$freeze)}setup_columns(){var t=this;this.columns=[];var e=frappe.meta.get_docfield.bind(null,this.doctype);this.meta.title_field?this.columns.push({type:"Subject",df:e(this.meta.title_field)}):this.columns.push({type:"Subject",df:{label:__("Name"),fieldname:"name"}}),this.columns.push({type:"Tag"}),frappe.has_indicator(this.doctype)&&this.columns.push({type:"Status"});var i=this.get_fields_in_list_view();this.columns=this.columns.concat(i.filter(function(e){return(!frappe.has_indicator(t.doctype)||"status"!==e.fieldname)&&(!!e.in_list_view&&e.fieldname!==t.meta.title_field)}).map(function(t){return{type:"Field",df:t}})),this.list_view_settings.fields&&(this.columns=this.reorder_listview_fields());var s=6;window.innerWidth<=1366?s=4:window.innerWidth>=1920&&(s=8),this.columns=this.columns.slice(0,this.list_view_settings.total_fields||s),!this.settings.hide_name_column&&this.meta.title_field&&"name"!==this.meta.title_field&&this.columns.push({type:"Field",df:{label:__("Name"),fieldname:"name"}})}reorder_listview_fields(){var t=[],e=JSON.parse(this.list_view_settings.fields);for(var i in t.push(this.columns[0]),t.push(this.columns[1]),this.columns.splice(0,2),e)for(var s in this.columns){var a=e[i],r=this.columns[s];if("Status"==r.type&&"status_field"==a.fieldname){t.push(r);break}if("Field"==r.type&&a.fieldname===r.df.fieldname){t.push(r);break}}return t}get_documentation_link(){return this.meta.documentation?'<a href="'+this.meta.documentation+'" target="blank" class="meta-description small text-muted">Need Help?</a>':""}get_no_result_message(){var t=this.get_documentation_link(),e=this.filter_area&&this.filter_area.get(),i=e&&e.length?__("No {0} found",[__(this.doctype)]):__("You haven't created a {0} yet",[__(this.doctype)]),s=e&&e.length?__("Create a new {0}",[__(this.doctype)]):__("Create your first {0}",[__(this.doctype)]);return'<div class="msg-box no-border">\n\t\t\t<div>\n\t\t\t\t<img src="'+(this.settings.empty_state_image||"/assets/frappe/images/ui-states/list-empty-state.svg")+'" alt="Generic Empty State" class="null-state">\n\t\t\t</div>\n\t\t\t<p>'+i+"</p>\n\t\t\t"+(this.can_create?'<p><button class="btn btn-primary btn-sm btn-new-doc hidden-xs">\n\t\t\t\t'+s+'\n\t\t\t</button> <button class="btn btn-primary btn-new-doc visible-xs">'+__("Create New")+"</button></p>":"")+"\n\t\t\t"+t+"\n\t\t</div>"}freeze(){this.list_view_settings&&!this.list_view_settings.disable_count&&this.$result.find(".list-count").html("<span>"+__("Refreshing")+"...</span>")}get_args(){var t=super.get_args();return Object.assign(t,{with_comment_count:!0})}before_refresh(){var t=this;return frappe.route_options&&this.filter_area&&(this.filters=this.parse_filters_from_route_options(),frappe.route_options=null,this.filters.length>0)?this.filter_area.clear(!1).then(function(){return t.filter_area.set(t.filters)}):Promise.resolve()}parse_filters_from_settings(){var t=this;return(this.settings.filters||[]).map(function(e){return 3===e.length&&(e=[t.doctype,e[0],e[1],e[2]]),e})}toggle_result_area(){super.toggle_result_area(),this.toggle_actions_menu_button(this.$result.find(".list-row-check:checked").length>0)}toggle_actions_menu_button(t){t?(this.page.show_actions_menu(),this.page.clear_primary_action(),this.toggle_workflow_actions()):(this.page.hide_actions_menu(),this.set_primary_action())}render_header(t){void 0===t&&(t=!1),t&&this.$result.find(".list-row-head").remove(),0===this.$result.find(".list-row-head").length&&this.$result.prepend(this.get_header_html())}render_skeleton(){var t=this.get_list_row_html_skeleton('<div><input type="checkbox" class="render-list-checkbox"/></div>');this.$result.append(t)}before_render(){this.settings.before_render&&this.settings.before_render(),frappe.model.user_settings.save(this.doctype,"last_view",this.view_name),this.save_view_user_settings({filters:this.filter_area&&this.filter_area.get(),sort_by:this.sort_selector&&this.sort_selector.sort_by,sort_order:this.sort_selector&&this.sort_selector.sort_order}),this.toggle_paging&&this.$paging_area.toggle(!1)}after_render(){this.$no_result.html('\n\t\t\t<div class="no-result text-muted flex justify-center align-center">\n\t\t\t\t'+this.get_no_result_message()+"\n\t\t\t</div>\n\t\t"),this.setup_new_doc_event(),this.list_sidebar&&this.list_sidebar.reload_stats(),this.toggle_paging&&this.$paging_area.toggle(!0)}render(){this.render_list(),this.set_rows_as_checked(),this.on_row_checked(),this.render_count()}render_list(){var t=this;this.$result.find(".list-row-container").remove(),this.data.length>0&&this.$result.append(this.data.map(function(e,i){return e._idx=i,t.get_list_row_html(e)}).join(""))}render_count(){var t=this;this.list_view_settings.disable_count||this.get_count_str().then(function(e){t.$result.find(".list-count").html("<span>"+e+"</span>")})}get_header_html(){if(this.columns){var t=this.columns[0].df,e='\n\t\t\t<input class="level-item list-check-all" type="checkbox"\n\t\t\t\ttitle="'+__("Select All")+'">\n\t\t\t<span class="level-item list-liked-by-me hidden-xs">\n\t\t\t\t<span title="'+__("Likes")+'">'+frappe.utils.icon("heart","sm","like-icon")+'</span>\n\t\t\t</span>\n\t\t\t<span class="level-item">'+__(t.label)+"</span>\n\t\t",i=this.columns.map(function(t){return'\n\t\t\t\t<div class="'+["list-row-col ellipsis","Subject"==t.type?"list-subject level":"hidden-xs","Tag"==t.type?"tag-col hide":"",frappe.model.is_numeric_field(t.df)?"text-right":""].join(" ")+'">\n\t\t\t\t\t'+("Subject"===t.type?e:"\n\t\t\t\t\t\t<span>"+__(t.df&&t.df.label||t.type)+"</span>")+"\n\t\t\t\t</div>\n\t\t\t"}).join("");return this.get_header_html_skeleton(i,'<span class="list-count"></span>')}}get_header_html_skeleton(t,e){return void 0===t&&(t=""),void 0===e&&(e=""),'\n\t\t\t<header class="level list-row-head text-muted">\n\t\t\t\t<div class="level-left list-header-subject">\n\t\t\t\t\t'+t+'\n\t\t\t\t</div>\n\t\t\t\t<div class="level-left checkbox-actions">\n\t\t\t\t\t<div class="level list-subject">\n\t\t\t\t\t\t<input class="level-item list-check-all" type="checkbox"\n\t\t\t\t\t\t\ttitle="'+__("Select All")+'">\n\t\t\t\t\t\t<span class="level-item list-header-meta"></span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="level-right">\n\t\t\t\t\t'+e+"\n\t\t\t\t</div>\n\t\t\t</header>\n\t\t"}get_left_html(t){var e=this;return this.columns.map(function(i){return e.get_column_html(i,t)}).join("")}get_right_html(t){return this.get_meta_html(t)}get_list_row_html(t){return this.get_list_row_html_skeleton(this.get_left_html(t),this.get_right_html(t))}get_list_row_html_skeleton(t,e){return void 0===t&&(t=""),void 0===e&&(e=""),'\n\t\t\t<div class="list-row-container" tabindex="1">\n\t\t\t\t<div class="level list-row">\n\t\t\t\t\t<div class="level-left ellipsis">\n\t\t\t\t\t\t'+t+'\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="level-right text-muted ellipsis">\n\t\t\t\t\t\t'+e+"\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"}get_column_html(t,e){if("Status"===t.type)return'\n\t\t\t\t<div class="list-row-col hidden-xs ellipsis">\n\t\t\t\t\t'+this.get_indicator_html(e)+"\n\t\t\t\t</div>\n\t\t\t";if("Tag"===t.type)return'\n\t\t\t\t<div class="list-row-col tag-col '+(this.tags_shown?"":"hide")+' hidden-xs ellipsis">\n\t\t\t\t\t'+(e._user_tags?this.get_tags_html(e._user_tags,2):'<div class="tags-empty">-</div>')+"\n\t\t\t\t</div>\n\t\t\t";var i,s,a=t.df||{},r=a.label,n=a.fieldname,l=e[n]||"",o=["list-row-col ellipsis",{Subject:"list-subject level",Field:"hidden-xs"}[t.type],frappe.model.is_numeric_field(a)?"text-right":""].join(" "),d={Subject:this.get_subject_html(e),Field:(s="Text Editor"==a.fieldtype||a.fetch_from&&["Text","Small Text"].includes(a.fieldtype)?strip_html(l):"string"==typeof l?frappe.utils.escape_html(l):l,i="Image"===a.fieldtype?a.options?'<img src="'+e[a.options]+'"\n\t\t\t\t\tstyle="max-height: 30px; max-width: 100%;">':'<div class="missing-image small">\n\t\t\t\t\t\t'+frappe.utils.icon("restriction")+"\n\t\t\t\t\t</div>":"Select"===a.fieldtype?'<span class="filterable indicator-pill '+frappe.utils.guess_colour(s)+' ellipsis"\n\t\t\t\t\tdata-filter="'+n+",=,"+l+'">\n\t\t\t\t\t<span class="ellipsis"> '+__(s)+" </span>\n\t\t\t\t</span>":"Link"===a.fieldtype?'<a class="filterable ellipsis"\n\t\t\t\t\tdata-filter="'+n+",=,"+l+'">\n\t\t\t\t\t'+s+"\n\t\t\t\t</a>":["Text Editor","Text","Small Text","HTML Editor","Markdown Editor"].includes(a.fieldtype)?'<span class="ellipsis">\n\t\t\t\t\t'+s+"\n\t\t\t\t</span>":'<a class="filterable ellipsis"\n\t\t\t\t\tdata-filter="'+n+",=,"+frappe.utils.escape_html(l)+'">\n\t\t\t\t\t'+("Code"===a.fieldtype?l:"Percent"===a.fieldtype?'<div class="progress" style="margin: 0px;">\n\t\t\t\t\t\t<div class="progress-bar progress-bar-success" role="progressbar"\n\t\t\t\t\t\t\taria-valuenow="'+l+'"\n\t\t\t\t\t\t\taria-valuemin="0" aria-valuemax="100" style="width: '+Math.round(l)+'%;">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>':frappe.format(l,a,null,e))+"\n\t\t\t\t</a>",'<span class="ellipsis"\n\t\t\t\ttitle="'+__(r)+": "+frappe.utils.escape_html(s)+'">\n\t\t\t\t'+i+"\n\t\t\t</span>")}[t.type];return this.settings.formatters&&this.settings.formatters[n]&&(d=this.settings.formatters[n](l,a,e)),'\n\t\t\t<div class="'+o+'">\n\t\t\t\t'+d+"\n\t\t\t</div>\n\t\t"}get_tags_html(t,e,i){void 0===i&&(i=!1);return t.split(",").slice(1,e+1).map(function(t){var e="",s="";if(t)return i&&(s="background-color: var("+(e=frappe.get_palette(t))[0]+"); color: var("+e[1]+")"),'<div class="tag-pill ellipsis" title="'+t+'" style="'+s+'">'+t+"</div>"}).join("")}get_meta_html(t){var e="",i=null;this.settings.button&&this.settings.button.show(t)&&(i='\n\t\t\t\t<span class="list-actions">\n\t\t\t\t\t<button class="btn btn-action btn-default btn-xs"\n\t\t\t\t\t\tdata-name="'+t.name+'" data-idx="'+t._idx+'"\n\t\t\t\t\t\ttitle="'+this.settings.button.get_description(t)+'">\n\t\t\t\t\t\t'+this.settings.button.get_label(t)+"\n\t\t\t\t\t</button>\n\t\t\t\t</span>\n\t\t\t");var s=comment_when(t.modified,!0),a='<div class="list-assignments">\n\t\t\t<span class="avatar avatar-small">\n\t\t\t<span class="avatar-empty"></span>\n\t\t</div>',r=JSON.parse(t._assign||"[]");return r.length&&(a='<div class="list-assignments">\n\t\t\t\t\t'+frappe.avatar_group(r,3,{filterable:!0})[0].outerHTML+"\n\t\t\t\t</div>"),e+='\n\t\t\t<div class="level-item list-row-activity hidden-xs">\n\t\t\t\t<div class="hidden-md hidden-xs">\n\t\t\t\t\t'+(i||a)+"\n\t\t\t\t</div>\n\t\t\t\t"+s+"\n\t\t\t\t"+('<span class="'+(t._comment_count?"":"text-extra-muted")+' comment-count">\n\t\t\t\t'+frappe.utils.icon("small-message")+"\n\t\t\t\t"+(t._comment_count>99?"99+":t._comment_count)+"\n\t\t\t</span>")+'\n\t\t\t</div>\n\t\t\t<div class="level-item visible-xs text-right">\n\t\t\t\t'+this.get_indicator_dot(t)+"\n\t\t\t</div>\n\t\t"}get_count_str(){var t=this,e=this.data.length,i=this.data.uniqBy(function(t){return t.name}).length;return frappe.db.count(this.doctype,{filters:this.get_filters_for_args()}).then(function(s){t.total_count=s||e,t.count_without_children=i!==e?i:void 0;var a=__("{0} of {1}",[e,t.total_count]);return t.count_without_children&&(a=__("{0} of {1} ({2} rows with children)",[i,t.total_count,e])),a})}get_form_link(t){if(this.settings.get_form_link)return this.settings.get_form_link(t);var e=t.name.match(/[%'"\s]/)?encodeURIComponent(t.name):t.name;return"/app/"+frappe.router.slug(frappe.router.doctype_layout||this.doctype)+"/"+e}get_seen_class(t){return JSON.parse(t._seen||"[]").includes(frappe.session.user)?"":"bold"}get_like_html(t){var e=JSON.parse(t._liked_by||"[]");return'<span\n\t\t\tclass="like-action '+(e.includes(frappe.session.user)?"liked-by liked":"not-liked")+'"\n\t\t\tdata-name="'+t.name+'" data-doctype="'+this.doctype+'"\n\t\t\tdata-liked-by="'+(encodeURI(t._liked_by)||"[]")+'"\n\t\t\ttitle="'+e.map(function(t){return frappe.user_info(t).fullname}).join(", ")+'">\n\t\t\t'+frappe.utils.icon("heart","sm","like-icon")+'\n\t\t</span>\n\t\t<span class="likes-count">\n\t\t\t'+(e.length>99?__("99")+"+":__(e.length||""))+"\n\t\t</span>"}get_subject_html(t){var e=this.columns[0].df,i=t[e.fieldname];this.settings.formatters&&this.settings.formatters[e.fieldname]&&(i=(0,this.settings.formatters[e.fieldname])(i,e,t));i||(i=t.name);var s=strip_html(i.toString()),a=frappe.utils.escape_html(s),r=this.get_seen_class(t);return'\n\t\t\t<span class="level-item select-like">\n\t\t\t\t<input class="list-row-checkbox" type="checkbox"\n\t\t\t\t\tdata-name="'+escape(t.name)+'">\n\t\t\t\t<span class="list-row-like hidden-xs style="margin-bottom: 1px;">\n\t\t\t\t\t'+this.get_like_html(t)+'\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t\t<span class="level-item '+r+' ellipsis" title="'+a+'">\n\t\t\t\t<a class="ellipsis"\n\t\t\t\t\thref="'+this.get_form_link(t)+'"\n\t\t\t\t\ttitle="'+a+'"\n\t\t\t\t\tdata-doctype="'+this.doctype+'"\n\t\t\t\t\tdata-name="'+t.name+'">\n\t\t\t\t\t'+s+"\n\t\t\t\t</a>\n\t\t\t</span>\n\t\t"}get_indicator_html(t){var e=frappe.get_indicator(t,this.doctype);return e?'<span class="indicator-pill '+e[1]+" filterable ellipsis\"\n\t\t\t\tdata-filter='"+e[2]+'\'>\n\t\t\t\t<span class="ellipsis"> '+__(e[0])+"</span>\n\t\t\t<span>":""}get_indicator_dot(t){var e=frappe.get_indicator(t,this.doctype);return e?"<span class='indicator "+e[1]+"' title='"+__(e[0])+"'></span>":""}get_image_url(t){var e=t.image?t.image:t[this.meta.image_field];return window.cordova&&!frappe.utils.is_url(e)&&(e=frappe.base_url+e),e||null}setup_events(){this.setup_filterable(),this.setup_list_click(),this.setup_tag_event(),this.setup_new_doc_event(),this.setup_check_events(),this.setup_like(),this.setup_realtime_updates(),this.setup_action_handler(),this.setup_keyboard_navigation()}setup_keyboard_navigation(){var t=this,e=function(){$(document.activeElement).next().focus()},i=function(){$(document.activeElement).prev().focus()},s=function(t){t.find("input[type=checkbox]").click()},a=function(){return $(document.activeElement).is(".list-row-container")?$(document.activeElement):null},r=function(){return t.page.wrapper.is(":visible")},n=function(){return $(document.activeElement).is("input")},l=function(s){if(!r()||n())return!1;a()?"down"===s?e():i():t.$result.find(".list-row-container:first").focus()};frappe.ui.keys.add_shortcut({shortcut:"down",action:function(){return l("down")},description:__("Navigate list down"),page:this.page}),frappe.ui.keys.add_shortcut({shortcut:"up",action:function(){return l("up")},description:__("Navigate list up"),page:this.page}),frappe.ui.keys.add_shortcut({shortcut:"shift+down",action:function(){if(!r()||n())return!1;var t=a();s(t),e()},description:__("Select multiple list items"),page:this.page}),frappe.ui.keys.add_shortcut({shortcut:"shift+up",action:function(){if(!r()||n())return!1;var t=a();s(t),i()},description:__("Select multiple list items"),page:this.page}),frappe.ui.keys.add_shortcut({shortcut:"enter",action:function(){var t=a();return!!t&&(t.find("a[data-name]")[0].click(),!0)},description:__("Open list item"),page:this.page}),frappe.ui.keys.add_shortcut({shortcut:"space",action:function(){var t=a();return!!t&&(s(t),!0)},description:__("Select list item"),page:this.page})}setup_filterable(){var t=this;this.$result.on("click",".filterable",function(e){if(!e.metaKey&&!e.ctrlKey){e.stopPropagation();var i=$(e.currentTarget).attr("data-filter").split("|").map(function(e){return"Today"===(e=e.split(","))[2]?e[2]=frappe.datetime.get_today():"User"==e[2]&&(e[2]=frappe.session.user),t.filter_area.remove(e[0]),[t.doctype,e[0],e[1],e.slice(2).join(",")]});t.filter_area.add(i)}})}setup_list_click(){var t=this;this.$result.on("click",".list-row, .image-view-header, .file-header",function(e){var i=$(e.target);if(e.ctrlKey||e.metaKey&&!i.is("a")){var s=$(e.currentTarget).find(".list-row-checkbox");return s.prop("checked",!s.prop("checked")),e.preventDefault(),void t.on_row_checked()}if(i.hasClass("filterable")||i.hasClass("select-like")||i.hasClass("file-select")||i.hasClass("list-row-like")||i.is(":checkbox"))e.stopPropagation();else if(!i.is("a")){var a=$(e.currentTarget).find(".list-subject a").get(0);return a?(frappe.set_route(a.pathname),!1):void 0}})}setup_action_handler(){var t=this;this.$result.on("click",".btn-action",function(e){var i=$(e.currentTarget),s=t.data[i.attr("data-idx")];return t.settings.button.action(s),e.stopPropagation(),!1})}setup_check_events(){var t=this;this.$result.on("change","input[type=checkbox]",function(e){var i=$(e.currentTarget);if(i.is(".list-header-subject .list-check-all")){var s=t.$result.find(".checkbox-actions .list-check-all");s.prop("checked",i.prop("checked")),s.trigger("change")}else if(i.is(".checkbox-actions .list-check-all")){t.$result.find(".list-header-subject .list-check-all").prop("checked",i.prop("checked")),t.$result.find(".list-row-checkbox").prop("checked",i.prop("checked"))}else i.attr("data-parent")&&t.$result.find("."+i.attr("data-parent")).find(".list-row-checkbox").prop("checked",i.prop("checked"));t.on_row_checked()}),this.$result.on("click",".list-row-checkbox",function(e){var i,s=$(e.currentTarget);if(e.shiftKey&&t.$checkbox_cursor&&!s.is(t.$checkbox_cursor)){var a=t.$checkbox_cursor.data().name,r=s.data().name,n=[t.data.findIndex(function(t){return t.name===a}),t.data.findIndex(function(t){return t.name===r})],l=n[0],o=n[1];l>o&&(l=(i=[o,l])[0],o=i[1]);var d=t.data.slice(l+1,o).map(function(t){return t.name}).map(function(t){return'.list-row-checkbox[data-name="'+t+'"]'}).join(",");t.$result.find(d).prop("checked",!0)}t.$checkbox_cursor=s,t.update_checkbox(s)})}setup_like(){var t=this;this.$result.on("click",".like-action",frappe.ui.click_toggle_like),this.$result.on("click",".list-liked-by-me",function(e){var i=$(e.currentTarget);i.toggleClass("active"),i.hasClass("active")?t.filter_area.add(t.doctype,"_liked_by","like","%"+frappe.session.user+"%"):t.filter_area.remove("_liked_by")})}setup_new_doc_event(){var t=this;this.$no_result.find(".btn-new-doc").click(function(){t.settings.primary_action?t.settings.primary_action():t.make_new_doc()})}setup_tag_event(){var t=this;this.tags_shown=!1,this.list_sidebar&&this.list_sidebar.parent.on("click",".list-tag-preview",function(){t.tags_shown=!t.tags_shown,t.toggle_tags()})}setup_realtime_updates(){var t=this;this.list_view_settings&&this.list_view_settings.disable_auto_refresh||frappe.realtime.on("list_update",function(e){if(!t.filter_area.is_being_edited()){var i=e.doctype,s=e.name;if(i===t.doctype){var a=t.get_call_args();a.args.filters.push([t.doctype,"name","=",s]),a.args.start=0,frappe.call(a).then(function(e){var i=e.message;if(i){var a=frappe.utils.dict(i.keys,i.values);if(!a||!a.length)return t.data=t.data.filter(function(t){return t.name!==s}),void t.render_list();var r=a[0],n=t.data.findIndex(function(t){return t.name===r.name});-1===n?t.data.push(r):t.data[n]=r,t.data.sort(function(e,i){var s=e[t.sort_by]||"",a=i[t.sort_by]||"",r=0;return s>a&&(r=1),a>s&&(r=-1),"desc"===t.sort_order&&(r=-r),r}),t.toggle_result_area(),t.render_list(),t.$checks&&t.$checks.length&&t.set_rows_as_checked()}})}}})}set_rows_as_checked(){var t=this;$.each(this.$checks,function(e,i){var s=$(i).attr("data-name");t.$result.find(".list-row-checkbox[data-name='"+s+"']").prop("checked",!0)}),this.on_row_checked()}on_row_checked(){this.$list_head_subject=this.$list_head_subject||this.$result.find("header .list-header-subject"),this.$checkbox_actions=this.$checkbox_actions||this.$result.find("header .checkbox-actions"),this.$checks=this.$result.find(".list-row-checkbox:checked"),this.$list_head_subject.toggle(0===this.$checks.length),this.$checkbox_actions.toggle(this.$checks.length>0),0===this.$checks.length?this.$list_head_subject.find(".list-check-all").prop("checked",!1):(this.$checkbox_actions.find(".list-header-meta").html(__("{0} items selected",[this.$checks.length])),this.$checkbox_actions.show(),this.$list_head_subject.hide()),this.update_checkbox(),this.toggle_actions_menu_button(this.$checks.length>0)}toggle_tags(){this.$result.find(".tag-col").toggleClass("hide");var t=this.tags_shown?__("Hide Tags"):__("Show Tags");this.list_sidebar.parent.find(".list-tag-preview").text(t)}get_checked_items(t){var e=Array.from(this.$checks||[]).map(function(t){return cstr(unescape($(t).data().name))});return t?e:this.data.filter(function(t){return e.includes(t.name)})}save_view_user_settings(t){return frappe.model.user_settings.save(this.doctype,this.view_name,t)}on_update(){}get_share_url(){var t=this.get_filters_for_args().map(function(t){return t[3]=encodeURIComponent(t[3]),"="===t[2]?t[1]+"="+t[3]:[t[1],"=",JSON.stringify([t[2],t[3]])].join("")}).join("&"),e=window.location.href;return t&&(e+="?"+t),e}share_url(){new frappe.ui.Dialog({title:__("Share URL"),fields:[{fieldtype:"Code",fieldname:"url",label:"URL",default:this.get_share_url(),read_only:1}]}).show()}get_menu_items(){var t=this,e=this.doctype,i=[];return frappe.model.can_import(e)&&i.push({label:__("Import"),action:function(){return frappe.set_route("list","data-import",{reference_doctype:e})},standard:!0}),frappe.model.can_set_user_permissions(e)&&i.push({label:__("User Permissions"),action:function(){return frappe.set_route("list","user-permission",{allow:e})},standard:!0}),frappe.user_roles.includes("System Manager")&&(i.push({label:__("Role Permissions Manager"),action:function(){return frappe.set_route("permission-manager",{doctype:e})},standard:!0}),i.push({label:__("Customize"),action:function(){t.meta&&(t.meta.custom?frappe.set_route("form","doctype",e):t.meta.custom||frappe.set_route("form","customize-form",{doc_type:e}))},standard:!0,shortcut:"Ctrl+J"})),i.push({label:__("Toggle Sidebar"),action:function(){return t.toggle_side_bar()},condition:function(){return!t.hide_sidebar},standard:!0,shortcut:"Ctrl+K"}),i.push({label:__("Share URL"),action:function(){return t.share_url()},standard:!0,shortcut:"Ctrl+L"}),frappe.user.has_role("System Manager")&&1===frappe.boot.developer_mode&&i.push({label:__("Edit DocType"),action:function(){return frappe.set_route("form","doctype",e)},standard:!0}),frappe.user.has_role("System Manager")&&i.push({label:__("List Settings"),action:function(){return t.show_list_settings()},standard:!0}),i}show_list_settings(){var t=this;frappe.model.with_doctype(this.doctype,function(){new ListSettings({listview:t,doctype:t.doctype,settings:t.list_view_settings,meta:frappe.get_meta(t.doctype)})})}get_workflow_action_menu_items(){var t=this,e=[];frappe.model.has_workflow(this.doctype)&&frappe.workflow.get_all_transition_actions(this.doctype).forEach(function(i){e.push({label:__(i),name:i,action:function(){frappe.xcall("frappe.model.workflow.bulk_workflow_approval",{docnames:t.get_checked_items(!0),doctype:t.doctype,action:i})},is_workflow_action:!0})});return e}toggle_workflow_actions(){var t=this;if(frappe.model.has_workflow(this.doctype)){var e=this.get_checked_items();frappe.xcall("frappe.model.workflow.get_common_transition_actions",{docs:e,doctype:this.doctype}).then(function(e){Object.keys(t.workflow_action_items).forEach(function(i){t.workflow_action_items[i].toggle(e.includes(i))})})}}get_actions_menu_items(){var t=this,e=this.doctype,i=[],s=new BulkOperations({doctype:this.doctype}),a=function(t){return t.fieldname&&frappe.model.is_value_type(t)&&"Read Only"!==t.fieldtype&&!t.hidden&&!t.read_only};return function(t){return frappe.meta.get_docfields(t).some(function(t){return a(t)})}(e)&&i.push({label:__("Edit"),action:function(){var i={};frappe.meta.get_docfields(e).forEach(function(t){a(t)&&(i[t.label]=Object.assign({},t))});var r=t.get_checked_items(!0);s.edit(r,i,t.refresh)},standard:!0}),i.push({label:__("Assign To"),action:function(){return s.assign(t.get_checked_items(!0),t.refresh)},standard:!0}),i.push({label:__("Apply Assignment Rule"),action:function(){return s.apply_assignment_rule(t.get_checked_items(!0),t.refresh)},standard:!0}),i.push({label:__("Add Tags"),action:function(){return s.add_tags(t.get_checked_items(!0),t.refresh)},standard:!0}),frappe.model.can_print(e)&&i.push({label:__("Print"),action:function(){return s.print(t.get_checked_items())},standard:!0}),frappe.model.is_submittable(e)&&function(t){return frappe.perm.has_perm(t,0,"submit")}(e)&&!frappe.model.has_workflow(e)&&i.push({label:__("Submit"),action:function(){var e=t.get_checked_items(!0);e.length>0&&frappe.confirm(__("Submit {0} documents?",[e.length]),function(){return s.submit_or_cancel(e,"submit",t.refresh)})},standard:!0}),frappe.model.can_cancel(e)&&!frappe.model.has_workflow(e)&&i.push({label:__("Cancel"),action:function(){var e=t.get_checked_items(!0);e.length>0&&frappe.confirm(__("Cancel {0} documents?",[e.length]),function(){return s.submit_or_cancel(e,"cancel",t.refresh)})},standard:!0}),frappe.model.can_delete(e)&&i.push({label:__("Delete"),action:function(){var e=t.get_checked_items(!0).map(function(t){return t.toString()});frappe.confirm(__("Delete {0} items permanently?",[e.length]),function(){return s.delete(e,t.refresh)})},standard:!0}),i}parse_filters_from_route_options(){var t=[];for(var e in frappe.route_options){var i=null,s=frappe.route_options[e],a=void 0;if($.isArray(s)&&s[0].startsWith("[")&&s[0].endsWith("]")){a=[];for(var r=0;r<s.length;r++)a.push(JSON.parse(s[r]))}else"string"==typeof s&&s.startsWith("[")&&s.endsWith("]")&&(s=JSON.parse(s));if(e.includes(".")&&(i=e.split(".")[0],e=e.split(".")[1]),i||(i=frappe.meta.get_doctype_for_field(this.doctype,e)),i)if(a)for(var n=0;n<a.length;n++)$.isArray(a[n])?t.push([i,e,a[n][0],a[n][1]]):t.push([i,e,"=",a[n]]);else $.isArray(s)?t.push([i,e,s[0],s[1]]):t.push([i,e,"=",s])}return t}static trigger_list_update(t){if(t.doctype){frappe.provide("frappe.views.trees");var e=frappe.get_route_str(),i=frappe.views.list_view[e];i&&i.on_update(t)}}},$(document).on("save",function(t,e){frappe.views.ListView.trigger_list_update(e)}),frappe.get_list_view=function(t){var e="List/"+t+"/List";return frappe.views.list_view[e]},frappe.provide("frappe.views.list_view"),window.cur_list=null,frappe.views.ListFactory=class extends frappe.views.Factory{make(t){var e=this,i=t[1];frappe.model.with_doctype(i,function(){if(locals.DocType[i].issingle)frappe.set_re_route("Form",i);else{var s="File"!==i?frappe.utils.to_title_case(t[2]||"List"):"File",a=frappe.views[s+"View"];if(a||(a=frappe.views.ListView),a&&a.load_last_view&&a.load_last_view())return;frappe.provide("frappe.views.list_view."+i);var r=frappe.get_route_str();frappe.views.list_view[r]?frappe.container.change_to(r):frappe.views.list_view[r]=new a({doctype:i,parent:e.make_page(!0,r)}),e.set_cur_list()}})}show(){this.re_route_to_view()||(this.set_module_breadcrumb(),super.show(),this.set_cur_list(),cur_list&&cur_list.show())}re_route_to_view(){var t=frappe.get_route(),e=t[1],i=frappe.route_history.slice(-2)[0];if("List"===t[0]&&2===t.length&&frappe.views.list_view[e])return!(!i||"List"!==i[0]||i[1]!==e)&&(window.history.go(-1),!0)}set_module_breadcrumb(){if(frappe.route_history.length>1){var t=frappe.route_history[frappe.route_history.length-2];if("modules"===t[0]){var e=frappe.get_route()[1],i=t[1];frappe.module_links[i]&&frappe.module_links[i].includes(e)&&frappe.breadcrumbs.set_doctype_module(e,i)}}}set_cur_list(){var t=frappe.get_route(),e=frappe.get_route_str();cur_list=frappe.views.list_view[e],cur_list&&cur_list.doctype!==t[1]&&(window.cur_list=null)}},frappe.provide("frappe.views"),frappe.views.ListViewSelect=class{constructor(t){$.extend(this,t),this.set_current_view(),this.setup_views()}add_view_to_menu(t,e){this.page.add_custom_menu_item(this.parent,__(t),e,!0,null,this.icon_map[t]||"list").parent().attr("data-view",t)}set_current_view(){this.current_view="List";var t=frappe.get_route(),e=frappe.utils.to_title_case(t[2]||"");t.length>2&&frappe.views.view_modes.includes(e)&&(this.current_view=e,"Kanban"===this.current_view?this.kanban_board=t[3]:"Inbox"===this.current_view&&(this.email_account=t[3]))}set_route(t,e){var i=[this.slug(),"view",t];e&&i.push(e),frappe.set_route(i)}setup_views(){var t=this,e={List:{condition:!0,action:function(){return t.set_route("list")}},Report:{condition:!0,action:function(){return t.set_route("report")},current_view_handler:function(){var e=t.get_reports(),i={};frappe.get_route().length>3&&(i={label:__("Report Builder"),action:function(){return t.set_route("report")}}),t.setup_dropdown_in_sidebar("Report",e,i)}},Dashboard:{condition:!0,action:function(){return t.set_route("dashboard")}},Calendar:{condition:frappe.views.calendar[this.doctype],action:function(){return t.set_route("calendar","default")},current_view_handler:function(){t.get_calendars().then(function(e){t.setup_dropdown_in_sidebar("Calendar",e)})}},Gantt:{condition:frappe.views.calendar[this.doctype],action:function(){return t.set_route("gantt")}},Inbox:{condition:"Communication"===this.doctype&&frappe.boot.email_accounts.length,action:function(){return t.set_route("inbox")},current_view_handler:function(){var e,i=t.get_email_accounts();has_common(frappe.user_roles,["System Manager","Administrator"])&&(e={label:__("New Email Account"),action:function(){return frappe.new_doc("Email Account")}}),t.setup_dropdown_in_sidebar("Inbox",i,e)}},Image:{condition:this.list_view.meta.image_field,action:function(){return t.set_route("image")}},Tree:{condition:frappe.treeview_settings[this.doctype]||frappe.get_meta(this.doctype).is_tree,action:function(){return t.set_route("tree")}},Kanban:{condition:!0,action:function(){return t.setup_kanban_boards()},current_view_handler:function(){frappe.views.KanbanView.get_kanbans(t.doctype).then(function(e){return t.setup_kanban_switcher(e)})}},Map:{condition:this.list_view.settings.get_coords_method||this.list_view.meta.fields.find(function(t){return"latitude"===t.fieldname})&&this.list_view.meta.fields.find(function(t){return"longitude"===t.fieldname})||this.list_view.meta.fields.find(function(t){return"location"===t.fieldname&&"Geolocation"==t.fieldtype}),action:function(){return t.set_route("map")}}};frappe.views.view_modes.forEach(function(i){t.current_view!==i&&e[i].condition&&t.add_view_to_menu(i,e[i].action),t.current_view==i&&e[i].current_view_handler&&e[i].current_view_handler()})}setup_dropdown_in_sidebar(t,e,i){if(this.sidebar){var s=this.sidebar.sidebar.find(".views-section");s.find(".sidebar-label").html(""+__(t));var a=s.find(".views-dropdown"),r=""+__("Select {0}",[__(t)]),n="";if(e&&e.length){var l=this.get_page_name();e.map(function(t){t.name.toLowerCase()==l.toLowerCase()?r=t.name:n+='<li><a class="dropdown-item" href="'+t.route+'">'+t.name+"</a></li>"})}else n='<div class="empty-state">\n\t\t\t\t\t\t'+__("No {0} Found",[__(t)])+"\n\t\t\t\t</div>";s.find(".selected-view").html(r),i&&(s.find(".sidebar-action a").html(i.label),s.find(".sidebar-action a").click(function(){return i.action()})),a.html(n),s.removeClass("hide")}}setup_kanban_switcher(t){var e=this,i=this.page.add_custom_button_group(__("Select Kanban"),null,this.list_view.$filter_section);t.map(function(t){e.page.add_custom_menu_item(i,t.name,function(){return e.set_route("kanban",t.name)},!1)}),this.page.add_custom_menu_item(i,__("Create New Kanban Board"),function(){return frappe.views.KanbanView.show_kanban_dialog(e.doctype)},!0)}get_page_name(){return frappe.utils.to_title_case(frappe.get_route().slice(-1)[0]||"")}get_reports(){var t=this,e=[],i=[],s=function(s){s.map(function(s){if(!s.ref_doctype||s.ref_doctype==t.doctype){var a="Report Builder"===s.report_type?"/app/list/"+s.ref_doctype+"/report":"/app/query-report",r=s.route||a+"/"+(s.title||s.name);-1===e.indexOf(r)&&(e.push(r),i.push({name:s.title||s.name,route:r}))}})};return this.list_view.settings.reports&&s(this.list_view.settings.reports),s(Object.values(frappe.boot.user.all_reports).sort(function(t,e){return t.title.localeCompare(e.title)})||[]),i}setup_kanban_boards(){var t=frappe.model.user_settings[this.doctype].Kanban&&frappe.model.user_settings[this.doctype].Kanban.last_kanban_board;t?frappe.set_route("list",this.doctype,"kanban",t):frappe.views.KanbanView.show_kanban_dialog(this.doctype,!0)}get_calendars(){var t=this,e=this.doctype,i=[];return frappe.db.get_list("Calendar View",{filters:{reference_doctype:e}}).then(function(e){if(e&&Array.isArray(e)&&e.length)return frappe.views.calendar[t.doctype]&&i.push({name:"Default",route:"/app/"+t.slug()+"/view/calendar/default"}),e.map(function(e){i.push({name:e.name,route:"/app/"+t.slug()+"/view/calendar/"+e.name})}),i})}get_email_accounts(){var t=[];return frappe.boot.email_accounts.forEach(function(e){var i="/app/communication/inbox/"+("All Accounts"==e.email_id?"All Accounts":e.email_account),s=["All Accounts","Sent Mail","Spam","Trash"].includes(e.email_id)?__(e.email_id):e.email_account;t.push({name:s,route:i})}),t}slug(){return frappe.router.slug(frappe.router.doctype_layout||this.doctype)}},frappe.provide("frappe.ui");class ListFilter{constructor(t){t.wrapper,t.doctype;Object.assign(this,arguments[0]),this.can_add_global=frappe.user.has_role(["System Manager","Administrator"]),this.filters=[],this.make(),this.bind(),this.refresh()}make(){this.wrapper.html('\n\t\t\t<li class="input-area"></li>\n\t\t\t<li class="sidebar-action">\n\t\t\t\t<a class="saved-filters-preview">'+__("Show Saved")+'</a>\n\t\t\t</li>\n\t\t\t<div class="saved-filters"></div>\n\t\t'),this.$input_area=this.wrapper.find(".input-area"),this.$list_filters=this.wrapper.find(".list-filters"),this.$saved_filters=this.wrapper.find(".saved-filters").hide(),this.$saved_filters_preview=this.wrapper.find(".saved-filters-preview"),this.saved_filters_hidden=!0,this.filter_input=frappe.ui.form.make_control({df:{fieldtype:"Data",placeholder:__("Filter Name"),input_class:"input-xs"},parent:this.$input_area,render_input:1}),this.is_global_input=frappe.ui.form.make_control({df:{fieldtype:"Check",label:__("Is Global")},parent:this.$input_area,render_input:1})}bind(){this.bind_save_filter(),this.bind_toggle_saved_filters(),this.bind_click_filter(),this.bind_remove_filter()}refresh(){var t=this;this.get_list_filters().then(function(){t.filters.length?t.$saved_filters_preview.show():t.$saved_filters_preview.hide();var e=t.filters.map(function(e){return t.filter_template(e)});t.wrapper.find(".filter-pill").remove(),t.$saved_filters.append(e)}),this.is_global_input.toggle(!1),this.filter_input.set_description("")}filter_template(t){return'<div class="list-link filter-pill list-sidebar-button btn btn-default" data-name="'+t.name+'">\n\t\t\t<a class="ellipsis filter-name">'+t.filter_name+'</a>\n\t\t\t<a class="remove">'+frappe.utils.icon("close")+"</a>\n\t\t</div>"}bind_toggle_saved_filters(){var t=this;this.wrapper.find(".saved-filters-preview").click(function(){t.toggle_saved_filters(t.saved_filters_hidden)})}toggle_saved_filters(t){this.$saved_filters.toggle(t);var e=t?__("Hide Saved"):__("Show Saved");this.wrapper.find(".saved-filters-preview").text(e),this.saved_filters_hidden=!this.saved_filters_hidden}bind_click_filter(){var t=this;this.wrapper.on("click",".filter-pill .filter-name",function(e){var i=$(e.currentTarget).parent(".filter-pill");t.set_applied_filter(i);var s=i.attr("data-name");t.list_view.filter_area.clear().then(function(){t.list_view.filter_area.add(t.get_filters_values(s))})})}bind_remove_filter(){var t=this;this.wrapper.on("click",".filter-pill .remove",function(e){var i=$(e.currentTarget).closest(".filter-pill"),s=i.attr("data-name"),a=t.get_filters_values(s);i.remove(),t.remove_filter(s).then(function(){return t.refresh()}),t.list_view.filter_area.remove_filters(a)})}bind_save_filter(){var t=this;this.filter_input.$input.keydown(frappe.utils.debounce(function(e){var i=t.filter_input.get_value(),s=Boolean(i);if(e.which===frappe.ui.keyCode.ENTER){if(!s||t.filter_name_exists(i))return;t.filter_input.set_value(""),t.save_filter(i).then(function(){return t.refresh()}),t.toggle_saved_filters(!0)}else{var a=__("Press Enter to save");t.filter_name_exists(i)&&(a=__("Duplicate Filter Name")),t.filter_input.set_description(s?a:""),t.can_add_global&&t.is_global_input.toggle(s)}},300))}save_filter(t){return frappe.db.insert({doctype:"List Filter",reference_doctype:this.list_view.doctype,filter_name:t,for_user:this.is_global_input.get_value()?"":frappe.session.user,filters:JSON.stringify(this.get_current_filters())})}remove_filter(t){if(t)return frappe.db.delete_doc("List Filter",t)}get_filters_values(t){var e=this.filters.find(function(e){return e.name===t});return JSON.parse(e.filters||"[]")}get_current_filters(){return this.list_view.filter_area.get()}filter_name_exists(t){return(this.filters||[]).find(function(e){return e.filter_name===t})}get_list_filters(){var t=this;return"Guest"===frappe.session.user?Promise.resolve():frappe.db.get_list("List Filter",{fields:["name","filter_name","for_user","filters"],filters:{reference_doctype:this.list_view.doctype},or_filters:[["for_user","=",frappe.session.user],["for_user","=",""]]}).then(function(e){t.filters=e||[]})}set_applied_filter(t){this.$saved_filters.find(".btn-primary-light").toggleClass("btn-primary-light btn-default"),t.toggleClass("btn-default btn-primary-light")}}function redirect_to_home_if_invalid_route(){return"List"===frappe.get_route()[2]&&(frappe.set_route("List","File","Home"),!0)}function get_doc_mappings(){return{Event:{field_map:{interaction_type:"doctype",summary:"subject",description:"description",category:"event_category",due_date:"starts_on",public:"event_type"},reqd_fields:["summary","due_date"],hidden_fields:[]},ToDo:{field_map:{interaction_type:"doctype",description:"description",due_date:"date",reference_doctype:"reference_type",reference_document:"reference_name",assigned_to:"owner"},reqd_fields:["description"],hidden_fields:["public","category"]}}}frappe.provide("frappe.views"),frappe.views.ListSidebar=class{constructor(t){$.extend(this,t),this.make()}make(){var t=this,e=frappe.render_template("list_sidebar",{doctype:this.doctype});this.sidebar=$('<div class="list-sidebar overlay-sidebar hidden-xs hidden-sm"></div>').html(e).appendTo(this.page.sidebar.empty()),this.setup_list_filter(),this.setup_list_group_by(),$(document).trigger("list_sidebar_setup"),this.list_view.list_view_settings&&this.list_view.list_view_settings.disable_sidebar_stats?this.sidebar.find(".list-tags").remove():this.sidebar.find(".list-stats").on("click",function(e){t.reload_stats()})}setup_views(){var t=!1;frappe.views.calendar[this.doctype]&&(this.sidebar.find('.list-link[data-view="Calendar"]').removeClass("hide"),this.sidebar.find('.list-link[data-view="Gantt"]').removeClass("hide"),t=!0),this.sidebar.find('.list-link[data-view="Kanban"]').removeClass("hide"),"Communication"===this.doctype&&frappe.boot.email_accounts.length&&(this.sidebar.find('.list-link[data-view="Inbox"]').removeClass("hide"),t=!0),(frappe.treeview_settings[this.doctype]||frappe.get_meta(this.doctype).is_tree)&&this.sidebar.find(".tree-link").removeClass("hide"),this.current_view="List";var e=frappe.get_route();e.length>2&&frappe.views.view_modes.includes(e[2])&&(this.current_view=e[2],"Kanban"===this.current_view?this.kanban_board=e[3]:"Inbox"===this.current_view&&(this.email_account=e[3])),this.sidebar.find('.list-link[data-view="'+this.current_view+'"] a').attr("disabled","disabled").addClass("disabled"),this.sidebar.find('.list-link[data-view="Kanban"] a, .list-link[data-view="Inbox"] a').attr("disabled",null).removeClass("disabled"),this.list_view.meta.image_field&&(this.sidebar.find('.list-link[data-view="Image"]').removeClass("hide"),t=!0),(this.list_view.settings.get_coords_method||this.list_view.meta.fields.find(function(t){return"latitude"===t.fieldname})&&this.list_view.meta.fields.find(function(t){return"longitude"===t.fieldname})||this.list_view.meta.fields.find(function(t){return"location"===t.fieldname&&"Geolocation"==t.fieldtype}))&&(this.sidebar.find('.list-link[data-view="Map"]').removeClass("hide"),t=!0),t&&this.sidebar.find('.list-link[data-view="List"]').removeClass("hide")}setup_reports(){var t=this,e=[],i=this.page.sidebar.find(".reports-dropdown"),s=!1,a=function(a){$.each(a,function(a,r){if(!r.ref_doctype||r.ref_doctype==t.doctype){var n="Report Builder"===r.report_type?"List/"+r.ref_doctype+"/Report":"query-report",l=r.route||n+"/"+(r.title||r.name);-1===e.indexOf(l)&&(e.push(l),s||(t.get_divider().appendTo(i),s=!0),$('<li><a href="#'+l+'">'+__(r.title||r.name)+"</a></li>").appendTo(i))}})};this.list_view.settings.reports&&a(this.list_view.settings.reports),a(Object.values(frappe.boot.user.all_reports).sort(function(t,e){return t.title.localeCompare(e.title)})||[])}setup_list_filter(){this.list_filter=new ListFilter({wrapper:this.page.sidebar.find(".list-filters"),doctype:this.doctype,list_view:this.list_view})}setup_kanban_boards(){var t=this.page.sidebar.find(".kanban-dropdown");frappe.views.KanbanView.setup_dropdown_in_sidebar(this.doctype,t)}setup_keyboard_shortcuts(){var t=this;this.sidebar.find(".list-link > a, .list-link > .btn-group > a").each(function(e,i){frappe.ui.keys.get_shortcut_group(t.page).add($(i))})}setup_list_group_by(){this.list_group_by=new frappe.views.ListGroupBy({doctype:this.doctype,sidebar:this,list_view:this.list_view,page:this.page})}get_stats(){var t=this;frappe.call({method:"frappe.desk.reportview.get_sidebar_stats",type:"GET",args:{stats:t.stats,doctype:t.doctype,filters:(t.list_view.filter_area?t.list_view.get_filters_for_args():t.default_filters)||[]},callback:function(e){t.render_stat((e.message.stats||{})._user_tags);var i=t.sidebar.find(".list-stats-dropdown");frappe.utils.setup_search(i,".stat-link",".stat-label")}})}render_stat(t){var e=this,i={stats:t,label:__("Tags")},s=$(frappe.render_template("list_sidebar_stat",i)).on("click",".stat-link",function(t){var i=$(t.currentTarget).attr("data-field"),s=$(t.currentTarget).attr("data-label"),a="like",r=e.list_view.filter_area.filter_list.get_filter(i);r&&r.remove(),"No Tags"==s&&(s="%,%",a="not like"),e.list_view.filter_area.add(e.doctype,i,a,s)});this.sidebar.find(".list-stats-dropdown .stat-result").html(s)}reload_stats(){this.sidebar.find(".stat-link").remove(),this.sidebar.find(".stat-no-records").remove(),this.get_stats()}},frappe.templates.list_sidebar='<ul class="list-unstyled sidebar-menu user-actions hide">  <li class="divider"></li> </ul> <ul class="list-unstyled sidebar-menu">  <div class="sidebar-section views-section hide">   <li class="sidebar-label">   </li>   <div class="current-view">    <li class="list-link">     <a class="btn btn-default btn-sm list-sidebar-button"      data-toggle="dropdown"      aria-haspopup="true"      aria-expanded="false"      href="#"     >      <span class="selected-view ellipsis">      </span>      <span>       <svg class="icon icon-xs">        <use xlink:href="#icon-select"></use>       </svg>      </span>     </a>     <ul class="dropdown-menu views-dropdown" role="menu">     </ul>    </li>    <li class="sidebar-action">     <a class="view-action"></a>    </li>   </div>  </div>   <div class="sidebar-section filter-section">   <li class="sidebar-label">    {{ __("Filter By") }}   </li>    <div class="list-group-by">   </div>    <div class="list-tags">    <li class="list-stats list-link">     <a      class="btn btn-default btn-sm list-sidebar-button"      data-toggle="dropdown"      aria-haspopup="true"      aria-expanded="false"      href="#"     >      <span>{{ __("Tags") }}</span>      <span>       <svg class="icon icon-xs">        <use xlink:href="#icon-select"></use>       </svg>      </span>     </a>     <ul class="dropdown-menu list-stats-dropdown" role="menu">      <div class="dropdown-search">       <input type="text" placeholder={{__("Search") }} data-element="search" class="form-control input-xs">      </div>      <div class="stat-result">      </div>     </ul>    </li>    <li class="sidebar-action show-tags">     <a class="list-tag-preview">{{ __("Show Tags") }}</a>    </li>   </div>  </div>   <div class="sidebar-section save-filter-section">   <li class="sidebar-label">    {{ __("Save Filter") }}   </li>   <li class="list-filters list-link"></li> </ul> ',frappe.templates.list_sidebar_stat=' {% if (!stats.length) { %} <li class="stat-no-records text-muted">{{ __("No records tagged.") }}</li> {% } else {  for (var i=0, l=stats.length; i < l; i++) {   var stat_label = stats[i][0];   var stat_count = stats[i][1]; %} <li>  <a class="stat-link dropdown-item" data-label="{{ stat_label %}" data-field="_user_tags" href="#" onclick="return false;">   <span class="stat-label">{{ __(stat_label) }}</span>   <span>{{ stat_count }}</span>  </a> </li>  {% } } %} ',frappe.provide("frappe.views"),frappe.views.ListGroupBy=class{constructor(t){$.extend(this,t),this.make_wrapper(),this.user_settings=frappe.get_user_settings(this.doctype),this.group_by_fields=["assigned_to","owner"],this.user_settings.group_by_fields&&(this.group_by_fields=this.group_by_fields.concat(this.user_settings.group_by_fields)),this.render_group_by_items(),this.make_group_by_fields_modal(),this.setup_dropdown(),this.setup_filter_by()}make_group_by_fields_modal(){var t=this,e=new frappe.ui.Dialog({title:__("Select Filters"),fields:this.get_group_by_dropdown_fields()});e.set_primary_action(__("Save"),function(i){var s=i.group_by_fields;frappe.model.user_settings.save(t.doctype,"group_by_fields",s||null),t.group_by_fields=s?["assigned_to","owner"].concat(s):["assigned_to","owner"],t.render_group_by_items(),t.setup_dropdown(),e.hide()}),e.$body.prepend('\n\t\t\t<div class="filters-search">\n\t\t\t\t<input type="text"\n\t\t\t\t\tplaceholder="'+__("Search")+'"\n\t\t\t\t\tdata-element="search" class="form-control input-xs">\n\t\t\t</div>\n\t\t'),this.page.sidebar.find(".add-list-group-by a").on("click",function(){frappe.utils.setup_search(e.$body,".unit-checkbox",".label-area"),e.show()})}make_wrapper(){this.$wrapper=this.sidebar.sidebar.find(".list-group-by");var t='\n\t\t\t<div class="list-group-by-fields">\n\t\t\t</div>\n\t\t\t<li class="add-list-group-by sidebar-action">\n\t\t\t\t<a class="add-group-by">\n\t\t\t\t\t'+__("Edit Filters")+"\n\t\t\t\t</a>\n\t\t\t</li>\n\t\t";this.$wrapper.html(t)}render_group_by_items(){var t=this,e=this.group_by_fields.map(function(e){var i,s;if("assigned_to"===e)i=__("Assigned To");else if("owner"===e)i=__("Created By");else{i=frappe.meta.get_label(t.doctype,e);var a=frappe.meta.get_docfield(t.doctype,e);if(!a)return;s=a.fieldtype}return'<li class="group-by-field list-link">\n\t\t\t\t\t<a class="btn btn-default btn-sm list-sidebar-button" data-toggle="dropdown"\n\t\t\t\t\taria-haspopup="true" aria-expanded="false"\n\t\t\t\t\tdata-label="'+i+'" data-fieldname="'+e+'" data-fieldtype="'+s+'"\n\t\t\t\t\thref="#" onclick="return false;">\n\t\t\t\t\t\t<span class="ellipsis">'+__(i)+"</span>\n\t\t\t\t\t\t<span>"+frappe.utils.icon("select","xs")+'</span>\n\t\t\t\t\t</a>\n\t\t\t\t\t<ul class="dropdown-menu group-by-dropdown" role="menu">\n\t\t\t\t\t</ul>\n\t\t\t</li>'}).join("");this.$wrapper.find(".list-group-by-fields").html(e)}setup_dropdown(){var t=this;this.$wrapper.find(".group-by-field").on("show.bs.dropdown",function(e){var i=$(e.currentTarget).find(".group-by-dropdown");t.set_loading_state(i);var s=$(e.currentTarget).find("a").attr("data-fieldname"),a=$(e.currentTarget).find("a").attr("data-fieldtype");t.get_group_by_count(s).then(function(e){if(e.length){var r=t.list_view.get_filter_value("assigned_to"==s?"_assign":s);t.render_dropdown_items(e,a,i,r),t.setup_search(i)}else t.set_empty_state(i)})})}set_loading_state(t){t.html('<li>\n\t\t\t<div class="empty-state group-by-loading">\n\t\t\t\t'+__("Loading...")+"\n\t\t\t</div>\n\t\t</li>")}set_empty_state(t){t.html('<div class="empty-state group-by-empty">\n\t\t\t\t'+__("No filters found")+"\n\t\t\t</div>")}setup_search(t){frappe.utils.setup_search(t,".group-by-item",".group-by-value","data-name")}get_group_by_dropdown_fields(){var t=this,e=[],i=this.list_view.meta.fields.filter(function(t){return["Select","Link","Data","Int","Check"].includes(t.fieldtype)});return e.push({label:__(this.doctype),fieldname:"group_by_fields",fieldtype:"MultiCheck",columns:2,options:i.map(function(e){return{label:__(e.label),value:e.fieldname,checked:t.group_by_fields.includes(e.fieldname)}})}),e}get_group_by_count(t){var e=this.list_view.get_filters_for_args();e=e.filter(function(e){return!e.includes("assigned_to"===t?"_assign":t)});var i={doctype:this.doctype,current_filters:e,field:t};return frappe.call("frappe.desk.listview.get_group_by_count",i).then(function(t){var e=t.message||[],i=(e=e.filter(function(t){return 0!==t.count})).find(function(t){return t.name===frappe.session.user});return e=e.filter(function(t){return!["Guest","Administrator",frappe.session.user].includes(t.name)}),i&&e.unshift(i),e})}render_dropdown_items(t,e,i,s){var a=this,r='\n\t\t\t<div class="dropdown-search">\n\t\t\t\t<input type="text"\n\t\t\t\t\tplaceholder="'+__("Search")+'"\n\t\t\t\t\tdata-element="search"\n\t\t\t\t\tclass="dropdown-search-input form-control input-xs"\n\t\t\t\t>\n\t\t\t</div>\n\t\t',n="",l="";t.map(function(t){t.name===s?n=a.get_dropdown_html(t,e,!0):l+=a.get_dropdown_html(t,e)});var o=r+n+l;i.toggleClass("has-selected",Boolean(n)),i.html(o)}get_dropdown_html(t,e,i){void 0===i&&(i=!1);var s=null==t.name?__("Not Set"):t.name;return s===frappe.session.user?s=__("Me"):e&&"Check"==e&&(s="0"==s?__("No"):__("Yes")),'<li class="group-by-item '+(i?"selected":"")+'" data-value="'+(null==t.name?"":encodeURIComponent(t.name))+'">\n\t\t\t<a class="dropdown-item" href="#" onclick="return false;">\n\t\t\t\t'+(i?'<span class="applied"> '+frappe.utils.icon("tick","xs")+" </span>":"")+'\n\t\t\t\t<span class="group-by-value ellipsis" data-name="'+t.name+'">'+s+'</span>\n\t\t\t\t<span class="group-by-count">'+t.count+"</span>\n\t\t\t</a>\n\t\t</li>"}setup_filter_by(){var t=this;this.$wrapper.on("click",".group-by-item",function(e){var i=$(e.currentTarget),s=i.hasClass("selected"),a=i.parents(".group-by-field").find("a").data("fieldname"),r="string"==typeof i.data("value")?decodeURIComponent(i.data("value").trim()):i.data("value");return a="assigned_to"===a?"_assign":a,t.list_view.filter_area.remove(a).then(function(){if(!s)return t.apply_filter(a,r)})})}apply_filter(t,e){var i="=";return""===e&&(i="is",e="not set"),"_assign"===t&&(i="like",e="%"+e+"%"),this.list_view.filter_area.add(this.doctype,t,i,e)}},frappe.templates.list_view_permission_restrictions='<table class="table table-bordered" style="margin: 0;">  <thead>   <th>{{ __("Field") }}</th>   <th>{{ __("Value") }}</th>  </thead>  <tbody>   {% for (let condition of condition_list ) { %}    {% for (let key in condition) { %}    <tr>     <td>{{ __(key) }}</td>     <td>{{ frappe.utils.comma_or(condition[key]) }}</td>    </tr>    {% } %}   {% } %}  </tbody> </table> ',frappe.provide("frappe.views"),frappe.views.GanttView=class extends frappe.views.ListView{get view_name(){return"Gantt"}setup_defaults(){var t=this;return super.setup_defaults().then(function(){t.page_title=t.page_title+" "+__("Gantt"),t.calendar_settings=frappe.views.calendar[t.doctype]||{},"object"==typeof t.calendar_settings.gantt&&Object.assign(t.calendar_settings,t.calendar_settings.gantt),t.calendar_settings.order_by?(t.sort_by=t.calendar_settings.order_by,t.sort_order="asc"):(t.sort_by=t.view_user_settings.sort_by||t.calendar_settings.field_map.start,t.sort_order=t.view_user_settings.sort_order||"asc")})}setup_view(){}prepare_data(t){super.prepare_data(t),this.prepare_tasks()}prepare_tasks(){var t=this,e=this.meta,i=this.calendar_settings.field_map;this.tasks=this.data.map(function(s){var a,r=0;i.progress&&$.isFunction(i.progress)?r=i.progress(s):i.progress&&(r=s[i.progress]),a=e.title_field?s.progress?__("{0} ({1}) - {2}%",[s[e.title_field],s.name,s.progress]):__("{0} ({1})",[s[e.title_field],s.name]):s[i.title];var n={start:s[i.start],end:s[i.end],name:a,id:s[i.id||"name"],doctype:t.doctype,progress:r,dependencies:s.depends_on_tasks||""};return s.color&&frappe.ui.color.validate_hex(s.color)&&(n.custom_class="color-"+s.color.substr(1)),s.is_milestone&&(n.custom_class="bar-milestone"),n})}render(){var t=this;this.load_lib.then(function(){t.render_gantt()})}render_header(){}render_gantt(){var t=this,e=this.view_user_settings.gantt_view_mode||"Day",i=this.calendar_settings.field_map;this.$result.empty(),this.$result.addClass("gantt-modern"),this.gantt=new Gantt(this.$result[0],this.tasks,{bar_height:35,bar_corner_radius:4,resize_handle_width:8,resize_handle_height:28,resize_handle_corner_radius:3,resize_handle_offset:4,view_mode:e,date_format:"YYYY-MM-DD",on_click:function(t){frappe.set_route("Form",t.doctype,t.id)},on_date_change:function(e,s,a){var r;t.can_write&&frappe.db.set_value(e.doctype,e.id,((r={})[i.start]=moment(s).format("YYYY-MM-DD"),r[i.end]=moment(a).format("YYYY-MM-DD"),r))},on_progress_change:function(e,s){var a;if(t.can_write){var r="progress";$.isFunction(i.progress)?r=null:i.progress&&(r=i.progress),r&&frappe.db.set_value(e.doctype,e.id,((a={})[r]=parseInt(s),a))}},on_view_change:function(e){t.save_view_user_settings({gantt_view_mode:e})},custom_popup_html:function(e){var i=t.get_item(e.id),s='<div class="title">'+e.name+'</div>\n\t\t\t\t\t<div class="subtitle">'+moment(e._start).format("MMM D")+" - "+moment(e._end).format("MMM D")+"</div>",a=t.settings.gantt_custom_popup_html;a&&$.isFunction(a)&&(s=a(e,i));return'<div class="details-container">'+s+"</div>"}}),this.setup_view_mode_buttons(),this.set_colors()}setup_view_mode_buttons(){var t=this;if(!(this.$paging_area.find(".gantt-view-mode").length>0)){var e=this.gantt.options.view_modes||[],i='<div class="btn-group gantt-view-mode">\n\t\t\t\t'+e.map(function(e){return'<button type="button"\n\t\t\t\t\t\tclass="btn btn-default btn-sm btn-view-mode '+(i=e,t.gantt.view_is(i)?"btn-info":"")+'"\n\t\t\t\t\t\tdata-value="'+e+'">\n\t\t\t\t\t\t'+__(e)+"\n\t\t\t\t\t</button>";var i}).join("")+"\n\t\t\t</div>";this.$paging_area.find(".level-left").append(i);this.$paging_area.on("click",".btn-view-mode",function(e){var i=$(e.currentTarget);t.$paging_area.find(".btn-view-mode").removeClass("btn-info"),i.addClass("btn-info"),function(e){setTimeout(function(){return t.gantt.change_view_mode(e)},0)}(i.data().value)})}}set_colors(){var t=this.tasks.map(function(t){return t.custom_class}).filter(function(t){return t&&t.startsWith("color-")}).map(function(t){var e=t.replace("#",""),i="#"+t.substr(6);return"\n\t\t\t\t.gantt .bar-wrapper."+e+" .bar {\n\t\t\t\t\tfill: "+i+";\n\t\t\t\t}\n\t\t\t\t.gantt .bar-wrapper."+e+" .bar-progress {\n\t\t\t\t\tfill: "+frappe.ui.color.get_contrast_color(i)+";\n\t\t\t\t}\n\t\t\t"}).join("");t="<style>"+t+"</style>",this.$result.prepend(t)}get_item(t){return this.data.find(function(e){return e.name===t})}get required_libs(){return["assets/frappe/node_modules/frappe-gantt/dist/frappe-gantt.css","assets/frappe/node_modules/frappe-gantt/dist/frappe-gantt.min.js"]}},frappe.provide("frappe.views.calendar"),frappe.provide("frappe.views.calendars"),frappe.views.CalendarView=class extends frappe.views.ListView{static load_last_view(){var t=frappe.get_route();if(3===t.length){var e=t[1],i=frappe.get_user_settings(e).Calendar||{};return t.push(i.last_calendar||"default"),frappe.set_route(t),!0}return!1}toggle_result_area(){}get view_name(){return"Calendar"}setup_defaults(){var t=this;return super.setup_defaults().then(function(){t.page_title=__("{0} Calendar",[t.page_title]),t.calendar_settings=frappe.views.calendar[t.doctype]||{},t.calendar_name=frappe.utils.to_title_case(frappe.get_route()[3]||"")})}setup_page(){this.hide_page_form=!0,super.setup_page()}setup_view(){}before_render(){super.before_render(),this.save_view_user_settings({last_calendar:this.calendar_name})}render(){var t=this;this.calendar?this.calendar.refresh():this.load_lib.then(function(){return t.get_calendar_preferences()}).then(function(e){t.calendar=new frappe.views.Calendar(e)})}get_calendar_preferences(){var t=this,e={doctype:this.doctype,parent:this.$result,page:this.page,list_view:this},i=this.calendar_name;return new Promise(function(s){"Default"===i?(Object.assign(e,frappe.views.calendar[t.doctype]),s(e)):frappe.model.with_doc("Calendar View",i,function(){var t=frappe.get_doc("Calendar View",i);Object.assign(e,{field_map:{id:"name",start:t.start_date_field,end:t.end_date_field,title:t.subject_field,allDay:t.all_day?1:0}}),s(e)})})}get required_libs(){var t=["assets/frappe/js/lib/fullcalendar/fullcalendar.min.css","assets/frappe/js/lib/fullcalendar/fullcalendar.min.js"],e=frappe.boot.user.language;return e&&"en"!==e&&t.push("assets/frappe/js/lib/fullcalendar/locale-all.js"),t}},frappe.views.Calendar=Class.extend({init:function(t){$.extend(this,t),this.get_default_options()},get_default_options:function(){var t=this;return new Promise(function(t){var e=localStorage.getItem("cal_defaultView"),i=localStorage.getItem("cal_weekends");t({defaultView:e||"month",weekends:i||!0})}).then(function(e){t.make_page(),t.setup_options(e),t.make(),t.setup_view_mode_button(e),t.bind()})},make_page:function(){var t=this;t.page.clear_user_actions(),$.each(frappe.boot.calendars,function(e,i){frappe.model.can_read(i)&&t.page.add_menu_item(__(i),function(){frappe.set_route("List",i,"Calendar")})}),$(this.parent).on("show",function(){t.$cal.fullCalendar("refetchEvents")})},make:function(){this.$wrapper=this.parent,this.$cal=$("<div>").appendTo(this.$wrapper),this.footnote_area=frappe.utils.set_footnote(this.footnote_area,this.$wrapper,__("Select or drag across time slots to create a new event.")),this.footnote_area.css({"border-top":"0px"}),this.$cal.fullCalendar(this.cal_options),this.set_css()},setup_view_mode_button:function(t){$(this.footnote_area).find(".btn-weekend").detach();var e='<button class="btn btn-default btn-xs btn-weekend">'+(t.weekends?__("Hide Weekends"):__("Show Weekends"))+"</button>";this.footnote_area.append(e)},set_localStorage_option:function(t,e){localStorage.removeItem(t),localStorage.setItem(t,e)},bind:function(){var t=this;t.$wrapper.find(".fc-button-group").on("click",".btn",function(){var e=$(this).hasClass("fc-agendaWeek-button")?"agendaWeek":$(this).hasClass("fc-agendaDay-button")?"agendaDay":"month";t.set_localStorage_option("cal_defaultView",e)}),t.$wrapper.on("click",".btn-weekend",function(){t.cal_options.weekends=!t.cal_options.weekends,t.$cal.fullCalendar("option","weekends",t.cal_options.weekends),t.set_localStorage_option("cal_weekends",t.cal_options.weekends),t.set_css(),t.setup_view_mode_button(t.cal_options)})},set_css:function(){this.$wrapper.find("button.fc-state-default").removeClass("fc-state-default").addClass("btn btn-default"),this.$wrapper.find(".fc-month-button, .fc-agendaWeek-button, .fc-agendaDay-button").wrapAll('<div class="btn-group" />'),this.$wrapper.find(".fc-prev-button span").attr("class","").html(frappe.utils.icon("left")),this.$wrapper.find(".fc-next-button span").attr("class","").html(frappe.utils.icon("right")),this.$wrapper.find(".fc-today-button").prepend(frappe.utils.icon("today")),this.$wrapper.find(".fc-day-number").wrap('<div class="fc-day"></div>');var t=this.$wrapper.find(".fc-button-group");t.find(".fc-state-active").addClass("active"),t.find(".btn").on("click",function(){t.find(".btn").removeClass("active"),$(this).addClass("active")})},field_map:{id:"name",start:"start",end:"end",allDay:"all_day"},color_map:{danger:"red",success:"green",warning:"orange",default:"blue"},get_system_datetime:function(t){return t._offset=moment(t).tz(frappe.sys_defaults.time_zone)._offset,frappe.datetime.convert_to_system_tz(t)},setup_options:function(t){var e=this;t.meridiem="false",this.cal_options={locale:frappe.boot.user.language||"en",header:{left:"prev, title, next",right:"today, month, agendaWeek, agendaDay"},editable:!0,selectable:!0,selectHelper:!0,forceEventDuration:!0,displayEventTime:!0,defaultView:t.defaultView,weekends:t.weekends,nowIndicator:!0,events:function(t,i,s,a){return frappe.call({method:e.get_events_method||"frappe.desk.calendar.get_events",type:"GET",args:e.get_args(t,i),callback:function(t){var i=t.message||[];i=e.prepare_events(i),a(i)}})},displayEventEnd:!0,eventRender:function(t,e){e.attr("title",t.tooltip)},eventClick:function(t){var i=t.doctype||e.doctype;frappe.model.can_read(i)&&frappe.set_route("Form",i,t.name)},eventDrop:function(t,i,s){e.update_event(t,s)},eventResize:function(t,i,s){e.update_event(t,s)},select:function(t,i,s,a){if("month"!==a.name||i-t!=864e5){var r=frappe.model.get_new_doc(e.doctype);if(r[e.field_map.start]=e.get_system_datetime(t),e.field_map.end&&(r[e.field_map.end]=e.get_system_datetime(i)),e.field_map.allDay){var n=t._ambigTime&&i._ambigTime?1:0;r[e.field_map.allDay]=n,n&&(r[e.field_map.end]=e.get_system_datetime(moment(i).subtract(1,"s")))}frappe.set_route("Form",e.doctype,r.name)}},dayClick:function(t,i,s){if("month"===s.name){var a=$("td[data-date="+t.format("YYYY-MM-DD")+"]");a.hasClass("date-clicked")&&(e.$cal.fullCalendar("changeView","agendaDay"),e.$cal.fullCalendar("gotoDate",t),e.$wrapper.find(".date-clicked").removeClass("date-clicked"),e.$wrapper.find(".fc-month-button").removeClass("active"),e.$wrapper.find(".fc-agendaDay-button").addClass("active")),e.$wrapper.find(".date-clicked").removeClass("date-clicked"),a.addClass("date-clicked")}return!1}},this.options&&$.extend(this.cal_options,this.options)},get_args:function(t,e){return{doctype:this.doctype,start:this.get_system_datetime(t),end:this.get_system_datetime(e),fields:this.fields,filters:this.list_view.filter_area.get(),field_map:this.field_map}},refresh:function(){this.$cal.fullCalendar("refetchEvents")},prepare_events:function(t){var e=this;return(t||[]).map(function(t){return t.id=t.name,t.editable=frappe.model.can_write(t.doctype||e.doctype),t.docstatus&&t.docstatus>0&&(t.editable=!1),$.each(e.field_map,function(e,i){t[e]=t[i]}),e.field_map.allDay||(t.allDay=1),t.start=frappe.datetime.convert_to_user_tz(t.start),t.end=frappe.datetime.convert_to_user_tz(t.end),!frappe.datetime.validate(t.start)&&t.end&&(t.start=frappe.datetime.add_days(t.end,-1)),t.start&&!frappe.datetime.validate(t.end)&&(t.end=frappe.datetime.add_days(t.start,1)),e.fix_end_date_for_event_render(t),e.prepare_colors(t),t.title=frappe.utils.html2text(t.title),t})},prepare_colors:function(t){var e,i;return this.get_css_class?((i=this.color_map[this.get_css_class(t)]||"blue").startsWith("#")&&(i=frappe.ui.color.validate_hex(i)?i:"blue"),t.backgroundColor=frappe.ui.color.get(i,"extra-light"),t.textColor=frappe.ui.color.get(i,"dark")):(e=t.color,frappe.ui.color.validate_hex(e)&&e||(e=frappe.ui.color.get("blue","extra-light")),t.backgroundColor=e,t.textColor=frappe.ui.color.get_contrast_color(e)),t},update_event:function(t,e){return frappe.model.remove_from_locals(this.doctype,t.name),frappe.call({method:this.update_event_method||"frappe.desk.calendar.update_event",args:this.get_update_args(t),callback:function(t){t.exc&&(frappe.show_alert(__("Unable to update event")),e())},error:function(){e()}})},get_update_args:function(t){var e={name:t[this.field_map.id]};return e[this.field_map.start]=this.get_system_datetime(t.start),this.field_map.allDay&&(e[this.field_map.allDay]=t.start._ambigTime&&t.end._ambigTime?1:0),this.field_map.end&&(t.end||(t.end=t.start.add(1,"hour")),e[this.field_map.end]=this.get_system_datetime(t.end),e[this.field_map.allDay]&&(e[this.field_map.end]=this.get_system_datetime(moment(t.end).subtract(1,"s")))),e.doctype=t.doctype||this.doctype,{args:e,field_map:this.field_map}},fix_end_date_for_event_render:function(t){t.allDay&&(t.start=t.start?$.fullCalendar.moment(t.start).stripTime():null,t.end=t.end?$.fullCalendar.moment(t.end).add(1,"day").stripTime():null)}}),frappe.provide("frappe.views"),frappe.views.DashboardView=class extends frappe.views.ListView{get view_name(){return"Dashboard"}setup_defaults(){var t=this;return super.setup_defaults().then(function(){t.page_title=__("{0} Dashboard",[__(t.doctype)]),t.dashboard_settings=frappe.get_user_settings(t.doctype).dashboard_settings||null})}render(){}setup_page(){this.hide_sidebar=!0,this.hide_page_form=!0,this.hide_filters=!0,this.hide_sort_selector=!0,super.setup_page()}setup_view(){this.chart_group||this.number_card_group||(this.setup_dashboard_page(),this.setup_dashboard_customization(),this.make_dashboard())}setup_dashboard_customization(){var t=this;this.page.add_menu_item(__("Customize Dashboard"),function(){return t.customize()}),this.page.add_menu_item(__("Reset Dashboard Customizations"),function(){return t.reset_dashboard_customization()}),this.add_customization_buttons()}setup_dashboard_page(){this.$frappe_list.html('<div class="dashboard-view"></div>'),this.page.clear_secondary_action(),this.$dashboard_page=this.$page.find(".layout-main-section-wrapper").addClass("dashboard-page"),this.page.main.removeClass("frappe-card"),this.$dashboard_wrapper=this.$page.find(".dashboard-view"),this.$chart_header=this.$page.find(".dashboard-header"),frappe.utils.bind_actions_with_object(this.$dashboard_page,this)}add_customization_buttons(){var t=this;this.save_customizations_button=this.page.add_button(__("Save Customizations"),function(){t.save_dashboard_customization(),t.page.standard_actions.show()},{btn_class:"btn-primary"}),this.discard_customizations_button=this.page.add_button(__("Discard"),function(){t.discard_dashboard_customization(),t.page.standard_actions.show()}),this.toggle_customization_buttons(!1)}set_primary_action(){}toggle_customization_buttons(t){this.save_customizations_button.toggle(t),this.discard_customizations_button.toggle(t)}make_dashboard(){var t=this;this.dashboard_settings?(this.charts=this.dashboard_settings.charts,this.number_cards=this.dashboard_settings.number_cards,this.render_dashboard()):frappe.run_serially([function(){return t.fetch_dashboard_items("Dashboard Chart",{chart_type:["in",["Count","Sum","Group By"]],document_type:t.doctype,is_public:1},"charts")},function(){return t.fetch_dashboard_items("Number Card",{document_type:t.doctype,is_public:1},"number_cards")},function(){return t.render_dashboard()}])}render_dashboard(){var t=this;this.$dashboard_wrapper.empty(),frappe.dashboard_utils.get_dashboard_settings().then(function(e){t.dashboard_chart_settings=e.chart_config?JSON.parse(e.chart_config):{},t.charts.map(function(e){e.label=e.chart_name,e.chart_settings=t.dashboard_chart_settings[e.chart_name]||{}}),t.render_dashboard_charts()}),this.render_number_cards(),this.charts.length||this.number_cards.length||this.render_empty_state()}fetch_dashboard_items(t,e,i){var s=this;return frappe.db.get_list(t,{filters:e,fields:["*"]}).then(function(t){s[i]=t})}render_number_cards(){this.number_card_group=new frappe.widget.WidgetGroup({container:this.$dashboard_wrapper,type:"number_card",columns:3,options:{allow_sorting:!0,allow_create:!0,allow_delete:!0,allow_hiding:!0},default_values:{doctype:this.doctype},widgets:this.number_cards||[],in_customize_mode:this.in_customize_mode||!1}),this.in_customize_mode&&this.number_card_group.customize()}render_dashboard_charts(){var t=this;this.chart_group=new frappe.widget.WidgetGroup({container:this.$dashboard_wrapper,type:"chart",columns:2,height:240,options:{allow_sorting:!0,allow_create:!0,allow_delete:!0,allow_hiding:!0,allow_resize:!0},custom_dialog:function(){return t.show_add_chart_dialog()},widgets:this.charts,in_customize_mode:this.in_customize_mode||!1}),this.in_customize_mode&&this.chart_group.customize(),this.chart_group.container.find(".widget-group-head").hide()}render_empty_state(){var t='<div class="msg-box no-border empty-dashboard">\n\t\t\t<div>\n\t\t\t\t<img src="/assets/frappe/images/ui-states/list-empty-state.svg" alt="Generic Empty State" class="null-state">\n\t\t\t</div>\n\t\t\t'+("<p>"+__("You haven't added any Dashboard Charts or Number Cards yet.")+"\n\t\t\t<br>"+__("Click On Customize to add your first widget")+"</p>")+"\n\t\t\t"+('<p><button class="btn btn-primary btn-sm" data-action="customize">\n\t\t\t\t'+__("Customize")+"\n\t\t\t</button></p>")+"\n\t\t</div>";this.$dashboard_wrapper.append(t),this.$empty_state=this.$dashboard_wrapper.find(".empty-dashboard")}customize(){this.in_customize_mode||(this.page.standard_actions.hide(),this.$empty_state&&this.$empty_state.remove(),this.toggle_customize(!0),this.in_customize_mode=!0,this.chart_group.customize(),this.number_card_group.customize())}get_widgets_to_save(t){var e=t.get_widget_config(),i=[];return e.order.map(function(t){i.push(e.widgets[t])}),this.remove_duplicates(i)}save_dashboard_customization(){this.toggle_customize(!1);var t=this.get_widgets_to_save(this.chart_group),e=this.get_widgets_to_save(this.number_card_group);this.dashboard_settings={charts:t,number_cards:e},frappe.model.user_settings.save(this.doctype,"dashboard_settings",this.dashboard_settings),this.make_dashboard()}discard_dashboard_customization(){this.dashboard_settings=frappe.get_user_settings(this.doctype).dashboard_settings||null,this.toggle_customize(!1),this.render_dashboard()}reset_dashboard_customization(){var t=this;frappe.confirm(__("Are you sure you want to reset all customizations?"),function(){t.dashboard_settings=null,frappe.model.user_settings.save(t.doctype,"dashboard_settings",t.dashboard_settings).then(function(){return t.make_dashboard()}),t.toggle_customize(!1)})}toggle_customize(t){this.toggle_customization_buttons(t),this.in_customize_mode=t}show_add_chart_dialog(){var t=this,e=this.get_field_options(),i=new frappe.ui.Dialog({title:__("Add a {0} Chart",[__(this.doctype)]),fields:[{fieldname:"new_or_existing",fieldtype:"Select",label:"Choose an existing chart or create a new chart",options:["New Chart","Existing Chart"],reqd:1},{label:"Chart",fieldname:"chart",fieldtype:"Link",get_query:function(){return{query:"frappe.desk.doctype.dashboard_chart.dashboard_chart.get_charts_for_user",filters:{document_type:t.doctype}}},options:"Dashboard Chart",depends_on:'eval: doc.new_or_existing == "Existing Chart"'},{fieldname:"sb_2",fieldtype:"Section Break",depends_on:'eval: doc.new_or_existing == "New Chart"'},{label:"Chart Label",fieldname:"label",fieldtype:"Data",mandatory_depends_on:'eval: doc.new_or_existing == "New Chart"'},{fieldname:"cb_1",fieldtype:"Column Break"},{label:"Chart Type",fieldname:"chart_type",fieldtype:"Select",options:["Time Series","Group By"],mandatory_depends_on:'eval: doc.new_or_existing == "New Chart"'},{fieldname:"sb_2",fieldtype:"Section Break",label:"Chart Config",depends_on:'eval: doc.chart_type == "Time Series" && doc.new_or_existing == "New Chart"'},{label:"Function",fieldname:"chart_function",fieldtype:"Select",options:["Count","Sum","Average"],default:"Count"},{label:"Timespan",fieldtype:"Select",fieldname:"timespan",depends_on:'eval: doc.chart_type == "Time Series"',options:["Last Year","Last Quarter","Last Month","Last Week"],default:"Last Year"},{fieldname:"cb_2",fieldtype:"Column Break"},{label:"Value Based On",fieldtype:"Select",fieldname:"based_on",options:e.value_fields,depends_on:'eval: doc.chart_function=="Sum"'},{label:"Time Series Based On",fieldtype:"Select",fieldname:"based_on",options:e.date_fields,mandatory_depends_on:'eval: doc.chart_type == "Time Series"'},{label:"Time Interval",fieldname:"time_interval",fieldtype:"Select",depends_on:'eval: doc.chart_type == "Time Series"',options:["Yearly","Quarterly","Monthly","Weekly","Daily"],default:"Monthly"},{fieldname:"sb_2",fieldtype:"Section Break",label:"Chart Config",depends_on:'eval: doc.chart_type == "Group By" && doc.new_or_existing == "New Chart"'},{label:"Group By Type",fieldname:"group_by_type",fieldtype:"Select",options:["Count","Sum","Average"],default:"Count"},{label:"Aggregate Function Based On",fieldtype:"Select",fieldname:"aggregate_function_based_on",options:e.aggregate_function_fields,depends_on:'eval: ["Sum", "Avergage"].includes(doc.group_by_type)'},{fieldname:"cb_2",fieldtype:"Column Break"},{label:"Group By Based On",fieldtype:"Select",fieldname:"group_by_based_on",options:e.group_by_fields,default:"Last Year"},{label:"Number of Groups",fieldtype:"Int",fieldname:"number_of_groups",default:0},{fieldname:"sb_3",fieldtype:"Section Break",depends_on:'eval: doc.new_or_existing == "New Chart"'},{label:"Chart Type",fieldname:"type",fieldtype:"Select",options:["Line","Bar","Percentage","Pie"],depends_on:'eval: doc.new_or_existing == "New Chart"'},{fieldname:"cb_1",fieldtype:"Column Break"},{label:"Chart Color",fieldname:"color",fieldtype:"Color",depends_on:'eval: doc.new_or_existing == "New Chart"'}],primary_action_label:__("Add"),primary_action:function(e){var s=e;"New Chart"==s.new_or_existing?(s.chart_name=s.label,s.chart_type="Time Series"==s.chart_type?s.chart_function:s.chart_type,s.document_type=t.doctype,s.filters_json="[]",frappe.xcall("frappe.desk.doctype.dashboard_chart.dashboard_chart.create_dashboard_chart",{args:s}).then(function(e){t.chart_group.new_widget.on_create({chart_name:e.chart_name,name:e.chart_name,label:s.label})})):t.chart_group.new_widget.on_create({chart_name:s.chart,label:s.chart,name:s.chart}),i.hide()}});i.show()}get_field_options(){var t=[{label:__("Created On"),value:"creation"},{label:__("Last Modified On"),value:"modified"}],e=[],i=[],s=[];return frappe.get_meta(this.doctype).fields.map(function(a){if(["Date","Datetime"].includes(a.fieldtype)&&t.push({label:a.label,value:a.fieldname}),frappe.model.numeric_fieldtypes.includes(a.fieldtype)){if("Currency"==a.fieldtype&&(!a.options||"Company:company:default_currency"!==a.options))return;e.push({label:a.label,value:a.fieldname}),s.push({label:a.label,value:a.fieldname})}["Link","Select"].includes(a.fieldtype)&&i.push({label:a.label,value:a.fieldname})}),{date_fields:t,value_fields:e,group_by_fields:i,aggregate_function_fields:s}}remove_duplicates(t){return t.filter(function(e,i){return t.indexOf(e)===i})}},frappe.provide("frappe.views"),frappe.views.ImageView=class extends frappe.views.ListView{get view_name(){return"Image"}setup_defaults(){var t=this;return super.setup_defaults().then(function(){t.page_title=t.page_title+" "+__("Images")})}setup_view(){this.setup_columns(),this.setup_check_events(),this.setup_like()}set_fields(){this.fields=["name"].concat(this.get_fields_in_list_view().map(function(t){return t.fieldname}),[this.meta.title_field],[this.meta.image_field],["_liked_by"])}prepare_data(t){var e=this;super.prepare_data(t),this.items=this.data.map(function(t){return t._image_url=e.get_image_url(t),t})}render(){var t=this;this.get_attached_images().then(function(){t.render_image_view(),t.gallery?t.gallery.prepare_pswp_items(t.items,t.images_map):t.setup_gallery()})}render_image_view(){var t=this.items.map(this.item_html.bind(this)).join("");this.$page.find(".layout-main-section-wrapper").addClass("image-view"),this.$result.html('\n\t\t\t<div class="image-view-container">\n\t\t\t\t'+t+"\n\t\t\t</div>\n\t\t"),this.render_count()}item_details_html(t){var e=this.get_fields_in_list_view().map(function(t){return t.fieldname})||[],i=this.meta.title_field||"name";e=e.filter(function(t){return t!==i});var s='<div><ul class="list-unstyled image-view-info">',a=!1;return e.forEach(function(e,i){t[e]&&!a&&(s+=0==i?"<li>"+t[e]+"</li>":'<li class="text-muted">'+t[e]+"</li>",a=!0)}),s+="</ul></div>"}item_html(t){t._name=encodeURI(t.name);var e=t._name,i=strip_html(t[this.meta.title_field||"name"]),s=frappe.utils.escape_html(i),a=t._image_url?"":"no-image",r=t._image_url?'<img data-name="'+e+'" src="'+t._image_url+'" alt="'+i+'">':'<span class="placeholder-text">\n\t\t\t\t'+frappe.get_abbr(i)+"\n\t\t\t</span>",n=this.item_details_html(t),l=t._image_url?'<div class="zoom-view" data-name="'+e+'">\n\t\t\t\t'+frappe.utils.icon("expand","xs")+"\n\t\t\t</div>":"";return'\n\t\t\t<div class="image-view-item ellipsis">\n\t\t\t\t<div class="image-view-header">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<input class="level-item list-row-checkbox hidden-xs"\n\t\t\t\t\t\t\ttype="checkbox" data-name="'+escape(t.name)+'">\n\t\t\t\t\t\t'+this.get_like_html(t)+'\n\t\t\t\t\t</div>\n\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="image-view-body '+a+'">\n\t\t\t\t\t<a data-name="'+e+'"\n\t\t\t\t\t\ttitle="'+e+'"\n\t\t\t\t\t\thref="'+this.get_form_link(t)+'"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="image-field"\n\t\t\t\t\t\t\tdata-name="'+e+'"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t'+r+"\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</a>\n\t\t\t\t\t"+l+'\n\t\t\t\t</div>\n\t\t\t\t<div class="image-view-footer">\n\t\t\t\t\t<div class="image-title">\n\t\t\t\t\t\t<span class="ellipsis" title="'+s+'">\n\t\t\t\t\t\t\t<a class="ellipsis" href="'+this.get_form_link(t)+'"\n\t\t\t\t\t\t\t\ttitle="'+s+'" data-doctype="'+this.doctype+'" data-name="'+t.name+'">\n\t\t\t\t\t\t\t\t'+i+"\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t"+n+"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"}get_attached_images(){var t=this;return frappe.call({method:"frappe.core.doctype.file.file.get_attached_images",args:{doctype:this.doctype,names:this.items.map(function(t){return t.name})}}).then(function(e){t.images_map=Object.assign(t.images_map||{},e.message)})}get_header_html(){}setup_gallery(){var t=this;this.gallery=new frappe.views.GalleryView({doctype:this.doctype,items:this.items,wrapper:this.$result,images_map:this.images_map}),this.$result.on("click",".zoom-view",function(e){e.preventDefault(),e.stopPropagation();var i=$(this).data().name;return i=decodeURIComponent(i),t.gallery.show(i),!1})}},frappe.views.GalleryView=Class.extend({init:function(t){$.extend(this,t);var e=this;this.lib_ready=this.load_lib(),this.lib_ready.then(function(){e.prepare()})},prepare:function(){if(this.pswp_root=$("body > .pswp"),0===this.pswp_root.length){var t=frappe.render_template("photoswipe_dom");this.pswp_root=$(t).appendTo("body")}},prepare_pswp_items:function(t,e){var i=this,s=this;return t&&(this.items=this.items.concat(t),this.images_map=e),new Promise(function(t){var e=i.items.map(function(t){var e,i,a='img[data-name="'+t._name+'"]',r=s.wrapper.find(a).get(0);return r&&(e=r.naturalWidth,i=r.naturalHeight),r||(e=(r=s.wrapper.find('.image-field[data-name="'+t._name+'"]').get(0)).getBoundingClientRect().width,i=r.getBoundingClientRect().height),{src:t._image_url,msrc:t._image_url,name:t.name,w:e,h:i,el:r}});i.pswp_items=e,t()})},show:function(t){var e=this;this.lib_ready.then(function(){return e.prepare_pswp_items()}).then(function(){return e._show(t)})},_show:function(t){var e=this,i=this.pswp_items,s={index:i.findIndex(function(e){return e.name===t}),getThumbBoundsFn:function(t){var s='img[data-name="'+i[t]._name+'"]',a=e.wrapper.find(s).get(0);if(a){var r=window.pageYOffset||document.documentElement.scrollTop,n=a.getBoundingClientRect();return{x:n.left,y:n.top+r,w:n.width}}},history:!1,shareEl:!1,showHideOpacity:!0};this.pswp=new PhotoSwipe(this.pswp_root.get(0),PhotoSwipeUI_Default,i,s),this.browse_images(),this.pswp.init()},browse_images:function(){var t=this,e=this.pswp_root.find(".pswp__more-items"),i=this.images_map,s=null;function a(){clearTimeout(s),e.show(),s=setTimeout(r,2e3)}function r(){e.hide()}function n(t){return'<div class="pswp__more-item">\n\t\t\t\t<img src="'+t+'">\n\t\t\t</div>'}this.pswp.listen("afterChange",function(){var t=i[this.currItem.name];if(t&&1!==t.length){a();var s=t.map(n).join("");e.html(s)}else e.html("")}),this.pswp.listen("beforeChange",r),this.pswp.listen("initialZoomOut",r),this.pswp.listen("destroy",function(){$(document).off("mousemove",a)}),e.on("click",".pswp__more-item",function(e){var i=e.target,s=t.pswp.items.findIndex(function(e){return e.name===t.pswp.currItem.name});t.pswp.goTo(s),t.pswp.items.splice(s,1,{src:i.src,w:i.naturalWidth,h:i.naturalHeight,name:t.pswp.currItem.name}),t.pswp.invalidateCurrItems(),t.pswp.updateSize(!0)}),$(document).on("mousemove",a)},load_lib:function(){return new Promise(function(t){var e="assets/frappe/js/lib/photoswipe/";frappe.require([e+"photoswipe.css",e+"default-skin.css",e+"photoswipe.js",e+"photoswipe-ui-default.js"],t)})}}),frappe.provide("frappe.utils.utils"),frappe.provide("frappe.views"),frappe.views.MapView=class extends frappe.views.ListView{get view_name(){return"Map"}setup_defaults(){super.setup_defaults(),this.page_title=__("{0} Map",[this.page_title])}setup_view(){}on_filter_change(){this.get_coords()}render(){var t=this;this.get_coords().then(function(){t.render_map_view()}),this.$paging_area.find(".level-left").append("<div></div>")}render_map_view(){var t=this;if(this.map_id=frappe.dom.get_unique_id(),this.$result.html('<div id="'+this.map_id+'" class="map-view-container"></div>'),L.Icon.Default.imagePath="/assets/frappe/images/leaflet/",this.map=L.map(this.map_id).setView(frappe.utils.map_defaults.center,frappe.utils.map_defaults.zoom),L.tileLayer(frappe.utils.map_defaults.tiles,frappe.utils.map_defaults.options).addTo(this.map),L.control.scale().addTo(this.map),this.coords.features&&this.coords.features.length){this.coords.features.forEach(function(e){return L.geoJSON(e).bindPopup(e.properties.name).addTo(t.map)});var e=this.coords.features[0].geometry.coordinates.reverse();this.map.panTo(e,8)}}get_coords(){var t=this,e=this.settings&&this.settings.get_coords_method||"frappe.geo.utils.get_coords";return cur_list.meta.fields.find(function(t){return"location"===t.fieldname&&"Geolocation"===t.fieldtype})?this.type="location_field":cur_list.meta.fields.find(function(t){return"latitude"===t.fieldname})&&cur_list.meta.fields.find(function(t){return"longitude"===t.fieldname})&&(this.type="coordinates"),frappe.call({method:e,args:{doctype:this.doctype,filters:cur_list.filter_area.get(),type:this.type}}).then(function(e){t.coords=e.message})}get required_libs(){return["assets/frappe/js/lib/leaflet/leaflet.css","assets/frappe/js/lib/leaflet/leaflet.js"]}},frappe.provide("frappe.views"),frappe.views.KanbanView=class extends frappe.views.ListView{static load_last_view(){var t=frappe.get_route();if(3===t.length){var e=t[1],i=frappe.get_user_settings(e).Kanban||{};return i.last_kanban_board?(t.push(i.last_kanban_board),frappe.set_route(t),!0):(frappe.msgprint({title:__("Error"),indicator:"red",message:__("Missing parameter Kanban Board Name")}),frappe.set_route("List",e,"List"),!0)}return!1}get view_name(){return"Kanban"}setup_defaults(){var t=this;return super.setup_defaults().then(function(){return t.board_name=frappe.get_route()[3],t.page_title=__(t.board_name),t.card_meta=t.get_card_meta(),t.page_length=0,t.menu_items.push({label:__("Save filters"),action:function(){t.save_kanban_board_filters()}}),t.get_board()})}setup_paging_area(){}toggle_result_area(){this.$result.toggle(this.data.length>0)}get_board(){var t=this;return frappe.db.get_doc("Kanban Board",this.board_name).then(function(e){t.board=e,t.board.filters_array=JSON.parse(t.board.filters||"[]"),t.filters=t.board.filters_array})}before_refresh(){}setup_page(){this.hide_sidebar=!0,this.hide_page_form=!0,this.hide_card_layout=!0,super.setup_page()}setup_view(){this.board.columns.length>5&&this.page.container.addClass("full-width"),this.setup_realtime_updates(),this.setup_like()}set_fields(){super.set_fields(),this._add_field(this.card_meta.title_field)}before_render(){frappe.model.user_settings.save(this.doctype,"last_view",this.view_name),this.save_view_user_settings({last_kanban_board:this.board_name})}render_list(){}on_filter_change(){JSON.stringify(this.board.filters_array)!==JSON.stringify(this.filter_area.get())?this.page.set_indicator(__("Not Saved"),"orange"):this.page.clear_indicator()}save_kanban_board_filters(){var t=this,e=this.filter_area.get();frappe.call({method:"frappe.desk.doctype.kanban_board.kanban_board.save_filters",args:{board_name:this.board_name,filters:e}}).then(function(i){i.exc?frappe.show_alert({indicator:"red",message:__("There was an error saving filters")}):(frappe.show_alert({indicator:"green",message:__("Filters saved")}),t.board.filters_array=e,t.on_filter_change())})}get_fields(){return this.fields.push([this.board.field_name,this.board.reference_doctype]),super.get_fields()}render(){var t=this.board_name;this.kanban&&t===this.kanban.board_name?this.kanban.update(this.data):this.kanban=new frappe.views.KanbanBoard({doctype:this.doctype,board:this.board,board_name:t,cards:this.data,card_meta:this.card_meta,wrapper:this.$result,cur_list:this,user_settings:this.view_user_settings})}get_card_meta(){var t=frappe.get_meta(this.doctype),e=frappe.model.get_new_doc(this.doctype),i=null,s=!1;this.meta.title_field&&(i=frappe.meta.get_field(this.doctype,this.meta.title_field)),this.meta.fields.forEach(function(t){in_list(["Data","Text","Small Text","Text Editor"],t.fieldtype)&&!t.hidden&&!i&&(i=t)});var a=t.fields.filter(function(t){return t.reqd&&!e[t.fieldname]});return(a.some(function(t){return frappe.model.table_fields.includes(t.fieldtype)})||a.length>1)&&(s=!0),i||(i=frappe.meta.get_field(this.doctype,"name")),{quick_entry:s,title_field:i}}get required_libs(){return["assets/frappe/js/lib/fluxify.min.js","assets/frappe/js/frappe/views/kanban/kanban_board.js"]}},frappe.views.KanbanView.get_kanbans=function(t){var e=[];return frappe.call("frappe.desk.doctype.kanban_board.kanban_board.get_kanban_boards",{doctype:t}).then(function(t){return t.message}).then(function(t){return t&&t.forEach(function(t){var i="/app/"+frappe.router.slug(t.reference_doctype)+"/view/kanban/"+t.name;e.push({name:t.name,route:i})}),e})},frappe.views.KanbanView.show_kanban_dialog=function(t,e){var i=null;frappe.views.KanbanView.get_kanbans(t).then(function(s){(i=function(e,s){if(i)return i;var a=function(e,i){void 0===i&&(i=!1);e.push("Create New Board");var s=[{fieldtype:"Select",fieldname:"selected_kanban",label:__("Choose Kanban Board"),reqd:1,depends_on:"eval: "+i,mandatory_depends_on:"eval: "+i,options:e},{fieldname:"new_kanban_board_sb",fieldtype:"Section Break",depends_on:"eval: !"+i+' || doc.selected_kanban == "Create New Board"'},{fieldtype:"Data",fieldname:"board_name",label:__("Kanban Board Name"),mandatory_depends_on:'eval: doc.selected_kanban == "Create New Board"',description:["Note","ToDo"].includes(t)?__("This Kanban Board will be private"):""}];"Task"===t&&s.push({fieldtype:"Link",fieldname:"project",label:__("Project"),options:"Project"});var a=frappe.get_meta(t).fields.filter(function(t){return"Select"===t.fieldtype&&"kanban_column"!==t.fieldname});a.length>0?s.push({fieldtype:"Select",fieldname:"field_name",label:__("Columns based on"),options:a.map(function(t){return{label:t.label,value:t.fieldname}}),default:a[0],mandatory_depends_on:'eval: doc.selected_kanban == "Create New Board"'}):s=[{fieldtype:"HTML",options:'\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<p class="text-medium">\n\t\t\t\t\t\t'+__('No fields found that can be used as a Kanban Column. Use the Customize Form to add a Custom Field of type "Select".')+'\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<a class="btn btn-xs btn-default" href="/app/customize-form?doc_type='+t+'">\n\t\t\t\t\t\t\t'+__("Customize Form")+"\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t"}];return s}(e.map(function(t){return t.name}),s),r=__("Save");return i=new frappe.ui.Dialog({title:__("New Kanban Board"),fields:a,primary_action_label:r,primary_action:function(){var s,a,r,n=i.get_values();n.selected_kanban&&"Create New Board"!=n.selected_kanban?frappe.set_route(e.find(function(t){return t.name==n.selected_kanban}).route):(s=n.board_name,a=n.field_name,r=n.project,frappe.call({method:"frappe.desk.doctype.kanban_board.kanban_board.quick_kanban_board",args:{doctype:t,board_name:s,field_name:a,project:r},callback:function(e){var i=e.message;i.filters&&(frappe.provide("frappe.kanban_filters"),frappe.kanban_filters[i.kanban_board_name]=i.filters),frappe.set_route("List",t,"Kanban",i.kanban_board_name)}})).then(function(){return i.hide()},function(t){return frappe.msgprint(t)})}})}(s,e)).show()})},frappe.provide("frappe.views"),frappe.views.InboxView=class extends frappe.views.ListView{static load_last_view(){var t,e=frappe.get_route();return!e[3]&&frappe.boot.email_accounts.length?(t="All Accounts"==frappe.boot.email_accounts[0].email_id?"All Accounts":frappe.boot.email_accounts[0].email_account,frappe.set_route("List","Communication","Inbox",t),!0):(e[3]&&("All Accounts"===e[3]||function(t){return frappe.boot.email_accounts.find(function(e){return e.email_account===t})}(e[3]))||frappe.throw(__("No email account associated with the User. Please add an account under User > Email Inbox.")),!1)}get view_name(){return"Inbox"}show(){super.show(),this.save_view_user_settings({last_email_account:this.current_email_account})}setup_defaults(){super.setup_defaults(),this.sort_by=this.view_user_settings.sort_by||"communication_date",this.sort_order=this.view_user_settings.sort_order||"desc",this.email_account=frappe.get_route()[3],this.page_title=this.email_account,this.filters=this.get_inbox_filters()}setup_columns(){this.columns=[],this.columns.push({type:"Subject",df:{label:__("Subject"),fieldname:"subject"}}),this.columns.push({type:"Field",df:{label:this.is_sent_emails?__("To"):__("From"),fieldname:this.is_sent_emails?"recipients":"sender"}})}get_seen_class(t){return Boolean(t.seen)||JSON.parse(t._seen||"[]").includes(frappe.session.user)?"":"bold"}get is_sent_emails(){var t=this.filter_area.get().find(function(t){return"sent_or_received"===t[1]});return t&&"Sent"===t[3]}render_header(){this.$result.find(".list-row-head").remove(),this.$result.prepend(this.get_header_html())}render(){this.setup_columns(),this.render_header(),this.render_list(),this.on_row_checked(),this.render_count()}get_meta_html(t){var e=t.has_attachment?'<span class="fa fa-paperclip fa-large" title="'+__("Has Attachments")+'"></span>':"",i="";t.reference_doctype&&t.reference_doctype!==this.doctype&&(i='<a class="text-muted grey"\n\t\t\t\thref="'+frappe.utils.get_form_link(t.reference_doctype,t.reference_name)+'"\n\t\t\t\ttitle="'+__("Linked with {0}",[t.reference_doctype])+'">\n\t\t\t\t<i class="fa fa-link fa-large"></i>\n\t\t\t</a>');var s=comment_when(t.communication_date,!0);return'\n\t\t\t<div class="level-item list-row-activity">\n\t\t\t\t'+i+"\n\t\t\t\t"+e+"\n\t\t\t\t"+("Closed"==t.status?'<span class="fa fa-check fa-large" title="'+__(t.status)+'"></span>':"Replied"==t.status?'<span class="fa fa-mail-reply fa-large" title="'+__(t.status)+'"></span>':"")+"\n\t\t\t\t"+s+"\n\t\t\t</div>\n\t\t"}get_inbox_filters(){var t=this.email_account,e=[["Communication","communication_type","=","Communication",!0],["Communication","communication_medium","=","Email",!0]],i=[];if("Sent"===t)i=e.concat([["Communication","sent_or_received","=","Sent",!0],["Communication","email_status","not in","Spam,Trash",!0]]);else if(in_list(["Spam","Trash"],t))i=e.concat([["Communication","email_status","=",t,!0],["Communication","email_account","in",frappe.boot.all_accounts,!0]]);else{var s="=";"All Accounts"==t&&(s="in",t=frappe.boot.all_accounts),i=e.concat([["Communication","sent_or_received","=","Received",!0],["Communication","status","=","Open",!0],["Communication","email_account",s,t,!0],["Communication","email_status","not in","Spam,Trash",!0]])}return i}get_no_result_message(){var t,e=this.email_account;return in_list(["Spam","Trash"],e)?__("No {0} mail",[e]):(t=e||frappe.boot.email_accounts.length?{doctype:"Communication",msg:__("No Emails"),label:__("Compose Email")}:{doctype:"Email Account",msg:__("No Email Account"),label:__("New Email Account")},'\n\t\t\t<div class="msg-box no-border">\n\t\t\t\t'+(frappe.model.can_create(t.doctype)?"<p>"+t.msg+'</p>\n\t\t\t<p>\n\t\t\t\t<button class="btn btn-primary btn-sm btn-new-doc">\n\t\t\t\t\t'+t.label+"\n\t\t\t\t</button>\n\t\t\t</p>\n\t\t\t":"<p>"+__("No Email Accounts Assigned")+"</p>")+"\n\t\t\t</div>\n\t\t")}make_new_doc(){this.email_account||frappe.boot.email_accounts.length?new frappe.views.CommunicationComposer:(frappe.route_options={email_id:frappe.session.user_email},frappe.new_doc("Email Account"))}},frappe.provide("frappe.views"),frappe.views.FileView=class extends frappe.views.ListView{static load_last_view(){if(2===frappe.get_route().length){var t=frappe.get_user_settings("File","File");return frappe.set_route("List","File",t.last_folder||frappe.boot.home_folder),!0}return redirect_to_home_if_invalid_route()}get view_name(){return"File"}show(){redirect_to_home_if_invalid_route()||super.show()}setup_view(){var t=this;this.render_header(),this.setup_events(),this.$page.find(".layout-main-section-wrapper").addClass("file-view"),this.add_file_action_buttons(),this.page.add_button(__("Toggle Grid View"),function(){frappe.views.FileView.grid_view=!frappe.views.FileView.grid_view,t.refresh()})}setup_no_result_area(){this.$no_result=$('<div class="no-result">\n\t\t\t<div class="breadcrumbs">'+this.get_breadcrumbs_html()+'</div>\n\t\t\t<div class="text-muted flex justify-center align-center">\n\t\t\t\t'+this.get_no_result_message()+"\n\t\t\t</div>\n\t\t</div>").hide(),this.$frappe_list.append(this.$no_result)}get_args(){var t=super.get_args();return frappe.views.FileView.grid_view&&Object.assign(t,{order_by:"is_folder desc, "+this.sort_by+" "+this.sort_order}),t}set_breadcrumbs(){var t=frappe.get_route();t.splice(-1),"File"!==t[t.length-1]&&frappe.breadcrumbs.add({type:"Custom",label:__("Home"),route:"/app/List/File/Home"})}setup_defaults(){var t=this;return super.setup_defaults().then(function(){t.page_title=__("File Manager");var e=frappe.get_route();t.current_folder=e.slice(2).join("/"),t.filters=[["File","folder","=",t.current_folder,!0]],t.order_by=t.view_user_settings.order_by||"file_name asc",t.menu_items=t.menu_items.concat(t.file_menu_items())})}file_menu_items(){var t=this;return[{label:__("Home"),action:function(){frappe.set_route("List","File","Home")}},{label:__("New Folder"),action:function(){frappe.prompt(__("Name"),function(e){e.value.indexOf("/")>-1&&frappe.throw(__("Folder name should not include '/' (slash)"));var i={file_name:e.value,folder:t.current_folder};frappe.call({method:"frappe.core.doctype.file.file.create_new_folder",args:i})},__("Enter folder name"),__("Create"))}},{label:__("Import Zip"),action:function(){new frappe.ui.FileUploader({folder:t.current_folder,restrictions:{allowed_file_types:[".zip"]},on_success:function(t){frappe.show_alert(__("Unzipping files...")),frappe.call("frappe.core.doctype.file.file.unzip_file",{name:t.name}).then(function(t){t.message&&frappe.show_alert(__("Unzipped {0} files",[t.message]))})}})}}]}add_file_action_buttons(){var t=this;this.$cut_button=this.page.add_button(__("Cut"),function(){frappe.file_manager.cut(t.get_checked_items(),t.current_folder),t.$checks.parents(".file-wrapper").addClass("cut")}).hide(),this.$paste_btn=this.page.add_button(__("Paste"),function(){return frappe.file_manager.paste(t.current_folder)}).hide()}set_fields(){this.fields=this.meta.fields.filter(function(t){return frappe.model.is_value_type(t.fieldtype)&&!t.hidden}).map(function(t){return t.fieldname}).concat(["name","modified","creation"])}prepare_data(t){var e=this;super.prepare_data(t),this.data=this.data.map(function(t){return e.prepare_datum(t)}),"file_name"===this.sort_selector.sort_by&&this.data.sort(function(t,e){return t.is_folder&&!e.is_folder?-1:!t.is_folder&&e.is_folder?1:0})}prepare_datum(t){var e="",i="";t.is_folder?(e="folder-normal",i="folder"):frappe.utils.is_image_file(t.file_name)?(e="image",i="image"):(e="file",i="file");var s=t.file_name||t.file_url;return s=s.slice(0,60),t._title=s,t.icon_class=e,t._type=i,t.subject_html="\n\t\t\t"+frappe.utils.icon(e)+"\n\t\t\t<span>"+s+"</span>\n\t\t\t"+(t.is_private?'<i class="fa fa-lock fa-fw text-warning"></i>':"")+"\n\t\t",t}before_render(){super.before_render(),frappe.model.user_settings.save("File","grid_view",frappe.views.FileView.grid_view),this.save_view_user_settings({last_folder:this.current_folder})}render(){this.$result.empty().removeClass("file-grid-view"),frappe.views.FileView.grid_view?this.render_grid_view():(super.render(),this.render_header())}after_render(){}render_list(){frappe.views.FileView.grid_view?this.render_grid_view():super.render_list()}render_grid_view(){var t=this,e=this.data.map(function(e){var i=e.icon_class+"-large",s="image"==e._type?'<div class="file-image"><img src="'+e.file_url+'" alt="'+e.file_name+'"></div>':frappe.utils.icon(i,{width:"40px",height:"45px"}),a=escape(e.name),r="Folder"!=e.type;return'\n\t\t\t\t<a href="'+t.get_route_url(e)+'"\n\t\t\t\t\tdraggable="'+r+'" class="file-wrapper ellipsis" data-name="'+a+'">\n\t\t\t\t\t<div class="file-header">\n\t\t\t\t\t\t<input class="level-item list-row-checkbox hidden-xs" type="checkbox" data-name="'+a+'">\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="file-body">\n\t\t\t\t\t\t'+s+'\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="file-footer">\n\t\t\t\t\t\t<div class="file-title ellipsis">'+e._title+'</div>\n\t\t\t\t\t\t<div class="file-creation">'+t.get_creation_date(e)+"</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t"}).join("");this.$result.addClass("file-grid-view"),this.$result.empty().html('<div class="file-grid">\n\t\t\t\t'+e+"\n\t\t\t</div>")}get_breadcrumbs_html(){var t=frappe.router.parse().slice(2);return t.map(function(e,i){return i===t.length-1?"<span>"+e+"</span>":'<a href="'+t.reduce(function(t,e,s){return s<=i&&(t+="/"+e),t},"/app/file/view")+'">'+e+"</a>"}).join("&nbsp;/&nbsp;")}get_header_html(){var t=this.get_breadcrumbs_html(),e='\n\t\t\t<div class="list-row-col list-subject level">\n\t\t\t\t'+(frappe.views.FileView.grid_view?"":'<input class="level-item list-check-all hidden-xs" type="checkbox" title="'+__("Select All")+'">')+'\n\t\t\t\t<span class="level-item">'+t+"</span>\n\t\t\t</div>\n\t\t\t"+(frappe.views.FileView.grid_view?"":'<div class="list-row-col ellipsis hidden-xs">\n\t\t\t\t\t<span>'+__("Size")+'</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="list-row-col ellipsis hidden-xs">\n\t\t\t\t\t<span>'+__("Created")+"</span>\n\t\t\t\t</div>")+"\n\t\t";return this.get_header_html_skeleton(e,'<span class="list-count"></span>')}get_route_url(t){return t.is_folder?"/app/List/File/"+t.name:this.get_form_link(t)}get_creation_date(t){var e=t.creation.split(" ")[0];return e===frappe.datetime.now_date()?comment_when(t.creation):frappe.datetime.str_to_user(e)}get_left_html(t){var e=(t=this.prepare_datum(t)).file_size?frappe.form.formatters.FileSize(t.file_size):"",i=this.get_route_url(t);return'\n\t\t\t<div class="list-row-col ellipsis list-subject level">\n\t\t\t\t<span class="level-item file-select">\n\t\t\t\t\t<input class="list-row-checkbox hidden-xs"\n\t\t\t\t\t\ttype="checkbox" data-name="'+t.name+'">\n\t\t\t\t</span>\n\t\t\t\t<span class="level-item  ellipsis" title="'+t.file_name+'">\n\t\t\t\t\t<a class="ellipsis" href="'+i+'" title="'+t.file_name+'">\n\t\t\t\t\t\t'+t.subject_html+'\n\t\t\t\t\t</a>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<div class="list-row-col ellipsis hidden-xs text-muted">\n\t\t\t\t<span>'+e+'</span>\n\t\t\t</div>\n\t\t\t<div class="list-row-col ellipsis hidden-xs text-muted">\n\t\t\t\t<span>'+this.get_creation_date(t)+"</span>\n\t\t\t</div>\n\t\t"}get_right_html(t){return'\n\t\t\t<div class="level-item list-row-activity">\n\t\t\t\t'+comment_when(t.modified)+"\n\t\t\t</div>\n\t\t"}setup_events(){super.setup_events(),this.setup_drag_events()}setup_drag_events(){var t=this;this.$result.on("dragstart",".files .file-wrapper",function(e){e.stopPropagation(),e.originalEvent.dataTransfer.setData("Text",$(e.currentTarget).attr("data-name")),e.target.style.opacity="0.4",frappe.file_manager.cut([{name:$(e.currentTarget).attr("data-name")}],t.current_folder)}),this.$result.on("dragover",function(t){t.preventDefault()},!1),this.$result.on("dragend",".files .file-wrapper",function(t){t.preventDefault(),t.stopPropagation(),t.target.style.opacity="1"}),this.$result.on("drop",function(e){e.stopPropagation(),e.preventDefault();var i=$(e.target).parents(".file-wrapper"),s=e.originalEvent.dataTransfer;if(s)if(s.files&&s.files.length>0)new frappe.ui.FileUploader({files:s.files,folder:t.current_folder});else if(s.getData("Text")&&0!==i.parents(".folders").length){var a=s.getData("Text"),r=decodeURIComponent(i.attr("data-name"));frappe.file_manager.paste(r),frappe.show_alert("File "+a+" moved to "+r)}})}toggle_result_area(){super.toggle_result_area(),this.toggle_cut_paste_buttons()}on_row_checked(){super.on_row_checked(),this.toggle_cut_paste_buttons()}toggle_cut_paste_buttons(){var t=!frappe.file_manager.can_paste||frappe.file_manager.old_folder===this.current_folder,e=!(this.$checks&&this.$checks.length>0);this.$paste_btn.toggle(!t),this.$cut_button.toggle(!e)}},frappe.views.FileView.grid_view=frappe.get_user_settings("File").grid_view||!1,frappe.provide("frappe.treeview_settings"),frappe.provide("frappe.views.trees"),window.cur_tree=null,frappe.views.TreeFactory=class extends frappe.views.Factory{make(t){frappe.model.with_doctype(t[1],function(){var e={doctype:t[1],meta:frappe.get_meta(t[1])};if(!frappe.treeview_settings[t[1]]&&!frappe.meta.get_docfield(t[1],"is_group"))return frappe.msgprint(__("Tree view is not available for {0}",[t[1]])),!1;$.extend(e,frappe.treeview_settings[t[1]]||{}),frappe.views.trees[e.doctype]=new frappe.views.TreeView(e)})}},frappe.views.TreeView=Class.extend({init:function(t){this.opts={},this.opts.get_tree_root=!0,this.opts.show_expand_all=!0,$.extend(this.opts,t),this.doctype=t.doctype,this.args={doctype:this.doctype},this.page_name=frappe.get_route_str(),this.get_tree_nodes=this.opts.get_tree_nodes||"frappe.desk.treeview.get_children",this.get_permissions(),this.make_page(),this.make_filters(),this.root_value=null,this.opts.get_tree_root&&this.get_root(),this.onload(),this.set_menu_item(),this.set_primary_action()},get_permissions:function(){this.can_read=frappe.model.can_read(this.doctype),this.can_create=-1!==frappe.boot.user.can_create.indexOf(this.doctype)||-1!==frappe.boot.user.in_create.indexOf(this.doctype),this.can_write=frappe.model.can_write(this.doctype),this.can_delete=frappe.model.can_delete(this.doctype)},make_page:function(){var t=this;if(this.parent=frappe.container.add_page(this.page_name),frappe.ui.make_app_page({parent:this.parent,single_column:!0}),this.page=this.parent.page,frappe.container.change_to(this.page_name),frappe.breadcrumbs.add(t.opts.breadcrumb||locals.DocType[t.doctype].module,t.doctype),this.set_title(),this.page.main.css({"min-height":"300px"}),this.page.main.addClass("frappe-card"),this.opts.show_expand_all&&this.page.add_inner_button(__("Expand All"),function(){t.tree.load_children(t.tree.root_node,!0)}),this.opts.view_template){var e=$('<div class="row"><div>').appendTo(this.page.main);this.body=$('<div class="col-sm-6 col-xs-12"></div>').appendTo(e),this.node_view=$('<div class="col-sm-6 hidden-xs"></div>').appendTo(e)}else this.body=this.page.main},set_title:function(){this.page.set_title(this.opts.title||__("{0} Tree",[__(this.doctype)]))},onload:function(){this.opts.onload&&this.opts.onload(this)},make_filters:function(){var t=this;frappe.treeview_settings.filters=[],$.each(this.opts.filters||[],function(e,i){frappe.route_options&&frappe.route_options[i.fieldname]&&(i.default=frappe.route_options[i.fieldname]),i.disable_onchange||(i.change=function(){i.onchange&&i.onchange();var e=this.get_value();t.args[i.fieldname]=e,t.root_label=e||t.opts.root_label,t.set_title(),t.make_tree()}),t.page.add_field(i),i.default&&$("[data-fieldname='"+i.fieldname+"']").trigger("change")})},get_root:function(){var t=this;frappe.call({method:t.get_tree_nodes,args:t.args,callback:function(e){e.message&&(e.message.length>1?(t.root_label=t.doctype,t.root_value=""):(t.root_label=e.message[0].value,t.root_value=t.root_label),t.make_tree())}})},make_tree:function(){var t=this;$(this.parent).find(".tree").remove();var e=this.args[this.opts.root_label]||this.root_label||this.opts.root_label,i=this.root_value;null==i&&(i=e),this.tree=new frappe.ui.Tree({parent:this.body,label:e,root_value:i,expandable:!0,args:this.args,method:this.get_tree_nodes,toolbar:this.get_toolbar(),get_label:this.opts.get_label,on_render:this.opts.onrender,on_get_node:this.opts.on_get_node,on_click:function(e){t.select_node(e)}}),cur_tree=this.tree,this.post_render()},rebuild_tree:function(){var t=this;frappe.call({method:"frappe.utils.nestedset.rebuild_tree",args:{doctype:t.doctype,parent_field:"parent_"+t.doctype.toLowerCase().replace(/ /g,"_")},callback:function(e){e.exc||t.make_tree()}})},post_render:function(){this.opts.post_render&&this.opts.post_render(this)},select_node:function(t){this.opts.click&&this.opts.click(t),this.opts.view_template&&(this.node_view.empty(),$(frappe.render_template(this.opts.view_template,{data:t.data,doctype:this.doctype})).appendTo(this.node_view))},get_toolbar:function(){var t=this,e=[{label:__(t.can_write?"Edit":"Details"),condition:function(e){return!e.is_root&&t.can_read},click:function(e){frappe.set_route("Form",t.doctype,e.label)}},{label:__("Add Child"),condition:function(e){return t.can_create&&e.expandable&&!e.hide_add},click:function(e){t.new_node()},btnClass:"hidden-xs"},{label:__("Rename"),condition:function(e){var i=!0;return t.doctype&&frappe.get_meta(t.doctype)&&(frappe.get_meta(t.doctype).allow_rename||(i=!1)),!e.is_root&&t.can_write&&i},click:function(e){frappe.model.rename_doc(t.doctype,e.label,function(i){e.$tree_link.find("a").text(i),e.label=i,t.tree.refresh()})},btnClass:"hidden-xs"},{label:__("Delete"),condition:function(e){return!e.is_root&&t.can_delete},click:function(e){frappe.model.delete_doc(t.doctype,e.label,function(){e.parent.remove()})},btnClass:"hidden-xs"}];return this.opts.toolbar&&this.opts.extend_toolbar?(e=e.filter(function(e){return!t.opts.toolbar.find(function(t){return t.label==e.label})})).concat(this.opts.toolbar):this.opts.toolbar&&!this.opts.extend_toolbar?this.opts.toolbar:e},new_node:function(){var t=this,e=t.tree.get_selected_node();if(e&&e.expandable){this.prepare_fields();var i=new frappe.ui.Dialog({title:__("New {0}",[__(t.doctype)]),fields:t.fields}),s=$.extend({},t.args);s["parent_"+t.doctype.toLowerCase().replace(/ /g,"_")]=t.args.parent,i.set_value("is_group",0),i.set_values(s),i.set_primary_action(__("Create New"),function(){var a=i.get_values();if(a)return a.parent=e.label,a.doctype=t.doctype,e.is_root?a.is_root=e.is_root:a.is_root=!1,i.hide(),frappe.dom.freeze(__("Creating {0}",[t.doctype])),$.extend(s,a),frappe.call({method:t.opts.add_tree_node||"frappe.desk.treeview.add_node",args:s,callback:function(i){i.exc||t.tree.load_children(e)},always:function(){frappe.dom.unfreeze()}})}),i.show()}else frappe.msgprint(__("Select a group node first."))},prepare_fields:function(){var t=this;this.fields=[{fieldtype:"Check",fieldname:"is_group",label:__("Group Node"),description:__("Further nodes can be only created under 'Group' type nodes")}],this.opts.fields&&(this.fields=this.opts.fields),this.ignore_fields=this.opts.ignore_fields||[];var e=$.map(t.opts.meta.fields,function(t){return t.reqd||t.bold&&!t.read_only?t:null}),i=this.fields.map(function(t){return t.fieldname});e.map(function(e){-1===$.inArray(e.fieldname,t.ignore_fields)&&-1===$.inArray(e.fieldname,i)&&t.fields.push(e)})},print_tree:function(){if(!frappe.model.can_print(this.doctype))return frappe.msgprint(__("You are not allowed to print this report")),!1;var t=$(".tree:visible").html(),e=this;frappe.ui.get_print_settings(!1,function(i){var s=__(e.docname||e.doctype);frappe.render_tree({title:s,tree:t,print_settings:i}),frappe.call({method:"frappe.core.doctype.access_log.access_log.make_access_log",args:{doctype:e.doctype,report_name:e.page_name,page:t,method:"Print"}})})},set_primary_action:function(){var t=this;!this.opts.disable_add_node&&this.can_create&&t.page.set_primary_action(__("New"),function(){t.new_node()},"add")},set_menu_item:function(){var me=this;this.menu_items=[{label:__("View List"),action:function(){frappe.set_route("List",me.doctype)}},{label:__("Print"),action:function(){me.print_tree()}},{label:__("Refresh"),action:function(){me.make_tree()}}],frappe.user.has_role("System Manager")&&this.menu_items.push({label:__("Rebuild Tree"),action:function(){me.rebuild_tree()}}),me.opts.menu_items&&me.menu_items.push.apply(me.menu_items,me.opts.menu_items),$.each(me.menu_items,function(i,menu_item){var has_perm=!0;menu_item.condition&&(has_perm=eval(menu_item.condition)),has_perm&&me.page.add_menu_item(menu_item.label,menu_item.action)})}}),frappe.provide("frappe.views"),frappe.provide("frappe.interaction_settings"),frappe.views.InteractionComposer=class{constructor(t){$.extend(this,t),this.make()}make(){var t=this;t.dialog=new frappe.ui.Dialog({title:t.title||t.subject||__("New Activity"),no_submit_on_enter:!0,fields:t.get_fields(),primary_action_label:__("Create"),primary_action:function(){t.create_action()}}),$(document).on("upload_complete",function(e,i){if(t.dialog.display){var s=$(t.dialog.fields_dict.select_attachments.wrapper),a=s.find("[data-file-name]:checked").map(function(){return $(this).attr("data-file-name")});t.render_attach(),a.push(i.name),$.each(a,function(t,e){s.find('[data-file-name="'+e+'"]').prop("checked",!0)})}}),t.prepare(),t.dialog.show()}get_fields(){var t=this,e=Object.keys(get_doc_mappings());return[{label:__("Reference"),fieldtype:"Select",fieldname:"interaction_type",options:e,reqd:1,onchange:function(){var e=t.get_values();t.get_fields().forEach(function(e){"interaction_type"!=e.fieldname&&(t.dialog.set_df_property(e.fieldname,"reqd",0),t.dialog.set_df_property(e.fieldname,"hidden",0))}),t.set_reqd_hidden_fields(e),t.get_event_categories()}},{label:__("Category"),fieldtype:"Select",fieldname:"category",options:"",hidden:1},{label:__("Public"),fieldtype:"Check",fieldname:"public",default:"1"},{fieldtype:"Column Break"},{label:__("Date"),fieldtype:"Datetime",fieldname:"due_date"},{label:__("Assigned To"),fieldtype:"Link",fieldname:"assigned_to",options:"User"},{fieldtype:"Section Break"},{label:__("Summary"),fieldtype:"Data",fieldname:"summary"},{fieldtype:"Section Break"},{fieldtype:"Text Editor",fieldname:"description"},{fieldtype:"Section Break"},{label:__("Select Attachments"),fieldtype:"HTML",fieldname:"select_attachments"}]}get_event_categories(){var t=this;frappe.model.with_doctype("Event",function(){var e=frappe.meta.get_docfield("Event","event_category").options.split("\n");t.dialog.get_input("category").empty().add_options(e)})}prepare(){this.setup_attach()}set_reqd_hidden_fields(t){var e=this;if(t&&"interaction_type"in t){var i=get_doc_mappings();i[t.interaction_type].reqd_fields.forEach(function(t){e.dialog.set_df_property(t,"reqd",1)}),i[t.interaction_type].hidden_fields.forEach(function(t){e.dialog.set_df_property(t,"hidden",1)})}}setup_attach(){var t=this,e=this.dialog.fields_dict,i=$(e.select_attachments.wrapper);this.attachments||(this.attachments=[]);var s={folder:"Home/Attachments",on_success:function(e){return t.attachments.push(e)}};this.frm&&(s={doctype:this.frm.doctype,docname:this.frm.docname,folder:"Home/Attachments",on_success:function(e){t.frm.attachments.attachment_uploaded(e),t.render_attach()}}),$("<h6 class='text-muted add-attachment' style='margin-top: 12px; cursor:pointer;'>"+__("Select Attachments")+"</h6><div class='attach-list'></div>\t\t\t<p class='add-more-attachments'>\t\t\t<a class='text-muted small'><i class='octicon octicon-plus' style='font-size: 12px'></i> "+__("Add Attachment")+"</a></p>").appendTo(i.empty()),i.find(".add-more-attachments a").on("click",function(){return new frappe.ui.FileUploader(s)}),this.render_attach()}render_attach(){var t=this.dialog.fields_dict,e=$(t.select_attachments.wrapper).find(".attach-list").empty(),i=[];this.attachments&&this.attachments.length&&(i=i.concat(this.attachments)),cur_frm&&(i=i.concat(cur_frm.get_files())),i.length&&$.each(i,function(t,i){i.file_name&&(i.file_url=frappe.urllib.get_full_url(i.file_url),$(repl('<p class="checkbox"><label><span><input type="checkbox" data-file-name="%(name)s"></input></span><span class="small">%(file_name)s</span> <a href="%(file_url)s" target="_blank" class="text-muted small"><i class="fa fa-share" style="vertical-align: middle; margin-left: 3px;"></i></label></p>',i)).appendTo(e))})}create_action(){var t=this.dialog.get_primary_btn(),e=this.get_values();if(e){var i=$.map($(this.dialog.wrapper).find("[data-file-name]:checked"),function(t){return $(t).attr("data-file-name")});this.create_interaction(t,e,i)}}get_values(){var t=this.dialog.get_values(!0);return t&&(t.reference_doctype=this.frm.doc.doctype,t.reference_document=this.frm.doc.name),t}create_interaction(t,e,i){var s=this;s.dialog.hide();var a=get_doc_mappings(),r={};return Object.keys(e).forEach(function(t){r[a[e.interaction_type].field_map[t]]=e[t]}),"event_type"in r&&(r.event_type=1==e.public?"Public":"Private"),"Event"==r.doctype&&(r.event_participants=[{reference_doctype:e.reference_doctype,reference_docname:e.reference_document}]),"owner"in r||(r.owner=frappe.session.user),"assigned_by"in r||"ToDo"!=r.doctype||(r.assigned_by=frappe.session.user),frappe.call({method:"frappe.client.insert",args:{doc:r},btn:t,callback:function(t){t.exc?frappe.msgprint(__("There were errors while creating the document. Please try again.")):(frappe.show_alert({message:__("{0} created successfully",[e.interaction_type]),indicator:"green"}),"assigned_to"in e&&s.assign_document(t.message,e.assigned_to),i&&s.add_attachments(t.message,i),cur_frm&&cur_frm.reload_doc())}})}assign_document(t,e){"ToDo"!=t.doctype&&frappe.call({method:"frappe.desk.form.assign_to.add",args:{doctype:t.doctype,name:t.name,assign_to:JSON.stringify([e])},callback:function(t){return t.exc?void frappe.show_alert({message:__("The document could not be correctly assigned"),indicator:"orange"}):void frappe.show_alert({message:__("The document has been assigned to {0}",[e]),indicator:"green"})}})}add_attachments(t,e){frappe.call({method:"frappe.utils.file_manager.add_attachments",args:{doctype:t.doctype,name:t.name,attachments:JSON.stringify(e)},callback:function(t){return t.exc?void frappe.show_alert({message:__("The attachments could not be correctly linked to the new document"),indicator:"orange"}):void 0}})}},frappe.templates.image_view_item_row='<div class="image-view-item has-checkbox ellipsis">  <div class="image-view-header doclist-row">   <div class="list-value">   {{ subject }}   </div>  </div>    <div class="image-view-body">   <a  data-name="{{ data.name }}"    title="{{ data.name }}"    href="/app/Form/{{ data.doctype }}/{{ data.name }}"   >    <div class="image-field"     data-name="{{ data.name }}"     style="     {% if (!data._image_url) { %}      background-color: {{ color }};     {% } %}     border: 0px;"    >     {% if (!data._image_url) { %}     <span class="placeholder-text">      {%= frappe.get_abbr(data._title) %}     </span>     {% } %}     {% if (data._image_url) { %}     <img data-name="{{ data.name }}" src="{{ data._image_url }}" alt="{{data.title}}">     {% } %}     <button class="btn btn-default zoom-view" data-name="{{data.name}}">      <i class="fa fa-search-plus"></i>     </button>    </div>   </a>  </div> </div> ',frappe.templates.photoswipe_dom='    <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">     <div class="pswp__bg"></div>     <div class="pswp__scroll-wrap">       <div class="pswp__container">    <div class="pswp__item"></div>    <div class="pswp__item"></div>    <div class="pswp__item"></div>   </div>    <div class="pswp__more-items">    </div>       <div class="pswp__ui pswp__ui--hidden">     <div class="pswp__top-bar">            <div class="pswp__counter"></div>      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>      <button class="pswp__button pswp__button--share" title="Share"></button>      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>                <div class="pswp__preloader">      <div class="pswp__preloader__icn">        <div class="pswp__preloader__cut">       <div class="pswp__preloader__donut"></div>        </div>      </div>     </div>    </div>     <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">     <div class="pswp__share-tooltip"></div>    </div>     <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">    </button>     <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">    </button>     <div class="pswp__caption">     <div class="pswp__caption__center"></div>    </div>    </div>   </div>  </div>',frappe.templates.kanban_board='<div class="kanban">  <div class="kanban-column add-new-column">   <div class="kanban-column-title compose-column">    <a> + {{ __("Add Column") }}</a>   </div>   <form class="compose-column-form kanban-column-title">    <input class="new-column-title" name="title" type="text" autocomplete="off">   </form>  </div>  <div class="kanban-empty-state text-muted text-center" style="display: none;">   {{ __("Loading...") }}  </div> </div>',frappe.templates.kanban_column='<div class="kanban-column" data-column-value="{{title}}">  <div class="kanban-column-header">   <span class="kanban-column-title">    <span class="indicator-pill {{indicator}}"></span>    <span class="kanban-title ellipsis" title="{{title}}">{{ __(title) }}</span>   </span>   <div class="column-options dropdown pull-right">    <a data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">     <svg class="icon icon-sm">      <use xlink:href="#icon-dot-horizontal"></use>     </svg>    </a>    <ul class="dropdown-menu" style="max-height: 300px; overflow-y: auto;">     <li><a class="dropdown-item" data-action="archive">{{ __("Archive") }}</a></li>    </ul>   </div>  </div>  <div class="add-card">   <div class="ellipsis">    + {{ __("Add " + doctype) }}   </div>  </div>  <div class="kanban-card new-card-area">   <textarea name="title"></textarea>  </div>  <div class="kanban-cards">  </div> </div>',frappe.templates.kanban_card='<div class="kanban-card-wrapper {{ disable_click }}" data-name="{{escape(name)}}">  <a class="kanban-card-redirect" href="#">   <div class="kanban-card content">    {% if(image_url) { %}    <div class="kanban-image">     <img  src="{{image_url}}" alt="{{title}}">    </div>    {% } %}    <div class="kanban-card-body">     <div class="kanban-title-area">      <div class="kanban-card-title ellipsis" title="{{title}}">       {{ title }}      </div>      <div class="kanban-card-creation">       {{ creation }}      </div>     </div>     <div class="kanban-card-meta">     </div>    </div>   </div>  </a> </div>'}();
//# sourceMappingURL=list.min.js.map
