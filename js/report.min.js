var Rollup=function(exports){"use strict";var commonjsGlobal="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function unwrapExports(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}var clusterize_min=createCommonjsModule(function(e){e.exports=function(){function e(e,t,r){return t.addEventListener?t.addEventListener(e,r,!1):t.attachEvent("on"+e,r)}function t(e,t,r){return t.removeEventListener?t.removeEventListener(e,r,!1):t.detachEvent("on"+e,r)}function r(e){return"[object Array]"===Object.prototype.toString.call(e)}function n(e,t){return window.getComputedStyle?window.getComputedStyle(t)[e]:t.currentStyle[e]}var i=function(){for(var e=3,t=document.createElement("b"),r=t.all||[];t.innerHTML="\x3c!--[if gt IE "+ ++e+"]><i><![endif]--\x3e",r[0];);return 4<e?e:document.documentMode}(),o=navigator.platform.toLowerCase().indexOf("mac")+1,a=function(n){if(!(this instanceof a))return new a(n);var i=this,s={rows_in_block:50,blocks_in_cluster:4,tag:null,show_no_data_row:!0,no_data_class:"clusterize-no-data",no_data_text:"No data",keep_parity:!0,callbacks:{}};i.options={};for(var l,d="rows_in_block blocks_in_cluster show_no_data_row no_data_class no_data_text keep_parity tag callbacks".split(" "),c=0;l=d[c];c++)i.options[l]=void 0!==n[l]&&null!=n[l]?n[l]:s[l];for(s=["scroll","content"],c=0;d=s[c];c++)if(i[d+"_elem"]=n[d+"Id"]?document.getElementById(n[d+"Id"]):n[d+"Elem"],!i[d+"_elem"])throw Error("Error! Could not find "+d+" element");i.content_elem.hasAttribute("tabindex")||i.content_elem.setAttribute("tabindex",0);var u=r(n.rows)?n.rows:i.fetchMarkup(),h={};n=i.scroll_elem.scrollTop,i.insertToDOM(u,h),i.scroll_elem.scrollTop=n;var p=!1,_=0,f=!1,g=function(){o&&(f||(i.content_elem.style.pointerEvents="none"),f=!0,clearTimeout(_),_=setTimeout(function(){i.content_elem.style.pointerEvents="auto",f=!1},50)),p!=(p=i.getClusterNum())&&i.insertToDOM(u,h),i.options.callbacks.scrollingProgress&&i.options.callbacks.scrollingProgress(i.getScrollProgress())},m=0,v=function(){clearTimeout(m),m=setTimeout(i.refresh,100)};e("scroll",i.scroll_elem,g),e("resize",window,v),i.destroy=function(e){t("scroll",i.scroll_elem,g),t("resize",window,v),i.html((e?i.generateEmptyRow():u).join(""))},i.refresh=function(e){(i.getRowsHeight(u)||e)&&i.update(u)},i.update=function(e){u=r(e)?e:[],e=i.scroll_elem.scrollTop,u.length*i.options.item_height<e&&(p=i.scroll_elem.scrollTop=0),i.insertToDOM(u,h),i.scroll_elem.scrollTop=e},i.clear=function(){i.update([])},i.getRowsAmount=function(){return u.length},i.getScrollProgress=function(){return this.options.scroll_top/(u.length*this.options.item_height)*100||0};var b=function(e,t){var n=r(t)?t:[];n.length&&(u="append"==e?u.concat(n):n.concat(u),i.insertToDOM(u,h))};i.append=function(e){b("append",e)},i.prepend=function(e){b("prepend",e)}};return a.prototype={constructor:a,fetchMarkup:function(){for(var e=[],t=this.getChildNodes(this.content_elem);t.length;)e.push(t.shift().outerHTML);return e},exploreEnvironment:function(e,t){var r=this.options;r.content_tag=this.content_elem.tagName.toLowerCase(),e.length&&(i&&9>=i&&!r.tag&&(r.tag=e[0].match(/<([^>\s\/]*)/)[1].toLowerCase()),1>=this.content_elem.children.length&&(t.data=this.html(e[0]+e[0]+e[0])),r.tag||(r.tag=this.content_elem.children[0].tagName.toLowerCase()),this.getRowsHeight(e))},getRowsHeight:function(e){var t=this.options,r=t.item_height;if(t.cluster_height=0,e.length){var i=(e=this.content_elem.children)[Math.floor(e.length/2)];return t.item_height=i.offsetHeight,"tr"==t.tag&&"collapse"!=n("borderCollapse",this.content_elem)&&(t.item_height+=parseInt(n("borderSpacing",this.content_elem),10)||0),"tr"!=t.tag&&(e=parseInt(n("marginTop",i),10)||0,i=parseInt(n("marginBottom",i),10)||0,t.item_height+=Math.max(e,i)),t.block_height=t.item_height*t.rows_in_block,t.rows_in_cluster=t.blocks_in_cluster*t.rows_in_block,t.cluster_height=t.blocks_in_cluster*t.block_height,r!=t.item_height}},getClusterNum:function(){return this.options.scroll_top=this.scroll_elem.scrollTop,Math.floor(this.options.scroll_top/(this.options.cluster_height-this.options.block_height))||0},generateEmptyRow:function(){var e=this.options;if(!e.tag||!e.show_no_data_row)return[];var t,r=document.createElement(e.tag),n=document.createTextNode(e.no_data_text);return r.className=e.no_data_class,"tr"==e.tag&&((t=document.createElement("td")).colSpan=100,t.appendChild(n)),r.appendChild(t||n),[r.outerHTML]},generate:function(e,t){var r=this.options;if((a=e.length)<r.rows_in_block)return{top_offset:0,bottom_offset:0,rows_above:0,rows:a?e:this.generateEmptyRow()};var n=Math.max((r.rows_in_cluster-r.rows_in_block)*t,0),i=n+r.rows_in_cluster,o=Math.max(n*r.item_height,0),a=(r=Math.max((a-i)*r.item_height,0),[]),s=n;for(1>o&&s++;n<i;n++)e[n]&&a.push(e[n]);return{top_offset:o,bottom_offset:r,rows_above:s,rows:a}},renderExtraTag:function(e,t){var r=document.createElement(this.options.tag);return r.className=["clusterize-extra-row","clusterize-"+e].join(" "),t&&(r.style.height=t+"px"),r.outerHTML},insertToDOM:function(e,t){this.options.cluster_height||this.exploreEnvironment(e,t);var r=this.generate(e,this.getClusterNum()),n=r.rows.join(""),i=this.checkChanges("data",n,t),o=this.checkChanges("top",r.top_offset,t),a=this.checkChanges("bottom",r.bottom_offset,t),s=this.options.callbacks,l=[];i||o?(r.top_offset&&(this.options.keep_parity&&l.push(this.renderExtraTag("keep-parity")),l.push(this.renderExtraTag("top-space",r.top_offset))),l.push(n),r.bottom_offset&&l.push(this.renderExtraTag("bottom-space",r.bottom_offset)),s.clusterWillChange&&s.clusterWillChange(),this.html(l.join("")),"ol"==this.options.content_tag&&this.content_elem.setAttribute("start",r.rows_above),s.clusterChanged&&s.clusterChanged()):a&&(this.content_elem.lastChild.style.height=r.bottom_offset+"px")},html:function(e){var t=this.content_elem;if(i&&9>=i&&"tr"==this.options.tag){var r=document.createElement("div");for(r.innerHTML="<table><tbody>"+e+"</tbody></table>";e=t.lastChild;)t.removeChild(e);for(r=this.getChildNodes(r.firstChild.firstChild);r.length;)t.appendChild(r.shift())}else t.innerHTML=e},getChildNodes:function(e){for(var t=[],r=0,n=(e=e.children).length;r<n;r++)t.push(e[r]);return t},checkChanges:function(e,t,r){var n=t!=r[e];return r[e]=t,n}},a}()});frappe.views.ReportFactory=class extends frappe.views.Factory{make(e){var t=["List",e[1],"Report"];e[2]&&t.push(e[2]),frappe.set_route(t)}};var Sortable=createCommonjsModule(function(e){var t;t=function(){if("undefined"==typeof window||!window.document)return function(){throw new Error("Sortable.js requires a window with a document")};var e,t,r,n,i,o,a,s,l,d,c,u,h,p,_,f,g,m,v,b,y,w,C,x,R,S=[],k=!1,T=!1,E=!1,I=[],D=!1,$=!1,H=/\s+/g,M="Sortable"+(new Date).getTime(),L=window,A=L.document,j=L.parseInt,O=L.setTimeout,N=L.jQuery||L.Zepto,F=L.Polymer,P={capture:!1,passive:!1},B=!!navigator.userAgent.match(/(?:Trident.*rv[ :]?11\.|msie|iemobile)/i),W=!!navigator.userAgent.match(/Edge/i),q=W||B?"cssFloat":"float",z="draggable"in A.createElement("div"),Y=function(){if(B)return!1;var e=A.createElement("x");return e.style.cssText="pointer-events:auto","auto"===e.style.pointerEvents}(),V=!1,X=!1,G=Math.abs,U=Math.min,K=[],Q=function(e,t){var r=fe(e),n=j(r.width),i=Ce(e,0,t),o=Ce(e,1,t),a=i&&fe(i),s=o&&fe(o),l=a&&j(a.marginLeft)+j(a.marginRight)+He(i).width,d=s&&j(s.marginLeft)+j(s.marginRight)+He(o).width;if("flex"===r.display)return"column"===r.flexDirection||"column-reverse"===r.flexDirection?"vertical":"horizontal";if(i&&"none"!==a.float){var c="left"===a.float?"left":"right";return!o||"both"!==s.clear&&s.clear!==c?"horizontal":"vertical"}return i&&("block"===a.display||"flex"===a.display||"table"===a.display||"grid"===a.display||l>=n&&"none"===r[q]||o&&"none"===r[q]&&l+d>n)?"vertical":"horizontal"},J=function(e,t){if(!e||!e.getBoundingClientRect)return L;var r=e,n=!1;do{if(r.clientWidth<r.scrollWidth||r.clientHeight<r.scrollHeight){var i=fe(r);if(r.clientWidth<r.scrollWidth&&("auto"==i.overflowX||"scroll"==i.overflowX)||r.clientHeight<r.scrollHeight&&("auto"==i.overflowY||"scroll"==i.overflowY)){if(!r||!r.getBoundingClientRect||r===A.body)return L;if(n||t)return r;n=!0}}}while(r=r.parentNode);return L},Z=Te(function(e,t,r,n){if(t.scroll){var i=r?r[M]:window,o=t.scrollSensitivity,a=t.scrollSpeed,c=e.clientX,u=e.clientY,h=(window.innerWidth,window.innerHeight,!1);l!==r&&(ee(),s=t.scroll,d=t.scrollFn,!0===s&&(s=J(r,!0),l=s));var p=0,_=s;do{var f,g,m,b,y,w,C,x,R,T=_,E=He(T),I=E.top,D=E.bottom,$=E.left,H=E.right,j=E.width,O=E.height;if(T!==L?(f=T.scrollWidth,g=T.scrollHeight,m=fe(T),w=j<f&&("auto"===m.overflowX||"scroll"===m.overflowX),C=O<g&&("auto"===m.overflowY||"scroll"===m.overflowY),x=T.scrollLeft,R=T.scrollTop):(f=A.documentElement.scrollWidth,g=A.documentElement.scrollHeight,m=fe(A.documentElement),w=j<f&&("auto"===m.overflowX||"scroll"===m.overflowX||"visible"===m.overflowX),C=O<g&&("auto"===m.overflowY||"scroll"===m.overflowY||"visible"===m.overflowY),x=A.documentElement.scrollLeft,R=A.documentElement.scrollTop),b=w&&(G(H-c)<=o&&x+j<f)-(G($-c)<=o&&!!x),y=C&&(G(D-u)<=o&&R+O<g)-(G(I-u)<=o&&!!R),!S[p])for(var N=0;N<=p;N++)S[N]||(S[N]={});S[p].vx==b&&S[p].vy==y&&S[p].el===T||(S[p].el=T,S[p].vx=b,S[p].vy=y,clearInterval(S[p].pid),!T||0==b&&0==y||(h=!0,S[p].pid=setInterval(function(){n&&0===this.layer&&de.active._emulateDragOver(!0);var t=S[this.layer].vy?S[this.layer].vy*a:0,r=S[this.layer].vx?S[this.layer].vx*a:0;"function"==typeof d&&"continue"!==d.call(i,r,t,e,v,S[this.layer].el)||(S[this.layer].el===L?L.scrollTo(L.pageXOffset+r,L.pageYOffset+t):(S[this.layer].el.scrollTop+=t,S[this.layer].el.scrollLeft+=r))}.bind({layer:p}),24))),p++}while(t.bubbleScroll&&_!==L&&(_=J(_,!1)));k=h}},30),ee=function(){S.forEach(function(e){clearInterval(e.pid)}),S=[]},te=function(e){function t(e,r){return function(n,i,o,a){var s=n.options.group.name&&i.options.group.name&&n.options.group.name===i.options.group.name;if(null==e&&(r||s))return!0;if(null==e||!1===e)return!1;if(r&&"clone"===e)return e;if("function"==typeof e)return t(e(n,i,o,a),r)(n,i,o,a);var l=(r?n:i).options.group.name;return!0===e||"string"==typeof e&&e===l||e.join&&e.indexOf(l)>-1}}var r={},n=e.group;n&&"object"==typeof n||(n={name:n}),r.name=n.name,r.checkPull=t(n.pull,!0),r.checkPut=t(n.put),r.revertClone=n.revertClone,e.group=r},re=function(t){e&&e.parentNode&&e.parentNode[M]&&e.parentNode[M]._computeIsAligned(t)},ne=function(e,t){for(var r=t;!r[M];)r=r.parentNode;return e===r},ie=function(e,t,r){for(var n=e.parentNode;n&&!n[M];)n=n.parentNode;n&&n[M][r](Ee(t,{artificialBubble:!0}))},oe=function(){!Y&&r&&fe(r,"display","none")},ae=function(){!Y&&r&&fe(r,"display","")};A.addEventListener("click",function(e){if(E)return e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),E=!1,!1},!0);var se,le=function(t){if(t=t.touches?t.touches[0]:t,e){var r=function(e,t){for(var r=0;r<I.length;r++)if(!I[r].children.length){var n=He(I[r]),i=I[r][M].options.emptyInsertThreshold,o=e>=n.left-i&&e<=n.right+i,a=t>=n.top-i&&t<=n.bottom+i;if(o&&a)return I[r]}}(t.clientX,t.clientY);r&&r[M]._onDragOver({clientX:t.clientX,clientY:t.clientY,target:r,rootEl:r})}};function de(e,t){if(!e||!e.nodeType||1!==e.nodeType)throw"Sortable: `el` must be HTMLElement, not "+{}.toString.call(e);this.el=e,this.options=t=Ee({},t),e[M]=this;var r={group:null,sort:!0,disabled:!1,store:null,handle:null,scroll:!0,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0,draggable:/[uo]l/i.test(e.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Q(e,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(e,t){e.setData("Text",t.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,touchStartThreshold:j(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==de.supportPointer&&("PointerEvent"in window||window.navigator&&"msPointerEnabled"in window.navigator),emptyInsertThreshold:5};for(var n in r)!(n in t)&&(t[n]=r[n]);for(var i in te(t),this)"_"===i.charAt(0)&&"function"==typeof this[i]&&(this[i]=this[i].bind(this));this.nativeDraggable=!t.forceFallback&&z,t.supportPointer?he(e,"pointerdown",this._onTapStart):(he(e,"mousedown",this._onTapStart),he(e,"touchstart",this._onTapStart)),this.nativeDraggable&&(he(e,"dragover",this),he(e,"dragenter",this)),I.push(this.el),t.store&&t.store.get&&this.sort(t.store.get(this)||[])}function ce(e,t,r,n){if(e){r=r||A;do{if(null!=t&&(">"===t[0]&&e.parentNode===r&&ke(e,t.substring(1))||ke(e,t))||n&&e===r)return e;if(e===r)break}while(e=ue(e))}return null}function ue(e){return e.host&&e!==A&&e.host.nodeType?e.host:e.parentNode}function he(e,t,r){e.addEventListener(t,r,P)}function pe(e,t,r){e.removeEventListener(t,r,P)}function _e(e,t,r){if(e&&t)if(e.classList)e.classList[r?"add":"remove"](t);else{var n=(" "+e.className+" ").replace(H," ").replace(" "+t+" "," ");e.className=(n+(r?" "+t:"")).replace(H," ")}}function fe(e,t,r){var n=e&&e.style;if(n){if(void 0===r)return A.defaultView&&A.defaultView.getComputedStyle?r=A.defaultView.getComputedStyle(e,""):e.currentStyle&&(r=e.currentStyle),void 0===t?r:r[t];t in n||-1!==t.indexOf("webkit")||(t="-webkit-"+t),n[t]=r+("string"==typeof r?"":"px")}}function ge(e){var t="";do{var r=fe(e,"transform");r&&"none"!==r&&(t=r+" "+t)}while(e=e.parentNode);return window.DOMMatrix?new DOMMatrix(t):window.WebKitCSSMatrix?new WebKitCSSMatrix(t):window.CSSMatrix?new CSSMatrix(t):void 0}function me(e,t,r){if(e){var n=e.getElementsByTagName(t),i=0,o=n.length;if(r)for(;i<o;i++)r(n[i],i);return n}return[]}function ve(e,t,r,i,o,a,s,l,d){var c,u=(e=e||t[M]).options,h="on"+r.charAt(0).toUpperCase()+r.substr(1);!window.CustomEvent||B||W?(c=A.createEvent("Event")).initEvent(r,!0,!0):c=new CustomEvent(r,{bubbles:!0,cancelable:!0}),c.to=o||t,c.from=a||t,c.item=i||t,c.clone=n,c.oldIndex=s,c.newIndex=l,c.originalEvent=d,t&&t.dispatchEvent(c),u[h]&&u[h].call(e,c)}function be(e,t,r,n,i,o,a,s){var l,d,c=e[M],u=c.options.onMove;return!window.CustomEvent||B||W?(l=A.createEvent("Event")).initEvent("move",!0,!0):l=new CustomEvent("move",{bubbles:!0,cancelable:!0}),l.to=t,l.from=e,l.dragged=r,l.draggedRect=n,l.related=i||t,l.relatedRect=o||He(t),l.willInsertAfter=s,l.originalEvent=a,e.dispatchEvent(l),u&&(d=u.call(c,l,a)),d}function ye(e){e.draggable=!1}function we(){V=!1}function Ce(t,n,i){for(var o=0,a=0,s=t.children;a<s.length;){if("none"!==s[a].style.display&&s[a]!==r&&s[a]!==e&&ce(s[a],i.draggable,t,!1)){if(o===n)return s[a];o++}a++}return null}function xe(e){for(var t=e.lastElementChild;(t===r||"none"===t.style.display)&&(t=t.previousElementSibling););return t||null}function Re(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,r=t.length,n=0;r--;)n+=t.charCodeAt(r);return n.toString(36)}function Se(e,t){var r=0;if(!e||!e.parentNode)return-1;for(;e&&(e=e.previousElementSibling);)"TEMPLATE"!==e.nodeName.toUpperCase()&&e!==n&&r++;return r}function ke(e,t){if(e)try{if(e.matches)return e.matches(t);if(e.msMatchesSelector)return e.msMatchesSelector(t);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(t)}catch(e){return!1}return!1}function Te(e,t){return function(){if(!se){var r=arguments,n=this;se=O(function(){1===r.length?e.call(n,r[0]):e.apply(n,r),se=void 0},t)}}}function Ee(e,t){if(e&&t)for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}function Ie(e){return F&&F.dom?F.dom(e).cloneNode(!0):N?N(e).clone(!0)[0]:e.cloneNode(!0)}function De(e){return O(e,0)}function $e(e){return clearTimeout(e)}function He(e,t,r){if(e.getBoundingClientRect||e===L){var n,i,o,a,s,l,d;if(e!==L?(i=(n=e.getBoundingClientRect()).top,o=n.left,a=n.bottom,s=n.right,l=n.height,d=n.width):(i=0,o=0,a=window.innerHeight,s=window.innerWidth,l=window.innerHeight,d=window.innerWidth),r&&e!==L){if(t=t||e.parentNode,!B)do{if(t&&t.getBoundingClientRect&&"none"!==fe(t,"transform")){var c=t.getBoundingClientRect();i-=c.top+j(fe(t,"border-top-width")),o-=c.left+j(fe(t,"border-left-width")),a=i+n.height,s=o+n.width;break}}while(t=t.parentNode);var u=ge(e),h=u&&u.a,p=u&&u.d;u&&(a=(i/=p)+(l/=p),s=(o/=h)+(d/=h))}return{top:i,left:o,bottom:a,right:s,width:d,height:l}}}return he(A,"dragover",le),he(A,"mousemove",le),he(A,"touchmove",le),de.prototype={constructor:de,_computeIsAligned:function(t){var n;if(r&&!Y?(oe(),n=A.elementFromPoint(t.clientX,t.clientY),ae()):n=t.target,n=ce(n,this.options.draggable,this.el,!1),!X&&e&&e.parentNode===this.el){for(var i,o,a,s,l,d,c,u,h=this.el.children,p=0;p<h.length;p++)ce(h[p],this.options.draggable,this.el,!1)&&h[p]!==n&&(h[p].sortableMouseAligned=(i=t.clientX,o=t.clientY,a=h[p],s=this._getDirection(t,null),this.options,l=void 0,d=void 0,c=void 0,u=void 0,l=He(a),d="vertical"===s?l.left:l.top,c="vertical"===s?l.right:l.bottom,d<(u="vertical"===s?i:o)&&u<c));ce(n,this.options.draggable,this.el,!0)||(y=null),X=!0,O(function(){X=!1},30)}},_getDirection:function(t,r){return"function"==typeof this.options.direction?this.options.direction.call(this,t,r,e):this.options.direction},_onTapStart:function(t){if(t.cancelable){var r,n=this,i=this.el,o=this.options,s=o.preventOnFilter,l=t.type,d=t.touches&&t.touches[0],c=(d||t).target,u=t.target.shadowRoot&&(t.path&&t.path[0]||t.composedPath&&t.composedPath()[0])||c,h=o.filter;if(function(e){K.length=0;var t=e.getElementsByTagName("input"),r=t.length;for(;r--;){var n=t[r];n.checked&&K.push(n)}}(i),(!B||t.artificialBubble||ne(i,c))&&!e&&!(/mousedown|pointerdown/.test(l)&&0!==t.button||o.disabled||u.isContentEditable))if(c=ce(c,o.draggable,i,!1)){if(a!==c){if(r=Se(c,o.draggable),"function"==typeof h){if(h.call(this,t,c,this))return ve(n,u,"filter",c,i,i,r),void(s&&t.cancelable&&t.preventDefault())}else if(h&&(h=h.split(",").some(function(e){if(e=ce(u,e.trim(),i,!1))return ve(n,e,"filter",c,i,i,r),!0})))return void(s&&t.cancelable&&t.preventDefault());o.handle&&!ce(u,o.handle,i,!1)||this._prepareDragStart(t,d,c,r)}}else B&&ie(i,t,"_onTapStart")}},_handleAutoScroll:function(t,r){if(e&&this.options.scroll){var n=t.clientX,i=t.clientY,o=A.elementFromPoint(n,i),a=this;if(r||W||B){Z(t,a.options,o,r);var s=J(o,!0);!k||_&&n===f&&i===g||(_&&clearInterval(_),_=setInterval(function(){if(e){var o=J(A.elementFromPoint(n,i),!0);o!==s&&(s=o,ee(),Z(t,a.options,s,r))}},10),f=n,g=i)}else{if(!a.options.bubbleScroll||J(o,!0)===window)return void ee();Z(t,a.options,J(o,!1),!1)}}},_prepareDragStart:function(r,n,s,l){var d,u=this,p=u.el,_=u.options,f=p.ownerDocument;s&&!e&&s.parentNode===p&&(i=p,t=(e=s).parentNode,o=e.nextSibling,a=s,h=_.group,c=l,m={target:e,clientX:(n||r).clientX,clientY:(n||r).clientY},this._lastX=(n||r).clientX,this._lastY=(n||r).clientY,e.style["will-change"]="all",e.style.transition="",e.style.transform="",d=function(){u._disableDelayedDrag(),e.draggable=u.nativeDraggable,u._triggerDragStart(r,n),ve(u,i,"choose",e,i,i,c),_e(e,_.chosenClass,!0)},_.ignore.split(",").forEach(function(t){me(e,t.trim(),ye)}),_.supportPointer?he(f,"pointerup",u._onDrop):(he(f,"mouseup",u._onDrop),he(f,"touchend",u._onDrop),he(f,"touchcancel",u._onDrop)),_.delay?(he(f,"mouseup",u._disableDelayedDrag),he(f,"touchend",u._disableDelayedDrag),he(f,"touchcancel",u._disableDelayedDrag),he(f,"mousemove",u._delayedDragTouchMoveHandler),he(f,"touchmove",u._delayedDragTouchMoveHandler),_.supportPointer&&he(f,"pointermove",u._delayedDragTouchMoveHandler),u._dragStartTimer=O(d,_.delay)):d())},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;U(G(t.clientX-this._lastX),G(t.clientY-this._lastY))>=this.options.touchStartThreshold&&this._disableDelayedDrag()},_disableDelayedDrag:function(){var e=this.el.ownerDocument;clearTimeout(this._dragStartTimer),pe(e,"mouseup",this._disableDelayedDrag),pe(e,"touchend",this._disableDelayedDrag),pe(e,"touchcancel",this._disableDelayedDrag),pe(e,"mousemove",this._delayedDragTouchMoveHandler),pe(e,"touchmove",this._delayedDragTouchMoveHandler),pe(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(t,r){r=r||("touch"==t.pointerType?t:null),!this.nativeDraggable||r?this.options.supportPointer?he(A,"pointermove",this._onTouchMove):he(A,r?"touchmove":"mousemove",this._onTouchMove):(he(e,"dragend",this),he(i,"dragstart",this._onDragStart));try{A.selection?De(function(){A.selection.empty()}):window.getSelection().removeAllRanges()}catch(e){}},_dragStarted:function(t){if(T=!1,i&&e){this.nativeDraggable&&(he(A,"dragover",this._handleAutoScroll),he(A,"dragover",re));var r=this.options;!t&&_e(e,r.dragClass,!1),_e(e,r.ghostClass,!0),fe(e,"transform",""),de.active=this,t&&this._appendGhost(),ve(this,i,"start",e,i,i,c)}else this._nulling()},_emulateDragOver:function(t){if(v){if(this._lastX===v.clientX&&this._lastY===v.clientY&&!t)return;this._lastX=v.clientX,this._lastY=v.clientY,oe();for(var r=A.elementFromPoint(v.clientX,v.clientY),n=r;r&&r.shadowRoot;)n=r=r.shadowRoot.elementFromPoint(v.clientX,v.clientY);if(n)do{if(n[M])if(n[M]._onDragOver({clientX:v.clientX,clientY:v.clientY,target:r,rootEl:n})&&!this.options.dragoverBubble)break;r=n}while(n=n.parentNode);e.parentNode[M]._computeIsAligned(v),ae()}},_onTouchMove:function(e){if(m){var t=this.options,n=t.fallbackTolerance,i=t.fallbackOffset,o=e.touches?e.touches[0]:e,a=r&&ge(r),s=r&&a&&a.a,l=r&&a&&a.d,d=(o.clientX-m.clientX+i.x)/(s||1),c=(o.clientY-m.clientY+i.y)/(l||1),u=e.touches?"translate3d("+d+"px,"+c+"px,0)":"translate("+d+"px,"+c+"px)";if(!de.active&&!T){if(n&&U(G(o.clientX-this._lastX),G(o.clientY-this._lastY))<n)return;this._onDragStart(e,!0)}this._handleAutoScroll(o,!0),b=!0,v=o,fe(r,"webkitTransform",u),fe(r,"mozTransform",u),fe(r,"msTransform",u),fe(r,"transform",u),e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!r){var t=He(e,this.options.fallbackOnBody?A.body:i,!0),n=(fe(e),this.options);_e(r=e.cloneNode(!0),n.ghostClass,!1),_e(r,n.fallbackClass,!0),_e(r,n.dragClass,!0),fe(r,"box-sizing","border-box"),fe(r,"margin",0),fe(r,"top",t.top),fe(r,"left",t.left),fe(r,"width",t.width),fe(r,"height",t.height),fe(r,"opacity","0.8"),fe(r,"position","fixed"),fe(r,"zIndex","100000"),fe(r,"pointerEvents","none"),n.fallbackOnBody&&A.body.appendChild(r)||i.appendChild(r)}},_onDragStart:function(t,r){var o=this,a=t.dataTransfer,s=o.options;(n=Ie(e)).draggable=!1,n.style["will-change"]="",this._hideClone(),_e(n,o.options.chosenClass,!1),o._cloneId=De(function(){o.options.removeCloneOnHide||i.insertBefore(n,e),ve(o,i,"clone",e)}),!r&&_e(e,s.dragClass,!0),r?(E=!0,o._loopId=setInterval(o._emulateDragOver,50)):(pe(A,"mouseup",o._onDrop),pe(A,"touchend",o._onDrop),pe(A,"touchcancel",o._onDrop),a&&(a.effectAllowed="move",s.setData&&s.setData.call(o,a,e)),he(A,"drop",o),fe(e,"transform","translateZ(0)")),T=!0,o._dragStartId=De(o._dragStarted.bind(o,r)),he(A,"selectstart",o)},_onDragOver:function(n){var a,s,l,d=this.el,u=n.target,_=this.options,f=_.group,g=de.active,m=h===f,v=_.sort,S=this;if(!V&&(!B||n.rootEl||n.artificialBubble||ne(d,u))){if(void 0!==n.preventDefault&&n.cancelable&&n.preventDefault(),b=!0,u=ce(u,_.draggable,d,!0),ce(n.target,null,e,!0)||u.animated)return z();if(u!==e&&(E=!1),g&&!_.disabled&&(m?v||(l=!i.contains(e)):p===this||(this.lastPutMode=h.checkPull(this,g,e,n))&&f.checkPut(this,g,e,n))){var T=this._getDirection(n,u);if(a=He(e),l)return this._hideClone(),t=i,o?i.insertBefore(e,o):i.appendChild(e),z();if(0===d.children.length||d.children[0]===r||function(e,t,r){var n=He(xe(r)),i="vertical"===t?e.clientY:e.clientX,o="vertical"===t?e.clientX:e.clientY,a="vertical"===t?n.bottom:n.right,s="vertical"===t?n.left:n.top,l="vertical"===t?n.right:n.bottom;return"vertical"===t?o>l+10||o<=l&&i>a&&o>=s:i>a&&o>s||i<=a&&o>l+10}(n,T,d)&&!e.animated){if(0!==d.children.length&&d.children[0]!==r&&d===n.target&&(u=xe(d)),u&&(s=He(u)),m?g._hideClone():g._showClone(this),!1!==be(i,d,e,a,u,s,n,!!u))return d.appendChild(e),t=d,R=null,Y(),this._animate(a,e),u&&this._animate(s,u),z()}else if(u&&u!==e&&u.parentNode===d){var I,H=0,j=u.sortableMouseAligned,N=e.parentNode!==d,F=function(e,t){var r=J(r,!0),n=He(e)[t];for(;r;){var i=He(r)[t];if(!("top"===t||"left"===t?n>=i:n<=i))return!0;if(r===L)break;r=J(r,!1)}return!1}(u,"vertical"===T?"top":"left");if(y!==u&&(C=null,I=He(u)["vertical"===T?"top":"left"],D=!1),function(t,r,n){var i=t===e&&R||He(t),o=r===e&&R||He(r),a="vertical"===n?i.left:i.top,s="vertical"===n?i.right:i.bottom,l="vertical"===n?i.width:i.height,d="vertical"===n?o.left:o.top,c="vertical"===n?o.right:o.bottom,u="vertical"===n?o.width:o.height;return a===d||s===c||a+l/2===d+u/2}(e,u,T)&&j||N||F||_.invertSwap||"insert"===C||"swap"===C?("swap"!==C&&($=_.invertSwap||N||k||F),H=function(t,r,n,i,o,a,s){var l=He(r),d="vertical"===n?t.clientY:t.clientX,c="vertical"===n?l.height:l.width,u="vertical"===n?l.top:l.left,h="vertical"===n?l.bottom:l.right,p=He(e),_=!1;if(!a)if(s&&x<c*i)if(!D&&(1===w?d>u+c*o/2:d<h-c*o/2)&&(D=!0),D)_=!0;else{"vertical"===n?p.top:p.left,"vertical"===n?p.bottom:p.right;if(1===w?d<u+x:d>h-x)return-1*w}else if(d>u+c*(1-i)/2&&d<h-c*(1-i)/2)return d>u+c/2?-1:1;if((_=_||a)&&(d<u+c*o/2||d>h-c*o/2))return d>u+c/2?1:-1;return 0}(n,u,T,_.swapThreshold,null==_.invertedSwapThreshold?_.swapThreshold:_.invertedSwapThreshold,$,y===u),C="swap"):(H=function(t,r){var n=Se(e,r.draggable),i=Se(t,r.draggable);return n<i?1:-1}(u,_),C="insert"),0===H)return z();R=null,y=u,w=H,s=He(u);var P=u.nextElementSibling,W=!1,q=be(i,d,e,a,u,s,n,W=1===H);if(!1!==q)return 1!==q&&-1!==q||(W=1===q),V=!0,O(we,30),m?g._hideClone():g._showClone(this),W&&!P?d.appendChild(e):u.parentNode.insertBefore(e,W?P:u),t=e.parentNode,void 0===I||$||(x=G(I-He(u)["vertical"===T?"top":"left"])),Y(),!N&&this._animate(s,u),this._animate(a,e),z()}if(d.contains(e))return z()}return B&&!n.rootEl&&ie(d,n,"_onDragOver"),!1}function z(){return g&&(_e(e,p?p.options.ghostClass:g.options.ghostClass,!1),_e(e,_.ghostClass,!0)),p!==S&&S!==de.active?p=S:S===de.active&&(p=null),(u===e&&!e.animated||u===d&&!u.animated)&&(y=null),_.dragoverBubble||n.rootEl||u===A||(S._handleAutoScroll(n),e.parentNode[M]._computeIsAligned(n)),!_.dragoverBubble&&n.stopPropagation&&n.stopPropagation(),!0}function Y(){ve(S,i,"change",u,d,i,c,Se(e,_.draggable),n)}},_animate:function(t,r){var n=this.options.animation;if(n){var i=He(r);if(r===e&&(R=i),1===t.nodeType&&(t=He(t)),t.left+t.width/2!==i.left+i.width/2||t.top+t.height/2!==i.top+i.height/2){var o=ge(this.el),a=o&&o.a,s=o&&o.d;fe(r,"transition","none"),fe(r,"transform","translate3d("+(t.left-i.left)/(a||1)+"px,"+(t.top-i.top)/(s||1)+"px,0)"),r.offsetWidth,fe(r,"transition","transform "+n+"ms"+(this.options.easing?" "+this.options.easing:"")),fe(r,"transform","translate3d(0,0,0)")}"number"==typeof r.animated&&clearTimeout(r.animated),r.animated=O(function(){fe(r,"transition",""),fe(r,"transform",""),r.animated=!1},n)}},_offUpEvents:function(){var e=this.el.ownerDocument;pe(A,"touchmove",this._onTouchMove),pe(A,"pointermove",this._onTouchMove),pe(e,"mouseup",this._onDrop),pe(e,"touchend",this._onDrop),pe(e,"pointerup",this._onDrop),pe(e,"touchcancel",this._onDrop),pe(A,"selectstart",this)},_onDrop:function(a){var s=this.el,l=this.options;T=!1,k=!1,$=!1,D=!1,clearInterval(this._loopId),clearInterval(_),ee(),clearTimeout(se),se=void 0,clearTimeout(this._dragStartTimer),$e(this._cloneId),$e(this._dragStartId),pe(A,"mousemove",this._onTouchMove),this.nativeDraggable&&(pe(A,"drop",this),pe(s,"dragstart",this._onDragStart),pe(A,"dragover",this._handleAutoScroll),pe(A,"dragover",re)),this._offUpEvents(),a&&(b&&(a.cancelable&&a.preventDefault(),!l.dropBubble&&a.stopPropagation()),r&&r.parentNode&&r.parentNode.removeChild(r),(i===t||p&&"clone"!==p.lastPutMode)&&n&&n.parentNode&&n.parentNode.removeChild(n),e&&(this.nativeDraggable&&pe(e,"dragend",this),ye(e),e.style["will-change"]="",_e(e,p?p.options.ghostClass:this.options.ghostClass,!1),_e(e,this.options.chosenClass,!1),ve(this,i,"unchoose",e,t,i,c,null,a),i!==t?((u=Se(e,l.draggable))>=0&&(ve(null,t,"add",e,t,i,c,u,a),ve(this,i,"remove",e,t,i,c,u,a),ve(null,t,"sort",e,t,i,c,u,a),ve(this,i,"sort",e,t,i,c,u,a)),p&&p.save()):e.nextSibling!==o&&(u=Se(e,l.draggable))>=0&&(ve(this,i,"update",e,t,i,c,u,a),ve(this,i,"sort",e,t,i,c,u,a)),de.active&&(null!=u&&-1!==u||(u=c),ve(this,i,"end",e,t,i,c,u,a),this.save()))),this._nulling()},_nulling:function(){i=e=t=r=o=n=a=s=l=S.length=_=f=g=m=v=b=u=c=y=w=R=p=h=de.active=null,K.forEach(function(e){e.checked=!0}),K.length=0},handleEvent:function(t){switch(t.type){case"drop":case"dragend":this._onDrop(t);break;case"dragenter":case"dragover":e&&(this._onDragOver(t),function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move");e.cancelable&&e.preventDefault()}(t));break;case"selectstart":t.preventDefault()}},toArray:function(){for(var e,t=[],r=this.el.children,n=0,i=r.length,o=this.options;n<i;n++)ce(e=r[n],o.draggable,this.el,!1)&&t.push(e.getAttribute(o.dataIdAttr)||Re(e));return t},sort:function(e){var t={},r=this.el;this.toArray().forEach(function(e,n){var i=r.children[n];ce(i,this.options.draggable,r,!1)&&(t[e]=i)},this),e.forEach(function(e){t[e]&&(r.removeChild(t[e]),r.appendChild(t[e]))})},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return ce(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var r=this.options;if(void 0===t)return r[e];r[e]=t,"group"===e&&te(r)},destroy:function(){var e=this.el;e[M]=null,pe(e,"mousedown",this._onTapStart),pe(e,"touchstart",this._onTapStart),pe(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(pe(e,"dragover",this),pe(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(e){e.removeAttribute("draggable")}),this._onDrop(),I.splice(I.indexOf(this.el),1),this.el=e=null},_hideClone:function(){n.cloneHidden||(fe(n,"display","none"),n.cloneHidden=!0,n.parentNode&&this.options.removeCloneOnHide&&n.parentNode.removeChild(n))},_showClone:function(t){"clone"===t.lastPutMode?n.cloneHidden&&(i.contains(e)&&!this.options.group.revertClone?i.insertBefore(n,e):o?i.insertBefore(n,o):i.appendChild(n),this.options.group.revertClone&&this._animate(e,n),fe(n,"display",""),n.cloneHidden=!1):this._hideClone()}},he(A,"touchmove",function(e){(de.active||T)&&e.cancelable&&e.preventDefault()}),de.utils={on:he,off:pe,css:fe,find:me,is:function(e,t){return!!ce(e,t,e,!1)},extend:Ee,throttle:Te,closest:ce,toggleClass:_e,clone:Ie,index:Se,nextTick:De,cancelNextTick:$e,detectDirection:Q,getChild:Ce},de.create=function(e,t){return new de(e,t)},de.version="1.8.3",de},e.exports=t()}),Sortable$1=Object.freeze({default:Sortable,__moduleExports:Sortable}),require$$0=Sortable$1&&Sortable||Sortable$1,frappeDatatable_cjs=createCommonjsModule(function(e){var t,r=(t=require$$0)&&"object"==typeof t&&"default"in t?t.default:t;function n(e,t){return"string"==typeof e?(t||document).querySelector(e):e||null}n.each=function(e,t){return"string"==typeof e?Array.from((t||document).querySelectorAll(e)):e||null},n.create=function(e,t){var r=document.createElement(e),i=function(e){var i=t[e];if("inside"===e)n(i).appendChild(r);else if("around"===e){var o=n(i);o.parentNode.insertBefore(r,o),r.appendChild(o)}else"styles"===e?"object"==typeof i&&Object.keys(i).map(function(e){r.style[e]=i[e]}):e in r?r[e]=i:r.setAttribute(e,i)};for(var o in t)i(o);return r},n.on=function(e,t,r,i){i?n.delegate(e,t,r,i):(i=r,n.bind(e,t,i))},n.off=function(e,t,r){e.removeEventListener(t,r)},n.bind=function(e,t,r){t.split(/\s+/).forEach(function(t){e.addEventListener(t,r)})},n.delegate=function(e,t,r,n){e.addEventListener(t,function(e){var t=e.target.closest(r);t&&(e.delegatedTarget=t,n.call(this,e,t))})},n.unbind=function(e,t){if(e){var r=function(r){var n=t[r];r.split(/\s+/).forEach(function(t){e.removeEventListener(t,n)})};for(var n in t)r(n)}},n.fire=function(e,t,r){var n=document.createEvent("HTMLEvents");for(var i in n.initEvent(t,!0,!0),r)n[i]=r[i];return e.dispatchEvent(n)},n.data=function(e,t){if(!t)return e.dataset;for(var r in t)e.dataset[r]=t[r]},n.style=function(e,t){if("string"==typeof t)return n.getStyle(e,t);Array.isArray(e)||(e=[e]),e.map(function(e){for(var r in t)e.style[r]=t[r]})},n.removeStyle=function(e,t){Array.isArray(e)||(e=[e]),Array.isArray(t)||(t=[t]),e.map(function(e){for(var r=0,n=t;r<n.length;r+=1){var i=n[r];e.style[i]=""}})},n.getStyle=function(e,t){if(!t)return getComputedStyle(e);var r=getComputedStyle(e)[t];return["width","height"].includes(t)&&(r=parseFloat(r)),r},n.closest=function(e,t){return t?t.matches(e)?t:n.closest(e,t.parentNode):null},n.inViewport=function(e,t){var r=e.getBoundingClientRect(),n=r.top,i=r.left,o=r.bottom,a=r.right,s=t.getBoundingClientRect(),l=s.top,d=s.left,c=s.bottom,u=s.right;return n>=l&&i>=d&&o<=c&&a<=u},n.scrollTop=function(e,t){requestAnimationFrame(function(){e.scrollTop=t})},n.scrollbarSize=function(){return n.scrollBarSizeValue||(n.scrollBarSizeValue=function(){var e=document.createElement("div");n.style(e,{width:"100px",height:"100px",overflow:"scroll",position:"absolute",top:"-9999px"}),document.body.appendChild(e);var t=e.offsetWidth-e.clientWidth;return document.body.removeChild(e),t}()),n.scrollBarSizeValue},n.hasVerticalOverflow=function(e){return e.scrollHeight>e.offsetHeight+10},n.hasHorizontalOverflow=function(e){return e.scrollWidth>e.offsetWidth+10},n.measureTextWidth=function(e){var t=document.createElement("div");return t.style.position="absolute",t.style.visibility="hidden",t.style.height="auto",t.style.width="auto",t.style.whiteSpace="nowrap",t.innerText=e,document.body.appendChild(t),t.clientWidth+1};var i=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},o="undefined"!=typeof window?window:void 0!==commonjsGlobal?commonjsGlobal:"undefined"!=typeof self?self:{};function a(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}var s="object"==typeof o&&o&&o.Object===Object&&o,l="object"==typeof self&&self&&self.Object===Object&&self,d=s||l||Function("return this")(),c=function(){return d.Date.now()},u=d.Symbol,h=Object.prototype,p=h.hasOwnProperty,_=h.toString,f=u?u.toStringTag:void 0;var g=function(e){var t=p.call(e,f),r=e[f];try{e[f]=void 0}catch(e){}var n=_.call(e);return t?e[f]=r:delete e[f],n},m=Object.prototype.toString;var v=function(e){return m.call(e)},b="[object Null]",y="[object Undefined]",w=u?u.toStringTag:void 0;var C=function(e){return null==e?void 0===e?y:b:w&&w in Object(e)?g(e):v(e)};var x=function(e){return null!=e&&"object"==typeof e},R="[object Symbol]";var S=function(e){return"symbol"==typeof e||x(e)&&C(e)==R},k=NaN,T=/^\s+|\s+$/g,E=/^[-+]0x[0-9a-f]+$/i,I=/^0b[01]+$/i,D=/^0o[0-7]+$/i,$=parseInt;var H=function(e){if("number"==typeof e)return e;if(S(e))return k;if(i(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=i(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(T,"");var r=I.test(e);return r||D.test(e)?$(e.slice(2),r?2:8):E.test(e)?k:+e},M="Expected a function",L=Math.max,A=Math.min;var j=function(e,t,r){var n,o,a,s,l,d,u=0,h=!1,p=!1,_=!0;if("function"!=typeof e)throw new TypeError(M);function f(t){var r=n,i=o;return n=o=void 0,u=t,s=e.apply(i,r)}function g(e){var r=e-d;return void 0===d||r>=t||r<0||p&&e-u>=a}function m(){var e=c();if(g(e))return v(e);l=setTimeout(m,function(e){var r=t-(e-d);return p?A(r,a-(e-u)):r}(e))}function v(e){return l=void 0,_&&n?f(e):(n=o=void 0,s)}function b(){var e=c(),r=g(e);if(n=arguments,o=this,d=e,r){if(void 0===l)return function(e){return u=e,l=setTimeout(m,t),h?f(e):s}(d);if(p)return l=setTimeout(m,t),f(d)}return void 0===l&&(l=setTimeout(m,t)),s}return t=H(t)||0,i(r)&&(h=!!r.leading,a=(p="maxWait"in r)?L(H(r.maxWait)||0,t):a,_="trailing"in r?!!r.trailing:_),b.cancel=function(){void 0!==l&&clearTimeout(l),u=0,n=d=o=l=void 0},b.flush=function(){return void 0===l?s:v(c())},b},O="Expected a function";var N=function(e,t,r){var n=!0,o=!0;if("function"!=typeof e)throw new TypeError(O);return i(r)&&(n="leading"in r?!!r.leading:n,o="trailing"in r?!!r.trailing:o),j(e,t,{leading:n,maxWait:t,trailing:o})},F="[object AsyncFunction]",P="[object Function]",B="[object GeneratorFunction]",W="[object Proxy]";var q,z=function(e){if(!i(e))return!1;var t=C(e);return t==P||t==B||t==F||t==W},Y=d["__core-js_shared__"],V=(q=/[^.]+$/.exec(Y&&Y.keys&&Y.keys.IE_PROTO||""))?"Symbol(src)_1."+q:"";var X=function(e){return!!V&&V in e},G=Function.prototype.toString;var U=function(e){if(null!=e){try{return G.call(e)}catch(e){}try{return e+""}catch(e){}}return""},K=/^\[object .+?Constructor\]$/,Q=Function.prototype,J=Object.prototype,Z=Q.toString,ee=J.hasOwnProperty,te=RegExp("^"+Z.call(ee).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var re=function(e){return!(!i(e)||X(e))&&(z(e)?te:K).test(U(e))};var ne=function(e,t){return null==e?void 0:e[t]};var ie=function(e,t){var r=ne(e,t);return re(r)?r:void 0},oe=ie(Object,"create");var ae=function(){this.__data__=oe?oe(null):{},this.size=0};var se=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},le="__lodash_hash_undefined__",de=Object.prototype.hasOwnProperty;var ce=function(e){var t=this.__data__;if(oe){var r=t[e];return r===le?void 0:r}return de.call(t,e)?t[e]:void 0},ue=Object.prototype.hasOwnProperty;var he=function(e){var t=this.__data__;return oe?void 0!==t[e]:ue.call(t,e)},pe="__lodash_hash_undefined__";var _e=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=oe&&void 0===t?pe:t,this};function fe(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}fe.prototype.clear=ae,fe.prototype.delete=se,fe.prototype.get=ce,fe.prototype.has=he,fe.prototype.set=_e;var ge=fe;var me=function(){this.__data__=[],this.size=0};var ve=function(e,t){return e===t||e!=e&&t!=t};var be=function(e,t){for(var r=e.length;r--;)if(ve(e[r][0],t))return r;return-1},ye=Array.prototype.splice;var we=function(e){var t=this.__data__,r=be(t,e);return!(r<0||(r==t.length-1?t.pop():ye.call(t,r,1),--this.size,0))};var Ce=function(e){var t=this.__data__,r=be(t,e);return r<0?void 0:t[r][1]};var xe=function(e){return be(this.__data__,e)>-1};var Re=function(e,t){var r=this.__data__,n=be(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function Se(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Se.prototype.clear=me,Se.prototype.delete=we,Se.prototype.get=Ce,Se.prototype.has=xe,Se.prototype.set=Re;var ke=Se,Te=ie(d,"Map");var Ee=function(){this.size=0,this.__data__={hash:new ge,map:new(Te||ke),string:new ge}};var Ie=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var De=function(e,t){var r=e.__data__;return Ie(t)?r["string"==typeof t?"string":"hash"]:r.map};var $e=function(e){var t=De(this,e).delete(e);return this.size-=t?1:0,t};var He=function(e){return De(this,e).get(e)};var Me=function(e){return De(this,e).has(e)};var Le=function(e,t){var r=De(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function Ae(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Ae.prototype.clear=Ee,Ae.prototype.delete=$e,Ae.prototype.get=He,Ae.prototype.has=Me,Ae.prototype.set=Le;var je=Ae,Oe="__lodash_hash_undefined__";var Ne=function(e){return this.__data__.set(e,Oe),this};var Fe=function(e){return this.__data__.has(e)};function Pe(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new je;++t<r;)this.add(e[t])}Pe.prototype.add=Pe.prototype.push=Ne,Pe.prototype.has=Fe;var Be=Pe;var We=function(e,t,r,n){for(var i=e.length,o=r+(n?1:-1);n?o--:++o<i;)if(t(e[o],o,e))return o;return-1};var qe=function(e){return e!=e};var ze=function(e,t,r){for(var n=r-1,i=e.length;++n<i;)if(e[n]===t)return n;return-1};var Ye=function(e,t,r){return t==t?ze(e,t,r):We(e,qe,r)};var Ve=function(e,t){return!(null==e||!e.length)&&Ye(e,t,0)>-1};var Xe=function(e,t,r){for(var n=-1,i=null==e?0:e.length;++n<i;)if(r(t,e[n]))return!0;return!1};var Ge=function(e,t){return e.has(t)},Ue=ie(d,"Set");var Ke=function(){};var Qe=function(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r},Je=Ue&&1/Qe(new Ue([,-0]))[1]==1/0?function(e){return new Ue(e)}:Ke,Ze=200;var et=function(e,t,r){var n=-1,i=Ve,o=e.length,a=!0,s=[],l=s;if(r)a=!1,i=Xe;else if(o>=Ze){var d=t?null:Je(e);if(d)return Qe(d);a=!1,i=Ge,l=new Be}else l=t?[]:s;e:for(;++n<o;){var c=e[n],u=t?t(c):c;if(c=r||0!==c?c:0,a&&u==u){for(var h=l.length;h--;)if(l[h]===u)continue e;t&&l.push(u),s.push(c)}else i(l,u,r)||(l!==s&&l.push(u),s.push(c))}return s};var tt=function(e){return e&&e.length?et(e):[]};function rt(e){return e.replace(/([A-Z])/g,function(e){return"-"+e[0].toLowerCase()})}function nt(e){return Object.keys(e).map(function(t){var r=rt(t),n=e[t];return void 0===n?"":"data-"+r+'="'+n+'" '}).join("").trim()}function it(e){var t=document.createElement("textarea");t.style.position="fixed",t.style.top=0,t.style.left=0,t.style.width="2em",t.style.height="2em",t.style.padding=0,t.style.border="none",t.style.outline="none",t.style.boxShadow="none",t.style.background="transparent",t.value=e,document.body.appendChild(t),t.select();try{document.execCommand("copy")}catch(e){console.log("Oops, unable to copy")}document.body.removeChild(t)}var ot=N,at=j;function st(e,t){return void 0===t&&(t=null),function(){for(var r=[],n=arguments.length;n--;)r[n]=arguments[n];return new Promise(function(n){setTimeout(function(){var i=e.apply(t,r);n(i)})})}}function lt(e,t,r){var n=r.reduce(function(e,r){return e[r]={get:function(){return t[r]}},e},{});Object.defineProperties(e,n)}function dt(e){return!isNaN(e)}function ct(e){return tt(e)}function ut(e,t){return e-t}class ht extends TypeError{}var pt={chevronDown:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"></polyline></svg>',chevronRight:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline></svg>'};var _t,ft=function(e,t){return e(t={exports:{}},t.exports),t.exports}(function(e,t){e.exports=function e(t,r,n){function i(s,l){if(!r[s]){if(!t[s]){var d=a;if(!l&&d)return d(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=r[s]={exports:{}};t[s][0].call(u.exports,function(e){var r=t[s][1][e];return i(r||e)},u,u.exports,e,t,r,n)}return r[s].exports}for(var o=a,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i={width:"100%",height:"100%"},o=function(e){return Number(e)==Number(e)},a=function(){function e(t,r){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._config={},this._lastRepaint=null,this._maxElementHeight=e.getMaxBrowserHeight(),this.refresh(t,r);var i=this._config;!function e(){var t=n._getScrollPosition(),r=n._lastRepaint;if(n._renderAnimationFrame=window.requestAnimationFrame(e),t!==r&&(!r||Math.abs(t-r)>n._averageHeight)){var o=n._renderChunk();n._lastRepaint=t,!1!==o&&"function"==typeof i.afterRender&&i.afterRender()}}()}return n(e,null,[{key:"create",value:function(t,r){return new e(t,r)}},{key:"mergeStyle",value:function(e,t){for(var r in t)e.style[r]!==t[r]&&(e.style[r]=t[r])}},{key:"getMaxBrowserHeight",value:function(){var t=document.createElement("div"),r=document.createElement("div");e.mergeStyle(t,{position:"absolute",height:"1px",opacity:0}),e.mergeStyle(r,{height:"1e7px"}),t.appendChild(r),document.body.appendChild(t);var n=r.offsetHeight;return document.body.removeChild(t),n}}]),n(e,[{key:"destroy",value:function(){window.cancelAnimationFrame(this._renderAnimationFrame)}},{key:"refresh",value:function(t,r){var n=this;if(Object.assign(this._config,i,r),!t||1!==t.nodeType)throw new Error("HyperList requires a valid DOM Node container");this._element=t;var a=this._config,s=this._scroller||a.scroller||document.createElement(a.scrollerTagName||"tr");if("boolean"!=typeof a.useFragment&&(this._config.useFragment=!0),!a.generate)throw new Error("Missing required `generate` function");if(!o(a.total))throw new Error("Invalid required `total` value, expected number");if(!Array.isArray(a.itemHeight)&&!o(a.itemHeight))throw new Error("\n        Invalid required `itemHeight` value, expected number or array\n      ".trim());o(a.itemHeight)?this._itemHeights=Array(a.total).fill(a.itemHeight):this._itemHeights=a.itemHeight,Object.keys(i).filter(function(e){return e in a}).forEach(function(e){var t=a[e],r=o(t),i=!r&&"%"===t.slice(-1);if(t&&"string"!=typeof t&&"number"!=typeof t){var s="Invalid optional `"+e+"`, expected string or number";throw new Error(s)}if(r&&(a[e]=t+"px"),"height"===e){var l=r?t:parseInt(t.replace(/px|%/,""),10);n._containerHeight=i?window.innerHeight*l/100:o(t)?t:l}});var l={width:""+a.width,height:""+a.height,overflow:"auto",position:"relative"};e.mergeStyle(t,l);var d=a.itemHeight*a.total,c=this._maxElementHeight;d>c&&console.warn(["HyperList: The maximum element height",c+"px has","been exceeded; please reduce your item height."].join(" "));var u={opacity:"0",position:"absolute",width:"1px",height:d+"px"};e.mergeStyle(s,u),this._scroller||t.appendChild(s),this._scroller=s,this._scrollHeight=this._computeScrollHeight(),this._itemPositions=this._itemPositions||Array(a.total).fill(0),this._computePositions(0),this._renderChunk(null!==this._lastRepaint),"function"==typeof a.afterRender&&a.afterRender()}},{key:"_getRow",value:function(t){var r=this._config,n=r.generate(t),i=n.height;if(void 0!==i&&o(i)?(n=n.element,i!==this._itemHeights&&(this._itemHeights[t]=i,this._computePositions(t),this._scrollHeight=this._computeScrollHeight(t))):i=this._itemHeights[t],!n||1!==n.nodeType)throw new Error("Generator did not return a DOM Node for index: "+t);var a=n.getAttribute("class")||"";n.setAttribute("class",a+" "+(r.rowClassName||"vrow"));var s=this._itemPositions[t];return e.mergeStyle(n,{position:"absolute",top:s+"px"}),n}},{key:"_getScrollPosition",value:function(){var e=this._config;return"function"==typeof e.overrideScrollPosition?e.overrideScrollPosition():this._element.scrollTop}},{key:"_renderChunk",value:function(e){var t=this._config,r=this._element,n=this._getScrollPosition(),i=t.total,o=t.reverse?this._getReverseFrom(n):this._getFrom(n)-1;if((o<0||o-this._screenItemsLen<0)&&(o=0),!e&&this._lastFrom===o)return!1;this._lastFrom=o;var a=o+this._cachedItemsLen;(a>i||a+this._cachedItemsLen>i)&&(a=i);var s=t.useFragment?document.createDocumentFragment():[],l=this._scroller;s[t.useFragment?"appendChild":"push"](l);for(var d=o;d<a;d++){var c=this._getRow(d);s[t.useFragment?"appendChild":"push"](c)}if(t.applyPatch)return t.applyPatch(r,s);r.innerHTML="",r.appendChild(s)}},{key:"_computePositions",value:function(){var e=arguments.length<=0||void 0===arguments[0]?1:arguments[0],t=this._config,r=t.total,n=t.reverse;e<1&&!n&&(e=1);for(var i=e;i<r;i++)n?0===i?this._itemPositions[0]=this._scrollHeight-this._itemHeights[0]:this._itemPositions[i]=this._itemPositions[i-1]-this._itemHeights[i]:this._itemPositions[i]=this._itemHeights[i-1]+this._itemPositions[i-1]}},{key:"_computeScrollHeight",value:function(){var t=this,r=this._config,n=r.total,i=this._itemHeights.reduce(function(e,t){return e+t},0);e.mergeStyle(this._scroller,{opacity:0,position:"absolute",width:"1px",height:i+"px"});var o=this._itemHeights.slice(0).sort(function(e,t){return e-t}),a=Math.floor(n/2),s=n%2==0?(o[a]+o[a-1])/2:o[a],l=this._element.clientHeight?this._element.clientHeight:this._containerHeight;return this._screenItemsLen=Math.ceil(l/s),this._containerHeight=l,this._cachedItemsLen=Math.max(this._cachedItemsLen||0,3*this._screenItemsLen),this._averageHeight=s,r.reverse&&window.requestAnimationFrame(function(){t._element.scrollTop=i}),i}},{key:"_getFrom",value:function(e){for(var t=0;this._itemPositions[t]<e;)t++;return t}},{key:"_getReverseFrom",value:function(e){for(var t=this._config.total-1;t>0&&this._itemPositions[t]<e+this._containerHeight;)t--;return t}}]),e}();r.default=a,t.exports=r.default},{}]},{},[1])(1)}),gt=(_t=ft)&&_t.__esModule&&Object.prototype.hasOwnProperty.call(_t,"default")?_t.default:_t;var mt={13:"enter",91:"meta",16:"shift",17:"ctrl",18:"alt",37:"left",38:"up",39:"right",40:"down",9:"tab",27:"esc",67:"c",70:"f",86:"v"};var vt={columns:[],data:[],dropdownButton:pt.chevronDown,headerDropdown:[{label:"Sort Ascending",action:function(e){this.sortColumn(e.colIndex,"asc")}},{label:"Sort Descending",action:function(e){this.sortColumn(e.colIndex,"desc")}},{label:"Reset sorting",action:function(e){this.sortColumn(e.colIndex,"none")}},{label:"Remove column",action:function(e){this.removeColumn(e.colIndex)}}],events:{onRemoveColumn:function(e){},onSwitchColumn:function(e,t){},onSortColumn:function(e){},onCheckRow:function(e){},onDestroy:function(){}},hooks:{columnTotal:null},sortIndicator:{asc:"↑",desc:"↓",none:""},overrideComponents:{},filterRows:function(e,t){var r=[];if(0===Object.keys(t).length)return e.map(function(e){return e.meta.rowIndex});var n=function(n){var i=t[n],o=(r.length?r.map(function(t){return e[t]}):e).map(function(e){return e[n]}),a=function(e){if(void 0===e&&(e=""),0===e.length)return{};var t=e;return[">","<","="].includes(t[0])?t=e.slice(1):t.startsWith("!=")&&(t=e.slice(2)),e.startsWith(">")&&t?{type:"greaterThan",text:t.trim()}:e.startsWith("<")&&t?{type:"lessThan",text:t.trim()}:e.startsWith("=")&&dt(t)?{type:"equals",text:Number(e.slice(1).trim())}:dt(t)?{type:"containsNumber",text:t}:e.startsWith("!=")&&dt(t)?{type:"notEquals",text:Number(e.slice(2).trim())}:2===e.split(":").length?{type:"range",text:(t=e.split(":")).map(function(e){return e.trim()})}:{type:"contains",text:t.toLowerCase()}}(i),s=function(e){var t=function(e){return String((t=e.html||"",t.replace(/<[^>]*>/g,"")||e.content||"")).toLowerCase();var t},r=function(e){return parseFloat(e.content)},n=function(e,n){if(e.column.compareValue){var i=e.column.compareValue(e,n);if(i&&Array.isArray(i))return i}var o=r(e);return isNaN(o)?[t(e),n]:[o,n]};return{contains:function(e,r){return r.filter(function(r){var n=t(r),i=(e||"").toLowerCase();return!i||n.includes(i)}).map(function(e){return e.rowIndex})},greaterThan:function(e,t){return t.filter(function(t){var r=n(t,e),i=r[0],o=r[1];return i>o}).map(function(e){return e.rowIndex})},lessThan:function(e,t){return t.filter(function(t){var r=n(t,e),i=r[0],o=r[1];return i<o}).map(function(e){return e.rowIndex})},equals:function(e,t){return t.filter(function(t){var r=parseFloat(t.content);return r===e}).map(function(e){return e.rowIndex})},notEquals:function(e,t){return t.filter(function(t){var r=parseFloat(t.content);return r!==e}).map(function(e){return e.rowIndex})},range:function(e,t){return t.filter(function(t){var r=n(t,e[0]),i=n(t,e[1]),o=r[0];return o>=r[1]&&o<=i[1]}).map(function(e){return e.rowIndex})},containsNumber:function(e,n){return n.filter(function(n){var i=parseFloat(e,10),o=e,a=r(n),s=t(n);return i===a||s.includes(o)}).map(function(e){return e.rowIndex})}}[e.type]}(a);r=s?s(a.text,o):o.map(function(e){return e.rowIndex})};for(var i in t)n(i);return r},freezeMessage:"",getEditor:null,serialNoColumn:!0,checkboxColumn:!1,clusterize:!0,logs:!1,layout:"fixed",noDataMessage:"No Data",cellHeight:40,minimumColumnWidth:30,inlineFilters:!1,treeView:!1,checkedRowStatus:!0,dynamicRowHeight:!1,pasteFromClipboard:!1,showTotalRow:!1,direction:"ltr",disableReorderColumn:!1},bt={DataManager:class{constructor(e){this.options=e,this.sortRows=st(this.sortRows,this),this.switchColumn=st(this.switchColumn,this),this.removeColumn=st(this.removeColumn,this),this.options.filterRows=st(this.options.filterRows,this)}init(e,t){e||(e=this.options.data),t&&(this.options.columns=t),this.data=e,this.rowCount=0,this.columns=[],this.rows=[],this.prepareColumns(),this.prepareRows(),this.prepareTreeRows(),this.prepareRowView(),this.prepareNumericColumns()}get currentSort(){return this.columns.find(function(e){return"none"!==e.sortOrder})||{colIndex:-1,sortOrder:"none"}}prepareColumns(){this.columns=[],this.validateColumns(),this.prepareDefaultColumns(),this.prepareHeader()}prepareDefaultColumns(){if(this.options.checkboxColumn&&!this.hasColumnById("_checkbox")){var e={id:"_checkbox",content:this.getCheckboxHTML(),editable:!1,resizable:!1,sortable:!1,focusable:!1,dropdown:!1,width:32};this.columns.push(e)}this.options.serialNoColumn&&!this.hasColumnById("_rowIndex")&&this.columns.push({id:"_rowIndex",content:"",align:"center",editable:!1,resizable:!1,focusable:!1,dropdown:!1})}prepareHeader(){var e=this,t=this.columns.concat(this.options.columns),r={isHeader:1,editable:!0,sortable:!0,resizable:!0,focusable:!0,dropdown:!0,width:null,format:function(e){return null==e?"":e+""}};this.columns=t.map(function(t,r){return e.prepareCell(t,r)}).map(function(e){return Object.assign({},r,e)}).map(function(e){return e.content=e.content||e.name||"",e.id=e.id||e.content,e})}prepareCell(e,t){var r={content:"",sortOrder:"none",colIndex:t,column:this.columns[t]};return null!==e&&"object"==typeof e?Object.assign(r,e):r.content=e,r}prepareNumericColumns(){var e=this.getRow(0);e&&(this.columns=this.columns.map(function(t,r){var n=e[r].content;return t.align||isNaN(n)||(t.align="right"),t}))}prepareRows(){var e=this;this.validateData(this.data),this.rows=this.data.map(function(t,r){var n=e._getNextRowCount(),i=[],o={rowIndex:n};if(Array.isArray(t))for(e.options.checkboxColumn&&i.push(e.getCheckboxHTML()),e.options.serialNoColumn&&i.push(n+1+""),i=i.concat(t);i.length<e.columns.length;)i.push("");else{for(var a=0,s=e.columns;a<s.length;a+=1){var l=s[a];"_checkbox"===l.id?i.push(e.getCheckboxHTML()):"_rowIndex"===l.id?i.push(n+1+""):i.push(t[l.id])}o.indent=t.indent||0}return e.prepareRow(i,o)})}prepareTreeRows(){var e=this;this.rows.forEach(function(t,r){if(dt(t.meta.indent)){var n=e.getRow(r+1);t.meta.isLeaf=!n||!function(e){return void 0!==e||null!==e}(n.meta.indent)||n.meta.indent<=t.meta.indent,t.meta.isTreeNodeClose=!1}})}prepareRowView(){this.rowViewOrder=this.rows.map(function(e){return e.meta.rowIndex})}prepareRow(e,t){var r=this,n={rowIndex:t.rowIndex,indent:t.indent};return(e=e.map(function(e,t){return r.prepareCell(e,t)}).map(function(e){return Object.assign({},n,e)})).meta=t,e}validateColumns(){var e=this.options.columns;if(!Array.isArray(e))throw new ht("`columns` must be an array");e.forEach(function(e,t){if("string"!=typeof e&&"object"!=typeof e)throw new ht('column "'+t+'" must be a string or an object')})}validateData(e){if(Array.isArray(e)&&(0===e.length||Array.isArray(e[0])||"object"==typeof e[0]))return!0;throw new ht("`data` must be an array of arrays or objects")}appendRows(e){var t;this.validateData(e),(t=this.rows).push.apply(t,this.prepareRows(e))}sortRows(e,t){void 0===t&&(t="none"),e=+e,this.getColumns().map(function(r){r.colIndex===e?r.sortOrder=t:r.sortOrder="none"}),this._sortRows(e,t)}_sortRows(e,t){var r=this;if(this.currentSort.colIndex===e&&("asc"===this.currentSort.sortOrder&&"desc"===t||"desc"===this.currentSort.sortOrder&&"asc"===t))return this.reverseArray(this.rowViewOrder),void(this.currentSort.sortOrder=t);if(this.rowViewOrder.sort(function(n,i){var o=n,a=i,s=r.getCell(e,n).content,l=r.getCell(e,i).content;if(s=null==s?"":s,l=null==l?"":l,"none"===t)return o-a;if("asc"===t){if(s<l)return-1;if(s>l)return 1;if(s===l)return 0}else if("desc"===t){if(s<l)return 1;if(s>l)return-1;if(s===l)return 0}return 0}),this.hasColumnById("_rowIndex")){var n=this.getColumnIndexById("_rowIndex");this.rows.forEach(function(e,t){var i=r.rowViewOrder.indexOf(t);e[n].content=i+1+""})}}reverseArray(e){var t=null,r=null;for(t=0,r=e.length-1;t<r;t+=1,r-=1){var n=e[t];e[t]=e[r],e[r]=n}}switchColumn(e,t){var r=this.columns[e];this.columns[e]=this.columns[t],this.columns[t]=r,this.columns[e].colIndex=e,this.columns[t].colIndex=t,this.rows.forEach(function(r){var n=Object.assign({},r[e],{colIndex:t}),i=Object.assign({},r[t],{colIndex:e});r[t]=n,r[e]=i})}removeColumn(e){e=+e,this.columns=this.columns.filter(function(t){return t.colIndex!==e}).map(function(e,t){return Object.assign({},e,{colIndex:t})}),this.rows.forEach(function(t){t.splice(e,1),t.forEach(function(e,t){e.colIndex=t})})}updateRow(e,t){e.length<this.columns.length&&(this.hasColumnById("_rowIndex")&&(e=[t+1+""].concat(e)),this.hasColumnById("_checkbox")&&(e=['<input type="checkbox" />'].concat(e)));var r=this.prepareRow(e,{rowIndex:t}),n=this.rows.findIndex(function(e){return e[0].rowIndex===t});return this.rows[n]=r,r}updateCell(e,t,r){var n;for(var i in"object"==typeof e&&(e=(n=e).colIndex,t=n.rowIndex,r=n),n=this.getCell(e,t),r){var o=r[i];void 0!==o&&(n[i]=o)}return n}updateColumn(e,t){var r=this.getColumn(e);for(var n in t){var i=t[n];void 0!==i&&(r[n]=i)}return r}filterRows(e){var t=this;return this.options.filterRows(this.rows,e).then(function(e){return e||(e=t.getAllRowIndices()),e.then||(e=Promise.resolve(e)),e.then(function(e){return t._filteredRows=e,{rowsToHide:t.getAllRowIndices().filter(function(t){return!e.includes(t)}),rowsToShow:e}})})}getFilteredRowIndices(){return this._filteredRows||this.getAllRowIndices()}getAllRowIndices(){return this.rows.map(function(e){return e.meta.rowIndex})}getRowCount(){return this.rowCount}_getNextRowCount(){var e=this.rowCount;return this.rowCount++,e}getRows(e,t){return this.rows.slice(e,t)}getRowsForView(e,t){var r=this;return this.rowViewOrder.map(function(e){return r.rows[e]}).slice(e,t)}getColumns(e){var t=this.columns;return e&&(t=t.slice(this.getStandardColumnCount())),t}getStandardColumnCount(){return this.options.checkboxColumn&&this.options.serialNoColumn?2:this.options.checkboxColumn||this.options.serialNoColumn?1:0}getColumnCount(e){var t=this.columns.length;return e&&(t-=this.getStandardColumnCount()),t}getColumn(e){return(e=+e)<0&&(e=this.columns.length+e),this.columns.find(function(t){return t.colIndex===e})}getColumnById(e){return this.columns.find(function(t){return t.id===e})}getRow(e){return e=+e,this.rows[e]}getCell(e,t){return t=+t,e=+e,this.getRow(t)[e]}getChildren(e){e=+e;for(var t=this.getRow(e).meta.indent,r=[],n=e+1;n<this.rowCount;n++){var i=this.getRow(n);if(!isNaN(i.meta.indent)&&(i.meta.indent>t&&r.push(n),i.meta.indent===t))break}return r}getImmediateChildren(e){e=+e;for(var t=this.getRow(e).meta.indent,r=[],n=t+1,i=e+1;i<this.rowCount;i++){var o=this.getRow(i);if(!(isNaN(o.meta.indent)||o.meta.indent>n)&&(o.meta.indent===n&&r.push(i),o.meta.indent===t))break}return r}get(){return{columns:this.columns,rows:this.rows}}getData(e){return this.data[e]}hasColumn(e){return Boolean(this.columns.find(function(t){return t.content===e}))}hasColumnById(e){return Boolean(this.columns.find(function(t){return t.id===e}))}getColumnIndex(e){return this.columns.findIndex(function(t){return t.content===e})}getColumnIndexById(e){return this.columns.findIndex(function(t){return t.id===e})}getCheckboxHTML(){return'<input type="checkbox" />'}},CellManager:class{constructor(e){this.instance=e,lt(this,this.instance,["wrapper","options","style","header","bodyScrollable","columnmanager","rowmanager","datamanager","keyboard"]),this.bindEvents()}bindEvents(){this.bindFocusCell(),this.bindEditCell(),this.bindKeyboardSelection(),this.bindCopyCellContents(),this.bindMouseEvents(),this.bindTreeEvents()}bindFocusCell(){this.bindKeyboardNav()}bindEditCell(){var e=this;this.$editingCell=null,n.on(this.bodyScrollable,"dblclick",".dt-cell",function(t,r){e.activateEditing(r)}),this.keyboard.on("enter",function(){e.$focusedCell&&!e.$editingCell?e.activateEditing(e.$focusedCell):e.$editingCell&&e.deactivateEditing()})}bindKeyboardNav(){var e=this;["left","right","up","down","tab","shift+tab"].map(function(t){return e.keyboard.on(t,function(){return e.focusCellInDirection(t)})}),["left","right","up","down"].map(function(t){return e.keyboard.on("ctrl+"+t,function(){return function(t){if(!e.$focusedCell||e.$editingCell)return!1;var r=e.$focusedCell,i=n.data(r),o=i.rowIndex,a=i.colIndex;return"left"===t?r=e.getLeftMostCell$(o):"right"===t?r=e.getRightMostCell$(o):"up"===t?r=e.getTopMostCell$(a):"down"===t&&(r=e.getBottomMostCell$(a)),e.focusCell(r),!0}(t)})}),this.keyboard.on("esc",function(){e.deactivateEditing(!1),e.columnmanager.toggleFilter(!1)}),this.options.inlineFilters&&(this.keyboard.on("ctrl+f",function(t){var r=n.closest(".dt-cell",t.target),i=n.data(r).colIndex;return e.activateFilter(i),!0}),n.on(this.header,"focusin",".dt-filter",function(){e.unfocusCell(e.$focusedCell)}))}bindKeyboardSelection(){var e=this;["left","right","up","down"].map(function(t){return e.keyboard.on("shift+"+t,function(){return e.selectArea(function(t){var r=e.getSelectionCursor();return"left"===t?r=e.getLeftCell$(r):"right"===t?r=e.getRightCell$(r):"up"===t?r=e.getAboveCell$(r):"down"===t&&(r=e.getBelowCell$(r)),r}(t))})})}bindCopyCellContents(){var e=this;this.keyboard.on("ctrl+c",function(){var t=e.copyCellContents(e.$focusedCell,e.$selectionCursor),r=t+" cell"+(t>1?"s":"")+" copied";t&&e.instance.showToastMessage(r,2)}),this.options.pasteFromClipboard&&this.keyboard.on("ctrl+v",function(t){return e.instance.pasteTarget.focus(),setTimeout(function(){var t=e.instance.pasteTarget.value;e.instance.pasteTarget.value="",e.pasteContentInCell(t)},10),!1})}bindMouseEvents(){var e=this,t=null;n.on(this.bodyScrollable,"mousedown",".dt-cell",function(r){t=!0,e.focusCell(n(r.delegatedTarget))}),n.on(this.bodyScrollable,"mouseup",function(){t=!1}),n.on(this.bodyScrollable,"mousemove",".dt-cell",ot(function(r){t&&e.selectArea(n(r.delegatedTarget))},50))}bindTreeEvents(){var e=this;n.on(this.bodyScrollable,"click",".dt-tree-node__toggle",function(t,r){var i=n.closest(".dt-cell",r),o=n.data(i).rowIndex;i.classList.contains("dt-cell--tree-close")?e.rowmanager.openSingleNode(o):e.rowmanager.closeSingleNode(o)})}focusCell(e,t){void 0===t&&(t={});var r=t.skipClearSelection;void 0===r&&(r=0);var i=t.skipDOMFocus;void 0===i&&(i=0);var o=t.skipScrollToCell;if(void 0===o&&(o=0),e&&e!==this.$editingCell){var a=n.data(e),s=a.colIndex;a.isHeader||!1!==this.columnmanager.getColumn(s).focusable&&(o||this.scrollToCell(e),this.deactivateEditing(),r||this.clearSelection(),this.$focusedCell&&this.$focusedCell.classList.remove("dt-cell--focus"),this.$focusedCell=e,e.classList.add("dt-cell--focus"),i||e.focus(),this.highlightRowColumnHeader(e))}}unfocusCell(e){e&&(e.classList.remove("dt-cell--focus"),this.$focusedCell=null,this.lastHeaders&&this.lastHeaders.forEach(function(e){return e&&e.classList.remove("dt-cell--highlight")}))}highlightRowColumnHeader(e){var t=n.data(e),r=t.colIndex,i=t.rowIndex,o=".dt-cell--header-"+r,a=".dt-cell--"+this.datamanager.getColumnIndexById("_rowIndex")+"-"+i;this.lastHeaders&&this.lastHeaders.forEach(function(e){return e&&e.classList.remove("dt-cell--highlight")});var s=n(o,this.wrapper),l=n(a,this.wrapper);this.lastHeaders=[s,l],this.lastHeaders.forEach(function(e){return e&&e.classList.add("dt-cell--highlight")})}selectAreaOnClusterChanged(){if(this.$focusedCell&&this.$selectionCursor){var e=n.data(this.$selectionCursor),t=e.colIndex,r=e.rowIndex,i=this.getCell$(t,r);if(i&&i!==this.$selectionCursor){var o=n.data(this.$focusedCell);this.$focusedCell=this.getCell$(o.colIndex,o.rowIndex),this.selectArea(i)}}}focusCellOnClusterChanged(){if(this.$focusedCell){var e=n.data(this.$focusedCell),t=e.colIndex,r=e.rowIndex,i=this.getCell$(t,r);i&&this.focusCell(i,{skipClearSelection:1,skipDOMFocus:1,skipScrollToCell:1})}}selectArea(e){this.$focusedCell&&this._selectArea(this.$focusedCell,e)&&(this.$selectionCursor=e)}_selectArea(e,t){var r=this;if(e===t)return!1;var n=this.getCellsInRange(e,t);return!!n&&(this.clearSelection(),this._selectedCells=n.map(function(e){var t;return(t=r).getCell$.apply(t,e)}),requestAnimationFrame(function(){r._selectedCells.map(function(e){return e.classList.add("dt-cell--highlight")})}),!0)}getCellsInRange(e,t){var r,i,o,a,s,l,d;if("number"==typeof e)a=(r=arguments)[0],s=r[1],l=r[2],d=r[3];else if("object"==typeof e){if(!e||!t)return!1;var c=n.data(e),u=n.data(t);a=+c.colIndex,s=+c.rowIndex,l=+u.colIndex,d=+u.rowIndex}if(s>d&&(s=(i=[d,s])[0],d=i[1]),a>l&&(a=(o=[l,a])[0],l=o[1]),this.isStandardCell(a)||this.isStandardCell(l))return!1;for(var h=[],p=a,_=s,f=[];_<=d;)f.push(_),_+=1;return f.map(function(e){for(;p<=l;)h.push([p,e]),p++;p=a}),h}clearSelection(){(this._selectedCells||[]).forEach(function(e){return e.classList.remove("dt-cell--highlight")}),this._selectedCells=[],this.$selectionCursor=null}getSelectionCursor(){return this.$selectionCursor||this.$focusedCell}activateEditing(e){this.focusCell(e);var t=n.data(e),r=t.rowIndex,i=t.colIndex,o=this.columnmanager.getColumn(i);if(!o||!1!==o.editable&&!1!==o.focusable){var a=this.getCell(i,r);if(!a||!1!==a.editable){if(this.$editingCell){var s=n.data(this.$editingCell),l=s._rowIndex,d=s._colIndex;if(r===l&&i===d)return}this.$editingCell=e,e.classList.add("dt-cell--editing");var c=n(".dt-cell__edit",e);c.innerHTML="";var u=this.getEditor(i,r,a.content,c);u&&(this.currentCellEditor=u,u.initValue(a.content,r,o))}}}deactivateEditing(e){void 0===e&&(e=!0),e&&this.submitEditing(),this.$focusedCell&&this.$focusedCell.focus(),this.$editingCell&&(this.$editingCell.classList.remove("dt-cell--editing"),this.$editingCell=null)}getEditor(e,t,r,n){var i=this.datamanager.getColumn(e),o=this.datamanager.getRow(t),a=this.datamanager.getData(t),s=this.options.getEditor?this.options.getEditor(e,t,r,n,i,o,a):this.getDefaultEditor(n);return!1!==s&&(void 0===s&&(s=this.getDefaultEditor(n)),s)}getDefaultEditor(e){var t=n.create("input",{class:"dt-input",type:"text",inside:e});return{initValue:function(e){t.focus(),t.value=e},getValue:function(){return t.value},setValue:function(e){t.value=e}}}submitEditing(){var e=this,t=Promise.resolve();if(!this.$editingCell)return t;var r=this.$editingCell,i=n.data(r),o=i.rowIndex,a=i.colIndex,s=this.datamanager.getColumn(a);if(r){var l=this.currentCellEditor;if(l){var d=l.getValue();d.then||(d=Promise.resolve(d)),t=d.then(function(t){var n=l.setValue(t,o,s),i=e.getCell(a,o).content;return e.updateCell(a,o,t),r.focus(),n&&n.then&&n.catch(function(t){console.log(t),e.updateCell(a,o,i)}),n})}}return this.currentCellEditor=null,t}copyCellContents(e,t){var r=this;if(!t&&e){var i=n.data(e),o=i.colIndex,a=i.rowIndex;return it(this.getCell(o,a).content),1}var s=this.getCellsInRange(e,t);if(!s)return 0;var l=s.map(function(e){var t;return(t=r).getCell.apply(t,e)}).reduce(function(e,t){var r=t.rowIndex;return e[r]=e[r]||[],e[r].push(t.content),e},[]);return it(l.map(function(e){return e.join("\t")}).join("\n")),l.reduce(function(e,t){return e+t.length},0)}pasteContentInCell(e){var t=this;if(this.$focusedCell){var r=e.split("\n").map(function(e){return e.split("\t")}).filter(function(e){return e.length&&e.every(function(e){return e})}),i=n.data(this.$focusedCell),o=i.colIndex,a=i.rowIndex,s=+o,l=+a;r.forEach(function(e,r){var n=r+l;e.forEach(function(e,r){var i=r+s;t.updateCell(i,n,e)})})}}activateFilter(e){this.columnmanager.toggleFilter(),this.columnmanager.focusFilter(e),this.columnmanager.isFilterShown||this.$focusedCell&&this.$focusedCell.focus()}updateCell(e,t,r){var n=this.datamanager.updateCell(e,t,{content:r});this.refreshCell(n)}refreshCell(e){n(this.selector(e.colIndex,e.rowIndex),this.bodyScrollable).innerHTML=this.getCellContent(e)}toggleTreeButton(e,t){var r=this.columnmanager.getFirstColumnIndex(),n=this.getCell$(r,e);n&&n.classList[t?"remove":"add"]("dt-cell--tree-close")}isStandardCell(e){return e<this.columnmanager.getFirstColumnIndex()}focusCellInDirection(e){if(!this.$focusedCell)return!1;this.$editingCell&&["tab","shift+tab"].includes(e)&&this.deactivateEditing();var t=this.$focusedCell;if("left"===e||"shift+tab"===e?t=this.getLeftCell$(t):"right"===e||"tab"===e?t=this.getRightCell$(t):"up"===e?t=this.getAboveCell$(t):"down"===e&&(t=this.getBelowCell$(t)),!t)return!1;var r=n.data(t).colIndex;if(!this.columnmanager.getColumn(r).focusable){var i=this.$focusedCell;this.unfocusCell(i),this.$focusedCell=t;var o=this.focusCellInDirection(e);return o||this.focusCell(i),o}return this.focusCell(t),!0}getCell$(e,t){return n(this.selector(e,t),this.bodyScrollable)}getAboveCell$(e){for(var t=n.data(e).colIndex,r=e.parentElement.previousElementSibling;r&&r.classList.contains("dt-row--hide");)r=r.previousElementSibling;return r?n(".dt-cell--col-"+t,r):e}getBelowCell$(e){for(var t=n.data(e).colIndex,r=e.parentElement.nextElementSibling;r&&r.classList.contains("dt-row--hide");)r=r.nextElementSibling;return r?n(".dt-cell--col-"+t,r):e}getLeftCell$(e){return e.previousElementSibling}getRightCell$(e){return e.nextElementSibling}getLeftMostCell$(e){return this.getCell$(this.columnmanager.getFirstColumnIndex(),e)}getRightMostCell$(e){return this.getCell$(this.columnmanager.getLastColumnIndex(),e)}getTopMostCell$(e){return this.getCell$(e,this.rowmanager.getFirstRowIndex())}getBottomMostCell$(e){return this.getCell$(e,this.rowmanager.getLastRowIndex())}getCell(e,t){return this.instance.datamanager.getCell(e,t)}getRowHeight(){return n.style(n(".dt-row",this.bodyScrollable),"height")}scrollToCell(e){if(n.inViewport(e,this.bodyScrollable))return!1;var t=n.data(e).rowIndex;return this.rowmanager.scrollToRow(t),!1}getRowCountPerPage(){return Math.ceil(this.instance.getViewportHeight()/this.getRowHeight())}getCellHTML(e){var t=e.rowIndex,r=e.colIndex,n=e.isHeader,i=e.isFilter,o=e.isTotalRow,a=nt({rowIndex:t,colIndex:r,isHeader:n,isFilter:i,isTotalRow:o}),s=this.datamanager.getRow(t),l=!(n||i||o);return'\n            <div class="'+["dt-cell","dt-cell--col-"+r,l?"dt-cell--"+r+"-"+t:"",l?"dt-cell--row-"+t:"",n?"dt-cell--header":"",n?"dt-cell--header-"+r:"",i?"dt-cell--filter":"",l&&s&&s.meta.isTreeNodeClose?"dt-cell--tree-close":""].join(" ")+'" '+a+' tabindex="0">\n                '+this.getCellContent(e)+"\n            </div>\n        "}getCellContent(e){var t,r=e.isHeader,n=e.isFilter,i=e.colIndex,o=r||!1===e.editable?"":this.getEditCellHTML(i),a=r&&!1!==e.sortable?'<span class="sort-indicator">\n                '+this.options.sortIndicator[e.sortOrder]+"\n            </span>":"",s=r&&!1!==e.resizable?'<span class="dt-cell__resize-handle"></span>':"",l=r&&!1!==e.dropdown?this.columnmanager.getDropdownHTML():"",d=e.format||e.column&&e.column.format||null;if(r||n||!d)t=e.content;else{var c=this.datamanager.getRow(e.rowIndex),u=this.datamanager.getData(e.rowIndex);t=d(e.content,c,e.column,u)}if(e.html=t,this.options.treeView&&!r&&!n&&void 0!==e.indent){var h=this.datamanager.getRow(e.rowIndex+1),p=h&&h.meta.indent>e.indent;if(this.datamanager.getColumnIndexById("_rowIndex")+1===e.colIndex){var _=20*(e.indent||0);t='<span class="dt-tree-node" style="padding-left: '+_+'px">\n                    '+(p?'<span class="dt-tree-node__toggle" style="left: '+(_-20)+'px">\n                        <span class="icon-open">'+pt.chevronDown+'</span>\n                        <span class="icon-close">'+pt.chevronRight+"</span>\n                    </span>":"")+"\n                    <span>"+t+"</span>\n                </span>"}}return'\n            <div class="'+["dt-cell__content",r?"dt-cell__content--header-"+i:"dt-cell__content--col-"+i].join(" ")+'">\n                '+t+"\n                "+a+"\n                "+s+"\n                "+l+"\n            </div>\n            "+o+"\n        "}getEditCellHTML(e){return'<div class="dt-cell__edit dt-cell__edit--col-'+e+'"></div>'}selector(e,t){return".dt-cell--"+e+"-"+t}},ColumnManager:class{constructor(e){this.instance=e,lt(this,this.instance,["options","fireEvent","header","datamanager","cellmanager","style","wrapper","rowmanager","bodyScrollable","bodyRenderer"]),this.bindEvents()}renderHeader(){this.header.innerHTML="<div></div>",this.refreshHeader()}refreshHeader(){var e=this.datamanager.getColumns();n("div",this.header).innerHTML=this.getHeaderHTML(e),this.$filterRow=n(".dt-row-filter",this.header),this.$filterRow&&n.style(this.$filterRow,{display:"none"}),this.$columnMap=[],this.bindMoveColumn()}getHeaderHTML(e){var t=this.rowmanager.getRowHTML(e,{isHeader:1});return this.options.inlineFilters&&(t+=this.rowmanager.getRowHTML(e,{isFilter:1})),t}bindEvents(){this.bindDropdown(),this.bindResizeColumn(),this.bindPerfectColumnWidth(),this.bindFilter()}bindDropdown(){var e=this,t=".dt-dropdown__toggle",r=".dt-dropdown__list";this.instance.dropdownContainer.innerHTML=this.getDropdownListHTML(),this.$dropdownList=this.instance.dropdownContainer.firstElementChild,n.on(this.header,"click",t,function(t){e.openDropdown(t)});var i=function(e){var n=[t,t+" *",r,r+" *"].join(",");e.target.matches(n)||a()};n.on(document.body,"click",i),document.addEventListener("scroll",a,!0),this.instance.on("onDestroy",function(){n.off(document.body,"click",i),n.off(document,"scroll",a)}),n.on(this.$dropdownList,"click",".dt-dropdown__list-item",function(t,r){if(e._dropdownActiveColIndex){var i=e.options.headerDropdown,o=n.data(r).index,a=e._dropdownActiveColIndex,s=i[o].action;s&&s.call(e.instance,e.getColumn(a)),e.hideDropdown()}});var o=this;function a(e){o.hideDropdown()}this.hideDropdown()}openDropdown(e){this._dropdownWidth||(n.style(this.$dropdownList,{display:""}),this._dropdownWidth=n.style(this.$dropdownList,"width")),n.style(this.$dropdownList,{display:"",left:e.clientX-this._dropdownWidth+4+"px",top:e.clientY+4+"px"});var t=n.closest(".dt-cell",e.target),r=n.data(t).colIndex;this._dropdownActiveColIndex=r}hideDropdown(){n.style(this.$dropdownList,{display:"none"}),this._dropdownActiveColIndex=null}bindResizeColumn(){var e,t,r,i=this,o=!1;n.on(this.header,"mousedown",".dt-cell .dt-cell__resize-handle",function(a,s){document.body.classList.add("dt-resize");var l=s.parentNode.parentNode;e=l;var d=n.data(e).colIndex,c=i.getColumn(d);c&&!1===c.resizable||(o=!0,t=n.style(n(".dt-cell__content",e),"width"),r=a.pageX)});var a=function(t){if(document.body.classList.remove("dt-resize"),e){o=!1;var r=n.data(e).colIndex;i.setColumnWidth(r),i.style.setBodyStyle(),e=null}};n.on(document.body,"mouseup",a),this.instance.on("onDestroy",function(){n.off(document.body,"mouseup",a)});var s=function(a){if(o){var s=t+(a.pageX-r),l=n.data(e).colIndex;i.options.minimumColumnWidth>s||(i.datamanager.updateColumn(l,{width:s}),i.setColumnHeaderWidth(l))}};n.on(document.body,"mousemove",s),this.instance.on("onDestroy",function(){n.off(document.body,"mousemove",s)})}bindPerfectColumnWidth(){var e=this;n.on(this.header,"dblclick",".dt-cell .dt-cell__resize-handle",function(t,r){var i=r.parentNode.parentNode,o=n.data(i).colIndex,a=e.bodyRenderer.visibleRows.map(function(e){return e[o]}).reduce(function(e,t){return e.content.length>t.content.length?e:t}),s=e.cellmanager.getCellHTML(a),l=document.createElement("div");l.innerHTML=s;var d=l.querySelector(".dt-cell__content").textContent,c=n.getStyle(e.bodyScrollable.querySelector(".dt-cell__content")),u=[c.borderLeftWidth,c.borderRightWidth,c.paddingLeft,c.paddingRight].map(parseFloat).reduce(function(e,t){return e+t}),h=n.measureTextWidth(d)+u;e.datamanager.updateColumn(o,{width:h}),e.setColumnHeaderWidth(o),e.setColumnWidth(o)})}bindMoveColumn(){var e=this;if(!this.options.disableReorderColumn){var t=n(".dt-row",this.header);this.sortable=r.create(t,{onEnd:function(t){var r=t.oldIndex,i=t.newIndex,o=t.item;+n.data(o).colIndex!==i&&e.switchColumn(r,i)},preventOnFilter:!1,filter:".dt-cell__resize-handle, .dt-dropdown",chosenClass:"dt-cell--dragging",animation:150})}}sortColumn(e,t){var r=this;this.instance.freeze(),this.sortRows(e,t).then(function(){return r.refreshHeader(),r.rowmanager.refreshRows()}).then(function(){return r.instance.unfreeze()}).then(function(){r.fireEvent("onSortColumn",r.getColumn(e))})}removeColumn(e){var t=this,r=this.getColumn(e);this.instance.freeze(),this.datamanager.removeColumn(e).then(function(){return t.refreshHeader(),t.rowmanager.refreshRows()}).then(function(){return t.instance.unfreeze()}).then(function(){t.fireEvent("onRemoveColumn",r)})}switchColumn(e,t){var r=this;this.instance.freeze(),this.datamanager.switchColumn(e,t).then(function(){return r.refreshHeader(),r.rowmanager.refreshRows()}).then(function(){r.setColumnWidth(e),r.setColumnWidth(t),r.instance.unfreeze()}).then(function(){r.fireEvent("onSwitchColumn",r.getColumn(e),r.getColumn(t))})}toggleFilter(e){var t;this.options.inlineFilters&&((t=void 0===e?!this.isFilterShown:e)?n.style(this.$filterRow,{display:""}):n.style(this.$filterRow,{display:"none"}),this.isFilterShown=t,this.style.setBodyStyle())}focusFilter(e){this.isFilterShown&&n(".dt-cell--col-"+e+" .dt-filter",this.$filterRow).focus()}bindFilter(){var e=this;this.options.inlineFilters&&n.on(this.header,"keydown",".dt-filter",at(function(t){e.applyFilter(e.getAppliedFilters())},300))}applyFilter(e){var t=this;this.datamanager.filterRows(e).then(function(e){var r=e.rowsToShow;t.rowmanager.showRows(r)})}getAppliedFilters(){var e={};return n.each(".dt-filter",this.header).map(function(t){var r=t.value;r&&(e[t.dataset.colIndex]=r)}),e}applyDefaultSortOrder(){var e=this.getColumns().filter(function(e){return"none"!==e.sortOrder});if(1===e.length){var t=e[0];this.sortColumn(t.colIndex,t.sortOrder)}}sortRows(e,t){return this.datamanager.sortRows(e,t)}getColumn(e){return this.datamanager.getColumn(e)}getColumns(){return this.datamanager.getColumns()}setColumnWidth(e,t){e=+e;var r=t||this.getColumn(e).width,n=[".dt-cell__content--col-"+e,".dt-cell__edit--col-"+e].join(", "),i={width:r+"px"};this.style.setStyle(n,i)}setColumnHeaderWidth(e){e=+e,this.$columnMap=this.$columnMap||[];var t=".dt-cell__content--header-"+e,r=this.getColumn(e).width,n=this.$columnMap[e];n||(n=this.header.querySelector(t),this.$columnMap[e]=n),n.style.width=r+"px"}getColumnMinWidth(e){return e=+e,this.getColumn(e).minWidth||24}getFirstColumnIndex(){return this.datamanager.getColumnIndexById("_rowIndex")+1}getHeaderCell$(e){return n(".dt-cell--header-"+e,this.header)}getLastColumnIndex(){return this.datamanager.getColumnCount()-1}getDropdownHTML(){return'\n            <div class="dt-dropdown">\n                <div class="dt-dropdown__toggle">'+this.options.dropdownButton+"</div>\n            </div>\n      "}getDropdownListHTML(){return'\n            <div class="dt-dropdown__list">\n            '+this.options.headerDropdown.map(function(e,t){return'\n                <div class="dt-dropdown__list-item" data-index="'+t+'">'+e.label+"</div>\n            "}).join("")+"\n            </div>\n        "}},RowManager:class{constructor(e){this.instance=e,lt(this,this.instance,["options","fireEvent","wrapper","bodyScrollable","bodyRenderer","style"]),this.bindEvents(),this.refreshRows=st(this.refreshRows,this)}get datamanager(){return this.instance.datamanager}get cellmanager(){return this.instance.cellmanager}bindEvents(){this.bindCheckbox()}bindCheckbox(){var e=this;this.options.checkboxColumn&&(this.checkMap=[],n.on(this.wrapper,"click",'.dt-cell--col-0 [type="checkbox"]',function(t,r){var i=r.closest(".dt-cell"),o=n.data(i),a=o.rowIndex,s=o.isHeader,l=r.checked;s?e.checkAll(l):e.checkRow(a,l)}))}refreshRows(){this.instance.renderBody(),this.instance.setDimensions()}refreshRow(e,t){var r=this;this.datamanager.updateRow(e,t).forEach(function(e){r.cellmanager.refreshCell(e)})}getCheckedRows(){if(!this.checkMap)return[];var e=[];for(var t in this.checkMap)1===this.checkMap[t]&&e.push(t);return e}highlightCheckedRows(){var e=this;this.getCheckedRows().map(function(t){return e.checkRow(t,!0)})}checkRow(e,t){var r=t?1:0;this.checkMap[e]=r,n.each(function(e){return".dt-cell--0-"+e+' [type="checkbox"]'}(e),this.bodyScrollable).map(function(e){e.checked=t}),this.highlightRow(e,t),this.showCheckStatus(),this.fireEvent("onCheckRow",this.datamanager.getRow(e))}checkAll(e){var t=e?1:0;this.checkMap=e?Array.from(Array(this.getTotalRows())).map(function(e){return t}):[],n.each('.dt-cell--col-0 [type="checkbox"]',this.bodyScrollable).map(function(t){t.checked=e}),this.highlightAll(e),this.showCheckStatus(),this.fireEvent("onCheckRow")}showCheckStatus(){if(this.options.checkedRowStatus){var e=this.getCheckedRows().length;e>0?this.bodyRenderer.showToastMessage(e+" row"+(e>1?"s":"")+" selected"):this.bodyRenderer.clearToastMessage()}}highlightRow(e,t){void 0===t&&(t=!0);var r=this.getRow$(e);r&&(t||!this.bodyScrollable.classList.contains("dt-scrollable--highlight-all")?(t&&r.classList.contains("dt-row--unhighlight")&&r.classList.remove("dt-row--unhighlight"),this._highlightedRows=this._highlightedRows||{},t?(r.classList.add("dt-row--highlight"),this._highlightedRows[e]=r):(r.classList.remove("dt-row--highlight"),delete this._highlightedRows[e])):r.classList.add("dt-row--unhighlight"))}highlightAll(e){if(void 0===e&&(e=!0),e)this.bodyScrollable.classList.add("dt-scrollable--highlight-all");else{for(var t in this.bodyScrollable.classList.remove("dt-scrollable--highlight-all"),this._highlightedRows)this._highlightedRows[t].classList.remove("dt-row--highlight");this._highlightedRows={}}}showRows(e){var t,r=this;t=e;var n=(e=Array.isArray(t)?t:[t]).map(function(e){return r.datamanager.getRow(e)});this.bodyRenderer.renderRows(n)}showAllRows(){var e=this.datamanager.getAllRowIndices();this.showRows(e)}getChildrenToShowForNode(e){return this.datamanager.getRow(e).meta.isTreeNodeClose=!1,this.datamanager.getImmediateChildren(e)}openSingleNode(e){var t=this.getChildrenToShowForNode(e),r=this.bodyRenderer.visibleRowIndices,n=ct(t.concat(r)).sort(ut);this.showRows(n)}getChildrenToHideForNode(e){var t=this;this.datamanager.getRow(e).meta.isTreeNodeClose=!0;var r=this.datamanager.getChildren(e);return r.forEach(function(e){var r=t.datamanager.getRow(e);r.meta.isLeaf||(r.meta.isTreeNodeClose=!0)}),r}closeSingleNode(e){var t=this.getChildrenToHideForNode(e),r=this.bodyRenderer.visibleRowIndices.filter(function(e){return!t.includes(e)}).sort(ut);this.showRows(r)}expandAllNodes(){var e=this,t=this.datamanager.getRows().filter(function(e){return!e.meta.isLeaf}).map(function(t){return e.getChildrenToShowForNode(t.meta.rowIndex)}).flat(),r=this.bodyRenderer.visibleRowIndices,n=ct(t.concat(r)).sort(ut);this.showRows(n)}collapseAllNodes(){var e=this,t=this.datamanager.getRows().filter(function(e){return 0===e.meta.indent}).map(function(t){return e.getChildrenToHideForNode(t.meta.rowIndex)}).flat(),r=this.bodyRenderer.visibleRowIndices.filter(function(e){return!t.includes(e)}).sort(ut);this.showRows(r)}setTreeDepth(e){var t=this.datamanager.getRows(),r=t.filter(function(t){return t.meta.indent<e}),n=t.filter(function(t){return t.meta.indent>=e}),i=n.filter(function(t){return t.meta.indent>e});n.forEach(function(e){e.meta.isLeaf||(e.meta.isTreeNodeClose=!0)}),r.forEach(function(e){e.meta.isLeaf||(e.meta.isTreeNodeClose=!1)});var o=t.filter(function(e){return!i.includes(e)}).map(function(e){return e.meta.rowIndex}).sort(ut);this.showRows(o)}getRow$(e){return n(this.selector(e),this.bodyScrollable)}getTotalRows(){return this.datamanager.getRowCount()}getFirstRowIndex(){return 0}getLastRowIndex(){return this.datamanager.getRowCount()-1}scrollToRow(e){e=+e,this._lastScrollTo=this._lastScrollTo||0;var t=this.getRow$(e);if(!n.inViewport(t,this.bodyScrollable)){var r=t.getBoundingClientRect().height,i=this.bodyScrollable.getBoundingClientRect(),o=i.top,a=i.bottom,s=Math.floor((a-o)/r),l=0;l=e>this._lastScrollTo?r*(e+1-s):r*(e+1-1),this._lastScrollTo=e,n.scrollTop(this.bodyScrollable,l)}}getRowHTML(e,t){var r=this,n=nt(t),i=t.rowIndex;return t.isFilter&&(e=e.map(function(e){return Object.assign({},e,{content:r.getFilterInput({colIndex:e.colIndex}),isFilter:1,isHeader:void 0,editable:!1})}),i="filter"),t.isHeader&&(i="header"),'\n            <div class="dt-row dt-row-'+i+'" '+n+">\n                "+e.map(function(e){return r.cellmanager.getCellHTML(e)}).join("")+"\n            </div>\n        "}getFilterInput(e){return'<input class="dt-filter dt-input" type="text" '+nt(e)+' tabindex="1" />'}selector(e){return".dt-row-"+e}},BodyRenderer:class{constructor(e){this.instance=e,this.options=e.options,this.datamanager=e.datamanager,this.rowmanager=e.rowmanager,this.cellmanager=e.cellmanager,this.bodyScrollable=e.bodyScrollable,this.footer=this.instance.footer,this.log=e.log}renderRows(e){var t=this;if(this.visibleRows=e,this.visibleRowIndices=e.map(function(e){return e.meta.rowIndex}),0!==e.length){var r=this.datamanager.rowViewOrder.map(function(e){return t.visibleRowIndices.includes(e)?e:null}).filter(function(e){return null!==e}),n=getComputedStyle(this.bodyScrollable),i={width:n.width,height:n.height,itemHeight:this.options.cellHeight,total:e.length,generate:function(e){var n=document.createElement("div"),i=r[e],o=t.datamanager.getRow(i),a=t.rowmanager.getRowHTML(o,o.meta);return n.innerHTML=a,n.children[0]},afterRender:function(){t.restoreState()}};this.hyperlist?this.hyperlist.refresh(this.bodyScrollable,i):this.hyperlist=new gt(this.bodyScrollable,i),this.renderFooter()}else this.bodyScrollable.innerHTML=this.getNoDataHTML()}render(){var e=this.datamanager.getRowsForView();this.renderRows(e),this.instance.setDimensions()}renderFooter(){if(this.options.showTotalRow){var e=this.getTotalRow(),t=this.rowmanager.getRowHTML(e,{isTotalRow:1,rowIndex:"totalRow"});this.footer.innerHTML=t}}getTotalRow(){var e=this;return this.datamanager.getColumns().map(function(e){var t=null;return["_rowIndex","_checkbox"].includes(e.id)&&(t=""),{content:t,isTotalRow:1,colIndex:e.colIndex,column:e}}).map(function(t,r){if(""===t.content)return t;if(e.options.hooks.columnTotal){var n=e.visibleRows.map(function(e){return e[r].content}),i=e.options.hooks.columnTotal.call(e.instance,n,t);if(null!=i)return t.content=i,t}return t.content=e.visibleRows.reduce(function(e,t){var n=t[r];return"number"==typeof n.content?(null==e&&(e=0),e+n.content):e},t.content),t})}restoreState(){this.rowmanager.highlightCheckedRows(),this.cellmanager.selectAreaOnClusterChanged(),this.cellmanager.focusCellOnClusterChanged()}showToastMessage(e,t){var r=this;this.instance.toastMessage.innerHTML=this.getToastMessageHTML(e),t&&setTimeout(function(){r.clearToastMessage()},1e3*t)}clearToastMessage(){this.instance.toastMessage.innerHTML=""}getNoDataHTML(){return'<div class="dt-scrollable__no-data">'+this.options.noDataMessage+"</div>"}getToastMessageHTML(e){return'<span class="dt-toast__message">'+e+"</span>"}},Style:class{constructor(e){this.instance=e,lt(this,this.instance,["options","datamanager","columnmanager","header","footer","bodyScrollable","datatableWrapper","getColumn","bodyRenderer"]),this.scopeClass="dt-instance-"+e.constructor.instances,e.datatableWrapper.classList.add(this.scopeClass);var t=document.createElement("style");e.wrapper.insertBefore(t,e.datatableWrapper),this.styleEl=t,this.bindResizeWindow(),this.bindScrollHeader()}get stylesheet(){return this.styleEl.sheet}bindResizeWindow(){this.onWindowResize=this.onWindowResize.bind(this),this.onWindowResize=ot(this.onWindowResize,300),"fluid"===this.options.layout&&n.on(window,"resize",this.onWindowResize)}bindScrollHeader(){var e=this;this._settingHeaderPosition=!1,n.on(this.bodyScrollable,"scroll",function(t){e._settingHeaderPosition||(e._settingHeaderPosition=!0,requestAnimationFrame(function(){var r=-t.target.scrollLeft;n.style(e.header,{transform:"translateX("+r+"px)"}),n.style(e.footer,{transform:"translateX("+r+"px)"}),e._settingHeaderPosition=!1}))})}onWindowResize(){this.distributeRemainingWidth(),this.refreshColumnWidth(),this.setBodyStyle()}destroy(){this.styleEl.remove(),n.off(window,"resize",this.onWindowResize)}setStyle(e,t){var r=this;if(e.includes(","))e.split(",").map(function(e){return e.trim()}).forEach(function(e){r.setStyle(e,t)});else if(e=e.trim()){this._styleRulesMap=this._styleRulesMap||{};var n=this._getPrefixedSelector(e);this._styleRulesMap[n]&&(this.removeStyle(e),t=Object.assign({},this._styleRulesMap[n],t));var i=n+" { "+this._getRuleString(t)+" }";this._styleRulesMap[n]=t,this.stylesheet.insertRule(i)}}removeStyle(e){var t=this;if(e.includes(","))e.split(",").map(function(e){return e.trim()}).forEach(function(e){t.removeStyle(e)});else if(e=e.trim()){var r=this._getPrefixedSelector(e),n=Array.from(this.stylesheet.cssRules).findIndex(function(e){return e.selectorText===r});-1!==n&&this.stylesheet.deleteRule(n)}}_getPrefixedSelector(e){return"."+this.scopeClass+" "+e}_getRuleString(e){return Object.keys(e).map(function(t){var r=t;return t.includes("-")||(r=rt(t)),r+":"+e[t]+";"}).join("")}setDimensions(){this.setCellHeight(),this.setupMinWidth(),this.setupNaturalColumnWidth(),this.setupColumnWidth(),this.distributeRemainingWidth(),this.setColumnStyle(),this.setBodyStyle()}setCellHeight(){this.setStyle(".dt-cell",{height:this.options.cellHeight+"px"})}setupMinWidth(){var e=this;n.each(".dt-cell--header",this.header).map(function(t){var r=n.data(t).colIndex,i=e.getColumn(r);if(!i.minWidth){var o=n.style(n(".dt-cell__content",t),"width");i.minWidth=o}})}setupNaturalColumnWidth(){var e=this;n(".dt-row")&&(n.each(".dt-row-header .dt-cell",this.header).map(function(t){var r=n.data(t).colIndex,i=e.datamanager.getColumn(r),o=n.style(n(".dt-cell__content",t),"width");"number"==typeof o&&o>=e.options.minimumColumnWidth?i.naturalWidth=o:i.naturalWidth=e.options.minimumColumnWidth}),n.each(".dt-row-0 .dt-cell",this.bodyScrollable).map(function(t){var r=n.data(t).colIndex,i=e.datamanager.getColumn(r),o=n.style(n(".dt-cell__content",t),"width");"number"==typeof o&&o>=i.naturalWidth?i.naturalWidth=o:i.naturalWidth=i.naturalWidth}))}setupColumnWidth(){var e=this;if("ratio"===this.options.layout){var t=n.style(this.datatableWrapper,"width");this.options.serialNoColumn&&(t=t-this.datamanager.getColumnById("_rowIndex").width-1),this.options.checkboxColumn&&(t=t-this.datamanager.getColumnById("_checkbox").width-1);var r=t/this.datamanager.getColumns().map(function(e){return"_rowIndex"===e.id||"_checkbox"===e.id?0:(e.width||(e.width=1),e.ratioWidth=parseInt(e.width,10),e.ratioWidth)}).reduce(function(e,t){return e+t});this.datamanager.getColumns().map(function(e){"_rowIndex"!==e.id&&"_checkbox"!==e.id&&(e.width=Math.floor(r*e.ratioWidth)-1)})}else this.datamanager.getColumns().map(function(t){t.width||(t.width=t.naturalWidth),"_rowIndex"===t.id&&(t.width=e.getRowIndexColumnWidth()),t.width<e.options.minimumColumnWidth&&(t.width=e.options.minimumColumnWidth)})}distributeRemainingWidth(){var e=this;if("fluid"===this.options.layout){var t=n.style(this.instance.datatableWrapper,"width"),r=n(".dt-row",this.bodyScrollable),i=t;if(r)i=n.style(r,"width");else{var o=n(".dt-row",this.instance.header);i=Array.from(o.children).map(function(e){return e.offsetWidth}).reduce(function(e,t){return e+t},0)}var a=this.datamanager.getColumns().filter(function(e){return e.resizable}),s=(t-i)/a.length;a.map(function(t){var r=n.style(e.getColumnHeaderElement(t.colIndex),"width"),i=Math.floor(r+s)-2;e.datamanager.updateColumn(t.colIndex,{width:i})})}}setColumnStyle(){var e=this;this.datamanager.getColumns().map(function(t){t.align||(t.align="left"),["left","center","right"].includes(t.align)||(t.align="left"),e.setStyle(".dt-cell--col-"+t.colIndex,{"text-align":t.align}),e.columnmanager.setColumnHeaderWidth(t.colIndex),e.columnmanager.setColumnWidth(t.colIndex)})}refreshColumnWidth(){var e=this;this.datamanager.getColumns().map(function(t){e.columnmanager.setColumnHeaderWidth(t.colIndex),e.columnmanager.setColumnWidth(t.colIndex)})}setBodyStyle(){var e=n.style(this.datatableWrapper,"width"),t=n(".dt-row",this.bodyScrollable);if(t){var r=n.style(t,"width"),i=e>r?r:e;n.style(this.bodyScrollable,{width:i+"px"}),n.removeStyle(this.bodyScrollable,"height");var o,a=n.getStyle(this.bodyScrollable,"height"),s=(this.bodyRenderer.hyperlist||{})._scrollHeight||1/0,l=n.hasHorizontalOverflow(this.bodyScrollable);s<a&&(o=s,l&&(o+=n.scrollbarSize()),n.style(this.bodyScrollable,{height:o+"px"})),this.bodyScrollable.scrollHeight-this.bodyScrollable.offsetHeight<n.scrollbarSize()&&n.style(this.bodyScrollable,{overflowY:"hidden"}),"fluid"===this.options.layout&&n.style(this.bodyScrollable,{overflowX:"hidden"})}}getColumnHeaderElement(e){return(e=+e)<0?null:n(".dt-cell--col-"+e,this.header)}getRowIndexColumnWidth(){var e=this.datamanager.getRowCount();return n.measureTextWidth(e+"")+22}},Keyboard:class{constructor(e){this.listeners={},n.on(e,"keydown",this.handler.bind(this))}handler(e){var t=mt[e.keyCode];e.shiftKey&&"shift"!==t&&(t="shift+"+t),(e.ctrlKey&&"ctrl"!==t||e.metaKey&&"meta"!==t)&&(t="ctrl+"+t);var r=this.listeners[t];if(r&&r.length>0)for(var n=0,i=r;n<i.length;n+=1){var o=(0,i[n])(e);void 0!==o&&!0!==o||e.preventDefault()}}on(e,t){var r=this;e.split(",").map(function(e){return e.trim()}).map(function(e){r.listeners[e]=r.listeners[e]||[],r.listeners[e].push(t)})}}};class yt{constructor(e,t){if(yt.instances++,"string"==typeof e&&(e=document.querySelector(e)),this.wrapper=e,!(this.wrapper instanceof HTMLElement))throw new Error("Invalid argument given for `wrapper`");this.buildOptions(t),this.prepare(),this.initializeComponents(),this.options.data&&(this.refresh(),this.columnmanager.applyDefaultSortOrder())}buildOptions(e){this.options=this.options||{},this.options=Object.assign({},vt,this.options||{},e),e.headerDropdown=e.headerDropdown||[],this.options.headerDropdown=vt.headerDropdown.concat(e.headerDropdown),this.events=Object.assign({},vt.events,this.options.events||{},e.events||{}),this.fireEvent=this.fireEvent.bind(this)}prepare(){this.prepareDom(),this.unfreeze()}initializeComponents(){var e=Object.assign({},bt,this.options.overrideComponents),t=e.Style,r=e.Keyboard,n=e.DataManager,i=e.RowManager,o=e.ColumnManager,a=e.CellManager,s=e.BodyRenderer;this.style=new t(this),this.keyboard=new r(this.wrapper),this.datamanager=new n(this.options),this.rowmanager=new i(this),this.columnmanager=new o(this),this.cellmanager=new a(this),this.bodyRenderer=new s(this)}prepareDom(){this.wrapper.innerHTML='\n            <div class="datatable" dir="'+this.options.direction+'">\n                <div class="dt-header"></div>\n                <div class="dt-scrollable"></div>\n                <div class="dt-footer"></div>\n                <div class="dt-freeze">\n                    <span class="dt-freeze__message">\n                        '+this.options.freezeMessage+'\n                    </span>\n                </div>\n                <div class="dt-toast"></div>\n                <div class="dt-dropdown-container"></div>\n                <textarea class="dt-paste-target"></textarea>\n            </div>\n        ',this.datatableWrapper=n(".datatable",this.wrapper),this.header=n(".dt-header",this.wrapper),this.footer=n(".dt-footer",this.wrapper),this.bodyScrollable=n(".dt-scrollable",this.wrapper),this.freezeContainer=n(".dt-freeze",this.wrapper),this.toastMessage=n(".dt-toast",this.wrapper),this.pasteTarget=n(".dt-paste-target",this.wrapper),this.dropdownContainer=n(".dt-dropdown-container",this.wrapper)}refresh(e,t){this.datamanager.init(e,t),this.render(),this.setDimensions()}destroy(){this.wrapper.innerHTML="",this.style.destroy(),this.fireEvent("onDestroy")}appendRows(e){this.datamanager.appendRows(e),this.rowmanager.refreshRows()}refreshRow(e,t){this.rowmanager.refreshRow(e,t)}render(){this.renderHeader(),this.renderBody()}renderHeader(){this.columnmanager.renderHeader()}renderBody(){this.bodyRenderer.render()}setDimensions(){this.style.setDimensions()}showToastMessage(e,t){this.bodyRenderer.showToastMessage(e,t)}clearToastMessage(){this.bodyRenderer.clearToastMessage()}getColumn(e){return this.datamanager.getColumn(e)}getColumns(){return this.datamanager.getColumns()}getRows(){return this.datamanager.getRows()}getCell(e,t){return this.datamanager.getCell(e,t)}getColumnHeaderElement(e){return this.columnmanager.getColumnHeaderElement(e)}getViewportHeight(){return this.viewportHeight||(this.viewportHeight=n.style(this.bodyScrollable,"height")),this.viewportHeight}sortColumn(e,t){this.columnmanager.sortColumn(e,t)}removeColumn(e){this.columnmanager.removeColumn(e)}scrollToLastColumn(){this.datatableWrapper.scrollLeft=9999}freeze(){n.style(this.freezeContainer,{display:""})}unfreeze(){n.style(this.freezeContainer,{display:"none"})}updateOptions(e){this.buildOptions(e)}fireEvent(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var n=0,i=(this._internalEventHandlers[e]||[]).concat([this.events[e]]).filter(Boolean);n<i.length;n+=1){i[n].apply(this,t)}}on(e,t){this._internalEventHandlers=this._internalEventHandlers||{},this._internalEventHandlers[e]=this._internalEventHandlers[e]||[],this._internalEventHandlers[e].push(t)}log(){this.options.logs&&console.log.apply(console,arguments)}}yt.instances=0;var wt="0.0.0-development";yt.__version__=wt,e.exports=yt}),DataTable=unwrapExports(frappeDatatable_cjs);return frappe.provide("frappe.views"),frappe.views.ReportView=class extends frappe.views.ListView{get view_name(){return"Report"}render_header(){}setup_defaults(){var e=this;super.setup_defaults(),this.page_title=__("Report:")+" "+this.page_title,this.menu_items=this.report_menu_items(),this.view="Report";var t=frappe.get_route();if(4===t.length&&(this.report_name=t[3]),this.report_name)return this.get_report_doc().then(function(t){e.report_doc=t,e.report_doc.json=JSON.parse(e.report_doc.json),e.filters=e.report_doc.json.filters,e.order_by=e.report_doc.json.order_by,e.add_totals_row=e.report_doc.json.add_totals_row,e.page_title=e.report_name,e.page_length=e.report_doc.json.page_length||20,e.order_by=e.report_doc.json.order_by||"modified desc",e.chart_args=e.report_doc.json.chart_args});this.add_totals_row=this.view_user_settings.add_totals_row||0,this.chart_args=this.view_user_settings.chart_args}setup_view(){this.setup_columns(),super.setup_new_doc_event(),this.page.main.addClass("report-view")}toggle_side_bar(){super.toggle_side_bar(),this.render(!0)}setup_result_area(){super.setup_result_area(),this.setup_charts_area(),this.$datatable_wrapper=$('<div class="datatable-wrapper">'),this.$result.append(this.$datatable_wrapper)}setup_charts_area(){var e=this;this.$charts_wrapper=$('<div class="charts-wrapper hidden">\n\t\t\t<div class="text-right"><button class="btn btn-default btn-xs btn-chart-configure"\n\t\t\t\tstyle="margin-right: 15px; margin-top: 15px">Configure</button></div>\n\t\t\t<div class="charts-inner-wrapper"></div>\n\t\t</div>'),this.$result.append(this.$charts_wrapper),this.$charts_wrapper.find(".btn-chart-configure").on("click",function(){e.setup_charts()})}setup_paging_area(){super.setup_paging_area();var e=__("For comparison, use >5, <10 or =324. For ranges, use 5:10 (for values between 5 & 10).");this.$paging_area.find(".level-left").append('<span class="comparison-message text-muted">'+e+"</span>")}setup_sort_selector(){this.sort_selector=new frappe.ui.SortSelector({parent:this.filter_area.$filter_list_wrapper,doctype:this.doctype,args:this.order_by,onchange:this.on_sort_change.bind(this)}),this.group_by_control=new frappe.ui.GroupBy(this),this.report_doc&&this.report_doc.json.group_by&&this.group_by_control.apply_settings(this.report_doc.json.group_by),this.view_user_settings&&this.view_user_settings.group_by&&this.group_by_control.apply_settings(this.view_user_settings.group_by)}get_args(){var e=super.get_args();return delete e.group_by,this.group_by_control.set_args(e),e}before_refresh(){return this.report_doc?Promise.resolve():super.before_refresh()}after_render(){this.report_doc?this.set_dirty_state_for_custom_report():this.save_report_settings(),this.group_by||this.init_chart()}set_dirty_state_for_custom_report(){var e={filters:this.filter_area.get(),fields:this.fields,order_by:this.sort_selector.get_sql_string(),add_totals_row:this.add_totals_row,page_length:this.page_length,column_widths:this.get_column_widths(),group_by:this.group_by_control.get_settings(),chart_args:this.get_chart_settings()},t={filters:this.report_doc.json.filters,fields:this.report_doc.json.fields,order_by:this.report_doc.json.order_by,add_totals_row:this.report_doc.json.add_totals_row,page_length:this.report_doc.json.page_length,column_widths:this.report_doc.json.column_widths,group_by:this.report_doc.json.group_by,chart_args:this.report_doc.json.chart_args};frappe.utils.deep_equal(e,t)?this.page.clear_indicator():this.page.set_indicator(__("Not Saved"),"orange")}save_report_settings(){frappe.model.user_settings.save(this.doctype,"last_view",this.view_name),this.report_name||this.save_view_user_settings({fields:this.fields,filters:this.filter_area.get(),order_by:this.sort_selector.get_sql_string(),group_by:this.group_by_control.get_settings(),chart_args:this.get_chart_settings(),add_totals_row:this.add_totals_row})}prepare_data(e){var t=e.message||{};t=frappe.utils.dict(t.keys,t.values),0===this.start?this.data=t:this.data=this.data.concat(t)}render(e){0!==this.data.length&&(this.render_count(),this.setup_columns(),this.group_by?this.$charts_wrapper.addClass("hidden"):this.chart&&this.refresh_charts(),!this.datatable||e?this.setup_datatable(this.data):this.datatable.refresh(this.get_data(this.data),this.columns))}render_count(){var e=this.$paging_area.find(".list-count");e.length||(e=$("<span>").addClass("text-muted list-count").prependTo(this.$paging_area.find(".level-right"))),this.get_count_str().then(function(t){e.text(t)})}on_update(e){var t=this;if(this.doctype===e.doctype&&e.name){var r=e.user!==frappe.session.user;this.data.find(function(t){return t.name===e.name})?frappe.db.get_doc(e.doctype,e.name).then(function(e){return t.update_row(e,r)}):this.refresh()}}update_row(e,t){var r=this,n=[];this.data=this.data.map(function(t,r){if(t.name===e.name){for(var i in t)if(i.includes(":")){var o=i.split(":"),a=o[0],s=o[1],l=Object.keys(e).filter(function(t){return Array.isArray(e[t])&&e[t].length&&e[t][0].doctype===a}).map(function(t){return e[t]}).map(function(e){return e[0]}).filter(function(e){return e.name===t[a+":name"]})[0];l&&(t[i]=l[s])}else t[i]=e[i];n.push([t,r])}return t});n.forEach(function(e){var n=e[0],i=e[1],o=r.build_row(n);r.datatable.refreshRow(o,i),function(e){if(t){var n=r.$result.find('.dt-row[data-row-index="'+e+'"]');n.addClass("row-update"),setTimeout(function(){return n.removeClass("row-update")},500)}}(i)})}setup_datatable(e){var t=this;this.$datatable_wrapper.empty(),this.datatable=new DataTable(this.$datatable_wrapper[0],{columns:this.columns,data:this.get_data(e),getEditor:this.get_editing_object.bind(this),checkboxColumn:!0,inlineFilters:!0,cellHeight:35,direction:frappe.utils.is_rtl()?"rtl":"ltr",events:{onRemoveColumn:function(e){t.remove_column_from_datatable(e)},onSwitchColumn:function(e,r){t.switch_column(e,r)},onCheckRow:function(){var e=t.get_checked_items();t.toggle_actions_menu_button(e.length>0)}},hooks:{columnTotal:frappe.utils.report_column_total},headerDropdown:[{label:__("Add Column"),action:function(e){var r=[],n=t.get_columns_for_picker();r=n[t.doctype].filter(function(e){return!t.is_column_added(e)}).map(function(e){return{label:__(e.label),value:e.fieldname}}),delete n[t.doctype];var i=function(e){n[e].filter(function(e){return!t.is_column_added(e)}).map(function(t){return{label:__(t.label)+" ("+e+")",value:t.fieldname+","+e}}).forEach(function(e){return r.push(e)})};for(var o in n)i(o);var a=new frappe.ui.Dialog({title:__("Add Column"),fields:[{label:__("Select Column"),fieldname:"column",fieldtype:"Autocomplete",options:r},{label:__("Insert Column Before {0}",[e.docfield.label.bold()]),fieldname:"insert_before",fieldtype:"Check"}],primary_action:function(n){var i,o=n.column,s=n.insert_before;if(!r.map(function(e){return e.value}).includes(o))return frappe.show_alert({message:__("Invalid column"),indicator:"orange"}),void a.hide();var l=t.doctype;o.includes(",")&&(i=o.split(","),o=i[0],l=i[1]);var d=e.colIndex;s&&(d-=1),t.add_column_to_datatable(o,l,d),a.hide()}});a.show()}}]})}toggle_charts(){this.chart?this.$charts_wrapper.hasClass("hidden")?(this.$charts_wrapper.removeClass("hidden"),this.refresh_charts()):(this.$charts_wrapper.addClass("hidden"),this.save_view_user_settings({chart_args:null}),this.chart_args=null):this.setup_charts()}init_chart(){this.chart||this.chart_args&&(this.build_chart_args(this.chart_args.x_axis,this.chart_args.y_axes,this.chart_args.chart_type),this.make_chart())}setup_charts(){for(var e=this,t=[],r=[],n=0,i=this.columns;n<i.length;n+=1){var o=i[n];t.push({label:o.content,fieldname:o.id,value:o.id}),o.docfield&&frappe.model.numeric_fieldtypes.includes(o.docfield.fieldtype)&&r.push({label:o.content,fieldname:o.id,value:o.id})}var a=this.chart_args||{},s=new frappe.ui.Dialog({title:__("Configure Chart"),fields:[{label:__("X Axis Field"),fieldtype:"Select",fieldname:"x_axis",options:t,default:a.x_axis},{label:__("Y Axis Fields"),fieldtype:"MultiSelect",fieldname:"y_axes",options:r,description:__("Showing only Numeric fields from Report"),default:a.y_axes?a.y_axes.join(", "):null},{label:__("Chart Type"),fieldtype:"Select",options:["Bar","Line","Pie","Percentage","Donut"],fieldname:"chart_type",default:a.chart_type?frappe.utils.to_title_case(a.chart_type):"Bar"}],primary_action:function(t){t.y_axes=t.y_axes.split(",").map(function(e){return e.trim()}).filter(Boolean),e.build_chart_args(t.x_axis,t.y_axes,t.chart_type),e.make_chart(),s.hide()}});s.show()}build_chart_args(e,t,r){var n=this,i=t.map(function(e){return{name:n.columns_map[e].content,values:n.data.map(function(t){return t[e]})}});this.chart_args={chart_type:r.toLowerCase(),x_axis:e,y_axes:t,labels:this.data.map(function(t){return t[e]}),datasets:i},this.save_view_user_settings({chart_args:this.get_chart_settings()})}get_chart_settings(){if(this.chart_args)return{chart_type:this.chart_args.chart_type,x_axis:this.chart_args.x_axis,y_axes:this.chart_args.y_axes}}make_chart(){var e=this,t=this.chart_args,r={labels:t.labels,datasets:t.datasets};this.last_chart_type=t.chart_type;this.$charts_wrapper.removeClass("hidden"),this.chart=new frappe.Chart(this.$charts_wrapper.find(".charts-inner-wrapper")[0],{title:__("{0} Chart",[this.doctype]),data:r,type:t.chart_type,truncateLegends:1,colors:["#70E078","light-blue","orange","red"],axisOptions:{shortenYAxisNumbers:1},tooltipOptions:{formatTooltipY:function(t){return frappe.format(t,(r=e.chart_args.y_axes[0],e.columns_map[r].docfield),{always_show_decimals:!0,inline:!0},function(t,r){return e.data.find(function(e){return e[r]===t})}(t.doc));var r}}})}refresh_charts(){if(this.chart&&this.chart_args){this.$charts_wrapper.removeClass("hidden");var e=this.chart_args,t=e.x_axis,r=e.y_axes,n=e.chart_type;this.build_chart_args(t,r,n),this.chart.update(this.chart_args)}}get_editing_object(e,t,r,n){var i=this,o=this.render_editing_input(e,r,n);return!!o&&(o.df.change=function(){return o.set_focus()},{initValue:function(e){return o.set_value(e)},setValue:function(r){var n=i.datatable.getCell(e,t),a=i.datatable.getColumn(e).docfield.fieldname,s=n.name,l=n.doctype;return o.set_value(r),i.set_control_value(l,s,a,r).then(function(e){var t=i.data.filter(function(t){return t.name===e.name}).find(function(t){return l!=e.doctype&&t[l+":name"]==s||l==e.doctype});for(var r in t)if(r.includes(":")){var n=r.split(":"),o=n[0],a=n[1],d=Object.keys(e).filter(function(t){return Array.isArray(e[t])&&e[t].length&&e[t][0].doctype===o}).map(function(t){return e[t]})[0].filter(function(e){return e.name===t[o+":name"]})[0];d&&(t[r]=d[a])}else t[r]=e[r]}).then(function(){return i.refresh_charts()})},getValue:function(){return o.get_value()}})}set_control_value(e,t,r,n){return this.last_updated_doc=t,new Promise(function(i,o){var a;frappe.db.set_value(e,t,(a={},a[r]=n,a)).then(function(e){e.message?i(e.message):o()}).fail(o)})}render_editing_input(e,t,r){var n=this,i=this.datatable.getColumn(e),o=null;if("Text Editor"===i.docfield.fieldtype){var a=new frappe.ui.Dialog({title:__("Edit {0}",[i.docfield.label]),fields:[i.docfield],primary_action:function(){n.datatable.cellmanager.submitEditing(),n.datatable.cellmanager.deactivateEditing(),a.hide()}});a.show(),o=a.fields_dict[i.docfield.fieldname]}else(o=frappe.ui.form.make_control({df:i.docfield,parent:r,render_input:!0})).set_value(t),o.toggle_label(!1),o.toggle_description(!1);return o}is_editable(e,t){return!(!e||!frappe.model.can_write(this.doctype)||1===t.docstatus&&!e.allow_on_submit||2===t.docstatus||e.read_only||e.hidden||frappe.model.std_fields_list.includes(e.fieldname))}get_data(e){return this.build_rows(e)}set_fields(){var e=this;["name","docstatus"].map(function(t){return e._add_field(t)}),this.report_name&&this.report_doc.json.fields?this.report_doc.json.fields.slice().forEach(function(t){return e._add_field(t[0],t[1])}):this.view_user_settings.fields?this.view_user_settings.fields.forEach(function(t){return e._add_field(t[0],t[1])}):this.set_default_fields()}set_default_fields(){var e=this;this.fields=this.fields||[];var t=function(t){return e._add_field(t)};[this.meta.title_field,this.meta.image_field].map(t);var r=this.meta.fields.filter(function(t){return(t.in_list_view||t.in_standard_filter)&&frappe.perm.has_perm(e.doctype,t.permlevel,"read")&&frappe.model.is_value_type(t.fieldtype)&&!t.report_hide});r.map(t),r.filter(function(e){return"Currency"===e.fieldtype&&e.options}).map(function(e){e.options.includes(":")?t(e.options.split(":")[1]):t(e.options)}),(this.settings.add_fields||[]).map(t)}build_fields(){super.build_fields()}reorder_fields(){var e=this,t=this.columns.map(function(e){return[e.field,e.docfield.parent]}),r=t.filter(function(t){return e.fields.find(function(e){return t[0]==e[0]&&t[1]==e[1]})}),n=this.fields.filter(function(e){return!t.find(function(t){return e[0]==t[0]&&e[1]==t[1]})});this.fields=r.concat(n)}get_fields(){var e=this,t=this.fields.map(function(t){var r=frappe.model.get_full_column_name(t[0],t[1]);return t[1]!==e.doctype&&(r=r+" as '"+t[1]+":"+t[0]+"'"),r}),r=this.get_unique_cdt_in_view().map(function(e){return frappe.model.get_full_column_name("name",e)+" as '"+e+":name'"});return t=t.concat(r)}get_unique_cdt_in_view(){var e=this;return this.fields.filter(function(t){return t[1]!==e.doctype}).map(function(e){return e[1]}).uniqBy(function(e){return e})}add_column_to_datatable(e,t,r){var n=[e,t];this.fields.splice(r,0,n),this.add_currency_column(e,t,r),this.build_fields(),this.setup_columns(),this.datatable&&this.datatable.destroy(),this.datatable=null,this.refresh()}add_currency_column(e,t,r){var n=frappe.meta.get_docfield(t,e);if(n&&"Currency"===n.fieldtype&&n.options&&!n.options.includes(":")&&frappe.meta.has_field(t,n.options)){var i=[n.options,t];void 0===r?this.fields.push(i):this.fields.splice(r,0,i),frappe.show_alert(__("Also adding the dependent currency field {0}",[i[0].bold()]))}}add_status_dependency_column(e,t){if(!this.fields.find(function(t){return t[0]===e})){var r=[e,t];this.fields.push(r),this.refresh(),frappe.show_alert(__("Also adding the status dependency field {0}",[r[0].bold()]))}}remove_column_from_datatable(e){var t=this.fields.findIndex(function(t){return e.field===t[0]});-1!==t&&("name"===this.fields[t][0]&&(this.refresh(),frappe.throw(__("Cannot remove ID field"))),this.fields.splice(t,1),this.build_fields(),this.setup_columns(),this.refresh())}switch_column(e,t){var r=this.fields.findIndex(function(t){return e.field===t[0]}),n=this.fields.findIndex(function(e){return t.field===e[0]}),i=this.fields.slice(),o=i[r];i[r]=i[n],i[n]=o,this.fields=i,this.build_fields(),this.setup_columns(),this.refresh()}get_columns_for_picker(){var e={},t=function(e){return!in_list(frappe.model.no_value_type,e.fieldtype)},r=frappe.meta.get_docfields(this.doctype).filter(t),n=frappe.model.std_fields.filter(function(e){return"docstatus"!==e.fieldname}),i=!1;return this.data&&(i=frappe.get_indicator(this.data[0],this.doctype)),!frappe.meta.has_field(this.doctype,"status")&&i&&(r=[{label:__("Status"),fieldname:"docstatus",fieldtype:"Data"}].concat(r)),r=[{label:__("ID"),fieldname:"name",fieldtype:"Data",reqd:1}].concat(r,n),e[this.doctype]=r,frappe.meta.get_table_fields(this.doctype).forEach(function(r){var n=r.options,i=frappe.meta.get_docfields(n).filter(t);e[n]=i,e[n].push({label:__("Index"),fieldname:"idx",fieldtype:"Int",parent:n})}),e}get_dialog_fields(){var e=this,t=[],r=this.get_columns_for_picker();return t.push({label:__(this.doctype),fieldname:this.doctype,fieldtype:"MultiCheck",columns:2,options:r[this.doctype].filter(function(e){return!e.hidden&&"name"!==e.fieldname}).map(function(t){return{label:__(t.label),value:t.fieldname,checked:e.fields.find(function(r){return r[0]===t.fieldname&&r[1]===e.doctype})}})}),delete r[this.doctype],frappe.meta.get_table_fields(this.doctype).filter(function(e){return!e.hidden}).forEach(function(n){var i=n.options;t.push({label:__(n.label)+" ("+__(i)+")",fieldname:n.options,fieldtype:"MultiCheck",columns:2,options:r[i].filter(function(e){return!e.hidden}).map(function(t){return{label:__(t.label),value:t.fieldname,checked:e.fields.find(function(e){return e[0]===t.fieldname&&e[1]===i})}})})}),t}is_column_added(e){return Boolean(this.fields.find(function(t){return t[0]===e.fieldname&&e.parent===t[1]}))}setup_columns(){var e=null;this.columns&&(e=this.get_column_widths()),this.columns=[],this.columns_map={};for(var t=0,r=this.fields;t<r.length;t+=1){var n=r[t],i=void 0;"docstatus"!==n[0]?i=this.build_column(n):this.fields.includes(["status",this.doctype])||frappe.meta.has_field(this.doctype,"status")||(i=this.build_column(["docstatus",this.doctype])),i&&(e&&(i.width=e[i.id]||i.width||120),this.columns.push(i),this.columns_map[i.id]=i)}}build_column(e){var t=e[0],r=e[1],n=frappe.meta.docfield_map[r||this.doctype][t];if("_aggregate_column"===t&&(n=this.group_by_control.get_group_by_docfield()),"idx"===t&&r!==this.doctype&&(n={label:"Index",fieldtype:"Int",parent:r}),n||(n=frappe.model.get_std_field(t,!0))&&(n.label||(n.label=toTitle(t),n.label.includes("_")&&(n.label=n.label.replace("_"," "))),n.parent=this.doctype,"name"==t&&(n.options=this.doctype),"docstatus"!=t||frappe.meta.has_field(this.doctype,"status")||(n.label="Status",n.fieldtype="Data",n.name="status")),n&&!n.report_hide){var i=__(n?n.label:toTitle(t));r!==this.doctype&&(i+=" ("+__(r)+")");var o=frappe.model.is_non_std_field(t)&&!n.read_only,a=frappe.model.is_numeric_field(n)?"right":"Date"===n.fieldtype?"right":"left",s=t;r!==this.doctype&&"_aggregate_column"!==t&&(s=r+":"+t);var l=(n?cint(n.width):null)||null;if(this.report_doc)l=(this.report_doc.json.column_widths||{})[s]||l;var d=null;return"Date"===n.fieldtype&&(d=function(e,t){if(!e.content)return null;if(t.length!=="YYYY-MM-DD".length)return null;var r=frappe.datetime.user_to_obj(t);return[+frappe.datetime.str_to_obj(e.content),+r]}),{id:s,field:t,name:i,content:i,docfield:n,width:l,editable:o,align:a,compareValue:d,format:function(e,t,r,n){var i=null;return i=Array.isArray(t)?t.reduce(function(e,t){return t.column.docfield?(e[t.column.docfield.fieldname]=t.content,e):e},{}):t,frappe.format(e,r.docfield,{always_show_decimals:!0},i)}}}}build_rows(e){var t=this,r=e.map(function(e){return t.build_row(e)});if(this.add_totals_row){var n=this.get_columns_totals(e),i=this.columns.map(function(r,i){return{name:__("Totals Row"),content:n[r.id],format:function(n){var o=frappe.format(n,r.docfield,{always_show_decimals:!0},e[0]);return 0===i?t.format_total_cell(o,r):o}}});r.push(i)}return r}format_total_cell(e,t){var r=__("Totals").bold();return frappe.model.is_numeric_field(t.docfield)&&(r='<span class="flex justify-between">\n\t\t\t\t'+r+" "+$(e).text()+"\n\t\t\t</span>"),r}build_row(e){var t=this;return this.columns.map(function(r){if(r.docfield.parent!==t.doctype){var n=function(e){return r.docfield.parent+":"+e},i=e[n("name")];return{name:i,doctype:r.docfield.parent,content:e[n(r.field)]||e[r.field],editable:Boolean(i&&t.is_editable(r.docfield,e)),format:function(t){return frappe.format(t,r.docfield,{always_show_decimals:!0},e)}}}if("docstatus"!==r.field||frappe.meta.has_field(t.doctype,"status")){if(r.field in e){var o=e[r.field];return{name:e.name,doctype:r.docfield.parent,content:o,editable:t.is_editable(r.docfield,e)}}}else{var a=frappe.get_indicator(e,t.doctype);if(a){if(!a[0]){var s=a[2].split(",")[0];t.add_status_dependency_column(s,t.doctype)}return{name:e.name,doctype:r.docfield.parent,content:a[0],editable:!1}}t.remove_column_from_datatable(r)}return{content:""}})}get_checked_items(e){var t=this,r=this.datatable.rowmanager.getCheckedRows().map(function(e){return t.data[e]}).filter(function(e){return null!=e});return e?r.map(function(e){return e.name}):r}save_report(e){var t=this,r=function(e){var r={filters:t.filter_area.get(),fields:t.fields,order_by:t.sort_selector.get_sql_string(),add_totals_row:t.add_totals_row,page_length:t.page_length,column_widths:t.get_column_widths(),group_by:t.group_by_control.get_settings(),chart_args:t.get_chart_settings()};return frappe.call({method:"frappe.desk.reportview.save_report",args:{name:e,doctype:t.doctype,json:JSON.stringify(r)},callback:function(e){if(e.exc)frappe.msgprint(__("Report was not saved (there were errors)"));else{if(e.message!=t.report_name)return frappe.boot.user.all_reports[e.message]={ref_doctype:t.doctype,report_type:"Report Builder",title:e.message},void frappe.set_route("List",t.doctype,"Report",e.message);t.report_doc.json=r,t.set_dirty_state_for_custom_report()}}})};this.report_name&&"save"==e?r(this.report_name):frappe.prompt({fieldname:"name",label:__("New Report name"),reqd:1,fieldtype:"Data"},function(e){r(e.name)},__("Save As"))}get_column_widths(){return this.datatable?this.datatable.datamanager.getColumns(!0).reduce(function(e,t){return e[t.id]=parseInt(t.width),e},{}):{}}get_report_doc(){var e=this;return new Promise(function(t){frappe.model.with_doc("Report",e.report_name,function(){t(frappe.get_doc("Report",e.report_name))})})}get_filters_html_for_print(){return this.filter_area.get().map(function(e){var t=e[0],r=e[1],n=e[2],i=e[3];if("="!==n)return"";var o=frappe.meta.get_label(t,r);return"<h6>"+__(o)+": "+i+"</h6>"}).join("")}get_columns_totals(e){if(!this.add_totals_row)return[];var t={};return this.columns.forEach(function(r,n){var i=e.reduce(function(e,t){if(r.id in t&&frappe.model.is_numeric_field(r.docfield))return e+=flt(t[r.id])},0);t[r.id]=i}),t}report_menu_items(){var e=this,t=[{label:__("Show Totals"),action:function(){e.add_totals_row=!e.add_totals_row,e.save_view_user_settings({add_totals_row:e.add_totals_row}),e.datatable.refresh(e.get_data(e.data))}},{label:__("Print"),action:function(){var t=e.datatable.datamanager.rowViewOrder.map(function(t){if(e.datatable.bodyRenderer.visibleRowIndices.includes(t))return e.data[t]}).filter(Boolean);if(e.add_totals_row){var r=e.get_columns_totals(e.data);r.name=__("Totals").bold(),t.push(r)}frappe.ui.get_print_settings(!1,function(r){var n=e.report_name||__(e.doctype);frappe.render_grid({title:n,subtitle:e.get_filters_html_for_print(),print_settings:r,columns:e.columns,data:t})})}},{label:__("Toggle Chart"),action:function(){return e.toggle_charts()}},{label:__("Toggle Sidebar"),action:function(){return e.toggle_side_bar()},shortcut:"Ctrl+K"},{label:__("Pick Columns"),action:function(){var t=new frappe.ui.Dialog({title:__("Pick Columns"),fields:e.get_dialog_fields(),primary_action:function(r){var n=r[e.doctype].map(function(t){return[t,e.doctype]});delete r[e.doctype];var i=function(e){n=n.concat(r[e].map(function(t){return[t,e]}))};for(var o in r)i(o);e.fields=[["name",e.doctype]].concat(n),e.fields.map(function(t){return e.add_currency_column(t[0],t[1])}),e.reorder_fields(),e.build_fields(),e.setup_columns(),e.datatable.destroy(),e.datatable=null,e.refresh(),t.hide()}});t.$body.prepend('\n\t\t\t\t\t\t<div class="columns-search">\n\t\t\t\t\t\t\t<input type="text" placeholder="'+__("Search")+'" data-element="search" class="form-control input-xs">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t'),frappe.utils.setup_search(t.$body,".unit-checkbox",".label-area"),t.show()}}];return frappe.model.can_export(this.doctype)&&t.push({label:__("Export"),action:function(){var t=e.get_args(),r=e.get_checked_items(!0),n=[{fieldtype:"Select",label:__("Select File Type"),fieldname:"file_format_type",options:["Excel","CSV"],default:"Excel"}];(e.total_count>e.count_without_children||t.page_length)&&n.push({fieldtype:"Check",fieldname:"export_all_rows",label:__("Export All {0} rows?",[(e.total_count+"").bold()])});var i=new frappe.ui.Dialog({title:__("Export Report: {0}",[__(e.doctype)]),fields:n,primary_action_label:__("Download"),primary_action:function(n){t.cmd="frappe.desk.reportview.export_query",t.file_format_type=n.file_format_type,t.title=e.report_name||e.doctype,e.add_totals_row&&(t.add_totals_row=1),r.length>0&&(t.selected_items=r),n.export_all_rows?(delete t.start,delete t.page_length):(t.start=0,t.page_length=e.data.length),open_url_post(frappe.request.url,t),i.hide()}});i.show()}}),t.push({label:__("Setup Auto Email"),action:function(){e.report_name?frappe.set_route("List","Auto Email Report",{report:e.report_name}):frappe.msgprint(__("Please save the report first"))}}),frappe.user.is_report_manager()&&(t=t.concat([{label:__("Save"),action:function(){return e.save_report("save")}},{label:__("Save As"),action:function(){return e.save_report("save_as")}}])),this.report_name&&frappe.model.can_set_user_permissions("Report")&&t.push({label:__("User Permissions"),action:function(){var t={doctype:"Report",name:e.report_name};frappe.set_route("List","User Permission",t)}}),t.map(function(e){return Object.assign(e,{standard:!0})})}},frappe.provide("frappe.widget.utils"),frappe.provide("frappe.views"),frappe.provide("frappe.query_reports"),frappe.standard_pages["query-report"]=function(){var e=frappe.container.add_page("query-report");frappe.ui.make_app_page({parent:e,title:__("Query Report"),single_column:!0}),frappe.query_report=new frappe.views.QueryReport({parent:e}),$(e).bind("show",function(){frappe.query_report.show()})},frappe.views.QueryReport=class QueryReport extends frappe.views.BaseList{show(){var e=this;this.init().then(function(){return e.load()})}init(){var e=this;if(this.init_promise)return this.init_promise;var t=[this.setup_defaults,this.setup_page,this.setup_report_wrapper,this.setup_events].map(function(t){return t.bind(e)});return this.init_promise=frappe.run_serially(t),this.init_promise}setup_defaults(){this.route=frappe.get_route(),this.page_name=frappe.get_route_str(),this.primary_action=null,this.refresh=frappe.utils.throttle(this.refresh,300),this.menu_items=[]}set_default_secondary_action(){var e=this;this.refresh_button&&this.refresh_button.remove(),this.refresh_button=this.page.add_action_icon("refresh",function(){e.setup_progress_bar(),e.refresh()})}get_no_result_message(){return'<div class="msg-box no-border">\n\t\t\t<div>\n\t\t\t\t<img src="/assets/frappe/images/ui-states/list-empty-state.svg" alt="Generic Empty State" class="null-state">\n\t\t\t</div>\n\t\t\t<p>'+__("Nothing to show")+"</p>\n\t\t</div>"}setup_events(){var e=this;frappe.realtime.on("report_generated",function(t){if(e.toggle_primary_button_disabled(!1),t.report_name)if(e.prepared_report_action="Rebuild",t.name==e.prepared_report_doc_name)e.refresh();else{var r="Report "+e.report_name+' generated.\n\t\t\t\t\t\t<a href="#query-report/'+e.report_name+"/?prepared_report_name="+t.name+'">View</a>';frappe.show_alert({message:r,indicator:"orange"})}}),this.page.wrapper.on("click","[data-action]",function(t){var r=$(t.currentTarget).data("action"),n=e[r];n.call&&n.call(e,t)})}load(){frappe.get_route().length<2?this.toggle_nothing_to_show(!0):this.report_name!==frappe.get_route()[1]?this.load_report():frappe.has_route_options()&&this.refresh_report()}load_report(){var e=this;this.page.clear_inner_toolbar(),this.route=frappe.get_route(),this.page_name=frappe.get_route_str(),this.report_name=this.route[1],this.page_title=__(this.report_name),this.show_save=!1,this.menu_items=this.get_menu_items(),this.datatable=null,this.prepared_report_action="New",frappe.run_serially([function(){return e.get_report_doc()},function(){return e.get_report_settings()},function(){return e.setup_progress_bar()},function(){return e.setup_page_head()},function(){return e.refresh_report()},function(){return e.add_chart_buttons_to_toolbar(!0)},function(){return e.add_card_button_to_toolbar(!0)}])}add_card_button_to_toolbar(){var e=this;this.page.add_inner_button(__("Create Card"),function(){e.add_card_to_dashboard()})}add_chart_buttons_to_toolbar(e){var t=this;e?(this.create_chart_button&&this.create_chart_button.remove(),this.create_chart_button=this.page.add_button(__("Set Chart"),function(){t.open_create_chart_dialog()}),(this.chart_fields||this.chart_options)&&(this.add_to_dashboard_button&&this.add_to_dashboard_button.remove(),this.add_to_dashboard_button=this.page.add_button(__("Add Chart to Dashboard"),function(){t.add_chart_to_dashboard()}))):(this.create_chart_button&&this.create_chart_button.remove(),this.add_to_dashboard_button&&this.add_to_dashboard_button.remove())}add_card_to_dashboard(){var e=this,t=frappe.report_utils.get_field_options_from_report(this.columns,this.raw_data),r=frappe.dashboard_utils.get_dashboard_link_field(),n=frappe.boot.developer_mode,i=new frappe.ui.Dialog({title:__("Create Card"),fields:[{fieldname:"report_field",label:__("Field"),fieldtype:"Select",options:t.numeric_fields},{fieldname:"cb_1",fieldtype:"Column Break"},{fieldname:"report_function",label:__("Function"),options:["Sum","Average","Minimum","Maximum"],fieldtype:"Select"},{fieldname:"sb_1",label:__("Add to Dashboard"),fieldtype:"Section Break"},r,{fieldname:"cb_2",fieldtype:"Column Break"},{fieldname:"label",label:__("Card Label"),fieldtype:"Data"}],primary_action_label:__("Add"),primary_action:function(t){t.label||(t.label=t.report_function+" of "+toTitle(t.report_field)),e.create_number_card(t,t.dashboard,t.label,n),i.hide()}});i.show()}add_chart_to_dashboard(){var e=this;if(this.chart_fields||this.chart_options){var t=frappe.dashboard_utils.get_dashboard_link_field(),r=frappe.boot.developer_mode,n=new frappe.ui.Dialog({title:__("Create Chart"),fields:[{fieldname:"dashboard_chart_name",label:"Chart Name",fieldtype:"Data"},t],primary_action_label:__("Add"),primary_action:function(t){e.create_dashboard_chart(e.chart_fields||e.chart_options,t.dashboard,t.dashboard_chart_name,r),n.hide()}});n.show()}else frappe.msgprint(__("Please Set Chart"))}create_number_card(e,t,r,n){var i={dashboard:t||null,type:"Report",report_name:this.report_name,filters_json:JSON.stringify(this.get_filter_values()),set_standard:n};Object.assign(i,e),this.add_to_dashboard("frappe.desk.doctype.number_card.number_card.create_report_number_card",i,t,r,"Number Card")}create_dashboard_chart(e,t,r,n){var i={dashboard:t||null,chart_type:"Report",report_name:this.report_name,type:e.chart_type||frappe.model.unscrub(e.type),color:e.color,filters_json:JSON.stringify(this.get_filter_values()),custom_options:{},set_standard:n};for(var o in e)"data"!=o&&(i.custom_options[o]=e[o]);if(this.chart_fields){var a=toTitle(e.x_field),s=toTitle(e.y_fields[0]);r=r||this.report_name+": "+a+" vs "+s,Object.assign(i,{chart_name:r,x_field:e.x_field,y_axis:e.y_axis_fields.map(function(e){return{y_field:e.y_field,color:e.color}}),use_report_chart:0})}else r=r||this.report_name,Object.assign(i,{chart_name:r,use_report_chart:1});this.add_to_dashboard("frappe.desk.doctype.dashboard_chart.dashboard_chart.create_report_chart",i,t,r,"Dashboard Chart")}add_to_dashboard(e,t,r,n,i){frappe.xcall(e,{args:t}).then(function(){var e;if(r){var t='<a href="#dashboard-view/'+r+'">'+r+"</a>";e=__("New {0} {1} added to Dashboard {2}",[__(i),n,t])}else e=__("New {0} {1} created",[__(i),n]);frappe.msgprint(e,__("New {0} Created",[__(i)]))})}refresh_report(){var e=this;return this.toggle_message(!0),this.toggle_report(!1),frappe.run_serially([function(){return e.setup_filters()},function(){return e.set_route_filters()},function(){return e.page.clear_custom_actions()},function(){return e.report_settings.onload&&e.report_settings.onload(e)},function(){return e.refresh()}])}get_report_doc(){var e=this;return frappe.model.with_doc("Report",this.report_name).then(function(t){e.report_doc=t}).then(function(){return frappe.model.with_doctype(e.report_doc.ref_doctype)})}get_report_settings(){var e=this;return new Promise(function(t,r){frappe.query_reports[e.report_name]?(e.report_settings=frappe.query_reports[e.report_name],t()):frappe.xcall("frappe.desk.query_report.get_script",{report_name:e.report_name}).then(function(r){frappe.dom.eval(r.script||""),frappe.after_ajax(function(){e.report_settings=e.get_local_report_settings(),e.report_settings.html_format=r.html_format,e.report_settings.execution_time=r.execution_time||0,frappe.query_reports[e.report_name]=e.report_settings,e.report_doc.filters&&!e.report_settings.filters&&(e.report_settings.filters=e.report_doc.filters),t()})}).catch(r)})}get_local_report_settings(){var e="Custom Report"===this.report_doc.report_type?this.report_doc.reference_report:this.report_name;return frappe.query_reports[e]||{}}setup_progress_bar(){var e=0,t=this.report_settings.execution_time||0;t<5||(this.interval=setInterval(function(){e+=1,frappe.show_progress(__("Preparing Report"),e,t)},1e3))}refresh_filters_dependency(){var e=this;this.filters.forEach(function(t){t.guardian_has_value=!0,t.df.depends_on&&(t.guardian_has_value=e.evaluate_depends_on_value(t.df.depends_on,t.df.label),t.guardian_has_value?t.df.hidden_due_to_dependency&&(t.df.hidden_due_to_dependency=!1,e.toggle_filter_display(t.df.fieldname,!1)):t.df.hidden_due_to_dependency||(t.df.hidden_due_to_dependency=!0,e.toggle_filter_display(t.df.fieldname,!0),t.set_value(t.df.default||null)))})}evaluate_depends_on_value(expression,filter_label){var out=null,doc=this.get_filter_values();if(doc)if("boolean"==typeof expression)out=expression;else if("eval:"==expression.substr(0,5))try{out=eval(expression.substr(5))}catch(e){frappe.throw(__('Invalid "depends_on" expression set in filter {0}',[filter_label]))}else{var value=doc[expression];out=$.isArray(value)?!!value.length:!!value}return out}setup_filters(){var e=this;this.clear_filters();var t=this.report_settings.filters;void 0===t&&(t=[]);var r=this.page.page_form;this.filters=t.map(function(t){if("Break"!==t.fieldtype){var n=e.page.add_field(t,r);return t.default&&n.set_input(t.default),t.get_query&&(n.get_query=t.get_query),t.on_change&&(n.on_change=t.on_change),t.onchange=function(){e.refresh_filters_dependency();var t=e.get_filter_values();e.previous_filters&&JSON.stringify(e.previous_filters)===JSON.stringify(t)||(e.previous_filters=t,setTimeout(function(){return e.previous_filters=null},1e4),n.on_change?n.on_change(e):e.prepared_report?e.reset_report_view():e._no_refresh||e.refresh())},n=Object.assign(n,t)}}).filter(Boolean),this.refresh_filters_dependency(),0===this.filters.length?this.page.hide_form():this.page.show_form()}set_filters(e){this.filters.map(function(t){t.set_input(e[t.fieldname])})}set_route_filters(){if(frappe.route_options){var e=Object.keys(frappe.route_options),t=this.filters.filter(function(t){return e.includes(t.df.fieldname)}).map(function(e){return function(){var t=frappe.route_options[e.df.fieldname];e.set_value(t)}});return t.push(function(){frappe.route_options=null}),frappe.run_serially(t)}}clear_filters(){this.page.clear_fields()}refresh(){var e=this;this.toggle_message(!0),this.toggle_report(!1),this.show_loading_screen();var t=this.get_filter_values(!0);this.last_ajax&&this.last_ajax.abort();var r=this.get_query_params();return r.prepared_report_name&&(t.prepared_report_name=r.prepared_report_name),new Promise(function(r){e.last_ajax=frappe.call({method:"frappe.desk.query_report.run",type:"GET",args:{report_name:e.report_name,filters:t},callback:r,always:function(){return e.page.btn_secondary.prop("disabled",!1)}})}).then(function(t){var n=t.message;if(e.hide_status(),clearInterval(e.interval),e.execution_time=n.execution_time||.1,n.prepared_report){if(e.prepared_report=!0,r.prepared_report_name){e.prepared_report_action="Edit";var i=JSON.parse(n.doc.filters);Object.values(e.filters).forEach(function(e){i[e.fieldname]&&e.set_input(i[e.fieldname]),e.input&&(e.input.disabled=!0)})}e.add_prepared_report_buttons(n.doc)}n.report_summary&&(e.$summary.empty(),e.render_summary(n.report_summary)),n.message&&!n.prepared_report&&e.show_status(n.message),e.toggle_message(!1),n.result&&n.result.length?(e.prepare_report_data(n),e.chart_options=e.get_chart_options(n),e.$chart.empty(),e.chart_options?e.render_chart(e.chart_options):(e.$chart.empty(),e.chart_fields&&(e.chart_options=frappe.report_utils.make_chart_options(e.columns,e.raw_data,e.chart_fields),e.chart_options&&e.render_chart(e.chart_options))),e.render_datatable(),e.add_chart_buttons_to_toolbar(!0),e.add_card_button_to_toolbar(),e.$report.show()):(e.data=[],e.toggle_nothing_to_show(!0),e.add_chart_buttons_to_toolbar(!1)),e.show_footer_message(),frappe.hide_progress()}).finally(function(){e.hide_loading_screen()})}render_summary(e){var t=this;e.forEach(function(e){frappe.utils.build_summary_item(e).appendTo(t.$summary)}),this.$summary.show()}get_query_params(){var e=frappe.utils.get_query_string(frappe.get_route_str());return frappe.utils.get_query_params(e)}add_prepared_report_buttons(e){var t=this;if(e){this.page.add_inner_button(__("Download Report"),function(){window.open(frappe.urllib.get_full_url("/api/method/frappe.core.doctype.prepared_report.prepared_report.download_attachment?dn="+encodeURIComponent(e.name)))});var r=__("This report was generated {0}.",[frappe.datetime.comment_when(e.report_end_time)]),n=__("To get the updated report, click on {0}.",[__("Rebuild")]),i=__("See all past reports.");this.show_status('\n\t\t\t\t<div class="indicator orange">\n\t\t\t\t\t<span>\n\t\t\t\t\t\t'+r+"\n\t\t\t\t\t\t"+n+'\n\t\t\t\t\t\t<a href="/app/List/Prepared%20Report?report_name='+this.report_name+'"> '+i+"</a>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t")}this.primary_action_map={New:{label:__("Generate New Report"),click:function(){t.show_warning_or_generate_report()}},Edit:{label:__("Edit"),click:function(){frappe.set_route(frappe.get_route())}},Rebuild:{label:__("Rebuild"),click:function(){t.show_warning_or_generate_report()}}};var o=this.primary_action_map[this.prepared_report_action];this.primary_button&&this.primary_button.text()===o.label||(this.primary_button=this.page.set_primary_action(o.label,o.click))}toggle_primary_button_disabled(e){this.primary_button.prop("disabled",e)}show_warning_or_generate_report(){var e=this;frappe.xcall("frappe.core.doctype.prepared_report.prepared_report.get_reports_in_queued_state",{filters:this.get_filter_values(),report_name:this.report_name}).then(function(t){if(e.queued_prepared_reports=t,t.length){var r=e.get_queued_prepared_reports_warning_message(t);e.prepared_report_dialog=frappe.warn(__("Reports already in Queue"),r,function(){return e.generate_background_report()},__("Proceed Anyway"),!0),e.prepared_report_dialog.footer.prepend('\n\t\t\t\t\t<button type="button" class="btn btn-sm btn-default pull-left" data-action="delete_old_queued_reports">\n\t\t\t\t\t\t'+__("Delete and Generate New")+"\n\t\t\t\t\t</button>"),frappe.utils.bind_actions_with_object(e.prepared_report_dialog.wrapper,e)}else e.generate_background_report()})}get_queued_prepared_reports_warning_message(e){var t="/app/List/Prepared Report/List?status=Queued&report_name="+this.report_name,r=1==e.length?'<a class="underline" href="'+t+'">'+__("1 Report")+"</a>":'<a class="underline" href="'+t+'">'+__("{0} Reports",[e.length])+"</a>",n=1==e.length?""+__("There is {0} with the same filters already in the queue:",[r]):""+__("There are {0} with the same filters already in the queue:",[r]),i="\n\t\t\t<p>\n\t\t\t\t"+__("Are you sure you want to generate a new report?")+"\n\t\t\t\t"+n+"\n\t\t\t</p>";return i+=e.map(function(e){return'<a class="underline" href="/app/prepared-report/'+e.name+'">'+e.name+"</a>"}).join(", ")}delete_old_queued_reports(){var e=this;this.prepared_report_dialog.hide(),frappe.xcall("frappe.core.doctype.prepared_report.prepared_report.delete_prepared_reports",{reports:this.queued_prepared_reports}).then(function(){return e.generate_background_report()})}generate_background_report(){var e=this;if(this.toggle_primary_button_disabled(!0),!this.filters.filter(function(e){return e.df.reqd}).filter(function(e){return!e.get_value()}).length){var t=this.get_filter_values(!0);return new Promise(function(r){return frappe.call({method:"frappe.desk.query_report.background_enqueue_run",type:"GET",args:{report_name:e.report_name,filters:t},callback:r})}).then(function(t){var r=t.message;e.prepared_report_doc_name=r.name;var n="<a href='/app/prepared-report/"+r.name+"'>"+__("Report initiated, click to view status")+"</a>";frappe.show_alert({message:n,indicator:"orange"},10),e.toggle_nothing_to_show(!0)})}}prepare_report_data(e){this.raw_data=e,this.columns=this.prepare_columns(e.columns),this.custom_columns=[],this.data=this.prepare_data(e.result),this.linked_doctypes=this.get_linked_doctypes(),this.tree_report=this.data.some(function(e){return"indent"in e})}render_datatable(){var e=this.data,t=this.columns.filter(function(e){return!e.hidden});if(this.raw_data.add_total_row&&(e=e.slice()).splice(-1,1),this.$report.show(),this.datatable&&this.datatable.options&&this.datatable.options.showTotalRow===this.raw_data.add_total_row)this.datatable.options.treeView=this.tree_report,this.datatable.refresh(e,t);else{var r={columns:t,data:e,inlineFilters:!0,treeView:this.tree_report,layout:"fixed",cellHeight:33,showTotalRow:this.raw_data.add_total_row,direction:frappe.utils.is_rtl()?"rtl":"ltr",hooks:{columnTotal:frappe.utils.report_column_total}};this.report_settings.get_datatable_options&&(r=this.report_settings.get_datatable_options(r)),this.datatable=new DataTable(this.$report[0],r)}"number"==typeof this.report_settings.initial_depth&&this.datatable.rowmanager.setTreeDepth(this.report_settings.initial_depth),this.report_settings.after_datatable_render&&this.report_settings.after_datatable_render(this.datatable)}show_loading_screen(){var e='<div class="msg-box no-border">\n\t\t\t<div>\n\t\t\t\t<img src="/assets/frappe/images/ui-states/list-empty-state.svg" alt="Generic Empty State" class="null-state">\n\t\t\t</div>\n\t\t\t<p>'+__("Loading")+"...</p>\n\t\t</div>";this.$loading.find("div").html(e),this.$report.hide(),this.$loading.show()}hide_loading_screen(){this.$loading.hide()}get_chart_options(e){var t=this.report_settings.get_chart_data?this.report_settings.get_chart_data(e.columns,e.result):e.chart?e.chart:void 0;if(t&&t.data&&t.data.labels&&t.data.labels.length>0)return t.fieldtype&&(t.tooltipOptions={formatTooltipY:function(e){return frappe.format(e,{fieldtype:t.fieldtype,options:t.options})}}),t.axisOptions={shortenYAxisNumbers:1},t.height=280,t}render_chart(e){this.$chart.empty(),this.$chart.show(),this.chart=new frappe.Chart(this.$chart[0],e)}open_create_chart_dialog(){var e=this,t=this,r=frappe.report_utils.get_field_options_from_report(this.columns,this.raw_data);function n(e){return e.y_fields=[],e.colors=[],e.y_axis_fields&&e.y_axis_fields.map(function(t){e.y_fields.push(t.y_field),e.colors.push(t.color)}),e.y_fields=e.y_fields.map(function(e){return e.trim()}).filter(Boolean),e}function i(){var e=$(o.fields_dict.chart_preview.wrapper),r=o.get_values(!0);if((r=n(r)).x_field&&r.y_fields.length){var i=frappe.report_utils.make_chart_options(t.columns,t.raw_data,r);t.chart_fields=r,e.empty(),new frappe.Chart(e[0],i),e.find(".chart-container .title, .chart-container .sub-title").hide(),e.show(),o.fields_dict.create_dashoard_chart.df.hidden=0,o.refresh()}else e[0].innerHTML='<div class="flex justify-center align-center text-muted" style="height: 120px; display: flex;">\n\t\t\t\t\t<div>'+__("Please select X and Y fields")+"</div>\n\t\t\t\t</div>"}var o=new frappe.ui.Dialog({title:__("Create Chart"),fields:[{fieldname:"x_field",label:"X Field",fieldtype:"Select",default:t.chart_fields?t.chart_fields.x_field:null,options:r.non_numeric_fields},{fieldname:"cb_1",fieldtype:"Column Break"},{fieldname:"chart_type",label:"Type of Chart",fieldtype:"Select",options:["Bar","Line","Percentage","Pie","Donut"],default:t.chart_fields?t.chart_fields.chart_type:"Bar"},{fieldname:"sb_1",fieldtype:"Section Break",label:"Y axis"},{fieldname:"y_axis_fields",fieldtype:"Table",fields:[{fieldtype:"Select",fieldname:"y_field",name:"y_field",label:__("Y Field"),options:r.numeric_fields,in_list_view:1},{fieldtype:"Color",fieldname:"color",name:"color",label:__("Color"),in_list_view:1}]},{fieldname:"preview_chart_button",fieldtype:"Button",label:"Preview Chart",click:i},{fieldname:"sb_2",fieldtype:"Section Break",label:"Chart Preview"},{fieldname:"chart_preview",label:"Chart Preview",fieldtype:"HTML"},{fieldname:"create_dashoard_chart",label:"Add Chart to Dashboard",fieldtype:"Button",hidden:1,click:function(){o.hide(),e.add_chart_to_dashboard()}}],primary_action_label:__("Create"),primary_action:function(i){i=n(i);var a=frappe.report_utils.make_chart_options(e.columns,e.raw_data,i);t.chart_fields=i;var s=r.numeric_fields.filter(function(e){return e.value==i.y_fields[0]})[0].label,l=r.non_numeric_fields.filter(function(e){return e.value==i.x_field})[0].label;a.title=__("{0}: {1} vs {2}",[e.report_name,s,l]),e.render_chart(a),e.add_chart_buttons_to_toolbar(!0),o.hide()}});o.show(),setTimeout(i,500)}prepare_columns(e){var t=this;return e.map(function(e){e=frappe.report_utils.prepare_field_from_column(e);var r=function(e,r,n,i){if(n.isHeader&&!i&&t.data){var o=1;if(t.report_settings.get_datatable_options){var a=t.report_settings.get_datatable_options({});a&&a.checkboxColumn&&(o=2)}n.colIndex!==o||e?in_list(["Currency","Float"],n.fieldtype)&&(i=t.data[0]):(e="Total",n={fieldtype:"Data"})}return frappe.format(e,n,{for_print:!1,always_show_decimals:!0},i)},n=null;return"Date"===e.fieldtype&&(n=function(e,t){if(!e.content)return null;if(t.length!=="YYYY-MM-DD".length)return null;var r=frappe.datetime.user_to_obj(t);return[+frappe.datetime.str_to_obj(e.content),+r]}),Object.assign(e,{id:e.fieldname,name:__(e.label,null,"Column of report '"+t.report_name+"'"),width:parseInt(e.width)||null,editable:!1,compareValue:n,format:function(e,n,i,o){return t.report_settings.formatter?t.report_settings.formatter(e,n,i,o,r):r(e,0,i,o)}})})}prepare_data(e){var t=this;return e.map(function(e){var r={};return Array.isArray(e)?(t.columns.forEach(function(t,n){r[t.id]=e[n]}),r):e})}get_visible_columns(){var e=this;return this.datatable.datamanager.getColumns(!0).map(function(e){return e.id}).map(function(t){return e.columns.find(function(e){return e.id===t})}).filter(Boolean)}get_filter_values(e){var t=this.filters.filter(function(e){return e.df.reqd||e.df.mandatory}).filter(function(e){return!e.get_value()});if(e&&t.length>0){var r=__("Please set filters");throw this.toggle_message(e,r),"Filter missing"}return this.filters.filter(function(e){return e.get_value()}).map(function(e){var t,r=e.get_value();return e.df.hidden&&(r=e.value),"%"===r&&(r=null),e.df.wildcard_filter&&(r="%"+r+"%"),(t={})[e.df.fieldname]=r,t}).reduce(function(e,t){return Object.assign(e,t),e},{})}get_filter(e){var t=(this.filters||[]).find(function(t){return t.df.fieldname===e});return t||console.warn("[Query Report] Invalid filter: "+e),t}get_filter_value(e){var t=this.get_filter(e);return t?t.get_value():null}set_filter_value(e,t){var r=this,n={};"string"==typeof e?n[e]=t:n=e,this._no_refresh=!0,Object.keys(n).forEach(function(e,t,i){var o=n[e];t===i.length-1&&(r._no_refresh=!1),r.get_filter(e).set_value(o)})}set_breadcrumbs(){if(this.report_doc&&this.report_doc.ref_doctype){var e=frappe.get_meta(this.report_doc.ref_doctype);frappe.breadcrumbs.add(e.module)}}make_access_log(e,t){frappe.call("frappe.core.doctype.access_log.access_log.make_access_log",{doctype:this.doctype||"",report_name:this.report_name,filters:this.get_filter_values(),file_type:t,method:e})}print_report(e){var t=this.report_settings.html_format||null,r=this.get_filters_html_for_print(),n="Landscape"==e.orientation;this.make_access_log("Print","PDF"),frappe.render_grid({template:e.columns?"print_grid":t,title:__(this.report_name),subtitle:r,print_settings:e,landscape:n,filters:this.get_filter_values(),data:this.get_data_for_print(),columns:this.get_columns_for_print(e,t),original_data:this.data,report:this})}pdf_report(e){var t=frappe.urllib.get_base_url(),r=frappe.boot.print_css,n="Landscape"==e.orientation,i=this.report_settings.html_format||null,o=this.get_columns_for_print(e,i),a=this.get_data_for_print(),s=this.get_filter_values(),l=this.get_filters_html_for_print(),d=e.columns||!i?"print_grid":i,c=frappe.render_template(d,{title:__(this.report_name),subtitle:l,filters:s,data:a,original_data:this.data,columns:o,report:this}),u=frappe.render_template("print_template",{title:__(this.report_name),content:c,base_url:t,print_css:r,print_settings:e,landscape:n,columns:o,lang:frappe.boot.lang,layout_direction:frappe.utils.is_rtl()?"rtl":"ltr"});frappe.render_pdf(u,e)}get_filters_html_for_print(){var e=this.get_filter_values();return Object.keys(e).map(function(t){var r=frappe.query_report.get_filter(t).df.label,n=e[t];return"<h6>"+__(r)+": "+n+"</h6>"}).join("")}export_report(){var e=this;if(this.export_dialog)return this.export_dialog.clear(),void this.export_dialog.show();var t=[{label:__("Select File Format"),fieldname:"file_format",fieldtype:"Select",options:["Excel","CSV"],default:"Excel",reqd:1}];this.tree_report&&t.push({label:__("Include indentation"),fieldname:"include_indentation",fieldtype:"Check"}),this.export_dialog=frappe.prompt(t,function(t){var r=t.file_format,n=t.include_indentation;if(e.make_access_log("Export",r),"CSV"===r){var i=e.columns.reduce(function(e,t){return t.hidden||e.push(t.label),e},[]),o=e.get_data_for_csv(n),a=[i].concat(o);frappe.tools.downloadify(a,null,e.report_name)}else{var s=e.get_filter_values(!0);frappe.urllib.get_dict("prepared_report_name")&&(s=Object.assign(frappe.urllib.get_dict("prepared_report_name"),s));var l=e.datatable.bodyRenderer.visibleRowIndices;l.length+1===e.data.length&&l.push(l.length);var d={cmd:"frappe.desk.query_report.export_query",report_name:e.report_name,custom_columns:e.custom_columns.length?e.custom_columns:[],file_format_type:r,filters:s,visible_idx:l,include_indentation:n};open_url_post(frappe.request.url,d)}},__("Export Report: {0}",[this.report_name]),__("Download"))}get_data_for_csv(e){var t=this,r=this.datatable.bodyRenderer.visibleRows;return this.raw_data.add_total_row&&r.push(this.datatable.bodyRenderer.getTotalRow()),r.map(function(r){var n=t.datatable.datamanager.getStandardColumnCount();return r.slice(n).map(function(t,n){return"Duration"===t.column.fieldtype&&(t.content=frappe.utils.get_formatted_duration(t.content)),e&&0===n&&(t.content="   ".repeat(r.meta.indent)+(t.content||"")),t.content||""})})}get_data_for_print(){var e=this;if(!this.data.length)return[];var t=this.datatable.datamanager.rowViewOrder.map(function(t){if(e.datatable.bodyRenderer.visibleRowIndices.includes(t))return e.data[t]}).filter(Boolean);if(this.raw_data.add_total_row){var r=this.datatable.bodyRenderer.getTotalRow().reduce(function(e,t){return e[t.column.id]=t.content,e.is_total_row=!0,e},{});t.push(r)}return t}get_columns_for_print(e,t){return e&&e.columns?this.get_visible_columns().filter(function(t){return e.columns.includes(t.fieldname)}):t?this.columns:this.get_visible_columns()}get_menu_items(){var e=this,t=[{label:__("Refresh"),action:function(){return e.refresh()},class:"visible-xs"},{label:__("Edit"),action:function(){return frappe.set_route("Form","Report",e.report_name)},condition:function(){return frappe.user.is_report_manager()},standard:!0},{label:__("Print"),action:function(){var t=frappe.ui.get_print_settings(!1,function(t){return e.print_report(t)},e.report_doc.letter_head,e.get_visible_columns());e.add_portrait_warning(t)},condition:function(){return frappe.model.can_print(e.report_doc.ref_doctype)},standard:!0},{label:__("PDF"),action:function(){var t=frappe.ui.get_print_settings(!1,function(t){return e.pdf_report(t)},e.report_doc.letter_head,e.get_visible_columns());e.add_portrait_warning(t)},condition:function(){return frappe.model.can_print(e.report_doc.ref_doctype)},standard:!0},{label:__("Export"),action:function(){return e.export_report()},condition:function(){return frappe.model.can_export(e.report_doc.ref_doctype)},standard:!0},{label:__("Setup Auto Email"),action:function(){return frappe.set_route("List","Auto Email Report",{report:e.report_name})},standard:!0},{label:__("Add Column"),action:function(){var t=new frappe.ui.Dialog({title:__("Add Column"),fields:[{fieldtype:"Select",fieldname:"doctype",label:__("From Document Type"),options:e.linked_doctypes.map(function(e){return{label:e.doctype,value:e.doctype}}),change:function(){var e=t.get_value("doctype");frappe.model.with_doctype(e,function(){var r=frappe.meta.get_docfields(e).filter(frappe.model.is_value_type).map(function(e){return{label:e.label,value:e.fieldname}});t.set_df_property("field","options",r.sort(function(e,t){return e.label<t.label?-1:e.label>t.label?1:0}))})}},{fieldtype:"Select",label:__("Field"),fieldname:"field",options:[]},{fieldtype:"Select",label:__("Insert After"),fieldname:"insert_after",options:e.columns.map(function(e){return e.label})}],primary_action:function(r){var n=[],i=frappe.meta.get_docfield(r.doctype,r.field),o=e.columns.findIndex(function(e){return e.label===r.insert_after}),a=e.get_fieldname_for_column(i.fieldname,r.doctype);n.push({fieldname:a,field:r.field,fieldtype:i.fieldtype,label:i.label,insert_after_index:o,link_field:e.doctype_field_map[r.doctype],doctype:r.doctype,options:i.options,width:100}),e.custom_columns=e.custom_columns.concat(n),frappe.call({method:"frappe.desk.query_report.get_data_for_custom_field",args:{doctype:r.doctype,fieldname:a,field:r.field},callback:function(i){var s=i.message,l=e.doctype_field_map[r.doctype];e.add_custom_column(n,s,l,a,o),t.hide()}}),e.set_menu_items()}});t.show()},standard:!0},{label:__("User Permissions"),action:function(){return frappe.set_route("List","User Permission",{doctype:"Report",name:e.report_name})},condition:function(){return frappe.model.can_set_user_permissions("Report")},standard:!0}];return frappe.user.is_report_manager()&&t.push({label:__("Save"),action:function(){var t=new frappe.ui.Dialog({title:__("Save Report"),fields:[{fieldtype:"Data",fieldname:"report_name",label:__("Report Name"),default:"No"==e.report_doc.is_standard?e.report_name:"",reqd:!0}],primary_action:function(r){frappe.call({method:"frappe.desk.query_report.save_report",args:{reference_report:e.report_name,report_name:r.report_name,columns:e.get_visible_columns()},callback:function(e){this.show_save=!1,t.hide(),frappe.set_route("query-report",e.message)}})}});t.show()},standard:!0}),t}add_portrait_warning(e){this.columns.length>10&&e.set_df_property("orientation","change",function(){var t="Portrait"===e.get_value("orientation")?__("Report with more than 10 columns looks better in Landscape mode."):"";e.set_df_property("orientation","description",t)})}get_fieldname_for_column(e,t){var r=[];return this.columns.forEach(function(e){r.push(e.fieldname)}),r.includes(e)&&(e=frappe.model.scrub(e+" "+t)),e}add_custom_column(e,t,r,n,i){var o=this.prepare_columns(e);this.columns.splice(i+1,0,o[0]),this.data.forEach(function(e){e[n]=t[e[r]]}),this.render_datatable()}get_linked_doctypes(){var e=this,t=[],r=[],n=new Set;return this.doctype_field_map={},this.columns.forEach(function(e){"Link"==e.fieldtype&&e.options&&"Currency"!=e.options?t.push({doctype:e.options,fieldname:e.fieldname}):"Dynamic Link"==e.fieldtype&&e.options&&r.push({link_name:e.options,fieldname:e.fieldname})}),this.data.forEach(function(e){r.forEach(function(t){e[t.link_name]&&n.add(e[t.link_name]+":"+t.fieldname)})}),(t=t.concat(Array.from(n).map(function(e){var t=e.split(":");return{doctype:t[0],fieldname:t[1]}}))).forEach(function(t){e.doctype_field_map[t.doctype]=t.fieldname}),t}setup_report_wrapper(){if(!this.$report){$(".page-head-content").removeClass("border-bottom");var e=this.page.main.find(".page-form");this.$status=$('<div class="form-message text-muted small"></div>').hide().insertAfter(e),this.$summary=$('<div class="report-summary"></div>').hide().appendTo(this.page.main),this.$chart=$('<div class="chart-wrapper">').hide().appendTo(this.page.main),this.$loading=$(this.message_div("")).hide().appendTo(this.page.main),this.$report=$('<div class="report-wrapper">').appendTo(this.page.main),this.$message=$(this.message_div("")).hide().appendTo(this.page.main)}}show_status(e){this.$status.html(e).show()}hide_status(){this.$status.hide()}show_footer_message(){this.$report_footer&&this.$report_footer.remove(),this.$report_footer=$('<div class="report-footer text-muted"></div>').appendTo(this.page.main),this.tree_report&&(this.$tree_footer=$('<div class="tree-footer col-md-6">\n\t\t\t\t<button class="btn btn-xs btn-default" data-action="expand_all_rows">\n\t\t\t\t\t'+__("Expand All")+'</button>\n\t\t\t\t<button class="btn btn-xs btn-default" data-action="collapse_all_rows">\n\t\t\t\t\t'+__("Collapse All")+"</button>\n\t\t\t</div>"),$(this.$report_footer).append(this.$tree_footer),this.$tree_footer.find("[data-action=collapse_all_rows]").show(),this.$tree_footer.find("[data-action=expand_all_rows]").hide());var e=__("For comparison, use >5, <10 or =324. For ranges, use 5:10 (for values between 5 & 10)."),t=__("Execution Time: {0} sec",[this.execution_time||.1]);this.$report_footer.append('<div class="col-md-12">\n\t\t\t<span">'+e+'</span><span class="pull-right">'+t+"</span>\n\t\t</div>")}expand_all_rows(){this.$tree_footer.find("[data-action=expand_all_rows]").hide(),this.datatable.rowmanager.expandAllNodes(),this.$tree_footer.find("[data-action=collapse_all_rows]").show()}collapse_all_rows(){this.$tree_footer.find("[data-action=collapse_all_rows]").hide(),this.datatable.rowmanager.collapseAllNodes(),this.$tree_footer.find("[data-action=expand_all_rows]").show()}message_div(e){return"<div class='flex justify-center align-center text-muted' style='height: 50vh;'>\n\t\t\t<div>"+e+"</div>\n\t\t</div>"}reset_report_view(){this.hide_status(),this.toggle_nothing_to_show(!0),this.refresh()}toggle_nothing_to_show(e){var t=this.prepared_report?__("This is a background report. Please set the appropriate filters and then generate a new one."):this.get_no_result_message();this.toggle_message(e,t),e&&this.prepared_report&&(this.prepared_report_action="New",this.primary_button.is(":visible")||this.add_prepared_report_buttons())}toggle_message(e,t){e?(this.$message.find("div").html(t),this.$message.show()):this.$message.hide()}toggle_filter_display(e,t){this.$page.find("div[data-fieldname="+e+"]").toggleClass("hide-control",t)}toggle_report(e){this.$report.toggle(e),this.$chart.toggle(e),this.$summary.toggle(e)}get get_values(){return this.get_filter_values}},Object.defineProperty(frappe,"query_report_filters_by_name",{get:function(){return console.warn("[Query Report] frappe.query_report_filters_by_name is deprecated. Please use the new api: frappe.query_report.get_filter_value(fieldname) and frappe.query_report.set_filter_value(fieldname, value)"),null}}),frappe.templates.print_grid=' {% if title %} <h2>{{ __(title) }}</h2> <hr> {% endif %} {% if subtitle %} {{ subtitle }} <hr> {% endif %} <table class="table table-bordered">    <thead>   <tr>   <th> # </th>   {% for col in columns %}    {% if col.name && col._id !== "_check" %}    <th     {% if col.minWidth %}      style="min-width: {{ col.minWidth }}px"     {% endif %}     {% if col.docfield && frappe.model.is_numeric_field(col.docfield) %}      class="text-right"     {% endif %}    >     {{ __(col.name) }}</th>    {% endif %}   {% endfor %}   </tr>  </thead>    <tbody>   {% for row in data %}    <tr style="height: 30px">    <td {% if row.bold == 1 %} style="font-weight: bold" {% endif %}>     <span> {{ row._index + 1 }} </span>    </td>    {% for col in columns %}     {% if col.name && col._id !== "_check" %}       {% var value = col.fieldname ? row[col.fieldname] : row[col.id]; %}       <td {% if row.bold == 1 %} style="font-weight: bold" {% endif %}>       <span {% if col._index == 0 %} style="padding-left: {%= cint(row.indent) * 2 %}em" {% endif %}>        {% format_data = row.is_total_row && ["Currency", "Float"].includes(col.fieldtype) ? data[0] : row %}        {% if (row.is_total_row && col._index == 0) { %}         {{ __("Total") }}        {% } else { %}         {{          col.formatter           ? col.formatter(row._index, col._index, value, col, format_data, true)           : col.format            ? col.format(value, row, col, format_data)            : col.docfield             ? frappe.format(value, col.docfield)             : value         }}        {% } %}       </span>      </td>     {% endif %}    {% endfor %}    </tr>   {% endfor %}  </tbody> </table> ',frappe.templates.print_tree='<!DOCTYPE html> <html lang="en">   <head>     <meta charset="utf-8">     <meta http-equiv="X-UA-Compatible" content="IE=edge">     <meta name="viewport" content="width=device-width, initial-scale=1">     <meta name="description" content="">     <meta name="author" content="">     <title>{{ title }}</title>     <link href="{{ base_url }}/assets/frappe/css/bootstrap.css" rel="stylesheet">  <link type="text/css" rel="stylesheet"   href="{{ base_url }}/assets/frappe/css/font-awesome.css">  <link rel="stylesheet" type="text/css" href="{{ base_url }}/assets/frappe/css/tree.css">   <style>   {{ print_css }}  </style>  <style>   .tree.opened::before,    .tree-node.opened::before,    .tree:last-child::after,    .tree-node:last-child::after {    z-index: 1;    border-left: 1px solid #d1d8dd;    background: none;   }   .tree a,   .tree-link {    text-decoration: none;    cursor: default;   }   .tree.opened > .tree-children > .tree-node > .tree-link::before,    .tree-node.opened > .tree-children > .tree-node > .tree-link::before {    border-top: 1px solid #d1d8dd;    z-index: 1;    background: none;   }   i.fa.fa-fw.fa-folder {    z-index: 2;    position: relative;   }   .tree:last-child::after, .tree-node:last-child::after {    display: none;   }   .tree-node-toolbar {    display: none;   }   i.octicon.octicon-primitive-dot.text-extra-muted {    width: 7px;    height: 7px;    border-radius: 50%;    background: #d1d8dd;    display: inline-block;    position: relative;    z-index: 2;   }    @media (max-width: 767px) {    ul.tree-children {     padding-left: 20px;    }   }  </style>   </head>   <body>    <div class="print-format-gutter">     {% if print_settings.repeat_header_footer %}    <div id="footer-html" class="visible-pdf">     {% if print_settings.letter_head && print_settings.letter_head.footer %}      <div class="letter-head-footer">       {{ print_settings.letter_head.footer }}      </div>     {% endif %}     <p class="text-center small page-number visible-pdf">      {{ __("Page {0} of {1}", [`<span class="page"></span>`, `<span class="topage"></span>`]) }}     </p>    </div>     {% endif %}      <div class="print-format {% if landscape %} landscape {% endif %}">      {% if print_settings.letter_head %}      <div {% if print_settings.repeat_header_footer %} id="header-html" class="hidden-pdf" {% endif %}>       <div class="letter-head">{{ print_settings.letter_head.header }}</div>      </div>     {% endif %}     <div class="tree opened">      {{ tree }}     </div>     </div>    </div>   </body> </html> ',frappe.templates.group_by='<div class="group-by-box">  <div class="visible-xs flex justify-flex-end">   <span class="remove-group-by">    {{ __("Remove") }}   </span>  </div>  <div class="list_groupby row">   <div class="col-sm-8 form-group">    <select class="group-by form-control input-xs">     <option value="" disabled selected>{{ __("Select Group By...") }}</option>     {% for (var parent_doctype in group_by_conditions) { %}      {% for (var val in group_by_conditions[parent_doctype]) { %}       {% if (parent_doctype !== doctype) { %}       <option        data-doctype="{{parent_doctype}}"        value="{{group_by_conditions[parent_doctype][val].fieldname}}"       >        {{ __(group_by_conditions[parent_doctype][val].label) }}        ({{ __(parent_doctype) }})       </option>       {% } else { %}       <option        data-doctype="{{parent_doctype}}"        value="{{group_by_conditions[parent_doctype][val].fieldname}}"       >        {{ __(group_by_conditions[parent_doctype][val].label) }}       </option>       {% } %}      {% } %}     {% } %}    </select>   </div>   <div class="col-sm-3 form-group">    <select class="aggregate-function form-control input-xs">     {% for condition in aggregate_function_conditions %}     <option value="{{condition.name}}">{{ __(condition.label) }}</option>     {% endfor %}    </select>   </div>   <div class="col-sm-4 col-xs-12" style="display: none">    <select class="aggregate-on form-control input-xs">     <option value="" disabled selected>{{ __("Select Field...") }}</option>    </select>   </div>   <div class="groupby-actions pull-left col-sm-1 hidden-xs">    <span class="remove-group-by">     <svg class="icon icon-sm">      <use xlink:href="#icon-close"></use>     </svg>    </span>   </div>  </div> </div> ',frappe.provide("frappe.views"),frappe.ui.GroupBy=class{constructor(e){this.report_view=e,this.page=e.page,this.doctype=e.doctype,this.make()}make(){this.make_group_by_button(),this.init_group_by_popover(),this.set_popover_events()}init_group_by_popover(){var e=[{name:"count",label:__("Count")},{name:"sum",label:__("Sum")},{name:"avg",label:__("Average")}],t=$(frappe.render_template("group_by",{doctype:this.doctype,group_by_conditions:this.get_group_by_fields(),aggregate_function_conditions:e}));this.group_by_button.popover({content:t,template:'\n\t\t\t\t<div class="group-by-popover popover">\n\t\t\t\t\t<div class="arrow"></div>\n\t\t\t\t\t<div class="popover-body popover-content">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t',html:!0,trigger:"manual",container:"body",placement:"bottom",offset:"-100px 0"})}set_popover_events(){var e=this;$(document.body).on("click",function(t){e.wrapper&&e.wrapper.is(":visible")&&(0!==$(t.target).parents(".group-by-popover").length||0!==$(t.target).parents(".group-by-box").length||0!==$(t.target).parents(".group-by-button").length||$(t.target).is(e.group_by_button)||e.wrapper&&e.group_by_button.popover("hide"))}),this.group_by_button.on("click",function(){e.group_by_button.popover("toggle")}),this.group_by_button.on("shown.bs.popover",function(){e.wrapper||(e.wrapper=$(".group-by-popover"),e.setup_group_by_area())}),this.group_by_button.on("hidden.bs.popover",function(){e.update_group_by_button()}),frappe.router.on("change",function(){e.group_by_button.popover("hide")})}setup_group_by_area(){this.aggregate_on_html="",this.group_by_select=this.wrapper.find("select.group-by"),this.group_by_field&&this.group_by_select.val(this.group_by_field),this.aggregate_function_select=this.wrapper.find("select.aggregate-function"),this.aggregate_on_select=this.wrapper.find("select.aggregate-on"),this.remove_group_by_button=this.wrapper.find(".remove-group-by"),this.aggregate_function?this.aggregate_function_select.val(this.aggregate_function):(this.aggregate_function_select.val("count"),this.aggregate_function="count"),this.toggle_aggregate_on_field(),this.aggregate_on&&this.aggregate_on_select.val(this.aggregate_on_field),this.set_group_by_events()}set_group_by_events(){var e=this;this.group_by_select.on("change",function(){e.group_by_field=e.group_by_select.val(),e.group_by_doctype=e.group_by_select.find(":selected").attr("data-doctype"),e.apply_group_by_and_refresh()}),this.aggregate_function_select.on("change",function(){e.toggle_aggregate_on_field(),e.aggregate_function=e.aggregate_function_select.val(),e.apply_group_by_and_refresh()}),this.aggregate_on_select.on("change",function(){e.aggregate_on_field=e.aggregate_on_select.val(),e.aggregate_on_doctype=e.aggregate_on_select.find(":selected").attr("data-doctype"),e.apply_group_by_and_refresh()}),this.remove_group_by_button.on("click",function(){e.group_by&&(e.remove_group_by(),e.toggle_aggregate_on_field_display(!1))})}toggle_aggregate_on_field(){var e=this,t=this.aggregate_function_select.val();if("sum"===t||"avg"===t){if(!this.aggregate_on_html.length){this.aggregate_on_html='<option value="" disabled selected>\n\t\t\t\t\t\t'+__("Select Field...")+"\n\t\t\t\t\t</option>";var r=function(t){e.all_fields[t].forEach(function(r){if(frappe.model.is_numeric_field(r.fieldtype)){var n=t==e.doctype?r.label:r.label+" ("+__(t)+")";e.aggregate_on_html+='<option data-doctype="'+t+'"\n\t\t\t\t\t\t\t\tvalue="'+r.fieldname+'">'+__(n)+"</option>"}})};for(var n in e.all_fields)r(n)}this.aggregate_on_select.html(this.aggregate_on_html),this.toggle_aggregate_on_field_display(!0)}else this.toggle_aggregate_on_field_display(!1)}toggle_aggregate_on_field_display(e){this.group_by_select.parent().toggleClass("col-sm-5",e),this.group_by_select.parent().toggleClass("col-sm-8",!e),this.aggregate_function_select.parent().toggleClass("col-sm-2",e),this.aggregate_function_select.parent().toggleClass("col-sm-3",!e),this.aggregate_on_select.parent().toggle(e)}get_settings(){return this.group_by?{group_by:this.group_by,aggregate_function:this.aggregate_function,aggregate_on:this.aggregate_on}:null}apply_settings(e){var t=function(e){return e.split(".")[1].replace(/`/g,"")},r=function(e){return e.split(".")[0].replace(/`/g,"").replace("tab","")};if(e.group_by.startsWith("`tab")||(e.group_by="`tab"+this.doctype+"`.`"+e.group_by+"`"),e.aggregate_on&&!e.aggregate_on.startsWith("`tab")){var n=this.get_aggregate_on_doctype(e);e.aggregate_on="`tab"+n+"`.`"+e.aggregate_on+"`"}this.group_by_field=t(e.group_by),this.group_by_doctype=r(e.group_by),this.aggregate_function=e.aggregate_function,e.aggregate_on&&(this.aggregate_on_field=t(e.aggregate_on),this.aggregate_on_doctype=r(e.aggregate_on)),this.apply_group_by(),this.update_group_by_button()}get_aggregate_on_doctype(e){for(var t=0,r=Object.keys(this.all_fields);t<r.length;t+=1){var n=r[t];if(this.all_fields[n].find(function(t){return t.fieldname==e.aggregate_on}))return n}}make_group_by_button(){this.page.wrapper.find(".sort-selector").before($('<div class="group-by-selector">\n\t\t\t\t<button class="btn btn-default btn-sm group-by-button ellipsis">\n\t\t\t\t\t<span class="group-by-icon">\n\t\t\t\t\t\t'+frappe.utils.icon("group-by")+'\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class="button-label hidden-xs">\n\t\t\t\t\t\t'+__("Add Group")+"\n\t\t\t\t\t</span>\n\t\t\t\t</button>\n\t\t\t</div>")),this.group_by_button=this.page.wrapper.find(".group-by-button")}apply_group_by(){return this.group_by="`tab"+this.group_by_doctype+"`.`"+this.group_by_field+"`","count"===this.aggregate_function?(this.aggregate_on_field=null,this.aggregate_on_doctype=null):this.aggregate_on="`tab"+this.aggregate_on_doctype+"`.`"+this.aggregate_on_field+"`",!(!this.group_by||!this.aggregate_function||!this.aggregate_on_field&&"count"!==this.aggregate_function)}apply_group_by_and_refresh(){this.apply_group_by()&&this.report_view.refresh()}set_args(e){this.aggregate_function&&this.group_by&&(this.report_view.group_by=this.group_by,this.report_view.sort_by="_aggregate_column",this.report_view.sort_order="desc",this.report_view.fields.map(function(e){return e[0]}).includes("_aggregate_column")||(this.original_fields=this.report_view.fields.map(function(e){return e})),this.report_view.fields=[[this.group_by_field,this.group_by_doctype]],e.fields=this.report_view.get_fields(),this.report_view.fields.push(["_aggregate_column",this.aggregate_on_doctype||this.doctype]),this.report_view.setup_columns(),Object.assign(e,{with_comment_count:!1,aggregate_on_field:this.aggregate_on_field||"name",aggregate_on_doctype:this.aggregate_on_doctype||this.doctype,aggregate_function:this.aggregate_function||"count",group_by:this.report_view.group_by||null,order_by:"_aggregate_column desc"}))}get_group_by_docfield(){var e={};return"count"===this.aggregate_function?e={fieldtype:"Int",label:__("Count"),parent:this.doctype,width:200}:(e=Object.assign({},frappe.meta.docfield_map[this.aggregate_on_doctype][this.aggregate_on_field]),"sum"===this.aggregate_function?e.label=__("Sum of {0}",[e.label]):e.label=__("Average of {0}",[e.label])),e.fieldname="_aggregate_column",e}remove_group_by(){this.order_by="",this.group_by=null,this.group_by_field=null,this.report_view.group_by=null,this.aggregate_function="count",this.aggregate_on=null,this.aggregate_on_field=null,this.group_by_select.val(""),this.aggregate_function_select.val("count"),this.aggregate_on_select.empty().val(""),this.aggregate_on_select.parent().hide(),this.original_fields?this.report_view.fields=this.original_fields:this.report_view.set_default_fields(),this.report_view.setup_columns(),this.original_fields=null,this.report_view.refresh()}get_group_by_fields(){var e=this;this.group_by_fields={},this.all_fields={};var t=this.report_view.meta.fields.filter(function(e){return["Select","Link","Data","Int","Check"].includes(e.fieldtype)}),r={fieldname:"_user_tags",fieldtype:"Data",label:__("Tags")};this.group_by_fields[this.doctype]=t.concat(r),this.all_fields[this.doctype]=this.report_view.meta.fields;var n=function(e){return!in_list(frappe.model.no_value_type,e.fieldtype)&&!e.report_hide};return frappe.meta.get_table_fields(this.doctype).filter(function(e){return!e.hidden}).forEach(function(t){var r=t.options,i=frappe.meta.get_docfields(r).filter(n);e.group_by_fields[r]=i,e.all_fields[r]=i}),this.group_by_fields}update_group_by_button(){var e=Boolean(this.group_by_field),t=e?__("Group By {0}",[this.get_group_by_field_label()]):__("Add Group");this.group_by_button.toggleClass("btn-default",!e).toggleClass("btn-primary-light",e),this.group_by_button.find(".group-by-icon").toggleClass("active",e),this.group_by_button.find(".button-label").html(t),this.group_by_button.attr("title",t)}get_group_by_field_label(){var e=this;return this.group_by_fields[this.group_by_doctype].find(function(t){return t.fieldname==e.group_by_field}).label}},frappe.provide("frappe.report_utils"),frappe.report_utils={make_chart_options:function(e,t,r){var n=r.y_fields,i=r.x_field,o=r.chart_type,a=r.colors,s=r.height,l=o.toLowerCase(),d=t.result.filter(function(e){return Object.keys(e).length}),c=h(i),u=n.map(function(e){return{name:frappe.model.unscrub(e),values:h(e).map(function(e){return Number(e)})}});return t.add_total_row&&(c=c.slice(0,-1),u.forEach(function(e){e.values=e.values.slice(0,-1)})),{data:{labels:c.length?c:null,datasets:u},truncateLegends:1,type:l,height:s||280,colors:a,axisOptions:{shortenYAxisNumbers:1,xAxisMode:"tick"}};function h(t){if(Array.isArray(d[0])){var r=e.findIndex(function(e){return e.fieldname==t});return d.map(function(e){return e[r]})}return d.map(function(e){return e[t]})}},get_field_options_from_report:function(e,t){var r=t.result.filter(function(e){return Object.keys(e).length}),n=(Array.isArray(r[0])?r[0]:e.map(function(e){return r[0][e.fieldname]})).reduce(function(e,t,r){return Number.isFinite(t)&&e.push(r),e},[]);function i(e){return e.map(function(e){return e.fieldname?{label:e.label,value:e.fieldname}:{label:(e=frappe.report_utils.prepare_field_from_column(e)).label,value:e.fieldname}})}var o=e.filter(function(e,t){return n.includes(t)}),a=e.filter(function(e,t){return!n.includes(t)});return{numeric_fields:i(o),non_numeric_fields:i(a)}},prepare_field_from_column:function(e){var t;if("string"==typeof e)if(e.includes(":")){var r,n=e.split(":"),i=n[0],o=n[1],a=n[2];o.includes("/")&&(t=o.split("/"),o=t[0],r=t[1]),e={label:i,fieldname:i,fieldtype:o,width:a,options:r}}else e={label:e,fieldname:e,fieldtype:"Data"};return e},get_report_filters:function(e){if(frappe.query_reports[e]){var t=frappe.query_reports[e].filters;return Promise.resolve(t)}return frappe.xcall("frappe.desk.query_report.get_script",{report_name:e}).then(function(t){return frappe.dom.eval(t.script||""),frappe.after_ajax(function(){return frappe.query_reports[e]&&frappe.query_reports[e].filters})})},get_filter_values:function(e){return e.map(function(e){var t,r=e.default;return(t={})[e.fieldname]=r,t}).reduce(function(e,t){return Object.assign(e,t),e},{})},get_result_of_fn:function(e,t){return{Minimum:function(e){return e.reduce(function(e,t){return Math.min(e,t)},e[0])},Maximum:function(e){return e.reduce(function(e,t){return Math.max(e,t)},e[0])},Average:function(e){return e.reduce(function(e,t){return e+t},0)/e.length},Sum:function(e){return e.reduce(function(e,t){return e+t},0)}}[e](t)}},exports.__moduleExports=clusterize_min,exports}({});
//# sourceMappingURL=report.min.js.map
