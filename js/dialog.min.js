!function(){"use strict";frappe.provide("frappe.dom"),frappe.dom={id_count:0,freeze_count:0,by_id:function(t){return document.getElementById(t)},get_unique_id:function(){var t="unique-"+frappe.dom.id_count;return frappe.dom.id_count++,t},set_unique_id:function(t){var e=$(t);if(e.attr("id"))return e.attr("id");var i="unique-"+frappe.dom.id_count;return e.attr("id",i),frappe.dom.id_count++,i},eval:function(t){if(t){var e=document.createElement("script");e.appendChild(document.createTextNode(t)),document.getElementsByTagName("head")[0].appendChild(e)}},remove_script_and_style:function(t){var e=["script","style","noscript","title","meta","base","head"];if(!new RegExp(e.map(function(t){return"<"+t+">.*<\\/"+t+">"}).join("|"),"s").test(t))return t;var i=document.createElement("div");i.innerHTML=t;var s=!1;e.forEach(function(t){var e=i.getElementsByTagName(t);for(n=e.length;n--;)s=!0,e[n].parentNode.removeChild(e[n])});for(var a=i.getElementsByTagName("link"),n=a.length;n--;)"stylesheet"==a[n].getAttribute("rel")&&(s=!0,a[n].parentNode.removeChild(a[n]));return s?i.innerHTML:t},is_element_in_viewport:function(t,e){void 0===e&&(e=0),"function"==typeof jQuery&&t instanceof jQuery&&(t=t[0]);var i=t.getBoundingClientRect();return i.top+e>=0&&i.left+e>=0&&i.bottom-e<=$(window).height()&&i.right-e<=$(window).width()},is_element_in_modal:function(t){return Boolean($(t).parents(".modal").length)},set_style:function(t,e){if(t){var i=document.createElement("style");if(i.type="text/css",e){var s=document.getElementById(e);s&&s.parentNode.removeChild(s),i.id=e}return i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t)),document.getElementsByTagName("head")[0].appendChild(i),i}},add:function(t,e,i,s,a,n){t&&t.substr&&(t=frappe.dom.by_id(t));var r=document.createElement(e);return t&&t.appendChild(r),i&&("img"==e.toLowerCase()?r.src=i:r.className=i),s&&frappe.dom.css(r,s),a&&(r.innerHTML=a),n&&(r.onclick=n),r},css:function(t,e){return t&&e&&$.extend(t.style,e),t},activate:function(t,e,i,s){void 0===s&&(s="active"),t.find("."+i+"."+s).removeClass(s),e.addClass(s)},freeze:function(t,e){if($("#freeze").length)$("#freeze").addClass("in");else{var i=$('<div id="freeze" class="modal-backdrop fade"></div>').on("click",function(){if(cur_frm&&cur_frm.cur_grid)return cur_frm.cur_grid.toggle_view(),!1}).appendTo("#body");i.html(repl('<div class="freeze-message-container"><div class="freeze-message"><p class="lead">%(msg)s</p></div></div>',{msg:t||""})),setTimeout(function(){i.addClass("in")},1)}e&&$("#freeze").addClass(e),frappe.dom.freeze_count++},unfreeze:function(){if(frappe.dom.freeze_count&&(frappe.dom.freeze_count--,!frappe.dom.freeze_count))$("#freeze").removeClass("in").remove()},save_selection:function(){if(window.getSelection){var t=window.getSelection();if(t.getRangeAt&&t.rangeCount){for(var e=[],i=0,s=t.rangeCount;i<s;++i)e.push(t.getRangeAt(i));return e}}else if(document.selection&&document.selection.createRange)return document.selection.createRange();return null},restore_selection:function(t){if(t)if(window.getSelection){var e=window.getSelection();e.removeAllRanges();for(var i=0,s=t.length;i<s;++i)e.addRange(t[i])}else document.selection&&t.select&&t.select()},is_touchscreen:function(){return"ontouchstart"in window},handle_broken_images:function(t){$(t).find("img").on("error",function(t){$(t.currentTarget).addClass("no-image")})},scroll_to_bottom:function(t){var e=$(t);e.scrollTop(e[0].scrollHeight)},file_to_base64:function(t){return new Promise(function(e){var i=new FileReader;i.onload=function(){e(i.result)},i.readAsDataURL(t)})},scroll_to_section:function(t){setTimeout(function(){var e=$('a:contains("'+t+'")');e.length&&(e.parent().hasClass("collapsed")&&e.click(),frappe.ui.scroll(e.parent().parent()))},200)},pixel_to_inches:function(t){var e=$('<div id="dpi" style="height: 1in; width: 1in; left: 100%; position: fixed; top: 100%;"></div>');e.appendTo(document.body);var i=t/document.getElementById("dpi").offsetWidth;return e.remove(),i}},frappe.ellipsis=function(t,e){return e||(e=20),(t=cstr(t)).length>e&&(t=t.substr(0,e)+"..."),t},frappe.run_serially=function(t){var e=Promise.resolve();return t.forEach(function(t){t&&(e=e.then?e.then(t):Promise.resolve())}),e},frappe.load_image=function(t,e,i,s){void 0===s&&(s=function(){});var a=new Image;a.onload=function(){e(this)},a.onerror=i,s(a),a.src=t},frappe.timeout=function(t){return new Promise(function(e){setTimeout(function(){return e()},1e3*t)})},frappe.scrub=function(t,e){return void 0===e&&(e="_"),t.replace(/ /g,e).toLowerCase()},frappe.unscrub=function(t){return frappe.model.unscrub(t)},frappe.get_data_pill=function(t,e,i,s){void 0===e&&(e=null),void 0===i&&(i=null),void 0===s&&(s=null);var a=$('\n\t\t<button class="data-pill btn">\n\t\t\t<div class="flex align-center ellipsis">\n\t\t\t\t'+(s||"")+'\n\t\t\t\t<span class="pill-label '+(s?"ml-2":"")+'">'+t+"</span>\n\t\t\t</div>\n\t\t</button>\n\t");if(i){var n=$('\n\t\t\t<span class="remove-btn cursor-pointer">\n\t\t\t\t'+frappe.utils.icon("close","sm")+"\n\t\t\t</span>\n\t\t").click(function(){i(e||t,a)});a.append(n)}return a},frappe.get_modal=function(t,e){return $('<div class="modal fade" style="overflow: auto;" tabindex="-1">\n\t\t<div class="modal-dialog">\n\t\t\t<div class="modal-content">\n\t\t\t\t<div class="modal-header">\n\t\t\t\t\t<div class="fill-width flex title-section">\n\t\t\t\t\t\t<span class="indicator hidden"></span>\n\t\t\t\t\t\t<h4 class="modal-title">'+t+'</h4>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="modal-actions">\n\t\t\t\t\t\t<button class="btn btn-modal-minimize btn-link hide">\n\t\t\t\t\t\t\t'+frappe.utils.icon("collapse")+'\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button class="btn btn-modal-close btn-link" data-dismiss="modal">\n\t\t\t\t\t\t\t'+frappe.utils.icon("close-alt","sm","close-alt")+'\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="modal-body ui-front">'+e+'</div>\n\t\t\t\t<div class="modal-footer hide">\n\t\t\t\t\t<div class="custom-actions"></div>\n\t\t\t\t\t<div class="standard-actions">\n\t\t\t\t\t\t<button type="button" class="btn btn-secondary btn-sm hide btn-modal-secondary">\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button type="button" class="btn btn-primary btn-sm hide btn-modal-primary">\n\t\t\t\t\t\t\t'+__("Confirm")+"\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>")},frappe.is_online=function(){return 1==frappe.boot.developer_mode||(!("onLine"in navigator)||navigator.onLine)},$(window).on("online",function(){frappe.show_alert({indicator:"green",message:__("You are connected to internet.")})}),$(window).on("offline",function(){frappe.show_alert({indicator:"orange",message:__("Connection lost. Some features might not work.")})}),frappe.provide("frappe.form.formatters"),frappe.form.link_formatters={},frappe.form.formatters={_right:function(t,e){return e&&(e.inline||e.only_value)?t:"<div style='text-align: right'>"+t+"</div>"},Data:function(t,e){return e&&"URL"==e.options?'<a href="'+t+'" title="Open Link" target="_blank">'+t+"</a>":null==t?"":t},Select:function(t){return __(frappe.form.formatters.Data(t))},Float:function(t,e,i,s){var a=e.precision||cint(frappe.boot.sysdefaults&&frappe.boot.sysdefaults.float_precision)||null;if(e.options&&e.options.trim())return e.precision=a,frappe.form.formatters.Currency(t,e,i,s);if(!(i||{}).always_show_decimals&&!is_null(t)){var n=cstr(t).split(".");null!=n[1]&&0!==cint(n[1])||(a=0)}return frappe.form.formatters._right(null==t||""===t?"":format_number(t,null,a),i)},Int:function(t,e,i){return frappe.form.formatters._right(null==t?"":cint(t),i)},Percent:function(t,e,i){var s=e.precision||cint(frappe.boot.sysdefaults&&frappe.boot.sysdefaults.float_precision)||2;return frappe.form.formatters._right(flt(t,s)+"%",i)},Rating:function(t){return'<div class="rating">\n\t\t\t'+(""+[1,2,3,4,5].map(function(e){return'<svg class="icon icon-md '+(e<=(t||0)?"star-click":"")+'" data-idx="'+e+'">\n\t\t\t\t<use href="#icon-star"></use>\n\t\t\t</svg>'}).join(""))+"\n\t\t</div>"},Currency:function(t,e,i,s){var a=frappe.meta.get_field_currency(e,s),n=e.precision||cint(frappe.boot.sysdefaults.currency_precision)||2;if(n>2){var r=cstr(t).split("."),l=r.length>1?r[1]:"";if(l.length<3||l.length<n){var o=frappe.model.get_value(":Currency",a,"fraction_units")||100;l.length<cstr(o).length&&(n=cstr(o).length-1)}}return t=null==t||""===t?"":format_currency(t,a,n),i&&i.only_value?t:frappe.form.formatters._right(t,i)},Check:function(t){return'<input type="checkbox" disabled\n\t\t\tclass="disabled-'+(t?"selected":"deselected")+'">'},Link:function(t,e,i,s){var a=e._options||e.options,n=t;return t&&t.match&&t.match(/^['"].*['"]$/)&&t.replace(/^.(.*).$/,"$1"),i&&(i.for_print||i.only_value)?t:(frappe.form.link_formatters[a]&&s&&a!==s.doctype&&(t=frappe.form.link_formatters[a](t,s,e)),t?"'"==t[0]&&"'"==t[t.length-1]?t.substring(1,t.length-1):e&&e.link_onclick?repl('<a onclick="%(onclick)s">%(value)s</a>',{onclick:e.link_onclick.replace(/"/g,"&quot;"),value:t}):e&&a&&frappe.model.can_read(a)?'<a\n\t\t\t\t\thref="/app/'+encodeURIComponent(frappe.router.slug(a))+"/"+encodeURIComponent(n)+'"\n\t\t\t\t\tdata-doctype="'+a+'"\n\t\t\t\t\tdata-name="'+n+'">\n\t\t\t\t\t'+__(i&&i.label||t)+"</a>":t:"")},Date:function(t){return frappe.datetime.str_to_user?(t&&"Invalid date"===(t=frappe.datetime.str_to_user(t))&&(t=null),t||""):t},DateRange:function(t){return Array.isArray(t)?__("{0} to {1}",[frappe.datetime.str_to_user(t[0]),frappe.datetime.str_to_user(t[1])]):t||""},Datetime:function(t){if(t){var e=moment(frappe.datetime.convert_to_user_tz(t));return frappe.boot.sysdefaults.time_zone&&(e=e.tz(frappe.boot.sysdefaults.time_zone)),e.format(frappe.boot.sysdefaults.date_format.toUpperCase()+" "+(frappe.boot.sysdefaults.time_format||"HH:mm:ss"))}return""},Text:function(t){if(t){for(var e=["<p","<div","<br","<table"],i=!1,s=0;s<e.length;s++)if(t.match(e[s])){i=!0;break}i||(t=frappe.utils.replace_newlines(t))}return frappe.form.formatters.Data(t)},Time:function(t){return t&&(t=frappe.datetime.str_to_user(t,!0)),t||""},Duration:function(t,e){if(t){var i=frappe.utils.get_duration_options(e);t=frappe.utils.get_formatted_duration(t,i)}return t||""},LikedBy:function(t){var e="";return $.each(JSON.parse(t||"[]"),function(t,i){i&&(e+=frappe.avatar(i))}),e},Tag:function(t){var e="";return $.each((t||"").split(","),function(t,i){i&&(e+='\n\t\t\t\t<span\n\t\t\t\t\tclass="data-pill btn-xs align-center ellipsis"\n\t\t\t\t\tstyle="background-color: var(--control-bg); box-shadow: none; margin-right: 4px;"\n\t\t\t\t\tdata-field="_user_tags" data-label="'+i+"'\">\n\t\t\t\t\t"+i+"\n\t\t\t\t</span>")}),e},Comment:function(t){return t},Assign:function(t){var e="";return $.each(JSON.parse(t||"[]"),function(t,i){i&&(e+='<span class="label label-warning" \t\t\t\tstyle="margin-right: 7px;"\t\t\t\tdata-field="_assign">'+i+"</span>")}),e},SmallText:function(t){return frappe.form.formatters.Text(t)},TextEditor:function(t){var e=frappe.form.formatters.Text(t);try{$(e).find(".ql-editor").length||(e='<div class="ql-editor read-mode">'+e+"</div>")}catch(t){e='<div class="ql-editor read-mode">'+e+"</div>"}return e},Code:function(t){return"<pre>"+(null==t?"":$("<div>").text(t).html())+"</pre>"},WorkflowState:function(t){var e=frappe.get_doc("Workflow State",t);return e?repl("<span class='label label-%(style)s' \t\t\t\tdata-workflow-state='%(value)s'\t\t\t\tstyle='padding-bottom: 4px; cursor: pointer;'>\t\t\t\t<i class='fa fa-small fa-white fa-%(icon)s'></i> %(value)s</span>",{value:t,style:e.style.toLowerCase(),icon:e.icon}):"<span class='label'>"+t+"</span>"},Email:function(t){return $("<div></div>").text(t).html()},FileSize:function(t){return t>1048576?t=flt(flt(t)/1048576,1)+"M":t>1024&&(t=flt(flt(t)/1024,1)+"K"),t},TableMultiSelect:function(t,e,i){t=t||[];var s=frappe.get_meta(e.options).fields.find(function(t){return"Link"===t.fieldtype});return t.map(function(t){var e=t[s.fieldname];return frappe.format(e,s,i,t)}).join(", ")},Color:function(t){return t?'<div>\n\t\t\t<div class="selected-color" style="background-color: '+t+'"></div>\n\t\t\t<span class="color-value">'+t+"</span>\n\t\t</div>":""},Icon:function(t){return t?'<div>\n\t\t\t<div class="selected-icon">'+frappe.utils.icon(t,"md")+'</div>\n\t\t\t<span class="icon-value">'+t+"</span>\n\t\t</div>":""}},frappe.form.get_formatter=function(t){return t||(t="Data"),frappe.form.formatters[t.replace(/ /g,"")]||frappe.form.formatters.Data},frappe.format=function(t,e,i,s){e||(e={fieldtype:"Data"}),"_user_tags"==e.fieldname&&(e.fieldtype="Tag");var a=e.fieldtype||"Data";"Dynamic Link"===a&&(a="Link",e._options=s?s[e.options]:null);var n=(e.formatter||frappe.form.get_formatter(a))(t,e,i,s);return"string"==typeof n&&(n=frappe.dom.remove_script_and_style(n)),n},frappe.get_format_helper=function(t){var e={get_formatted:function(e){var i=frappe.meta.get_docfield(t.doctype,e);return i||console.log("fieldname not found: "+e),frappe.format(t[e],i,{inline:1},t)}};return $.extend(e,t),e},frappe.form.link_formatters.User=function(t,e,i){return e&&(e.full_name||i&&e[i.fieldname+"_full_name"])||t},function(t){var e=/xyz/.test(function(){})?/\b_super\b/:/.*/;function i(){}i.extend=function(t){var s=this.prototype,a=Object.create(s);for(var n in t)a[n]="function"==typeof t[n]&&"function"==typeof s[n]&&e.test(t[n])?function(t,e){return function(){var i=this._super;this._super=s[t];var a=e.apply(this,arguments);return this._super=i,a}}(n,t[n]):t[n];var r="function"==typeof a.init?a.hasOwnProperty("init")?a.init:function(){s.init.apply(this,arguments)}:function(){};return r.prototype=a,a.constructor=r,r.extend=i.extend,r},t.Class=i}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{}),frappe.ui.form.Layout=Class.extend({init:function(t){this.views={},this.pages=[],this.sections=[],this.fields_list=[],this.fields_dict={},$.extend(this,t)},make:function(){!this.parent&&this.body&&(this.parent=this.body),this.wrapper=$('<div class="form-layout">').appendTo(this.parent),this.message=$('<div class="form-message hidden"></div>').appendTo(this.wrapper),this.fields||(this.fields=this.get_doctype_fields()),this.setup_tabbing(),this.render()},show_empty_form_message:function(){this.wrapper.find(".frappe-control:visible").length||this.wrapper.find(".section-head.collapsed").length||this.show_message(__("This form does not have any input"))},get_doctype_fields:function(){var t=[this.get_new_name_field()];return t=this.doctype_layout?t.concat(this.get_fields_from_layout()):t.concat(frappe.meta.sort_docfields(frappe.meta.docfield_map[this.doctype]))},get_new_name_field:function(){return{parent:this.frm.doctype,fieldtype:"Data",fieldname:"__newname",reqd:1,hidden:1,label:__("Name"),get_status:function(t){return t.frm&&t.frm.is_new()&&t.frm.meta.autoname&&["prompt","name"].includes(t.frm.meta.autoname.toLowerCase())?"Write":"None"}}},get_fields_from_layout:function(){for(var t=[],e=0,i=this.doctype_layout.fields;e<i.length;e+=1){var s=i[e],a=copy_dict(frappe.meta.docfield_map[this.doctype][s.fieldname]);a.label=s.label,t.push(a)}return t},show_message:function(t,e){this.message_color&&this.message.removeClass(this.message_color),this.message_color=e&&["yellow","blue"].includes(e)?e:"blue",t?("<"!==t.substr(0,1)&&(t="<div>"+t+"</div>"),this.message.removeClass("hidden").addClass(this.message_color),$(t).appendTo(this.message)):this.message.empty().addClass("hidden")},render:function(t){var e=this,i=t||this.fields;this.section=null,this.column=null,this.with_dashboard&&this.setup_dashboard_section(),this.no_opening_section()&&this.make_section(),$.each(i,function(t,i){switch(i.fieldtype){case"Fold":e.make_page(i);break;case"Section Break":e.make_section(i);break;case"Column Break":e.make_column(i);break;default:e.make_field(i)}})},no_opening_section:function(){return this.fields[0]&&"Section Break"!=this.fields[0].fieldtype||!this.fields.length},setup_dashboard_section:function(){this.no_opening_section()&&this.fields.unshift({fieldtype:"Section Break"})},replace_field:function(t,e,i){if(e.fieldname=t,this.fields_dict[t]&&this.fields_dict[t].df){var s=this.init_field(e,i);this.fields_dict[t].$wrapper.remove(),this.fields_list.splice(this.fields_dict[t],1,s),this.fields_dict[t]=s,this.frm&&(s.perm=this.frm.perm),this.section.fields_list.splice(this.section.fields_dict[t],1,s),this.section.fields_dict[t]=s,this.refresh_fields([e])}},make_field:function(t,e,i){!this.section&&this.make_section(),!this.column&&this.make_column();var s=this.init_field(t,i);this.fields_list.push(s),this.fields_dict[t.fieldname]=s,this.frm&&(s.perm=this.frm.perm),this.section.fields_list.push(s),this.section.fields_dict[t.fieldname]=s,s.section=this.section},init_field:function(t,e){void 0===e&&(e=!1);var i=frappe.ui.form.make_control({df:t,doctype:this.doctype,parent:this.column.wrapper.get(0),frm:this.frm,render_input:e,doc:this.doc,layout:this});return i.layout=this,i},make_page:function(t){var e=this,i=$('<div class="form-clickable-section text-center">\t\t\t\t<a class="btn-fold h6 text-muted">'+__("Show more details")+"</a>\t\t\t</div>").appendTo(this.wrapper);this.page=$('<div class="form-page second-page hide"></div>').appendTo(this.wrapper),this.fold_btn=i.find(".btn-fold").on("click",function(){var t=$(this).parent().next();t.hasClass("hide")?($(this).removeClass("btn-fold").html(__("Hide details")),t.removeClass("hide"),frappe.utils.scroll_to($(this),!0,30),e.folded=!1):($(this).addClass("btn-fold").html(__("Show more details")),t.addClass("hide"),e.folded=!0)}),this.section=null,this.folded=!0},unfold:function(){this.fold_btn.trigger("click")},make_section:function(t){this.section=new frappe.ui.form.Section(this,t),t&&(this.fields_dict[t.fieldname]=this.section,this.fields_list.push(this.section)),this.column=null},make_column:function(t){this.column=new frappe.ui.form.Column(this.section,t),t&&t.fieldname&&this.fields_list.push(this.column)},refresh:function(t){t&&(this.doc=t),this.frm&&this.wrapper.find(".empty-form-alert").remove(),this.attach_doc_and_docfields(!0),this.frm&&this.frm.wrapper&&$(this.frm.wrapper).trigger("refresh-fields"),this.refresh_dependency(),this.refresh_sections(),this.frm&&this.refresh_section_collapse(),document.activeElement&&"INPUT"==document.activeElement.tagName&&this.is_numeric_field_active()&&document.activeElement.select()},is_numeric_field_active:function(){var t=($(document.activeElement).closest(".frappe-control").data()||{}).fieldtype;return frappe.model.numeric_fieldtypes.includes(t)},refresh_sections:function(){this.wrapper.find(".form-section:not(.hide-control)").each(function(){var t=$(this).removeClass("empty-section visible-section");t.find(".frappe-control:not(.hide-control)").length?t.addClass("visible-section"):t.addClass("empty-section")})},refresh_fields:function(t){var e=t.map(function(t){if(t.fieldname)return t.fieldname});this.fields_list.map(function(t){e.includes(t.df.fieldname)&&(t.refresh(),t.df.default&&t.set_input(t.df.default))})},add_fields:function(t){this.render(t),this.refresh_fields(t)},refresh_section_collapse:function(){if(this.sections&&this.sections.length)for(var t=0;t<this.sections.length;t++){var e=this.sections[t],i=e.df;if(i&&i.collapsible){var s=!0;i.collapsible_depends_on&&(s=!this.evaluate_depends_on_value(i.collapsible_depends_on)),s&&e.has_missing_mandatory()&&(s=!1),e.collapse(s)}}},attach_doc_and_docfields:function(t){for(var e=this,i=0,s=this.fields_list.length;i<s;i++){var a=this.fields_list[i];e.doc&&(a.doc=e.doc,a.doctype=e.doc.doctype,a.docname=e.doc.name,a.df=frappe.meta.get_docfield(e.doc.doctype,a.df.fieldname,e.doc.name)||a.df,e.frm&&(a.perm=e.frm.perm)),t&&a.df&&a.refresh&&a.refresh()}},refresh_section_count:function(){this.wrapper.find(".section-count-label:visible").each(function(t){$(this).html(t+1)})},setup_tabbing:function(){var t=this;this.wrapper.on("keydown",function(e){if(9==e.which){var i=$(e.target),s=i.attr("data-doctype"),a=i.attr("data-fieldname");if(s)return t.handle_tab(s,a,e.shiftKey)}})},handle_tab:function(t,e,i){var s=null,a=null,n=this.fields_list,r=!1;if(t!=this.doctype){if(!(s=this.get_open_grid_row())||!s.layout)return;n=s.layout.fields_list}for(var l=0,o=n.length;l<o;l++){if(n[l].df.fieldname==e){if(i){a?this.set_focus(a):$(this.primary_button).focus();break}if(l<o-1&&(r=this.focus_on_next_field(l,n)),r)break}this.is_visible(n[l])&&(a=n[l])}return r||(s?s.doc.idx==s.grid.grid_rows.length?s.toggle_view(!1,function(){s.grid.frm.layout.handle_tab(s.grid.df.parent,s.grid.df.fieldname)}):s.grid.grid_rows[s.doc.idx].toggle_view(!0):i||$(this.primary_button).focus()),!1},focus_on_next_field:function(t,e){for(var i=t+1,s=e.length;i<s;i++){var a=e[i];if(this.is_visible(a)){if("Table"===a.df.fieldtype)return a.grid.grid_rows&&a.grid.grid_rows.length||a.grid.add_new_row(),a.grid.grid_rows[0].show_form(),!0;if(!in_list(frappe.model.no_value_type,a.df.fieldtype))return this.set_focus(a),!0}}},is_visible:function(t){return"Write"===t.disp_status&&t.$wrapper&&t.$wrapper.is(":visible")},set_focus:function(t){"Table"==t.df.fieldtype?t.grid.grid_rows.length?t.grid.grid_rows[0].toggle_view(!0):t.grid.add_new_row(1):t.editor?t.editor.set_focus():t.$input&&t.$input.focus()},get_open_grid_row:function(){return $(".grid-row-open").data("grid_row")},refresh_dependency:function(){var t=!1;for(var e in this.fields_list){(s=this.fields_list[e]).dependencies_clear=!0,(s.df.depends_on||s.df.mandatory_depends_on||s.df.read_only_depends_on)&&(t=!0)}if(t){for(var i=this.fields_list.length-1;i>=0;i--){var s;(s=this.fields_list[i]).guardian_has_value=!0,s.df.depends_on&&(s.guardian_has_value=this.evaluate_depends_on_value(s.df.depends_on),s.guardian_has_value?s.df.hidden_due_to_dependency&&(s.df.hidden_due_to_dependency=!1,s.refresh()):s.df.hidden_due_to_dependency||(s.df.hidden_due_to_dependency=!0,s.refresh())),s.df.mandatory_depends_on&&this.set_dependant_property(s.df.mandatory_depends_on,s.df.fieldname,"reqd"),s.df.read_only_depends_on&&this.set_dependant_property(s.df.read_only_depends_on,s.df.fieldname,"read_only")}this.refresh_section_count()}},set_dependant_property:function(t,e,i){var s,a=this.evaluate_depends_on_value(t)?1:0;this.frm?s=this.frm:(this.is_dialog||"Web Form"===this.doctype)&&(s=this),s&&(this.doc&&this.doc.parent&&this.doc.parentfield?(s.setting_dependency=!0,s.set_df_property(this.doc.parentfield,i,a,this.doc.parent,e,this.doc.name),s.setting_dependency=!1,this.fields_dict[e]&&this.fields_dict[e].refresh()):s.set_df_property(e,i,a))},evaluate_depends_on_value:function(t){var e=null;if(!(i=this.doc)&&this.get_values)var i=this.get_values(!0);if(i){var s=this.frm?this.frm.doc:this.doc||null;if("boolean"==typeof t)e=t;else if("function"==typeof t)e=t(i);else if("eval:"==t.substr(0,5))try{e=frappe.utils.eval(t.substr(5),{doc:i,parent:s}),s&&s.istable&&t.includes("is_submittable")&&(e=!0)}catch(t){frappe.throw(__('Invalid "depends_on" expression'))}else if("fn:"==t.substr(0,3)&&this.frm)e=this.frm.script_manager.trigger(t.substr(3),this.doctype,this.docname);else{var a=i[t];e=$.isArray(a)?!!a.length:!!a}return e}}}),frappe.ui.form.Section=Class.extend({init:function(t,e){this.layout=t,this.df=e||{},this.fields_list=[],this.fields_dict={},this.make(),this.row={wrapper:this.wrapper},this.refresh()},make:function(){this.layout.page||(this.layout.page=$('<div class="form-page"></div>').appendTo(this.layout.wrapper));var t=this.layout.card_layout;this.wrapper=$('<div class="row form-section '+(t?"card-section":"")+'">').appendTo(this.layout.page),this.layout.sections.push(this),this.df&&(this.df.label&&this.make_head(),this.df.description&&$('<div class="col-sm-12 small text-muted form-section-description">'+__(this.df.description)+"</div>").appendTo(this.wrapper),this.df.cssClass&&this.wrapper.addClass(this.df.cssClass),this.df.hide_border&&this.wrapper.toggleClass("hide-border",!0)),this.body=$('<div class="section-body">').appendTo(this.wrapper)},make_head:function(){var t=this;this.head=$('<div class="section-head">\n\t\t\t'+__(this.df.label)+'\n\t\t\t<span class="ml-2 collapse-indicator mb-1">\n\t\t\t</span>\n\t\t</div>'),this.head.appendTo(this.wrapper),this.indicator=this.head.find(".collapse-indicator"),this.indicator.hide(),this.df.collapsible&&(this.collapse_link=this.head.on("click",function(){t.collapse()}),this.indicator.show())},refresh:function(){if(this.df){var t=this.df.hidden||this.df.hidden_due_to_dependency;!t&&this.layout&&this.layout.frm&&!this.layout.frm.get_perm(this.df.permlevel||0,"read")&&(t=!0),this.wrapper.toggleClass("hide-control",!!t)}},collapse:function(t){if(this.head&&this.body){void 0===t&&(t=!this.body.hasClass("hide")),this.body.toggleClass("hide",t),this.head.toggleClass("collapsed",t);var e=t?"down":"up-line";this.indicator,this.indicator.html(frappe.utils.icon(e,"sm","mb-1")),this.fields_list.forEach(function(t){"Signature"==t.df.fieldtype&&t.refresh()})}},is_collapsed:function(){return this.body.hasClass("hide")},has_missing_mandatory:function(){for(var t=!1,e=0,i=this.fields_list.length;e<i;e++){var s=this.fields_list[e].df;if(s.reqd&&null==this.layout.doc[s.fieldname]){t=!0;break}}return t}}),frappe.ui.form.Column=Class.extend({init:function(t,e){e||(e={}),this.df=e,this.section=t,this.make(),this.resize_all_columns()},make:function(){this.wrapper=$('<div class="form-column">\t\t\t<form>\t\t\t</form>\t\t</div>').appendTo(this.section.body).find("form").on("submit",function(){return!1}),this.df.label&&$('<label class="control-label">'+__(this.df.label)+"</label>").appendTo(this.wrapper)},resize_all_columns:function(){var t=cint(12/this.section.wrapper.find(".form-column").length);this.section.wrapper.find(".form-column").removeClass().addClass("form-column").addClass("col-sm-"+t)},refresh:function(){this.section.refresh()}}),frappe.provide("frappe.ui"),frappe.ui.FieldGroup=frappe.ui.form.Layout.extend({init:function(t){$.extend(this,t),this.dirty=!1,this._super(),$.each(this.fields||[],function(t,e){!e.fieldname&&e.label&&(e.fieldname=e.label.replace(/ /g,"_").toLowerCase())}),this.values&&this.set_values(this.values)},make:function(){var t=this,e=this;this.fields&&(this._super(),this.refresh(),$.each(this.fields_list,function(t,i){if(i.df.default){var s=i.df.default;"Today"==s&&"Date"==i.df.fieldtype&&(s=frappe.datetime.get_today()),i.set_input(s),e.refresh_dependency()}}),this.no_submit_on_enter||this.catch_enter_as_submit(),$(this.wrapper).find("input, select").on("change awesomplete-selectcomplete",function(){t.dirty=!0,frappe.run_serially([function(){return frappe.timeout(.1)},function(){return e.refresh_dependency()}])}))},first_button:!1,focus_on_first_input:function(){this.no_focus||$.each(this.fields_list,function(t,e){if(!in_list(["Date","Datetime","Time","Check"],e.df.fieldtype)&&e.set_focus)return e.set_focus(),!1})},catch_enter_as_submit:function(){var t=this;$(this.body).find('input[type="text"], input[type="password"], select').keypress(function(e){13==e.which&&t.has_primary_action&&(e.preventDefault(),t.get_primary_btn().trigger("click"))})},get_input:function(t){var e=this.fields_dict[t];return $(e.txt?e.txt:e.input)},get_field:function(t){return this.fields_dict[t]},get_values:function(t){var e={},i=[];for(var s in this.fields_dict){var a=this.fields_dict[s];if(a.get_value){var n=a.get_value();a.df.reqd&&is_null("string"==typeof n?strip_html(n):n)&&i.push(__(a.df.label)),a.df.reqd&&"Text Editor"===a.df.fieldtype&&is_null(strip_html(cstr(n)))&&i.push(__(a.df.label)),is_null(n)||(e[a.df.fieldname]=n)}}return i.length&&!t?(frappe.msgprint({title:__("Missing Values Required"),message:__("Following fields have missing values:")+"<br><br><ul><li>"+i.join("<li>")+"</ul>",indicator:"orange"}),null):e},get_value:function(t){var e=this.fields_dict[t];return e&&(e.get_value?e.get_value():null)},set_value:function(t,e){var i=this;return new Promise(function(s){var a=i.fields_dict[t];a?a.set_value(e).then(function(){a.set_input(e),i.refresh_dependency(),s()}):s()})},set_input:function(t,e){return this.set_value(t,e)},set_values:function(t){var e=[];for(var i in t)this.fields_dict[i]&&e.push(this.set_value(i,t[i]));return Promise.all(e)},clear:function(){for(var t in this.fields_dict){var e=this.fields_dict[t];e&&e.set_input&&e.set_input(e.df.default||"")}},set_df_property:function(t,e,i){var s=this.get_field(t);s.df[e]=i,s.refresh()}}),frappe.ui.form.LinkSelector=Class.extend({init:function(t){$.extend(this,t);var e=this;"[Select]"!=this.doctype?frappe.model.with_doctype(this.doctype,function(t){e.make()}):this.make()},make:function(){var t=this;this.start=0,this.dialog=new frappe.ui.Dialog({title:__("Select {0}",["[Select]"==this.doctype?__("value"):__(this.doctype)]),fields:[{fieldtype:"Data",fieldname:"txt",label:__("Beginning with"),description:__("You can use wildcard %")},{fieldtype:"HTML",fieldname:"results"},{fieldtype:"Button",fieldname:"more",label:__("More"),click:function(){t.start+=20,t.search()}}],primary_action_label:__("Search"),primary_action:function(){t.start=0,t.search()}}),this.txt&&this.dialog.fields_dict.txt.set_input(this.txt),this.dialog.get_input("txt").on("keypress",function(e){13===e.which&&(t.start=0,t.search())}),this.dialog.show(),this.search()},search:function(){var t={txt:this.dialog.fields_dict.txt.get_value(),searchfield:"name",start:this.start},e=this;this.target.set_custom_query&&this.target.set_custom_query(t),this.target.is_grid&&this.target.fieldinfo[this.fieldname]&&this.target.fieldinfo[this.fieldname].get_query&&$.extend(t,this.target.fieldinfo[this.fieldname].get_query(cur_frm.doc)),frappe.link_search(this.doctype,t,function(i){var s=e.dialog.fields_dict.results.$wrapper;(0===t.start&&s.empty(),i.values.length?$.each(i.values,function(t,i){$(repl('<div class="row link-select-row">\t\t\t\t\t\t<div class="col-xs-4">\t\t\t\t\t\t\t<b><a href="#">%(name)s</a></b></div>\t\t\t\t\t\t<div class="col-xs-8">\t\t\t\t\t\t\t<span class="text-muted">%(values)s</span></div>\t\t\t\t\t\t</div>',{name:i[0],values:i.splice(1).join(", ")})).appendTo(s).find("a").attr("data-value",i[0]).click(function(){var t=$(this).attr("data-value");return e.target.is_grid?e.set_in_grid(t):(e.target.doctype?e.target.parse_validate_and_set_in_model(t):(e.target.set_input(t),e.target.$input.trigger("change")),e.dialog.hide()),!1})}):$('<p><br><span class="text-muted">'+__("No Results")+"</span>"+(frappe.model.can_create(e.doctype)?'<br><br><a class="new-doc btn btn-default btn-sm">'+__("Create a new {0}",[__(e.doctype)])+"</a>":"")+"</p>").appendTo(s).find(".new-doc").click(function(){frappe.new_doc(e.doctype)}),i.values.length<20)&&e.dialog.fields_dict.more.$wrapper.hide()},this.dialog.get_primary_btn())},set_in_grid:function(t){var e=this,i=!1,s=null;if(this.qty_fieldname)frappe.prompt({fieldname:"qty",fieldtype:"Float",label:"Qty",default:1,reqd:1},function(a){$.each(e.target.frm.doc[e.target.df.fieldname]||[],function(s,n){if(n[e.fieldname]===t)return frappe.model.set_value(n.doctype,n.name,e.qty_fieldname,a.qty),frappe.show_alert(__("Added {0} ({1})",[t,n[e.qty_fieldname]])),i=!0,!1}),i||frappe.run_serially([function(){s=e.target.add_new_row()},function(){return frappe.timeout(.1)},function(){var i={};return i[e.fieldname]=t,i[e.qty_fieldname]=a.qty,frappe.model.set_value(s.doctype,s.name,i)},function(){return frappe.show_alert(__("Added {0} ({1})",[t,a.qty]))}])},__("Set Quantity"),__("Set"));else if(e.dynamic_link_field){s=e.target.add_new_row();frappe.model.set_value(s.doctype,s.name,e.dynamic_link_field,e.dynamic_link_reference),frappe.model.set_value(s.doctype,s.name,e.fieldname,t),frappe.show_alert(__("{0} {1} added",[e.dynamic_link_reference,t]))}else{s=e.target.add_new_row();frappe.model.set_value(s.doctype,s.name,e.fieldname,t),frappe.show_alert(__("{0} added",[t]))}}}),frappe.link_search=function(t,e,i,s){e||(e={txt:""}),e.doctype=t,e.searchfield||(e.searchfield="name"),frappe.call({method:"frappe.desk.search.search_widget",type:"GET",args:e,callback:function(t){i&&i(t)},btn:s})},frappe.ui.form.MultiSelectDialog=class{constructor(t){var e=this;Object.assign(this,t),this.for_select="[Select]"==this.doctype,this.for_select?this.init():frappe.model.with_doctype(this.doctype,function(){return e.init()})}init(){this.page_length=20,this.child_page_length=20,this.fields=this.get_fields(),this.make()}get_fields(){var t=this.get_primary_filters(),e=this.get_result_fields(),i=this.get_data_fields(),s=this.get_child_selection_fields();return t.concat(e,i,s)}get_result_fields(){var t=this;return[{fieldtype:"HTML",fieldname:"results_area"},{fieldtype:"Button",fieldname:"more_btn",label:__("More"),click:function(){t.page_length+=20,t.get_results()}.bind(this)}]}get_data_fields(){return this.data_fields&&this.data_fields.length?[{fieldtype:"Section Break"}].concat(this.data_fields):[]}get_child_selection_fields(){var t=this,e=[];if(this.allow_child_item_selection&&this.child_fieldname){e.push({fieldtype:"HTML",fieldname:"child_selection_area"}),e.push({fieldtype:"Button",fieldname:"more_child_btn",hidden:1,label:__("More"),click:function(){t.child_page_length+=20,t.show_child_results()}.bind(this)})}return e}make(){var t=this,e=this.doctype.plural(),i=__("Select {0}",[this.for_select?__("value"):__(e)]);this.dialog=new frappe.ui.Dialog({title:i,fields:this.fields,size:this.size,primary_action_label:this.primary_action_label||__("Get Items"),secondary_action_label:__("Make {0}",[__(this.doctype)]),primary_action:function(){var e=t.get_custom_filters(),i=cur_dialog.get_values(),s=t.get_selected_child_names(),a=t.get_checked_values().concat(t.get_parent_name_of_selected_children());t.action(a,Object.assign({},t.args,i,e,{filtered_children:s}))},secondary_action:this.make_new_document.bind(this)}),this.add_filters_group&&this.make_filter_area(),this.args={},this.setup_results(),this.bind_events(),this.get_results(),this.dialog.show()}make_new_document(t){t&&(this.set_route_options(),frappe.new_doc(this.doctype,!0))}set_route_options(){var t=this;if(frappe.route_options={},Array.isArray(this.setters))for(var e=0,i=this.setters;e<i.length;e+=1){var s=i[e];frappe.route_options[s.fieldname]=this.dialog.fields_dict[s.fieldname].get_value()||void 0}else Object.keys(this.setters).forEach(function(e){frappe.route_options[e]=t.dialog.fields_dict[e].get_value()||void 0})}setup_results(){this.$parent=$(this.dialog.body),this.$wrapper=this.dialog.fields_dict.results_area.$wrapper.append('<div class="results my-3"\n\t\t\tstyle="border: 1px solid #d1d8dd; border-radius: 3px; height: 300px; overflow: auto;"></div>'),this.$results=this.$wrapper.find(".results"),this.$results.append(this.make_list_row())}show_child_results(){var t=this;this.get_child_result().then(function(e){t.child_results=e.message||[],t.render_child_datatable(),t.$wrapper.addClass("hidden"),t.$child_wrapper.removeClass("hidden"),t.dialog.fields_dict.more_btn.$wrapper.hide()})}toggle_child_selection(){this.dialog.fields_dict.allow_child_item_selection.get_value()?this.show_child_results():(this.child_results=[],this.get_results(),this.$wrapper.removeClass("hidden"),this.$child_wrapper.addClass("hidden"))}render_child_datatable(){var t=this;this.child_datatable?setTimeout(function(){t.child_datatable.rowmanager.checkMap=[],t.child_datatable.refresh(t.get_child_datatable_rows()),t.$child_wrapper.find(".dt-scrollable").css("height","300px"),t.$child_wrapper.find(".dt-scrollable").css("overflow-y","scroll")},500):this.setup_child_datatable()}get_child_datatable_columns(){return[this.doctype].concat(this.child_columns).map(function(t){return{name:frappe.unscrub(t),editable:!1}})}get_child_datatable_rows(){return this.child_results.length>this.child_page_length?this.dialog.fields_dict.more_child_btn.toggle(!0):this.dialog.fields_dict.more_child_btn.toggle(!1),this.child_results.slice(0,this.child_page_length).map(function(t){return Object.values(t).slice(1)})}setup_child_datatable(){var t=this.get_child_datatable_columns(),e=this.get_child_datatable_rows();this.$child_wrapper=this.dialog.fields_dict.child_selection_area.$wrapper,this.$child_wrapper.addClass("my-3"),this.child_datatable=new frappe.DataTable(this.$child_wrapper.get(0),{columns:t,data:e,layout:"fluid",inlineFilters:!0,serialNoColumn:!1,checkboxColumn:!0,cellHeight:35,noDataMessage:__("No Data"),disableReorderColumn:!0}),this.$child_wrapper.find(".dt-scrollable").css("height","300px")}get_primary_filters(){var t=this,e=[],i=new Array(3);return i[0]=[{fieldtype:"Data",label:__("Name"),fieldname:"search_term"}],i[1]=[],i[2]=[],$.isArray(this.setters)?this.setters.forEach(function(t,e){i[(e+1)%3].push(t)}):Object.keys(this.setters).forEach(function(e,s){var a=frappe.meta.docfield_map[t.doctype][e];i[(s+1)%3].push({fieldtype:a.fieldtype,label:a.label,fieldname:e,options:a.options,default:t.setters[e]})}),Object.seal&&Object.seal(i),this.allow_child_item_selection&&(this.child_doctype=frappe.meta.get_docfield(this.doctype,this.child_fieldname).options,i[0].push({fieldtype:"Check",label:__("Select {0}",[this.child_doctype]),fieldname:"allow_child_item_selection",onchange:this.toggle_child_selection.bind(this)})),e=i[0].concat([{fieldtype:"Column Break"}],i[1],[{fieldtype:"Column Break"}],i[2],[{fieldtype:"Section Break",fieldname:"primary_filters_sb"}]),this.add_filters_group&&e.push({fieldtype:"HTML",fieldname:"filter_area"}),e}make_filter_area(){var t=this;this.filter_group=new frappe.ui.FilterGroup({parent:this.dialog.get_field("filter_area").$wrapper,doctype:this.doctype,on_change:function(){t.get_results()}}),this.filter_group.wrapper.find(".apply-filters").hide()}get_custom_filters(){return this.add_filters_group&&this.filter_group?this.filter_group.get_filters().reduce(function(t,e){var i;return Object.assign(t,((i={})[e[1]]=[e[2],e[3]],i))},{}):{}}bind_events(){var t=this,e=this;this.$results.on("click",".list-item-container",function(t){$(t.target).is(":checkbox")||$(t.target).is("a")||$(this).find(":checkbox").trigger("click")}),this.$results.on("click",".list-item--head :checkbox",function(e){t.$results.find(".list-item-container .list-row-check").prop("checked",$(e.target).is(":checked"))}),this.$parent.find(".input-with-feedback").on("change",function(){frappe.flags.auto_scroll=!1,t.get_results()}),this.$parent.find('[data-fieldtype="Data"]').on("input",function(){var i=$(t);clearTimeout(i.data("timeout")),i.data("timeout",setTimeout(function(){frappe.flags.auto_scroll=!1,e.empty_list(),e.get_results()},300))})}get_parent_name_of_selected_children(){var t=this;return this.child_datatable&&this.child_datatable.datamanager.rows.length?this.child_datatable.rowmanager.checkMap.reduce(function(e,i,s){if(1==i){var a=t.child_results[s].parent;e.includes(a)||e.push(a)}return e},[]):[]}get_selected_child_names(){var t=this;return this.child_datatable&&this.child_datatable.datamanager.rows.length?this.child_datatable.rowmanager.checkMap.reduce(function(e,i,s){if(1==i){var a=t.child_results[s].name;e.push(a)}return e},[]):[]}get_checked_values(){return this.$results.find(".list-item-container").map(function(){if($(this).find(".list-row-check:checkbox:checked").length>0)return $(this).attr("data-item-name")}).get()}get_checked_items(){var t=this.get_checked_values();return this.results.filter(function(e){return t.includes(e.name)})}make_list_row(t){void 0===t&&(t={});var e=this,i=0===Object.keys(t).length,s="",a=["name"];if($.isArray(this.setters))for(var n=0,r=this.setters;n<r.length;n+=1){var l=r[n];a.push(l.fieldname)}else a=a.concat(Object.keys(this.setters));a.forEach(function(a){s+='<div class="list-item__content ellipsis">\n\t\t\t\t'+(i?'<span class="ellipsis text-muted" title="'+__(frappe.model.unscrub(a))+'">'+__(frappe.model.unscrub(a))+"</span>":"name"!==a?'<span class="ellipsis result-row" title="'+__(t[a]||"")+'">'+__(t[a]||"")+"</span>":'<a href="'+("/app/"+frappe.router.slug(e.doctype)+"/"+t[a]||"")+'" class="list-id ellipsis" title="'+__(t[a]||"")+'">\n\t\t\t\t\t\t\t'+__(t[a]||"")+"</a>")+"\n\t\t\t</div>"});var o=$('<div class="list-item">\n\t\t\t<div class="list-item__content" style="flex: 0 0 10px;">\n\t\t\t\t<input type="checkbox" class="list-row-check" data-item-name="'+t.name+'" '+(t.checked?"checked":"")+">\n\t\t\t</div>\n\t\t\t"+s+"\n\t\t</div>");return i?o.addClass("list-item--head"):o=$('<div class="list-item-container" data-item-name="'+t.name+'"></div>').append(o),o}render_result_list(t,e,i){void 0===e&&(e=0),void 0===i&&(i=!0);var s=this,a=s.dialog.fields_dict.more_btn.$wrapper;if(!frappe.flags.auto_scroll&&i&&this.empty_list(),a.hide(),$(".modal-dialog .list-item--head").css("z-index",1),0!==t.length){e&&a.show();var n=this.get_checked_values();t.filter(function(t){return!n.includes(t.name)}).forEach(function(t){s.$results.append(s.make_list_row(t))}),this.$results.find(".list-item--head").css("z-index",1),frappe.flags.auto_scroll&&this.$results.animate({scrollTop:s.$results.prop("scrollHeight")},500)}}empty_list(){var t=this.get_checked_items().map(function(t){return Object.assign({},t,{checked:!0})});this.$results.find(".list-item-container").remove(),this.render_result_list(t,0,!1)}get_filters_from_setters(){var t=this,e=this.get_query?this.get_query().filters:{}||{},i=[];if($.isArray(this.setters))for(var s=0,a=this.setters;s<a.length;s+=1){var n=a[s];e[n.fieldname]=t.dialog.fields_dict[n.fieldname].get_value()||void 0,t.args[n.fieldname]=e[n.fieldname],i.push(n.fieldname)}else Object.keys(this.setters).forEach(function(s){var a=t.dialog.fields_dict[s].get_value();"Data"==t.dialog.fields_dict[s].df.fieldtype&&a?e[s]=["like","%"+a+"%"]:(e[s]=a||void 0,t.args[s]=e[s],i.push(s))});return[e,i]}get_args_for_search(){var t=this.get_filters_from_setters(),e=t[0],i=t[1],s=this.get_custom_filters();return Object.assign(e,s),{doctype:this.doctype,txt:this.dialog.fields_dict.search_term.get_value(),filters:e,filter_fields:i,page_length:this.page_length+5,query:this.get_query?this.get_query().query:"",as_dict:1}}async perform_search(t){var e=await frappe.call({type:"GET",method:"frappe.desk.search.search_widget",no_spinner:!0,args:t});return[e,e.values.length&&e.values.length>this.page_length?1:0]}async get_results(){var t=this,e=this.get_args_for_search(),i=await this.perform_search(e),s=i[0],a=i[1];a&&(s.values=s.values.splice(0,this.page_length)),this.results=[],s.values.length&&s.values.forEach(function(e){e.checked=0,t.results.push(e)}),this.render_result_list(this.results,a)}async get_filtered_parents_for_child_search(){var t=this.get_args_for_search();t.filter_fields=["name"];var e=await this.perform_search(t),i=e[0],s=(e[1],[]);return i.values.length&&(s=i.values.map(function(t){return t.name})),s}async add_parent_filters(t){var e=await this.get_filtered_parents_for_child_search();e.length&&t.push(["parent","in",e])}add_custom_child_filters(t){var e=this;this.add_filters_group&&this.filter_group&&this.filter_group.get_filters().forEach(function(i){i[0]==e.child_doctype&&t.push([i[1],i[2],i[3]])})}async get_child_result(){var t=[["parentfield","=",this.child_fieldname]];return await this.add_parent_filters(t),this.add_custom_child_filters(t),frappe.call({method:"frappe.client.get_list",args:{doctype:this.child_doctype,filters:t,fields:["name","parent"].concat(this.child_columns),parent:this.doctype,limit_page_length:this.child_page_length+5,order_by:"parent"}})}},frappe.provide("frappe.ui"),window.cur_dialog=null,frappe.ui.open_dialogs=[],frappe.ui.Dialog=class extends frappe.ui.FieldGroup{constructor(t){super(),this.display=!1,this.is_dialog=!0,$.extend(this,{animate:!0,size:null},t),this.make()}make(){var t=this;this.$wrapper=frappe.get_modal("",""),this.static&&(this.$wrapper.modal({backdrop:"static",keyboard:!1}),this.get_close_btn().hide()),this.wrapper=this.$wrapper.find(".modal-dialog").get(0),"small"==this.size?$(this.wrapper).addClass("modal-sm"):"large"==this.size?$(this.wrapper).addClass("modal-lg"):"extra-large"==this.size&&$(this.wrapper).addClass("modal-xl"),this.make_head(),this.modal_body=this.$wrapper.find(".modal-body"),this.$body=$("<div></div>").appendTo(this.modal_body),this.body=this.$body.get(0),this.$message=$('<div class="hide modal-message"></div>').appendTo(this.modal_body),this.header=this.$wrapper.find(".modal-header"),this.footer=this.$wrapper.find(".modal-footer"),this.standard_actions=this.footer.find(".standard-actions"),this.custom_actions=this.footer.find(".custom-actions"),this.set_indicator(),super.make(),this.refresh_section_collapse(),this.action=this.action||{primary:{},secondary:{}},(this.primary_action||this.action.primary&&this.action.primary.onsubmit)&&this.set_primary_action(this.primary_action_label||this.action.primary.label||__("Submit"),this.primary_action||this.action.primary.onsubmit),this.secondary_action&&this.set_secondary_action(this.secondary_action),(this.secondary_action_label||this.action.secondary&&this.action.secondary.label)&&this.set_secondary_action_label(this.secondary_action_label||this.action.secondary.label),this.minimizable&&(this.header.find(".title-section").click(function(){return t.is_minimized&&t.toggle_minimize()}),this.get_minimize_btn().removeClass("hide").on("click",function(){return t.toggle_minimize()}));var e=this;this.$wrapper.on("hide.bs.modal",function(){e.display=!1,e.is_minimized=!1,e.hide_scrollbar(!1),frappe.ui.open_dialogs[frappe.ui.open_dialogs.length-1]===e&&(frappe.ui.open_dialogs.pop(),frappe.ui.open_dialogs.length?window.cur_dialog=frappe.ui.open_dialogs[frappe.ui.open_dialogs.length-1]:window.cur_dialog=null),e.onhide&&e.onhide(),e.on_hide&&e.on_hide()}).on("shown.bs.modal",function(){e.display=!0,window.cur_dialog=e,frappe.ui.open_dialogs.push(e),e.focus_on_first_input(),e.hide_scrollbar(!0),e.on_page_show&&e.on_page_show(),$(document).trigger("frappe.ui.Dialog:shown"),$(document).off("focusin.modal")}).on("scroll",function(){var t=$("input:focus");t.length&&["Date","Datetime","Time"].includes(t.attr("data-fieldtype"))&&t.blur()})}get_primary_btn(){return this.standard_actions.find(".btn-primary")}get_minimize_btn(){return this.$wrapper.find(".modal-header .btn-modal-minimize")}set_message(t){this.$message.removeClass("hide"),this.$body.addClass("hide"),this.$message.text(t)}clear_message(){this.$message.addClass("hide"),this.$body.removeClass("hide")}clear(){super.clear(),this.clear_message()}set_primary_action(t,e){this.footer.removeClass("hide"),this.has_primary_action=!0;var i=this;return this.get_primary_btn().removeClass("hide").html(t).click(function(){i.primary_action_fulfilled=!0;var t=i.get_values();t&&e&&e.apply(i,[t])})}set_secondary_action(t){this.footer.removeClass("hide"),this.get_secondary_btn().removeClass("hide").off("click").on("click",t)}set_secondary_action_label(t){this.get_secondary_btn().removeClass("hide").html(t)}disable_primary_action(){this.get_primary_btn().addClass("disabled")}enable_primary_action(){this.get_primary_btn().removeClass("disabled")}make_head(){this.set_title(this.title)}set_title(t){this.$wrapper.find(".modal-title").html(t)}set_indicator(){this.indicator&&this.header.find(".indicator").removeClass().addClass("indicator "+this.indicator)}show(){return this.animate?this.$wrapper.addClass("fade"):this.$wrapper.removeClass("fade"),this.$wrapper.modal("show"),this.$wrapper.removeClass("modal-minimize"),this.minimizable&&this.is_minimized&&($(".modal-backdrop").toggle(),this.is_minimized=!1),this.clear_message(),this.primary_action_fulfilled=!1,this.is_visible=!0,this}hide(){this.$wrapper.modal("hide"),this.is_visible=!1}get_close_btn(){return this.$wrapper.find(".btn-modal-close")}get_secondary_btn(){return this.standard_actions.find(".btn-modal-secondary")}no_cancel(){this.get_close_btn().toggle(!1)}cancel(){this.get_close_btn().trigger("click")}toggle_minimize(){$(".modal-backdrop").toggle();var t=this.$wrapper.closest(".modal").toggleClass("modal-minimize");t.attr("tabindex")?t.removeAttr("tabindex"):t.attr("tabindex",-1),this.is_minimized=!this.is_minimized;var e=this.is_minimized?"expand":"collapse";this.get_minimize_btn().html(frappe.utils.icon(e)),this.on_minimize_toggle&&this.on_minimize_toggle(this.is_minimized),this.header.find(".modal-title").toggleClass("cursor-pointer"),this.hide_scrollbar(!this.is_minimized)}hide_scrollbar(t){$("body").css("overflow",t?"hidden":"auto")}add_custom_action(t,e,i){void 0===i&&(i=null),this.footer.removeClass("hide");var s=$('\n\t\t\t<button class="btn btn-secondary btn-sm '+(i||"")+'">\n\t\t\t\t'+t+"\n\t\t\t</button>\n\t\t");this.custom_actions.append(s),e&&s.click(e)}},frappe.ui.hide_open_dialog=function(){window.cur_dialog&&(cur_dialog.minimizable?cur_dialog.is_minimized||cur_dialog.toggle_minimize():cur_dialog.hide())}}();
//# sourceMappingURL=dialog.min.js.map
